{"task": "Stable_marriage_problem", "blocks": [{"lang": "AutoHotkey", "loc": 89, "block": "<pre class=\"autohotkey highlighted_source\"><span class=\"co1\">; Given a complete list of ranked preferences, where the most liked is to the left: </span><br/>abe <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><br/>bob <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><br/>col <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span><br/>dan <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span><br/>ed <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><br/>fred <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><br/>gav <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><br/>hal <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"br0\">]</span><br/>ian <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"br0\">]</span><br/>jon <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"br0\">]</span><br/>abi <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><br/>bea <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><br/>cath <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span><br/>dee <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"br0\">]</span><br/>eve <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"br0\">]</span><br/>fay <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><br/>gay <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"br0\">]</span><br/>hope <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"br0\">]</span><br/>ivy <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><br/>jan <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"co1\">; of ten males:</span><br/>males <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"co1\">; and ten females:</span><br/>females <span class=\"sy0\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"co1\">; and an empty set of engagements:</span><br/>engagements <span class=\"sy0\">:=</span> Object<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>freemales <span class=\"sy0\">:=</span> males<span class=\"sy0\">.</span>Clone<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"sy0\">,</span>s <span class=\"sy0\">:=</span> <span class=\"st0\">\"Engagements:`n\"</span><br/>\u00a0<br/><span class=\"co1\">; use the Gale Shapley algorithm to find a stable set of engagements:</span><br/>For i<span class=\"sy0\">,</span> male in freemales <span class=\"co1\">; i=index of male (not needed)</span><br/><span class=\"br0\">{</span><br/>\tj<span class=\"sy0\">:=</span><span class=\"nu0\">1</span> <span class=\"co1\">; index of female</span><br/>\t<span class=\"kw1\">While</span> <span class=\"br0\">(</span>engagements<span class=\"br0\">[</span>female<span class=\"sy0\">:=</span><span class=\"re0\">%male%</span><span class=\"br0\">[</span>j<span class=\"br0\">]</span><span class=\"br0\">]</span>\u00a0!<span class=\"sy0\">=</span> <span class=\"st0\">\"\"</span> <span class=\"kw1\">and</span> index<span class=\"br0\">(</span><span class=\"re0\">%female%</span><span class=\"sy0\">,</span> male<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> index<span class=\"br0\">(</span><span class=\"re0\">%female%</span><span class=\"sy0\">,</span> engagements<span class=\"br0\">[</span>female<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\t\tj<span class=\"sy0\">++</span> <span class=\"co1\">; each male loops through all females in order of his preference until one accepts him</span><br/>\t<span class=\"kw1\">If</span> <span class=\"br0\">(</span>engagements<span class=\"br0\">[</span>female<span class=\"br0\">]</span>\u00a0!<span class=\"sy0\">=</span> <span class=\"st0\">\"\"</span><span class=\"br0\">)</span> <span class=\"co1\">; if she was previously engaged</span><br/>\t\tfreemales<span class=\"sy0\">.</span><span class=\"kw6\">insert</span><span class=\"br0\">(</span>engagements<span class=\"br0\">[</span>female<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"co1\">; her old male goes to the bottom of the list</span><br/>\t\t<span class=\"sy0\">,</span>s <span class=\"sy0\">.=</span> female <span class=\"sy0\">.</span> <span class=\"st0\">\" dumped \"</span> <span class=\"sy0\">.</span> engagements<span class=\"br0\">[</span>female<span class=\"br0\">]</span> <span class=\"sy0\">.</span> <span class=\"st0\">\"`n\"</span><br/>\tengagements<span class=\"br0\">[</span>female<span class=\"br0\">]</span> <span class=\"sy0\">:=</span> male <span class=\"co1\">; the new engagement is registered</span><br/>\t<span class=\"sy0\">,</span>s <span class=\"sy0\">.=</span> female <span class=\"sy0\">.</span> <span class=\"st0\">\" accepted \"</span> <span class=\"sy0\">.</span> male <span class=\"sy0\">.</span> <span class=\"st0\">\"`n\"</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co1\">; summarize results:</span><br/>s <span class=\"sy0\">.=</span> <span class=\"st0\">\"`nCouples:`n\"</span><br/>For female<span class=\"sy0\">,</span> male in engagements<br/>\ts <span class=\"sy0\">.=</span> female <span class=\"sy0\">.</span> <span class=\"st0\">\" is engaged to \"</span> <span class=\"sy0\">.</span> male <span class=\"sy0\">.</span> <span class=\"st0\">\"`n\"</span><br/>s <span class=\"sy0\">.=</span> Stable<span class=\"br0\">(</span>engagements<span class=\"sy0\">,</span> females<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">; then perturb this set of engagements to form an unstable set of engagements then check this new set for stability:</span><br/>s <span class=\"sy0\">.=</span> <span class=\"st0\">\"`nWhat if cath and ivy swap?`n\"</span><br/>engagements<span class=\"br0\">[</span><span class=\"st0\">\"cath\"</span><span class=\"br0\">]</span><span class=\"sy0\">:=</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">,</span> engagements<span class=\"br0\">[</span><span class=\"st0\">\"ivy\"</span><span class=\"br0\">]</span><span class=\"sy0\">:=</span><span class=\"st0\">\"bob\"</span><br/>\u00a0<br/><span class=\"co1\">; summarize results:</span><br/>s <span class=\"sy0\">.=</span> <span class=\"st0\">\"`nCouples:`n\"</span><br/>For female<span class=\"sy0\">,</span> male in engagements<br/>\ts <span class=\"sy0\">.=</span> female <span class=\"sy0\">.</span> <span class=\"st0\">\" is engaged to \"</span> <span class=\"sy0\">.</span> male <span class=\"sy0\">.</span> <span class=\"st0\">\"`n\"</span><br/>s <span class=\"sy0\">.=</span> Stable<span class=\"br0\">(</span>engagements<span class=\"sy0\">,</span> females<span class=\"br0\">)</span><br/>\u00a0<br/><a href=\"http://www.autohotkey.com/docs/commands/MsgBox.htm\"><span class=\"kw3\">Msgbox</span></a>\u00a0% <a href=\"http://www.autohotkey.com/docs/Variables.htm#Clipboard\"><span class=\"kw2\">clipboard</span></a> <span class=\"sy0\">:=</span> s<br/><span class=\"kw1\">Return</span><br/>\u00a0<br/><span class=\"co1\">; Functions:</span><br/>Index<span class=\"br0\">(</span>obj<span class=\"sy0\">,</span> value<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\tFor key<span class=\"sy0\">,</span> val in obj<br/>\t\t<span class=\"kw1\">If</span> <span class=\"br0\">(</span>val <span class=\"sy0\">=</span> value<span class=\"br0\">)</span><br/>\t\t\t<span class=\"kw1\">Return</span><span class=\"sy0\">,</span> key<span class=\"sy0\">,</span> <a href=\"http://www.autohotkey.com/docs/Variables.htm#ErrorLevel\"><span class=\"kw2\">ErrorLevel</span></a> <span class=\"sy0\">:=</span> <span class=\"nu0\">0</span><br/>\t<span class=\"kw1\">Return</span><span class=\"sy0\">,</span> False<span class=\"sy0\">,</span> <a href=\"http://www.autohotkey.com/docs/Variables.htm#ErrorLevel\"><span class=\"kw2\">Errorlevel</span></a> <span class=\"sy0\">:=</span> <span class=\"nu0\">1</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>Stable<span class=\"br0\">(</span>engagements<span class=\"sy0\">,</span> females<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\tFor female<span class=\"sy0\">,</span> male in engagements<br/>\t<span class=\"br0\">{</span><br/>\t\tFor j<span class=\"sy0\">,</span> female2 in females <span class=\"co1\">; j=index of female (not needed)</span><br/>\t\t<span class=\"br0\">{</span><br/>\t\t\t<span class=\"kw1\">If</span> <span class=\"br0\">(</span>index<span class=\"br0\">(</span><span class=\"re0\">%male%</span><span class=\"sy0\">,</span> female<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> index<span class=\"br0\">(</span><span class=\"re0\">%male%</span><span class=\"sy0\">,</span> female2<span class=\"br0\">)</span> <br/>\t\t\t\t<span class=\"kw1\">and</span> index<span class=\"br0\">(</span><span class=\"re0\">%female2%</span><span class=\"sy0\">,</span> male2<span class=\"sy0\">:=</span>engagements<span class=\"br0\">[</span>female2<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> index<span class=\"br0\">(</span><span class=\"re0\">%female2%</span><span class=\"sy0\">,</span> male<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\t\t\t\ts <span class=\"sy0\">.=</span> male <span class=\"sy0\">.</span> <span class=\"st0\">\" is engaged to \"</span> <span class=\"sy0\">.</span> female <span class=\"sy0\">.</span> <span class=\"st0\">\" but would prefer \"</span> <span class=\"sy0\">.</span> female2<br/>\t\t\t\t\t<span class=\"sy0\">.</span> <span class=\"st0\">\" and \"</span> <span class=\"sy0\">.</span> female2 <span class=\"sy0\">.</span> <span class=\"st0\">\" is engaged to \"</span> <span class=\"sy0\">.</span> male2 <span class=\"sy0\">.</span> <span class=\"st0\">\" but would prefer \"</span> <span class=\"sy0\">.</span> male <span class=\"sy0\">.</span> <span class=\"st0\">\"`n\"</span><br/>\t\t<span class=\"br0\">}</span><br/>\t<span class=\"br0\">}</span><br/>\t<span class=\"kw1\">If</span> s<br/>\t\t<span class=\"kw1\">Return</span> <span class=\"st0\">\"`nThese couples are not stable.`n\"</span> <span class=\"sy0\">.</span> s<br/>\t<span class=\"kw1\">Else</span><br/>\t\t<span class=\"kw1\">Return</span> <span class=\"st0\">\"`nThese couples are stable.`n\"</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "Batch File", "loc": 148, "block": "<pre class=\"dos highlighted_source\"><span class=\"co2\">:: Stable Marriage Problem in Rosetta Code</span><br/><span class=\"co2\">:: Batch File Implementation</span><br/>\u00a0<br/><span class=\"sy0\">@</span><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a> off<br/><a href=\"http://www.ss64.com/nt/setlocal.html\"><span class=\"kw3\">setlocal</span></a> enabledelayedexpansion<br/><span class=\"co2\"><br/>:: Initialization (Index Starts in 0)</span><br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"male=abe bob col dan ed fred gav hal ian jon\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"femm=abi bea cath dee eve fay gay hope ivy jan\"<br/>\u00a0<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"abe[]=abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"bob[]=cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"col[]=hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"dan[]=ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"ed[]=jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"fred[]=bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"gav[]=gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"hal[]=abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"ian[]=hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"jon[]=abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope\"<br/>\u00a0<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"abi[]=bob, fred, jon, gav, ian, abe, dan, ed, col, hal\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"bea[]=bob, abe, col, fred, gav, dan, ian, ed, jon, hal\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"cath[]=fred, bob, ed, gav, hal, col, ian, abe, dan, jon\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"dee[]=fred, jon, col, abe, ian, hal, gav, dan, bob, ed\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"eve[]=jon, hal, fred, dan, abe, gav, col, ed, ian, bob\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"fay[]=bob, abe, ed, ian, jon, dan, fred, gav, col, hal\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"gay[]=jon, gav, hal, fred, bob, abe, col, ed, dan, ian\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"hope[]=gav, jon, bob, abe, ian, dan, hal, ed, col, fred\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"ivy[]=ian, col, hal, gav, fred, bob, abe, ed, jon, dan\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"jan[]=ed, hal, gav, abe, bob, jon, col, ian, fred, dan\"<br/><span class=\"co1\"><br/>rem variable notation:</span><br/><span class=\"co1\">rem    &lt;boy&gt;{&lt;index&gt;} = &lt;girl&gt;</span><br/><span class=\"co1\">rem    &lt;boy&gt;[&lt;girl&gt;] = &lt;index&gt;</span><br/><a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%%</span><span class=\"re3\">M</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(%</span><span class=\"re3\">male</span><span class=\"sy0\">%)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>   <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> cnt=0<br/>   <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(!</span><span class=\"re2\">%%<span class=\"re3\">M</span>[]</span><span class=\"sy0\">!)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%%</span><span class=\"re3\">M</span>{<span class=\"sy0\">!</span><span class=\"re2\">cnt</span><span class=\"sy0\">!</span>}=<span class=\"sy0\">%</span><span class=\"sy0\">%</span>.\"<br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%%</span><span class=\"re3\">M</span>[<span class=\"sy0\">%</span><span class=\"sy0\">%</span>.]=<span class=\"sy0\">!</span><span class=\"re2\">cnt</span><span class=\"sy0\">!</span>\"<br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> /a cnt+=1<br/>   <span class=\"sy0\">)</span><br/><span class=\"sy0\">)</span><br/><a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%%</span><span class=\"re3\">F</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(%</span><span class=\"re3\">femm</span><span class=\"sy0\">%)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>   <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> cnt=0<br/>   <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(!</span><span class=\"re2\">%%<span class=\"re3\">F</span>[]</span><span class=\"sy0\">!)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%%</span><span class=\"re3\">F</span>[<span class=\"sy0\">%</span><span class=\"sy0\">%</span>.]=<span class=\"sy0\">!</span><span class=\"re2\">cnt</span><span class=\"sy0\">!</span>\"<br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> /a cnt+=1<br/>   <span class=\"sy0\">)</span><br/><span class=\"sy0\">)</span><br/><span class=\"co2\"><br/>:: The Main Thing</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>HISTORY:<br/><a href=\"http://www.ss64.com/nt/call.html\"><span class=\"kw1\">call</span></a>\u00a0:<span class=\"re0\">stableMatching</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>NEWLYWEDS:<br/><a href=\"http://www.ss64.com/nt/call.html\"><span class=\"kw1\">call</span></a>\u00a0:<span class=\"re0\">display</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span><br/><a href=\"http://www.ss64.com/nt/call.html\"><span class=\"kw1\">call</span></a>\u00a0:<span class=\"re0\">isStable</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>What <a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> ed and hal swapped?<br/><a href=\"http://www.ss64.com/nt/call.html\"><span class=\"kw1\">call</span></a>\u00a0:<span class=\"re0\">swapper</span> ed hal<br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>NEW-NEWLYWEDS:<br/><a href=\"http://www.ss64.com/nt/call.html\"><span class=\"kw1\">call</span></a>\u00a0:<span class=\"re0\">display</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span><br/><a href=\"http://www.ss64.com/nt/call.html\"><span class=\"kw1\">call</span></a>\u00a0:<span class=\"re0\">isStable</span><br/>pause<span class=\"sy0\">&gt;</span><a href=\"http://www.ss64.com/nt/nul.html\"><span class=\"kw4\">nul</span></a><br/><a href=\"http://www.ss64.com/nt/exit.html\"><span class=\"kw1\">exit</span></a> /b 0<br/><span class=\"co2\"><br/>:: The Algorithm</span><br/>:<span class=\"re0\">stableMatching</span><br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"free_men=<span class=\"sy0\">%</span><span class=\"re3\">male</span><span class=\"sy0\">%</span>\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"free_fem=<span class=\"sy0\">%</span><span class=\"re3\">femm</span><span class=\"sy0\">%</span>\"<br/><a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%%</span><span class=\"re3\">M</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(%</span><span class=\"re3\">male</span><span class=\"sy0\">%)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%</span><span class=\"sy0\">%</span>M_tried=0\"<br/>\u00a0<br/>:<span class=\"re0\">match_loop</span><br/><a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> \"<span class=\"sy0\">%</span><span class=\"re3\">free_men</span><span class=\"sy0\">%</span>\"==\"\" <a href=\"http://www.ss64.com/nt/goto.html\"><span class=\"kw1\">goto</span></a>\u00a0:<span class=\"re0\">EOF</span><br/><a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f \"tokens=1* delims= \" <span class=\"sy0\">%%</span><span class=\"re3\">m</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">%</span><span class=\"re3\">free_men</span><span class=\"sy0\">%</span>\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/><span class=\"co1\">   rem get woman not yet proposed to, but if man's tries exceeds the number</span><br/><span class=\"co1\">   rem of women (poor guy), he starts again to his most preferred woman (#0).</span><br/>   <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%%</span><span class=\"re3\">x</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">m_tried</span><span class=\"sy0\">!</span>\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> <a href=\"http://www.ss64.com/nt/not.html\"><span class=\"kw2\">not</span></a> <a href=\"http://www.ss64.com/nt/defined.html\"><span class=\"kw2\">defined</span></a> </span><span class=\"sy0\">%%</span><span class=\"re3\">m</span>{<span class=\"sy0\">%%</span><span class=\"re3\">x</span>} <span class=\"sy0\">(</span><br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%%</span><span class=\"re3\">m_tried=0\" &amp; <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"w=<span class=\"sy0\">!</span><span class=\"sy0\">%%</span><span class=\"re3\">m</span>{0}</span><span class=\"sy0\">!</span>\"<br/>   <span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/else.html\"><span class=\"kw1\">else</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"w=<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">m</span>{<span class=\"sy0\">%%</span><span class=\"re3\">x</span>}</span><span class=\"sy0\">!</span>\" <br/>   <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"m=<span class=\"sy0\">%%</span><span class=\"re3\">m</span>\"<br/>\u00a0<br/>   <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%%</span><span class=\"re3\">x</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"free_fem:<span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span>=\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>      <a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> <a href=\"http://www.ss64.com/nt/not.html\"><span class=\"kw2\">not</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">free_fem</span><span class=\"sy0\">!</span><span class=\"re2\">\"==\"</span><span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">x</span></span><span class=\"sy0\">!</span>\" <span class=\"sy0\">(</span><br/><span class=\"co1\">         rem accept because\u00a0!w! (the woman) is free</span><br/>         <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span><span class=\"re2\">_=</span><span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span>\" <span class=\"sy0\">&amp;</span> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\">_=</span><span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span>\"<br/>         <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"free_men=<span class=\"sy0\">%%</span><span class=\"re3\">n</span>\" <span class=\"sy0\">&amp;</span> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"free_fem=<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">x</span></span><span class=\"sy0\">!</span>\"<br/>         <a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>    <span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\"> ACCEPTED </span><span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span>.<br/>      <span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/else.html\"><span class=\"kw1\">else</span></a> <span class=\"sy0\">(</span><br/><span class=\"co1\">         rem here,\u00a0!w! already has a pair; get his name and rank.</span><br/>         <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span>\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"cur_man=<span class=\"sy0\">!</span><span class=\"re2\">%%._</span><span class=\"sy0\">!</span>\"<br/>         <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\">[</span><span class=\"sy0\">!</span><span class=\"re2\">cur_man</span><span class=\"sy0\">!</span>]\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"rank_cur=<span class=\"sy0\">!</span><span class=\"re2\">%%.</span><span class=\"sy0\">!</span>\"<br/><span class=\"co1\">         rem also, get the rank of current proposing man.</span><br/>         <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\">[</span><span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span>]\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"rank_new=<span class=\"sy0\">!</span><span class=\"re2\">%%.</span><span class=\"sy0\">!</span>\"<br/>\u00a0<br/>         <a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> <span class=\"sy0\">!</span><span class=\"re2\">rank_new</span><span class=\"sy0\">!</span> <a href=\"http://www.ss64.com/nt/lss.html\"><span class=\"kw2\">lss</span></a> <span class=\"sy0\">!</span><span class=\"re2\">rank_cur</span><span class=\"sy0\">!</span> <span class=\"sy0\">(</span><br/><span class=\"co1\">            rem here,\u00a0!w! will leave her pair, and choose\u00a0!m!.</span><br/>            <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"free_men=<span class=\"sy0\">%%</span><span class=\"re3\">n</span> <span class=\"sy0\">!</span><span class=\"re2\">cur_man</span><span class=\"sy0\">!</span>\"<br/>            <a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>    <span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\"> LEFT </span><span class=\"sy0\">!</span><span class=\"re2\">cur_man</span><span class=\"sy0\">!</span>.<br/><span class=\"co1\">            rem pair them up now!</span><br/>            <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span><span class=\"re2\">_=</span><span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span>\" <span class=\"sy0\">&amp;</span> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\">_=</span><span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span>\"<br/>            <a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>    <span class=\"sy0\">!</span><span class=\"re2\">w</span><span class=\"sy0\">!</span><span class=\"re2\"> ACCEPTED </span><span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span>.<br/>         <span class=\"sy0\">)</span><br/>      <span class=\"sy0\">)</span><br/>   <span class=\"sy0\">)</span><br/>   <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> /a \"<span class=\"sy0\">!</span><span class=\"re2\">m</span><span class=\"sy0\">!</span>_tried+=1\"<br/><span class=\"sy0\">)</span><br/><a href=\"http://www.ss64.com/nt/goto.html\"><span class=\"kw1\">goto</span></a>\u00a0:<span class=\"re0\">match_loop</span><br/><span class=\"co2\"><br/>:: Output the Couples</span><br/>:<span class=\"re0\">display</span><br/><a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%%</span><span class=\"re3\">S</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(%</span><span class=\"re3\">femm</span><span class=\"sy0\">%)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a>.    <span class=\"sy0\">%%</span><span class=\"re3\">S</span> and <span class=\"sy0\">!</span><span class=\"re2\">%%S_</span><span class=\"sy0\">!</span>.<br/><a href=\"http://www.ss64.com/nt/goto.html\"><span class=\"kw1\">goto</span></a>\u00a0:<span class=\"re0\">EOF</span><br/><span class=\"co2\"><br/>:: Stability Checking</span><br/>:<span class=\"re0\">isStable</span><br/><a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%%</span><span class=\"re3\">f</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(%</span><span class=\"re3\">femm</span><span class=\"sy0\">%)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>   <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> <span class=\"sy0\">%%</span><span class=\"re3\">g</span> <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(%</span><span class=\"re3\">male</span><span class=\"sy0\">%)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <span class=\"sy0\">(</span><br/>      <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">%%</span><span class=\"re3\">f</span>[<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">f_</span><span class=\"sy0\">!</span>]\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"girl_cur=<span class=\"sy0\">!</span>%%.</span><span class=\"sy0\">!</span>\"<br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"girl_aboy=<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">f</span>[<span class=\"sy0\">%%</span><span class=\"re3\">g</span>]</span><span class=\"sy0\">!</span>\"<br/>      <a href=\"http://www.ss64.com/nt/for.html\"><span class=\"kw1\">for</span></a> /f <span class=\"sy0\">%</span><span class=\"sy0\">%</span>. <a href=\"http://www.ss64.com/nt/in.html\"><span class=\"kw1\">in</span></a> <span class=\"sy0\">(</span>\"<span class=\"sy0\">%%</span><span class=\"re3\">g</span>[<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">g_</span><span class=\"sy0\">!</span>]\"<span class=\"sy0\">)</span> <a href=\"http://www.ss64.com/nt/do.html\"><span class=\"kw1\">do</span></a> <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"boy_cur=<span class=\"sy0\">!</span>%%.</span><span class=\"sy0\">!</span>\"<br/>      <a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"boy_agirl=<span class=\"sy0\">!</span><span class=\"re2\">%%<span class=\"re3\">g</span>[<span class=\"sy0\">%%</span><span class=\"re3\">f</span>]</span><span class=\"sy0\">!</span>\"<br/>\u00a0<br/>      <a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> <span class=\"sy0\">!</span><span class=\"re2\">boy_cur</span><span class=\"sy0\">!</span> <a href=\"http://www.ss64.com/nt/gtr.html\"><span class=\"kw2\">gtr</span></a> <span class=\"sy0\">!</span><span class=\"re2\">boy_agirl</span><span class=\"sy0\">!</span> <span class=\"sy0\">(</span><br/>         <a href=\"http://www.ss64.com/nt/if.html\"><span class=\"kw1\">if</span></a> <span class=\"sy0\">!</span><span class=\"re2\">girl_cur</span><span class=\"sy0\">!</span> <a href=\"http://www.ss64.com/nt/gtr.html\"><span class=\"kw2\">gtr</span></a> <span class=\"sy0\">!</span><span class=\"re2\">girl_aboy</span><span class=\"sy0\">!</span> <span class=\"sy0\">(</span><br/>            <a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>STABILITY = FALSE.<br/>            <a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(%%</span><span class=\"re3\">f</span> and <span class=\"sy0\">%%</span><span class=\"re3\">g</span> would rather be together than their current partners.<br/>            <a href=\"http://www.ss64.com/nt/goto.html\"><span class=\"kw1\">goto</span></a>\u00a0:<span class=\"re0\">EOF</span><br/>         <span class=\"sy0\">)</span><br/>      <span class=\"sy0\">)</span><br/>   <span class=\"sy0\">)</span><br/><span class=\"sy0\">)</span><br/><a href=\"http://www.ss64.com/nt/echo.html\"><span class=\"kw3\">echo</span></a><span class=\"sy0\">(</span>STABILITY = TRUE.<br/><a href=\"http://www.ss64.com/nt/goto.html\"><span class=\"kw1\">goto</span></a>\u00a0:<span class=\"re0\">EOF</span><br/><span class=\"co2\"><br/>:: Swapper</span><br/>:<span class=\"re0\">swapper</span><br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> <span class=\"sy0\">%</span><span class=\"re3\">~1</span>.tmp=<span class=\"sy0\">!</span><span class=\"re2\">%~1_</span><span class=\"sy0\">!</span><br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> <span class=\"sy0\">%</span><span class=\"re3\">~2</span>.tmp=<span class=\"sy0\">!</span><span class=\"re2\">%~2_</span><span class=\"sy0\">!</span><br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%</span><span class=\"re3\">~1_=!%~2.tmp</span><span class=\"sy0\">!</span>\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">%</span><span class=\"re3\">~2_=!%~1.tmp</span><span class=\"sy0\">!</span>\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">%<span class=\"re3\">~1</span>.tmp</span><span class=\"sy0\">!</span>_=<span class=\"sy0\">%</span><span class=\"re3\">~2</span>\"<br/><a href=\"http://www.ss64.com/nt/set.html\"><span class=\"kw3\">set</span></a> \"<span class=\"sy0\">!</span><span class=\"re2\">%<span class=\"re3\">~2</span>.tmp</span><span class=\"sy0\">!</span>_=<span class=\"sy0\">%</span><span class=\"re3\">~1</span>\"<br/><a href=\"http://www.ss64.com/nt/goto.html\"><span class=\"kw1\">goto</span></a>\u00a0:<span class=\"re0\">EOF</span></pre>"}, {"lang": "BBC BASIC", "loc": 68, "block": "<pre class=\"text highlighted_source\">      N = 10<br/>      DIM mname$(N), wname$(N), mpref$(N), wpref$(N), mpartner%(N), wpartner%(N)<br/>      DIM proposed&amp;(N,N)<br/>      mname$() = \"\", \"Abe\",\"Bob\",\"Col\",\"Dan\",\"Ed\",\"Fred\",\"Gav\",\"Hal\",\"Ian\",\"Jon\"<br/>      wname$() = \"\", \"Abi\",\"Bea\",\"Cath\",\"Dee\",\"Eve\",\"Fay\",\"Gay\",\"Hope\",\"Ivy\",\"Jan\"<br/>      mpref$() = \"\", \"AECIJDFBHG\",\"CHADEFBJIG\",\"HEADBFIGCJ\",\"IFDGHEJBCA\",\"JDBCFEAIHG\",\\<br/>      \\              \"BADGEICJHF\",\"GEIBCADHJF\",\"AEHFICJBGD\",\"HCDGBAFIJE\",\"AFJGEBDCIH\"<br/>      wpref$() = \"\", \"BFJGIADECH\",\"BACFGDIEJH\",\"FBEGHCIADJ\",\"FJCAIHGDBE\",\"JHFDAGCEIB\",\\<br/>      \\              \"BAEIJDFGCH\",\"JGHFBACEDI\",\"GJBAIDHECF\",\"ICHGFBAEJD\",\"EHGABJCIFD\"<br/>\u00a0<br/>      REM The Gale-Shapley algorithm:<br/>      REPEAT<br/>        FOR m% = 1 TO N<br/>          REPEAT<br/>            IF mpartner%(m%) EXIT REPEAT<br/>            FOR i% = 1 TO N<br/>              w% = ASCMID$(mpref$(m%),i%) - 64<br/>              IF proposed&amp;(m%,w%) = 0 EXIT FOR<br/>            NEXT i%<br/>            IF i% &gt; N EXIT REPEAT<br/>            proposed&amp;(m%,w%) = 1<br/>            IF wpartner%(w%) = 0 THEN<br/>              mpartner%(m%) = w%\u00a0: REM Get engaged<br/>              wpartner%(w%) = m%<br/>            ELSE<br/>              o% = wpartner%(w%)<br/>              IF INSTR(wpref$(w%), LEFT$(mname$(m%),1)) &lt; \\<br/>              \\  INSTR(wpref$(w%), LEFT$(mname$(o%),1)) THEN<br/>                mpartner%(o%) = 0 \u00a0: REM Split up<br/>                mpartner%(m%) = w%\u00a0: REM Get engaged<br/>                wpartner%(w%) = m%<br/>              ENDIF<br/>            ENDIF<br/>          UNTIL TRUE<br/>        NEXT m%<br/>      UNTIL SUM(mpartner%()) = (N*(N+1))/2<br/>\u00a0<br/>      FOR m% = 1 TO N<br/>        PRINT mname$(m%) \" is engaged to \" wname$(mpartner%(m%))<br/>      NEXT<br/>      PRINT \"Relationships are \";<br/>      IF FNstable PRINT \"stable.\" ELSE PRINT \"unstable.\"<br/>\u00a0<br/>      a% = RND(N)<br/>      REPEAT b% = RND(N)\u00a0: UNTIL b%&lt;&gt;a%<br/>      PRINT '\"Now swapping \" mname$(a%) \"'s and \" mname$(b%) \"'s partners:\"<br/>      SWAP mpartner%(a%), mpartner%(b%)<br/>      PRINT mname$(a%) \" is engaged to \" wname$(mpartner%(a%))<br/>      PRINT mname$(b%) \" is engaged to \" wname$(mpartner%(b%))<br/>      PRINT \"Relationships are \";<br/>      IF FNstable PRINT \"stable.\" ELSE PRINT \"unstable.\"<br/>      END<br/>\u00a0<br/>      DEF FNstable<br/>      LOCAL m%, w%, o%, p%<br/>      FOR m% = 1 TO N<br/>        w% = mpartner%(m%)<br/>        FOR o% = 1 TO N<br/>          p% = wpartner%(o%)<br/>          IF INSTR(mpref$(m%), LEFT$(wname$(o%),1)) &lt; \\<br/>          \\  INSTR(mpref$(m%), LEFT$(wname$(w%),1)) AND \\<br/>          \\  INSTR(wpref$(o%), LEFT$(mname$(m%),1)) &lt; \\<br/>          \\  INSTR(wpref$(o%), LEFT$(mname$(p%),1)) THEN<br/>            = FALSE<br/>          ENDIF<br/>        NEXT o%<br/>      NEXT m%<br/>      = TRUE</pre>"}, {"lang": "Bracmat", "loc": 66, "block": "<pre class=\"text highlighted_source\">(     (abe.abi eve cath ivy jan dee fay bea hope gay)<br/>      (bob.cath hope abi dee eve fay bea jan ivy gay)<br/>      (col.hope eve abi dee bea fay ivy gay cath jan)<br/>      (dan.ivy fay dee gay hope eve jan bea cath abi)<br/>      (ed.jan dee bea cath fay eve abi ivy hope gay)<br/>      (fred.bea abi dee gay eve ivy cath jan hope fay)<br/>      (gav.gay eve ivy bea cath abi dee hope jan fay)<br/>      (hal.abi eve hope fay ivy cath jan bea gay dee)<br/>      (ian.hope cath dee gay bea abi fay ivy jan eve)<br/>      (jon.abi fay jan gay eve bea dee cath ivy hope)<br/> \u00a0:\u00a0?Mplan<br/> \u00a0:\u00a0?M<br/>&amp;     (abi.bob fred jon gav ian abe dan ed col hal)<br/>      (bea.bob abe col fred gav dan ian ed jon hal)<br/>      (cath.fred bob ed gav hal col ian abe dan jon)<br/>      (dee.fred jon col abe ian hal gav dan bob ed)<br/>      (eve.jon hal fred dan abe gav col ed ian bob)<br/>      (fay.bob abe ed ian jon dan fred gav col hal)<br/>      (gay.jon gav hal fred bob abe col ed dan ian)<br/>      (hope.gav jon bob abe ian dan hal ed col fred)<br/>      (ivy.ian col hal gav fred bob abe ed jon dan)<br/>      (jan.ed hal gav abe bob jon col ian fred dan)<br/> \u00a0:\u00a0?W<br/>&amp;\u00a0:?engaged<br/>&amp;   whl<br/>  ' (  \u00a0!Mplan<br/>     \u00a0:  \u00a0?A<br/>          (?m&amp;~(!engaged:? (!m.?)\u00a0?).%?w\u00a0?ws)<br/>          (\u00a0?Z<br/>          &amp; (   (   ~(!engaged:?a (?m`.!w)\u00a0?z)<br/>                  &amp; (!m.!w)\u00a0!engaged<br/>                |  \u00a0!W:? (!w.?\u00a0!m\u00a0?\u00a0!m`\u00a0?)\u00a0?<br/>                  &amp;\u00a0!a (!m.!w)\u00a0!z<br/>                )<br/>             \u00a0:\u00a0?engaged<br/>            | <br/>            )<br/>          &amp;\u00a0!Z\u00a0!A (!m.!ws):?Mplan<br/>          )<br/>    )<br/>&amp; ( unstable<br/>  =   m1 m2 w1 w2<br/>    .  \u00a0!arg<br/>     \u00a0:  \u00a0?<br/>          (?m1.?w1)<br/>         \u00a0?<br/>          (?m2.?w2)<br/>          (\u00a0?<br/>          &amp; (  \u00a0!M:? (!m1.?\u00a0!w2\u00a0?\u00a0!w1\u00a0?)\u00a0?<br/>              &amp;\u00a0!W:? (!w2.?\u00a0!m1\u00a0?\u00a0!m2\u00a0?)\u00a0?<br/>            |  \u00a0!M:? (!m2.?\u00a0!w1\u00a0?\u00a0!w2\u00a0?)\u00a0?<br/>              &amp;\u00a0!W:? (!w1.?\u00a0!m2\u00a0?\u00a0!m1\u00a0?)\u00a0?<br/>            )<br/>          )<br/>  )<br/>&amp; ( unstable$!engaged&amp;out$unstable<br/>  | out$stable<br/>  )<br/>&amp; out$!engaged<br/>&amp;\u00a0!engaged:(?m1.?w1) (?m2.?w2)\u00a0?others<br/>&amp; out$(swap\u00a0!w1 for\u00a0!w2)<br/>&amp; (   unstable$((!m1.!w2) (!m2.!w1)\u00a0!others)<br/>    &amp; out$unstable<br/>  | out$stable<br/>  )<br/>);</pre>"}, {"lang": "C", "loc": 134, "block": "<pre class=\"c highlighted_source\"><span class=\"co2\">#include &lt;stdio.h&gt;</span><br/>\u00a0<br/><span class=\"kw4\">int</span> verbose <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/><span class=\"kw2\">enum</span> <span class=\"br0\">{</span><br/>\tclown <span class=\"sy0\">=</span> <span class=\"sy0\">-</span><span class=\"nu0\">1</span><span class=\"sy0\">,</span><br/>\tabe<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span><br/>\tabi<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span><br/><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/><span class=\"kw4\">const</span> <span class=\"kw4\">char</span> <span class=\"sy0\">*</span>name<span class=\"br0\">[</span><span class=\"br0\">]</span> <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/>\t<span class=\"st0\">\"Abe\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Bob\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Col\"</span><span class=\"sy0\">,</span>  <span class=\"st0\">\"Dan\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Ed\"</span><span class=\"sy0\">,</span>  <span class=\"st0\">\"Fred\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Gav\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Hal\"</span><span class=\"sy0\">,</span>  <span class=\"st0\">\"Ian\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Jon\"</span><span class=\"sy0\">,</span><br/>\t<span class=\"st0\">\"Abi\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Bea\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Cath\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Dee\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Eve\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Fay\"</span><span class=\"sy0\">,</span>  <span class=\"st0\">\"Gay\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Hope\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Ivy\"</span><span class=\"sy0\">,</span> <span class=\"st0\">\"Jan\"</span><br/><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/><span class=\"kw4\">int</span> pref<span class=\"br0\">[</span>jan <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"br0\">[</span>jon <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span> <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/>\t<span class=\"br0\">{</span> abi<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> gay <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> cath<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> gay <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> hope<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> jan <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> ivy<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> abi <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> jan<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> gay <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> bea<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> fay <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> gay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> fay <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> abi<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> dee <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> hope<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> eve <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> abi<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> hope <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\u00a0<br/>\t<span class=\"br0\">{</span> bob<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> hal   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> hal   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> jon   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> fred<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> ed   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> jon<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> bob   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> hal   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> jon<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ian   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> gav<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> fred   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> ian<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> dan   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\t<span class=\"br0\">{</span> ed<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> dan   <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/><span class=\"kw4\">int</span> pairs<span class=\"br0\">[</span>jan <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"sy0\">,</span> proposed<span class=\"br0\">[</span>jan <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw4\">void</span> engage<span class=\"br0\">(</span><span class=\"kw4\">int</span> man<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> woman<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\tpairs<span class=\"br0\">[</span>man<span class=\"br0\">]</span> <span class=\"sy0\">=</span> woman<span class=\"sy0\">;</span><br/>\tpairs<span class=\"br0\">[</span>woman<span class=\"br0\">]</span> <span class=\"sy0\">=</span> man<span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>verbose<span class=\"br0\">)</span> <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"%4s is engaged to\u00a0%4s<span class=\"es1\">\\n</span>\"</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>man<span class=\"br0\">]</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>woman<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">void</span> dump<span class=\"br0\">(</span><span class=\"kw4\">int</span> woman<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> man<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\tpairs<span class=\"br0\">[</span>man<span class=\"br0\">]</span> <span class=\"sy0\">=</span> pairs<span class=\"br0\">[</span>woman<span class=\"br0\">]</span> <span class=\"sy0\">=</span> clown<span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>verbose<span class=\"br0\">)</span> <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"%4s dumps\u00a0%4s<span class=\"es1\">\\n</span>\"</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>woman<span class=\"br0\">]</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>man<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"coMULTI\">/* how high this person ranks that: lower is more preferred */</span><br/><span class=\"kw4\">int</span> rank<span class=\"br0\">(</span><span class=\"kw4\">int</span> this<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> that<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\t<span class=\"kw4\">int</span> i<span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">for</span> <span class=\"br0\">(</span>i <span class=\"sy0\">=</span> abe<span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;=</span> jon <span class=\"sy0\">&amp;&amp;</span> pref<span class=\"br0\">[</span>this<span class=\"br0\">]</span><span class=\"br0\">[</span>i<span class=\"br0\">]</span> <span class=\"sy0\">!=</span> that<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">return</span> i<span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">void</span> propose<span class=\"br0\">(</span><span class=\"kw4\">int</span> man<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> woman<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\t<span class=\"kw4\">int</span> fiance <span class=\"sy0\">=</span> pairs<span class=\"br0\">[</span>woman<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>verbose<span class=\"br0\">)</span> <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"%4s proposes to\u00a0%4s<span class=\"es1\">\\n</span>\"</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>man<span class=\"br0\">]</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>woman<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>fiance <span class=\"sy0\">==</span> clown<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t\tengage<span class=\"br0\">(</span>man<span class=\"sy0\">,</span> woman<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t<span class=\"br0\">}</span> <span class=\"kw1\">else</span> <span class=\"kw1\">if</span> <span class=\"br0\">(</span>rank<span class=\"br0\">(</span>woman<span class=\"sy0\">,</span> man<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> rank<span class=\"br0\">(</span>woman<span class=\"sy0\">,</span> fiance<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t\tdump<span class=\"br0\">(</span>woman<span class=\"sy0\">,</span> fiance<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t\tengage<span class=\"br0\">(</span>man<span class=\"sy0\">,</span> woman<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t<span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">int</span> covet<span class=\"br0\">(</span><span class=\"kw4\">int</span> man1<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> wife2<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>rank<span class=\"br0\">(</span>man1<span class=\"sy0\">,</span> wife2<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> rank<span class=\"br0\">(</span>man1<span class=\"sy0\">,</span> pairs<span class=\"br0\">[</span>man1<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"sy0\">&amp;&amp;</span><br/>\t\t\trank<span class=\"br0\">(</span>wife2<span class=\"sy0\">,</span> man1<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> rank<span class=\"br0\">(</span>wife2<span class=\"sy0\">,</span> pairs<span class=\"br0\">[</span>wife2<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t\t<a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span> <span class=\"st0\">\"   \u00a0%4s (w/\u00a0%4s) and\u00a0%4s (w/\u00a0%4s) prefer each other\"</span><br/>\t\t\t<span class=\"st0\">\" over current pairing.<span class=\"es1\">\\n</span>\"</span><span class=\"sy0\">,</span><br/>\t\t\tname<span class=\"br0\">[</span>man1<span class=\"br0\">]</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>pairs<span class=\"br0\">[</span>man1<span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>wife2<span class=\"br0\">]</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>pairs<span class=\"br0\">[</span>wife2<span class=\"br0\">]</span><span class=\"br0\">]</span><br/>\t\t<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t\t<span class=\"kw1\">return</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br/>\t<span class=\"br0\">}</span><br/>\t<span class=\"kw1\">return</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">int</span> thy_neighbors_wife<span class=\"br0\">(</span><span class=\"kw4\">int</span> man1<span class=\"sy0\">,</span> <span class=\"kw4\">int</span> man2<span class=\"br0\">)</span><br/><span class=\"br0\">{</span>\t<span class=\"coMULTI\">/* +: force checking all pairs; \"||\" would shortcircuit */</span><br/>\t<span class=\"kw1\">return</span> covet<span class=\"br0\">(</span>man1<span class=\"sy0\">,</span> pairs<span class=\"br0\">[</span>man2<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"sy0\">+</span> covet<span class=\"br0\">(</span>man2<span class=\"sy0\">,</span> pairs<span class=\"br0\">[</span>man1<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">int</span> unstable<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\t<span class=\"kw4\">int</span> i<span class=\"sy0\">,</span> j<span class=\"sy0\">,</span> bad <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">for</span> <span class=\"br0\">(</span>i <span class=\"sy0\">=</span> abe<span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> jon<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t\t<span class=\"kw1\">for</span> <span class=\"br0\">(</span>j <span class=\"sy0\">=</span> i <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span> j <span class=\"sy0\">&lt;=</span> jon<span class=\"sy0\">;</span> j<span class=\"sy0\">++</span><span class=\"br0\">)</span><br/>\t\t\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>thy_neighbors_wife<span class=\"br0\">(</span>i<span class=\"sy0\">,</span> j<span class=\"br0\">)</span><span class=\"br0\">)</span> bad <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br/>\t<span class=\"br0\">}</span><br/>\t<span class=\"kw1\">return</span> bad<span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">int</span> main<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>\t<span class=\"kw4\">int</span> i<span class=\"sy0\">,</span> unengaged<span class=\"sy0\">;</span><br/>\t<span class=\"coMULTI\">/* init: everyone marries the clown */</span><br/>\t<span class=\"kw1\">for</span> <span class=\"br0\">(</span>i <span class=\"sy0\">=</span> abe<span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;=</span> jan<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span><br/>\t\tpairs<span class=\"br0\">[</span>i<span class=\"br0\">]</span> <span class=\"sy0\">=</span> proposed<span class=\"br0\">[</span>i<span class=\"br0\">]</span> <span class=\"sy0\">=</span> clown<span class=\"sy0\">;</span><br/>\u00a0<br/>\t<span class=\"coMULTI\">/* rounds */</span><br/>\t<span class=\"kw1\">do</span> <span class=\"br0\">{</span><br/>\t\tunengaged <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/>\t\t<span class=\"kw1\">for</span> <span class=\"br0\">(</span>i <span class=\"sy0\">=</span> abe<span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;=</span> jon<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t\t<span class=\"co1\">//for (i = abi; i &lt;= jan; i++) { /* could let women propose */</span><br/>\t\t\t<span class=\"kw1\">if</span> <span class=\"br0\">(</span>pairs<span class=\"br0\">[</span>i<span class=\"br0\">]</span> <span class=\"sy0\">!=</span> clown<span class=\"br0\">)</span> <span class=\"kw1\">continue</span><span class=\"sy0\">;</span><br/>\t\t\tunengaged <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br/>\t\t\tpropose<span class=\"br0\">(</span>i<span class=\"sy0\">,</span> pref<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"sy0\">++</span>proposed<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t\t<span class=\"br0\">}</span><br/>\t<span class=\"br0\">}</span> <span class=\"kw1\">while</span> <span class=\"br0\">(</span>unengaged<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>\t<a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"Pairing:<span class=\"es1\">\\n</span>\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t<span class=\"kw1\">for</span> <span class=\"br0\">(</span>i <span class=\"sy0\">=</span> abe<span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;=</span> jon<span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span><br/>\t\t<a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\" \u00a0%4s -\u00a0%s<span class=\"es1\">\\n</span>\"</span><span class=\"sy0\">,</span> name<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>\t\t\tpairs<span class=\"br0\">[</span>i<span class=\"br0\">]</span> <span class=\"sy0\">==</span> clown <span class=\"sy0\">?</span> <span class=\"st0\">\"clown\"</span> <span class=\"sy0\">:</span> name<span class=\"br0\">[</span>pairs<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>\t<a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span>unstable<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>\t\t<span class=\"sy0\">?</span> <span class=\"st0\">\"Marriages not stable<span class=\"es1\">\\n</span>\"</span> <span class=\"coMULTI\">/* draw sad face here */</span><br/>\t\t<span class=\"sy0\">:</span> <span class=\"st0\">\"Stable matchup<span class=\"es1\">\\n</span>\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>\t<a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es1\">\\n</span>But if Bob and Fred were to swap:<span class=\"es1\">\\n</span>\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\ti <span class=\"sy0\">=</span> pairs<span class=\"br0\">[</span>bob<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\tengage<span class=\"br0\">(</span>bob<span class=\"sy0\">,</span> pairs<span class=\"br0\">[</span>fred<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\tengage<span class=\"br0\">(</span>fred<span class=\"sy0\">,</span> i<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t<a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span>unstable<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"sy0\">?</span> <span class=\"st0\">\"Marriages not stable<span class=\"es1\">\\n</span>\"</span> <span class=\"sy0\">:</span> <span class=\"st0\">\"Stable matchup<span class=\"es1\">\\n</span>\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>\t<span class=\"kw1\">return</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "C++", "loc": 141, "block": "<pre class=\"cpp highlighted_source\"><span class=\"co2\">#include &lt;algorithm&gt;</span><br/><span class=\"co2\">#include &lt;iostream&gt;</span><br/><span class=\"co2\">#include &lt;map&gt;</span><br/><span class=\"co2\">#include &lt;queue&gt;</span><br/><span class=\"co2\">#include &lt;string&gt;</span><br/><span class=\"co2\">#include &lt;vector&gt;</span><br/><span class=\"kw2\">using</span> <span class=\"kw2\">namespace</span> std<span class=\"sy4\">;</span><br/>\u00a0<br/><span class=\"kw4\">const</span> <span class=\"kw4\">char</span> <span class=\"sy2\">*</span>men_data<span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"nu0\">11</span><span class=\"br0\">]</span> <span class=\"sy1\">=</span> <span class=\"br0\">{</span><br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"abe\"</span>,  <span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"gay\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"bob\"</span>,  <span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"gay\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"col\"</span>,  <span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"jan\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"dan\"</span>,  <span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"abi\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"ed\"</span>,   <span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"gay\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"fay\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"gav\"</span>,  <span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"fay\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"hal\"</span>,  <span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"dee\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"ian\"</span>,  <span class=\"st0\">\"hope\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"eve\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"jon\"</span>,  <span class=\"st0\">\"abi\"</span>,<span class=\"st0\">\"fay\"</span>,<span class=\"st0\">\"jan\"</span>,<span class=\"st0\">\"gay\"</span>,<span class=\"st0\">\"eve\"</span>,<span class=\"st0\">\"bea\"</span>,<span class=\"st0\">\"dee\"</span>,<span class=\"st0\">\"cath\"</span>,<span class=\"st0\">\"ivy\"</span>,<span class=\"st0\">\"hope\"</span> <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><span class=\"sy4\">;</span><br/>\u00a0<br/><span class=\"kw4\">const</span> <span class=\"kw4\">char</span> <span class=\"sy2\">*</span>women_data<span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"nu0\">11</span><span class=\"br0\">]</span> <span class=\"sy1\">=</span> <span class=\"br0\">{</span><br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"abi\"</span>,  <span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"hal\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"bea\"</span>,  <span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"hal\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"jon\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"dee\"</span>,  <span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"ed\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"eve\"</span>,  <span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"bob\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"fay\"</span>,  <span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"hal\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"gay\"</span>,  <span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"ian\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"dan\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"fred\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"ivy\"</span>,  <span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"dan\"</span> <span class=\"br0\">}</span>,<br/>    <span class=\"br0\">{</span> <span class=\"st0\">\"jan\"</span>,  <span class=\"st0\">\"ed\"</span>,<span class=\"st0\">\"hal\"</span>,<span class=\"st0\">\"gav\"</span>,<span class=\"st0\">\"abe\"</span>,<span class=\"st0\">\"bob\"</span>,<span class=\"st0\">\"jon\"</span>,<span class=\"st0\">\"col\"</span>,<span class=\"st0\">\"ian\"</span>,<span class=\"st0\">\"fred\"</span>,<span class=\"st0\">\"dan\"</span> <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><span class=\"sy4\">;</span><br/>\u00a0<br/><span class=\"kw4\">typedef</span> vector<span class=\"sy1\">&lt;</span>string<span class=\"sy1\">&gt;</span> PrefList<span class=\"sy4\">;</span><br/><span class=\"kw4\">typedef</span> map<span class=\"sy1\">&lt;</span>string, PrefList<span class=\"sy1\">&gt;</span> PrefMap<span class=\"sy4\">;</span><br/><span class=\"kw4\">typedef</span> map<span class=\"sy1\">&lt;</span>string, string<span class=\"sy1\">&gt;</span> Couples<span class=\"sy4\">;</span><br/>\u00a0<br/><span class=\"co1\">// Does 'first' appear before 'second' in preference list?</span><br/><span class=\"kw4\">bool</span> prefers<span class=\"br0\">(</span><span class=\"kw4\">const</span> PrefList <span class=\"sy3\">&amp;</span>prefer, <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>first, <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>second<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span>PrefList<span class=\"sy4\">::</span><span class=\"me2\">const_iterator</span> it <span class=\"sy1\">=</span> prefer.<span class=\"me1\">begin</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> it <span class=\"sy3\">!</span><span class=\"sy1\">=</span> prefer.<span class=\"me1\">end</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>it<span class=\"br0\">)</span><br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"sy2\">*</span>it <span class=\"sy1\">==</span> first<span class=\"br0\">)</span> <span class=\"kw1\">return</span> <span class=\"kw2\">true</span><span class=\"sy4\">;</span><br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"sy2\">*</span>it <span class=\"sy1\">==</span> second<span class=\"br0\">)</span> <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy4\">;</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy4\">;</span> <span class=\"co1\">// no preference</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">void</span> check_stability<span class=\"br0\">(</span><span class=\"kw4\">const</span> Couples <span class=\"sy3\">&amp;</span>engaged, <span class=\"kw4\">const</span> PrefMap <span class=\"sy3\">&amp;</span>men_pref, <span class=\"kw4\">const</span> PrefMap <span class=\"sy3\">&amp;</span>women_pref<span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>    <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"Stablility:<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>    <span class=\"kw4\">bool</span> stable <span class=\"sy1\">=</span> <span class=\"kw2\">true</span><span class=\"sy4\">;</span><br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span>Couples<span class=\"sy4\">::</span><span class=\"me2\">const_iterator</span> it <span class=\"sy1\">=</span> engaged.<span class=\"me1\">begin</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> it <span class=\"sy3\">!</span><span class=\"sy1\">=</span> engaged.<span class=\"me1\">end</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>it<span class=\"br0\">)</span><br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>bride <span class=\"sy1\">=</span> it<span class=\"sy2\">-</span><span class=\"sy1\">&gt;</span>first<span class=\"sy4\">;</span><br/>        <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>groom <span class=\"sy1\">=</span> it<span class=\"sy2\">-</span><span class=\"sy1\">&gt;</span>second<span class=\"sy4\">;</span><br/>        <span class=\"kw4\">const</span> PrefList <span class=\"sy3\">&amp;</span>preflist <span class=\"sy1\">=</span> men_pref.<span class=\"me1\">at</span><span class=\"br0\">(</span>groom<span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>\u00a0<br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span>PrefList<span class=\"sy4\">::</span><span class=\"me2\">const_iterator</span> it <span class=\"sy1\">=</span> preflist.<span class=\"me1\">begin</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> it <span class=\"sy3\">!</span><span class=\"sy1\">=</span> preflist.<span class=\"me1\">end</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>it<span class=\"br0\">)</span><br/>        <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"sy2\">*</span>it <span class=\"sy1\">==</span> bride<span class=\"br0\">)</span> <span class=\"co1\">// he prefers his bride</span><br/>                <span class=\"kw1\">break</span><span class=\"sy4\">;</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>prefers<span class=\"br0\">(</span>preflist, <span class=\"sy2\">*</span>it, bride<span class=\"br0\">)</span> <span class=\"sy3\">&amp;&amp;</span> <span class=\"co1\">// he prefers another woman</span><br/>                prefers<span class=\"br0\">(</span>women_pref.<span class=\"me1\">at</span><span class=\"br0\">(</span><span class=\"sy2\">*</span>it<span class=\"br0\">)</span>, groom, engaged.<span class=\"me1\">at</span><span class=\"br0\">(</span><span class=\"sy2\">*</span>it<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"co1\">// other woman prefers him</span><br/>            <span class=\"br0\">{</span><br/>                <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\t</span>\"</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"sy2\">*</span>it <span class=\"sy1\">&lt;&lt;</span><br/>                    <span class=\"st0\">\" prefers \"</span> <span class=\"sy1\">&lt;&lt;</span> groom <span class=\"sy1\">&lt;&lt;</span><br/>                    <span class=\"st0\">\" over \"</span> <span class=\"sy1\">&lt;&lt;</span> engaged.<span class=\"me1\">at</span><span class=\"br0\">(</span><span class=\"sy2\">*</span>it<span class=\"br0\">)</span> <span class=\"sy1\">&lt;&lt;</span><br/>                    <span class=\"st0\">\" and \"</span> <span class=\"sy1\">&lt;&lt;</span> groom <span class=\"sy1\">&lt;&lt;</span><br/>                    <span class=\"st0\">\" prefers \"</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"sy2\">*</span>it <span class=\"sy1\">&lt;&lt;</span><br/>                    <span class=\"st0\">\" over \"</span> <span class=\"sy1\">&lt;&lt;</span> bride <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>                stable <span class=\"sy1\">=</span> <span class=\"kw2\">false</span><span class=\"sy4\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">if</span> <span class=\"br0\">(</span>stable<span class=\"br0\">)</span> <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\t</span>(all marriages stable)<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw4\">int</span> main<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>    PrefMap men_pref, women_pref<span class=\"sy4\">;</span><br/>    queue<span class=\"sy1\">&lt;</span>string<span class=\"sy1\">&gt;</span> bachelors<span class=\"sy4\">;</span><br/>\u00a0<br/>    <span class=\"co1\">// init data structures</span><br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span><span class=\"kw4\">int</span> i <span class=\"sy1\">=</span> <span class=\"nu0\">0</span><span class=\"sy4\">;</span> i <span class=\"sy1\">&lt;</span> <span class=\"nu0\">10</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>i<span class=\"br0\">)</span> <span class=\"co1\">// person</span><br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span><span class=\"kw4\">int</span> j <span class=\"sy1\">=</span> <span class=\"nu0\">1</span><span class=\"sy4\">;</span> j <span class=\"sy1\">&lt;</span> <span class=\"nu0\">11</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>j<span class=\"br0\">)</span> <span class=\"co1\">// preference</span><br/>        <span class=\"br0\">{</span><br/>              men_pref<span class=\"br0\">[</span>  men_data<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span>.<span class=\"me1\">push_back</span><span class=\"br0\">(</span>  men_data<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">[</span>j<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>            women_pref<span class=\"br0\">[</span>women_data<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span>.<span class=\"me1\">push_back</span><span class=\"br0\">(</span>women_data<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">[</span>j<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>        <span class=\"br0\">}</span><br/>        bachelors.<span class=\"me1\">push</span><span class=\"br0\">(</span>men_data<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    Couples engaged<span class=\"sy4\">;</span> <span class=\"co1\">// &lt;woman,man&gt;</span><br/>\u00a0<br/>    <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"Matchmaking:<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>    <span class=\"kw1\">while</span> <span class=\"br0\">(</span><span class=\"sy3\">!</span>bachelors.<span class=\"me1\">empty</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>suitor <span class=\"sy1\">=</span> bachelors.<span class=\"me1\">front</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>        <span class=\"kw4\">const</span> PrefList <span class=\"sy3\">&amp;</span>preflist <span class=\"sy1\">=</span> men_pref<span class=\"br0\">[</span>suitor<span class=\"br0\">]</span><span class=\"sy4\">;</span><br/>\u00a0<br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span>PrefList<span class=\"sy4\">::</span><span class=\"me2\">const_iterator</span> it <span class=\"sy1\">=</span> preflist.<span class=\"me1\">begin</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> it <span class=\"sy3\">!</span><span class=\"sy1\">=</span> preflist.<span class=\"me1\">end</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>it<span class=\"br0\">)</span><br/>        <span class=\"br0\">{</span><br/>            <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>bride <span class=\"sy1\">=</span> <span class=\"sy2\">*</span>it<span class=\"sy4\">;</span><br/>\u00a0<br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>engaged.<span class=\"me1\">find</span><span class=\"br0\">(</span>bride<span class=\"br0\">)</span> <span class=\"sy1\">==</span> engaged.<span class=\"me1\">end</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"co1\">// she's available</span><br/>            <span class=\"br0\">{</span><br/>                <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\t</span>\"</span> <span class=\"sy1\">&lt;&lt;</span> bride <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\" and \"</span> <span class=\"sy1\">&lt;&lt;</span> suitor <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>                engaged<span class=\"br0\">[</span>bride<span class=\"br0\">]</span> <span class=\"sy1\">=</span> suitor<span class=\"sy4\">;</span> <span class=\"co1\">// hook up</span><br/>                <span class=\"kw1\">break</span><span class=\"sy4\">;</span><br/>            <span class=\"br0\">}</span><br/>\u00a0<br/>            <span class=\"kw4\">const</span> string <span class=\"sy3\">&amp;</span>groom <span class=\"sy1\">=</span> engaged<span class=\"br0\">[</span>bride<span class=\"br0\">]</span><span class=\"sy4\">;</span><br/>\u00a0<br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>prefers<span class=\"br0\">(</span>women_pref<span class=\"br0\">[</span>bride<span class=\"br0\">]</span>, suitor, groom<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>            <span class=\"br0\">{</span><br/>                <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\t</span>\"</span> <span class=\"sy1\">&lt;&lt;</span> bride <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\" dumped \"</span> <span class=\"sy1\">&lt;&lt;</span> groom <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\" for \"</span> <span class=\"sy1\">&lt;&lt;</span> suitor <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>                bachelors.<span class=\"me1\">push</span><span class=\"br0\">(</span>groom<span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"co1\">// dump that zero</span><br/>                engaged<span class=\"br0\">[</span>bride<span class=\"br0\">]</span> <span class=\"sy1\">=</span> suitor<span class=\"sy4\">;</span> <span class=\"co1\">// get a hero</span><br/>                <span class=\"kw1\">break</span><span class=\"sy4\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>        bachelors.<span class=\"me1\">pop</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"co1\">// pop at the end to not invalidate suitor reference</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"Engagements:<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span>Couples<span class=\"sy4\">::</span><span class=\"me2\">const_iterator</span> it <span class=\"sy1\">=</span> engaged.<span class=\"me1\">begin</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> it <span class=\"sy3\">!</span><span class=\"sy1\">=</span> engaged.<span class=\"me1\">end</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy4\">;</span> <span class=\"sy2\">++</span>it<span class=\"br0\">)</span><br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\t</span>\"</span> <span class=\"sy1\">&lt;&lt;</span> it<span class=\"sy2\">-</span><span class=\"sy1\">&gt;</span>first <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\" and \"</span> <span class=\"sy1\">&lt;&lt;</span> it<span class=\"sy2\">-</span><span class=\"sy1\">&gt;</span>second <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    check_stability<span class=\"br0\">(</span>engaged, men_pref, women_pref<span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>\u00a0<br/>    <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"Perturb:<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>    std<span class=\"sy4\">::</span><span class=\"me2\">swap</span><span class=\"br0\">(</span>engaged<span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span>, engaged<span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>    <span class=\"kw3\">cout</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\t</span>engage abi with \"</span> <span class=\"sy1\">&lt;&lt;</span> engaged<span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\" and bea with \"</span> <span class=\"sy1\">&lt;&lt;</span> engaged<span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"br0\">]</span> <span class=\"sy1\">&lt;&lt;</span> <span class=\"st0\">\"<span class=\"es1\">\\n</span>\"</span><span class=\"sy4\">;</span><br/>\u00a0<br/>    check_stability<span class=\"br0\">(</span>engaged, men_pref, women_pref<span class=\"br0\">)</span><span class=\"sy4\">;</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "C#", "loc": 125, "block": "<pre class=\"csharp highlighted_source\"><span class=\"kw1\">using</span> <span class=\"co3\">System</span><span class=\"sy0\">;</span><br/><span class=\"kw1\">using</span> <span class=\"co3\">System.Collections.Generic</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw1\">namespace</span> StableMarriage<br/><span class=\"br0\">{</span><br/>    <span class=\"kw4\">class</span> Person<br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw1\">private</span> <span class=\"kw4\">int</span> _candidateIndex<span class=\"sy0\">;</span><br/>        <span class=\"kw1\">public</span> <span class=\"kw4\">string</span> Name <span class=\"br0\">{</span> <span class=\"kw1\">get</span><span class=\"sy0\">;</span> <span class=\"kw1\">set</span><span class=\"sy0\">;</span> <span class=\"br0\">}</span><br/>        <span class=\"kw1\">public</span> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span> Prefs <span class=\"br0\">{</span> <span class=\"kw1\">get</span><span class=\"sy0\">;</span> <span class=\"kw1\">set</span><span class=\"sy0\">;</span> <span class=\"br0\">}</span><br/>        <span class=\"kw1\">public</span> Person Fiance <span class=\"br0\">{</span> <span class=\"kw1\">get</span><span class=\"sy0\">;</span> <span class=\"kw1\">set</span><span class=\"sy0\">;</span> <span class=\"br0\">}</span><br/>\u00a0<br/>        <span class=\"kw1\">public</span> Person<span class=\"br0\">(</span><span class=\"kw4\">string</span> name<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            Name <span class=\"sy0\">=</span> name<span class=\"sy0\">;</span><br/>            Prefs <span class=\"sy0\">=</span> <span class=\"kw1\">null</span><span class=\"sy0\">;</span><br/>            Fiance <span class=\"sy0\">=</span> <span class=\"kw1\">null</span><span class=\"sy0\">;</span><br/>            _candidateIndex <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">public</span> <span class=\"kw4\">bool</span> Prefers<span class=\"br0\">(</span>Person p<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">return</span> Prefs<span class=\"sy0\">.</span><span class=\"me1\">FindIndex</span><span class=\"br0\">(</span>o <span class=\"sy0\">=&gt;</span> o <span class=\"sy0\">==</span> p<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> Prefs<span class=\"sy0\">.</span><span class=\"me1\">FindIndex</span><span class=\"br0\">(</span>o <span class=\"sy0\">=&gt;</span> o <span class=\"sy0\">==</span> Fiance<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">public</span> Person NextCandidateNotYetProposedTo<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>_candidateIndex <span class=\"sy0\">&gt;=</span> Prefs<span class=\"sy0\">.</span><span class=\"me1\">Count</span><span class=\"br0\">)</span> <span class=\"kw1\">return</span> <span class=\"kw1\">null</span><span class=\"sy0\">;</span><br/>            <span class=\"kw1\">return</span> Prefs<span class=\"br0\">[</span>_candidateIndex<span class=\"sy0\">++</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">public</span> <span class=\"kw4\">void</span> EngageTo<span class=\"br0\">(</span>Person p<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>p<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span> <span class=\"sy0\">!=</span> <span class=\"kw1\">null</span><span class=\"br0\">)</span> p<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span><span class=\"sy0\">.</span><span class=\"me1\">Fiance</span> <span class=\"sy0\">=</span> <span class=\"kw1\">null</span><span class=\"sy0\">;</span><br/>            p<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span> <span class=\"sy0\">=</span> <span class=\"kw1\">this</span><span class=\"sy0\">;</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>Fiance <span class=\"sy0\">!=</span> <span class=\"kw1\">null</span><span class=\"br0\">)</span> Fiance<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span> <span class=\"sy0\">=</span> <span class=\"kw1\">null</span><span class=\"sy0\">;</span><br/>            Fiance <span class=\"sy0\">=</span> p<span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">static</span> <span class=\"kw4\">class</span> MainClass<br/>    <span class=\"br0\">{</span><br/>        <span class=\"kw1\">static</span> <span class=\"kw1\">public</span> <span class=\"kw4\">bool</span> IsStable<span class=\"br0\">(</span>List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span> women <span class=\"sy0\">=</span> men<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"sy0\">.</span><span class=\"me1\">Prefs</span><span class=\"sy0\">;</span><br/>            <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>Person guy <span class=\"kw1\">in</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>Person gal <span class=\"kw1\">in</span> women<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    <span class=\"kw1\">if</span> <span class=\"br0\">(</span>guy<span class=\"sy0\">.</span><span class=\"me1\">Prefers</span><span class=\"br0\">(</span>gal<span class=\"br0\">)</span> <span class=\"sy0\">&amp;&amp;</span> gal<span class=\"sy0\">.</span><span class=\"me1\">Prefers</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>                        <span class=\"kw1\">return</span> <span class=\"kw1\">false</span><span class=\"sy0\">;</span><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>            <span class=\"kw1\">return</span> <span class=\"kw1\">true</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        <span class=\"kw1\">static</span> <span class=\"kw4\">void</span> DoMarriage<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            Person abe  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"abe\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person bob  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person col  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"col\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person dan  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person ed   <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"ed\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person fred <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person gav  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"gav\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person hal  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person ian  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"ian\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person jon  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person abi  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person bea  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"bea\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person cath <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"cath\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person dee  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"dee\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person eve  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"eve\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person fay  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person gay  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person hope <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person ivy  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"ivy\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person jan  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> Person<span class=\"br0\">(</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            abe<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            bob<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            col<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            dan<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            ed<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>   <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            fred<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span> <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            gav<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            hal<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            ian<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            jon<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            abi<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>bob, fred, jon, gav, ian, abe, dan, ed, col, hal<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            bea<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>bob, abe, col, fred, gav, dan, ian, ed, jon, hal<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            cath<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span> <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>fred, bob, ed, gav, hal, col, ian, abe, dan, jon<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            dee<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>fred, jon, col, abe, ian, hal, gav, dan, bob, ed<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            eve<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>jon, hal, fred, dan, abe, gav, col, ed, ian, bob<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            fay<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>bob, abe, ed, ian, jon, dan, fred, gav, col, hal<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            gay<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>jon, gav, hal, fred, bob, abe, col, ed, dan, ian<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            hope<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span> <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>gav, jon, bob, abe, ian, dan, hal, ed, col, fred<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            ivy<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>ian, col, hal, gav, fred, bob, abe, ed, jon, dan<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>            jan<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span>  <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span>ed, hal, gav, abe, bob, jon, col, ian, fred, dan<span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span> men <span class=\"sy0\">=</span> <a href=\"http://www.google.com/search?q=new+msdn.microsoft.com\"><span class=\"kw3\">new</span></a> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span>abi<span class=\"sy0\">.</span><span class=\"me1\">Prefs</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            <span class=\"kw4\">int</span> freeMenCount <span class=\"sy0\">=</span> men<span class=\"sy0\">.</span><span class=\"me1\">Count</span><span class=\"sy0\">;</span><br/>            <span class=\"kw1\">while</span> <span class=\"br0\">(</span>freeMenCount <span class=\"sy0\">&gt;</span> <span class=\"nu0\">0</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>Person guy <span class=\"kw1\">in</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    <span class=\"kw1\">if</span> <span class=\"br0\">(</span>guy<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span> <span class=\"sy0\">==</span> <span class=\"kw1\">null</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                        Person gal <span class=\"sy0\">=</span> guy<span class=\"sy0\">.</span><span class=\"me1\">NextCandidateNotYetProposedTo</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                        <span class=\"kw1\">if</span> <span class=\"br0\">(</span>gal<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span> <span class=\"sy0\">==</span> <span class=\"kw1\">null</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                            guy<span class=\"sy0\">.</span><span class=\"me1\">EngageTo</span><span class=\"br0\">(</span>gal<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                            freeMenCount<span class=\"sy0\">--;</span><br/>                        <span class=\"br0\">}</span> <span class=\"kw1\">else</span> <span class=\"kw1\">if</span> <span class=\"br0\">(</span>gal<span class=\"sy0\">.</span><span class=\"me1\">Prefers</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                            guy<span class=\"sy0\">.</span><span class=\"me1\">EngageTo</span><span class=\"br0\">(</span>gal<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                        <span class=\"br0\">}</span><br/>                    <span class=\"br0\">}</span><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>\u00a0<br/>            <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>Person guy <span class=\"kw1\">in</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                Console<span class=\"sy0\">.</span><span class=\"me1\">WriteLine</span><span class=\"br0\">(</span><span class=\"st0\">\"{0} is engaged to {1}\"</span>, guy<span class=\"sy0\">.</span><span class=\"me1\">Name</span>, guy<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span><span class=\"sy0\">.</span><span class=\"me1\">Name</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span><br/>            Console<span class=\"sy0\">.</span><span class=\"me1\">WriteLine</span><span class=\"br0\">(</span><span class=\"st0\">\"Stable = {0}\"</span>, IsStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            Console<span class=\"sy0\">.</span><span class=\"me1\">WriteLine</span><span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es0\">\\n</span>Switching fred &amp; jon's partners\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Person jonsFiance <span class=\"sy0\">=</span> jon<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span><span class=\"sy0\">;</span><br/>            Person fredsFiance <span class=\"sy0\">=</span> fred<span class=\"sy0\">.</span><span class=\"me1\">Fiance</span><span class=\"sy0\">;</span><br/>            fred<span class=\"sy0\">.</span><span class=\"me1\">EngageTo</span><span class=\"br0\">(</span>jonsFiance<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            jon<span class=\"sy0\">.</span><span class=\"me1\">EngageTo</span><span class=\"br0\">(</span>fredsFiance<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            Console<span class=\"sy0\">.</span><span class=\"me1\">WriteLine</span><span class=\"br0\">(</span><span class=\"st0\">\"Stable = {0}\"</span>, IsStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        <span class=\"kw1\">public</span> <span class=\"kw1\">static</span> <span class=\"kw4\">void</span> Main<span class=\"br0\">(</span><span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span> args<span class=\"br0\">)</span><br/>        <span class=\"br0\">{</span><br/>            DoMarriage<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "Ceylon", "loc": 138, "block": "<pre class=\"text highlighted_source\">abstract class Single(name) of Gal | Guy {<br/>\u00a0<br/>    shared String name;<br/>    shared late Single[] preferences;<br/>\u00a0<br/>    shared variable Single? fiance = null;<br/>    shared Boolean free =&gt; fiance is Null;<br/>\u00a0<br/>    shared variable Integer currentProposalIndex = 0;<br/>\u00a0<br/>    \"Does this single prefer this other single over their fiance?\"<br/>    shared Boolean prefers(Single otherSingle) =&gt;<br/>            let (p1 = preferences.firstIndexWhere(otherSingle.equals), f = fiance)<br/>            if (!exists p1)<br/>            then false<br/>            else if (!exists f)<br/>            then true<br/>            else if (exists p2 = preferences.firstIndexWhere(f.equals))<br/>            then p1 &lt; p2<br/>            else false;<br/>\u00a0<br/>    string =&gt; name;<br/>}<br/>\u00a0<br/>abstract class Guy(String name) of abe | bob | col | dan | ed | fred | gav | hal | ian | jon extends Single(name) {}<br/>\u00a0<br/>object abe extends Guy(\"Abe\") {}<br/>object bob extends Guy(\"Bob\") {}<br/>object col extends Guy(\"Col\") {}<br/>object dan extends Guy(\"Dan\") {}<br/>object ed extends Guy(\"Ed\") {}<br/>object fred extends Guy(\"Fred\") {}<br/>object gav extends Guy(\"Gav\") {}<br/>object hal extends Guy(\"Hal\") {}<br/>object ian extends Guy(\"Ian\") {}<br/>object jon extends Guy(\"Jon\") {}<br/>\u00a0<br/>abstract class Gal(String name) of abi | bea | cath | dee | eve | fay | gay | hope | ivy | jan extends Single(name) {}<br/>\u00a0<br/>object abi extends Gal(\"Abi\") {}<br/>object bea extends Gal(\"Bea\") {}<br/>object cath extends Gal(\"Cath\") {}<br/>object dee extends Gal(\"Dee\") {}<br/>object eve extends Gal(\"Eve\") {}<br/>object fay extends Gal(\"Fay\") {}<br/>object gay extends Gal(\"Gay\") {}<br/>object hope extends Gal(\"Hope\") {}<br/>object ivy extends Gal(\"Ivy\") {}<br/>object jan extends Gal(\"Jan\") {}<br/>\u00a0<br/>Guy[] guys = `Guy`.caseValues;<br/>Gal[] gals = `Gal`.caseValues;<br/>\u00a0<br/>\"The main function. Run this one.\"<br/>shared void run() {<br/>\u00a0<br/>    abe.preferences = [ abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay ];<br/>    bob.preferences = [ cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay ];<br/>    col.preferences = [ hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan ];<br/>    dan.preferences = [ ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi ];<br/>    ed.preferences = [ jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay ];<br/>    fred.preferences = [ bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay ];<br/>    gav.preferences = [ gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay ];<br/>    hal.preferences = [ abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee ];<br/>    ian.preferences = [ hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve ];<br/>    jon.preferences = [ abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope ];<br/>\u00a0<br/>    abi.preferences = [ bob, fred, jon, gav, ian, abe, dan, ed, col, hal ];<br/>    bea.preferences = [ bob, abe, col, fred, gav, dan, ian, ed, jon, hal ];<br/>    cath.preferences = [ fred, bob, ed, gav, hal, col, ian, abe, dan, jon ];<br/>    dee.preferences = [ fred, jon, col, abe, ian, hal, gav, dan, bob, ed ];<br/>    eve.preferences = [ jon, hal, fred, dan, abe, gav, col, ed, ian, bob ];<br/>    fay.preferences = [ bob, abe, ed, ian, jon, dan, fred, gav, col, hal ];<br/>    gay.preferences = [ jon, gav, hal, fred, bob, abe, col, ed, dan, ian ];<br/>    hope.preferences = [ gav, jon, bob, abe, ian, dan, hal, ed, col, fred ];<br/>    ivy.preferences = [ ian, col, hal, gav, fred, bob, abe, ed, jon, dan ];<br/>    jan.preferences = [ ed, hal, gav, abe, bob, jon, col, ian, fred, dan ];<br/>\u00a0<br/>    print(\"------ the matchmaking process ------\");<br/>    matchmake();<br/>    print(\"------ the final engagements ------\");<br/>    for (guy in guys) {<br/>        print(\"``guy`` is engaged to ``guy.fiance else \"no one\"``\");<br/>    }<br/>    print(\"------ is it stable? ------\");<br/>    checkStability();<br/>    value temp = jon.fiance;<br/>    jon.fiance = fred.fiance;<br/>    fred.fiance = temp;<br/>    print(\"------ is it stable after switching jon and fred's partners? ------\");<br/>    checkStability();<br/>}<br/>\u00a0<br/>\"Match up all the singles with the Gale/Shapley algorithm.\"<br/>void matchmake() {<br/>    while (true) {<br/>        value singleGuys = guys.filter(Guy.free);<br/>        if (singleGuys.empty) {<br/>            return;<br/>        }<br/>        for (guy in singleGuys) {<br/>            if (exists gal = guy.preferences[guy.currentProposalIndex]) {<br/>                guy.currentProposalIndex++;<br/>                value fiance = gal.fiance;<br/>                if (!exists fiance) {<br/>                    print(\"``guy`` and ``gal`` just got engaged!\");<br/>                    guy.fiance = gal;<br/>                    gal.fiance = guy;<br/>                }<br/>                else {<br/>                    if (gal.prefers(guy)) {<br/>                        print(\"``gal`` dumped ``fiance`` for ``guy``!\");<br/>                        fiance.fiance = null;<br/>                        gal.fiance = guy;<br/>                        guy.fiance = gal;<br/>                    }<br/>                    else {<br/>                        print(\"``gal`` turned down ``guy`` and stayed with ``fiance``!\");<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}<br/>\u00a0<br/>void checkStability() {<br/>    variable value stabilityFlag = true;<br/>    for (gal in gals) {<br/>        for (guy in guys) {<br/>            if (guy.prefers(gal) &amp;&amp; gal.prefers(guy)) {<br/>                stabilityFlag = false;<br/>                print(\"``guy`` prefers ``gal`` over ``guy.fiance else \"nobody\"`` <br/>                       and ``gal`` prefers ``guy`` over ``gal.fiance else \"nobody\"``!\".normalized);<br/>            }<br/>        }<br/>    }<br/>    print(\"``if(!stabilityFlag) then \"Not \" else \"\"``Stable!\");<br/>}</pre>"}, {"lang": "CoffeeScript", "loc": 128, "block": "<pre class=\"coffeescript highlighted_source\"><span class=\"kw3\">class</span> Person<br/>  constructor<span class=\"sy0\">:</span> <span class=\"br0\">(</span><span class=\"sy0\">@</span>name<span class=\"sy0\">,</span> <span class=\"sy0\">@</span>preferences<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>    <span class=\"sy0\">@</span>mate = <span class=\"kw4\">null</span><br/>    <span class=\"sy0\">@</span>best_mate_rank = <span class=\"nu0\">0</span><br/>    <span class=\"sy0\">@</span>rank = <span class=\"br0\">{</span><span class=\"br0\">}</span><br/>    <span class=\"kw1\">for</span> preference<span class=\"sy0\">,</span> i <span class=\"kw1\">in</span> <span class=\"sy0\">@</span>preferences<br/>      <span class=\"sy0\">@</span>rank<span class=\"br0\">[</span>preference<span class=\"br0\">]</span> = i<br/>\u00a0<br/>  preferred_mate_name<span class=\"sy0\">:</span> <span class=\"sy0\">=&gt;</span><br/>    <span class=\"sy0\">@</span>preferences<span class=\"br0\">[</span><span class=\"sy0\">@</span>best_mate_rank<span class=\"br0\">]</span><br/>\u00a0<br/>  reject<span class=\"sy0\">:</span> <span class=\"sy0\">=&gt;</span><br/>    <span class=\"sy0\">@</span>best_mate_rank <span class=\"sy0\">+</span>= <span class=\"nu0\">1</span><br/>\u00a0<br/>  set_mate<span class=\"sy0\">:</span> <span class=\"br0\">(</span>mate<span class=\"br0\">)</span> <span class=\"sy0\">=&gt;</span><br/>    <span class=\"sy0\">@</span>mate = mate<br/>\u00a0<br/>  offer_mate<span class=\"sy0\">:</span> <span class=\"br0\">(</span>free_mate<span class=\"sy0\">,</span> reject_mate_cb<span class=\"br0\">)</span> <span class=\"sy0\">=&gt;</span>  <br/>    <span class=\"kw1\">if</span> <span class=\"sy0\">@</span>mate<br/>      <span class=\"kw1\">if</span> <span class=\"sy0\">@</span>covets<span class=\"br0\">(</span>free_mate<span class=\"br0\">)</span><br/>        console.<span class=\"me1\">log</span> <span class=\"st0\">\"#{free_mate.name} steals #{@name} from #{@mate.name}\"</span><br/>        reject_mate_cb <span class=\"sy0\">@</span>mate<br/>        free_mate.<span class=\"me1\">set_mate</span> <span class=\"sy0\">@</span><br/>        <span class=\"sy0\">@</span>set_mate free_mate<br/>      <span class=\"kw1\">else</span><br/>        console.<span class=\"me1\">log</span> <span class=\"st0\">\"#{free_mate.name} cannot steal #{@name} from #{@mate.name}\"</span><br/>        reject_mate_cb free_mate<br/>    <span class=\"kw1\">else</span><br/>      console.<span class=\"me1\">log</span> <span class=\"st0\">\"#{free_mate.name} gets #{@name} first\"</span><br/>      free_mate.<span class=\"me1\">set_mate</span> <span class=\"sy0\">@</span><br/>      <span class=\"sy0\">@</span>set_mate free_mate<br/>\u00a0<br/>  happiness<span class=\"sy0\">:</span> <span class=\"sy0\">=&gt;</span><br/>    <span class=\"sy0\">@</span>rank<span class=\"br0\">[</span><span class=\"sy0\">@</span>mate.<span class=\"me1\">name</span><span class=\"br0\">]</span><br/>\u00a0<br/>  covets<span class=\"sy0\">:</span> <span class=\"br0\">(</span>other_mate<span class=\"br0\">)</span> <span class=\"sy0\">=&gt;</span><br/>    <span class=\"sy0\">@</span>rank<span class=\"br0\">[</span>other_mate.<span class=\"me1\">name</span><span class=\"br0\">]</span> <span class=\"sy0\">&lt;</span>= <span class=\"sy0\">@</span>rank<span class=\"br0\">[</span><span class=\"sy0\">@</span>mate.<span class=\"me1\">name</span><span class=\"br0\">]</span><br/>\u00a0<br/>persons_by_name = <span class=\"br0\">(</span>persons<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>  hsh = <span class=\"br0\">{</span><span class=\"br0\">}</span><br/>  <span class=\"kw1\">for</span> person <span class=\"kw1\">in</span> persons<br/>    hsh<span class=\"br0\">[</span>person.<span class=\"me1\">name</span><span class=\"br0\">]</span> = person<br/>  hsh<br/>\u00a0<br/>mate_off = <span class=\"br0\">(</span>guys<span class=\"sy0\">,</span> gals<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>  free_pursuers = <span class=\"br0\">(</span>guy <span class=\"kw1\">for</span> guy <span class=\"kw1\">in</span> guys<span class=\"br0\">)</span><br/>  guys_by_name = persons_by_name guys<br/>  gals_by_name = persons_by_name gals<br/>\u00a0<br/>  <span class=\"kw1\">while</span> free_pursuers.<span class=\"me1\">length</span> <span class=\"sy0\">&gt;</span> <span class=\"nu0\">0</span><br/>    free_pursuer = free_pursuers.<span class=\"me1\">shift</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    gal_name = free_pursuer.<span class=\"me1\">preferred_mate_name</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    gal = gals_by_name<span class=\"br0\">[</span>gal_name<span class=\"br0\">]</span><br/>    reject_mate_cb = <span class=\"br0\">(</span>guy<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>      guy.<span class=\"me1\">reject</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>      free_pursuers.<span class=\"me1\">push</span> guy<br/>    gal.<span class=\"me1\">offer_mate</span> free_pursuer<span class=\"sy0\">,</span> reject_mate_cb<br/>\u00a0<br/>\u00a0<br/>report_on_mates = <span class=\"br0\">(</span>guys<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>  console.<span class=\"me1\">log</span> <span class=\"st0\">\"<span class=\"es0\">\\n</span>----Marriage Report\"</span><br/>  <span class=\"kw1\">for</span> guy<span class=\"sy0\">,</span> i <span class=\"kw1\">in</span> guys<br/>    <span class=\"kw1\">throw</span> Error<span class=\"br0\">(</span><span class=\"st0\">\"illegal marriage\"</span><span class=\"br0\">)</span> <span class=\"kw1\">if</span> guy.<span class=\"me1\">mate</span>.<span class=\"me1\">mate</span> <span class=\"kw2\">isnt</span> guy<br/>    console.<span class=\"me1\">log</span> guy.<span class=\"me1\">name</span><span class=\"sy0\">,</span> guy.<span class=\"me1\">mate</span>.<span class=\"me1\">name</span><span class=\"sy0\">,</span> \\<br/>      <span class=\"st0\">\"(his choice #{guy.happiness()}, her choice #{guy.mate.happiness()} )\"</span><br/>\u00a0<br/>report_potential_adulteries = <span class=\"br0\">(</span>guys<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>  <span class=\"kw1\">for</span> guy1<span class=\"sy0\">,</span> i <span class=\"kw1\">in</span> guys<br/>    gal1 = guy1.<span class=\"me1\">mate</span><br/>    <span class=\"kw1\">for</span> j <span class=\"kw1\">in</span> <span class=\"br0\">[</span><span class=\"nu0\">0</span>...<span class=\"me1\">i</span><span class=\"br0\">]</span><br/>      guy2 = guys<span class=\"br0\">[</span>j<span class=\"br0\">]</span><br/>      gal2 = guy2.<span class=\"me1\">mate</span><br/>      <span class=\"kw1\">if</span> guy1.<span class=\"me1\">covets</span><span class=\"br0\">(</span>gal2<span class=\"br0\">)</span> <span class=\"kw2\">and</span> gal2.<span class=\"me1\">covets</span><span class=\"br0\">(</span>guy1<span class=\"br0\">)</span><br/>        console.<span class=\"me1\">log</span> <span class=\"st0\">\"#{guy1.name} and #{gal2.name} would stray\"</span><br/>      <span class=\"kw1\">if</span> guy2.<span class=\"me1\">covets</span><span class=\"br0\">(</span>gal1<span class=\"br0\">)</span> <span class=\"kw2\">and</span> gal1.<span class=\"me1\">covets</span><span class=\"br0\">(</span>guy2<span class=\"br0\">)</span><br/>        console.<span class=\"me1\">log</span> <span class=\"st0\">\"#{guy2.name} and #{gal1.name} would stray\"</span><br/>\u00a0<br/>perturb = <span class=\"br0\">(</span>guys<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>  <span class=\"co1\"># mess up marriages by swapping two couples...this is mainly to drive</span><br/>  <span class=\"co1\"># out that report_potential_adulteries will actually work</span><br/>  guy0 = guys<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><br/>  guy1 = guys<span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><br/>  gal0 = guy0.<span class=\"me1\">mate</span><br/>  gal1 = guy1.<span class=\"me1\">mate</span><br/>  console.<span class=\"me1\">log</span> <span class=\"st0\">\"<span class=\"es0\">\\n</span>Perturbing with #{guy0.name}, #{gal0.name}, #{guy1.name}, #{gal1.name}\"</span><br/>  guy0.<span class=\"me1\">set_mate</span> gal1<br/>  guy1.<span class=\"me1\">set_mate</span> gal0<br/>  gal1.<span class=\"me1\">set_mate</span> guy0<br/>  gal0.<span class=\"me1\">set_mate</span> guy1<br/>\u00a0<br/>\u00a0<br/>Population = <span class=\"sy0\">-&gt;</span><br/>  guy_preferences =<br/>   abe<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"br0\">]</span><br/>   bob<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"br0\">]</span><br/>   col<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"br0\">]</span><br/>   dan<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"br0\">]</span><br/>   ed<span class=\"sy0\">:</span>   <span class=\"br0\">[</span><span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"br0\">]</span><br/>   fred<span class=\"sy0\">:</span> <span class=\"br0\">[</span><span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"br0\">]</span><br/>   gav<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"br0\">]</span><br/>   hal<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"br0\">]</span><br/>   ian<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"br0\">]</span><br/>   jon<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"br0\">]</span><br/>\u00a0<br/>  gal_preferences =<br/>   abi<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"br0\">]</span><br/>   bea<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"br0\">]</span><br/>   cath<span class=\"sy0\">:</span> <span class=\"br0\">[</span><span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"br0\">]</span><br/>   dee<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"br0\">]</span><br/>   eve<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"br0\">]</span><br/>   fay<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"br0\">]</span><br/>   gay<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"br0\">]</span><br/>   hope<span class=\"sy0\">:</span> <span class=\"br0\">[</span><span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"br0\">]</span><br/>   ivy<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"br0\">]</span><br/>   jan<span class=\"sy0\">:</span>  <span class=\"br0\">[</span><span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"br0\">]</span><br/>\u00a0<br/>  guys = <span class=\"br0\">(</span><span class=\"kw3\">new</span> Person<span class=\"br0\">(</span>name<span class=\"sy0\">,</span> preferences<span class=\"br0\">)</span> <span class=\"kw1\">for</span> name<span class=\"sy0\">,</span> preferences <span class=\"kw1\">of</span> guy_preferences<span class=\"br0\">)</span><br/>  gals = <span class=\"br0\">(</span><span class=\"kw3\">new</span> Person<span class=\"br0\">(</span>name<span class=\"sy0\">,</span> preferences<span class=\"br0\">)</span> <span class=\"kw1\">for</span> name<span class=\"sy0\">,</span> preferences <span class=\"kw1\">of</span> gal_preferences<span class=\"br0\">)</span><br/>  <span class=\"br0\">[</span>guys<span class=\"sy0\">,</span> gals<span class=\"br0\">]</span><br/>\u00a0<br/>do <span class=\"sy0\">-&gt;</span><br/>  <span class=\"br0\">[</span>guys<span class=\"sy0\">,</span> gals<span class=\"br0\">]</span> = Population<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  mate_off guys<span class=\"sy0\">,</span> gals<br/>  report_on_mates guys<br/>  report_potential_adulteries guys<br/>  perturb guys<br/>  report_on_mates guys<br/>  report_potential_adulteries guys</pre>"}, {"lang": "ColdFusion", "loc": 123, "block": "<pre class=\"cfm highlighted_source\">\u00a0<br/>PERSON.CFC<br/>\u00a0<br/>component displayName=\"Person\" accessors=\"true\" {<br/>    property name=\"Name\" type=\"string\";<br/>    property name=\"MrOrMrsGoodEnough\" type=\"Person\";<br/>    property name=\"UnrealisticExpectations\" type=\"array\";<br/>    property name=\"PersonalHistory\" type=\"array\";<br/>\u00a0<br/>    public Person function init( required String name ) {<br/>        setName( arguments.name );<br/>        setPersonalHistory([ getName() &amp; \" is on the market.\" ]);<br/>        this.HotnessScale = 0;<br/>        return this;<br/>    }<br/>\u00a0<br/>    public Boolean function hasSettled() {<br/>        // if we have settled, return true;<br/>        return isInstanceOf( getMrOrMrsGoodEnough(), \"Person\" );<br/>    }<br/>\u00a0<br/>    public Person function getBestOfWhatIsLeft() {<br/>        // increment the hotness scale...1 is best, 10 is...well...VERY settling.<br/>        this.HotnessScale++;<br/>        // get the match from the current rung in the barrel<br/>        var bestChoice = getUnrealisticExpectations()[ this.HotnessScale ];<br/>        return bestChoice;<br/>    }<br/>\u00a0<br/>    public Boolean function wouldRatherBeWith( required Person person ) {<br/>        // only compare if we've already settled on a potential mate<br/>        if( isInstanceOf( this.getMrOrMrsGoodEnough(), \"Person\" ) ) {<br/>            // if the new person's hotness is greater (numerically smaller) than our current beau...<br/>            return getHotness( this, arguments.person ) <span class=\"sc5\"><span class=\"sy0\">&lt;</span> getHotness<span class=\"br0\">(</span> this, this.getMrOrMrsGoodEnough<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        return false; </span><br/><span class=\"sc5\">    <span class=\"br0\">}</span></span><br/>\u00a0<br/><span class=\"sc5\">    public Void <span class=\"kw4\">function</span> settle<span class=\"br0\">(</span> <span class=\"kw6\">required</span> Person person <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">        <span class=\"kw4\">if</span><span class=\"br0\">(</span> person.hasSettled<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">            <span class=\"co1\">// this is the match we want. Force a break up of a previous relationship (sorry!)</span></span><br/><span class=\"sc5\">            dumpLikeATonOfBricks<span class=\"br0\">(</span> person <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        person.setMrOrMrsGoodEnough<span class=\"br0\">(</span> this <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">if</span><span class=\"br0\">(</span> hasSettled<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">            <span class=\"co1\">// this is the match we want, so write a dear john to our current match</span></span><br/><span class=\"sc5\">            dumpLikeATonOfBricks<span class=\"br0\">(</span> this <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        logHookup<span class=\"br0\">(</span> arguments.person <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"co1\">// we've found the mate of our dreams!</span></span><br/><span class=\"sc5\">        setMrOrMrsGoodEnough<span class=\"br0\">(</span> arguments.person <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">    <span class=\"br0\">}</span></span><br/>\u00a0<br/><span class=\"sc5\">    public Void <span class=\"kw4\">function</span> swing<span class=\"br0\">(</span> <span class=\"kw6\">required</span> Person person <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">        <span class=\"co1\">// get our spouses</span></span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> mySpouse <span class=\"sy0\">=</span> getMrOrMrsGoodEnough<span class=\"br0\">(</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> notMySpouse <span class=\"sy0\">=</span> arguments.person.getMrOrMrsGoodEnough<span class=\"br0\">(</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"co1\">// swap em'</span></span><br/><span class=\"sc5\">        setMrOrMrsGoodEnough<span class=\"br0\">(</span> notMySpouse <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        person.setMrOrMrsGoodEnough<span class=\"br0\">(</span> mySpouse <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">    <span class=\"br0\">}</span></span><br/>\u00a0<br/><span class=\"sc5\">    public Void <span class=\"kw4\">function</span> dumpLikeATonOfBricks<span class=\"br0\">(</span> <span class=\"kw6\">required</span> Person person <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">        logBreakup<span class=\"br0\">(</span> arguments.person <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        person.getMrOrMrsGoodEnough<span class=\"br0\">(</span><span class=\"br0\">)</span>.setMrOrMrsGoodEnough<span class=\"br0\">(</span> <span class=\"kw5\">JavaCast</span><span class=\"br0\">(</span> <span class=\"st0\">\"null\"</span>, <span class=\"st0\">\"\"</span> <span class=\"br0\">)</span> <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">    <span class=\"br0\">}</span></span><br/>\u00a0<br/><span class=\"sc5\">    public String <span class=\"kw4\">function</span> psychoAnalyze<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">        logNuptuals<span class=\"br0\">(</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        logRegrets<span class=\"br0\">(</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> personalJourney <span class=\"sy0\">=</span> <span class=\"st0\">\"\"</span>;</span><br/><span class=\"sc5\">        <span class=\"kw3\">for</span><span class=\"br0\">(</span> <span class=\"kw4\">var</span> entry in getPersonalHistory<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">            personalJourney <span class=\"sy0\">=</span> personalJourney <span class=\"sy0\">&amp;</span> entry <span class=\"sy0\">&amp;</span> <span class=\"st0\">\"&lt;br /&gt;\"</span>;</span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        return personalJourney;</span><br/><span class=\"sc5\">    <span class=\"br0\">}</span></span><br/>\u00a0<br/><span class=\"sc5\">    private Numeric <span class=\"kw4\">function</span> getHotness<span class=\"br0\">(</span> <span class=\"kw6\">required</span> Person pursuer, <span class=\"kw6\">required</span> Person pursued <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> pursuersExpectations <span class=\"sy0\">=</span> pursuer.getUnrealisticExpectations<span class=\"br0\">(</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> hotnessFactor <span class=\"sy0\">=</span> <span class=\"nu0\">1</span>;</span><br/><span class=\"sc5\">        <span class=\"kw3\">for</span><span class=\"br0\">(</span> <span class=\"kw4\">var</span> hotnessFactor<span class=\"sy0\">=</span><span class=\"nu0\">1</span>; hotnessFactor<span class=\"sy0\">&lt;=</span><span class=\"kw5\">arrayLen</span><span class=\"br0\">(</span> pursuersExpectations <span class=\"br0\">)</span>; hotnessFactor++ <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">            <span class=\"kw4\">if</span><span class=\"br0\">(</span> pursuersExpectations<span class=\"br0\">[</span> hotnessFactor <span class=\"br0\">]</span>.getName<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">==</span>arguments.pursued.getName<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">                return hotnessFactor;</span><br/><span class=\"sc5\">            <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">    <span class=\"br0\">}</span></span><br/>\u00a0<br/><span class=\"sc5\">    private Void <span class=\"kw4\">function</span> logRegrets<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> spouse <span class=\"sy0\">=</span> getMrOrMrsGoodEnough<span class=\"br0\">(</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> spouseHotness <span class=\"sy0\">=</span> getHotness<span class=\"br0\">(</span> this, spouse <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">var</span> myHotness <span class=\"sy0\">=</span> getHotness<span class=\"br0\">(</span> spouse, this <span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"kw4\">if</span><span class=\"br0\">(</span> spouseHotness <span class=\"sy0\">==</span> <span class=\"nu0\">1</span> <span class=\"sy0\">&amp;&amp;</span> myHotness <span class=\"sy0\">==</span> <span class=\"nu0\">1</span> <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">            <span class=\"kw5\">arrayAppend</span><span class=\"br0\">(</span> getPersonalHistory<span class=\"br0\">(</span><span class=\"br0\">)</span>, <span class=\"st0\">\"Yes, yes, the beautiful people always find happy endings: #getName()# (her ###myHotness#), #spouse.getName()# (his ###spouseHotness#)\"</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        <span class=\"kw4\">else</span> <span class=\"kw4\">if</span><span class=\"br0\">(</span> spouseHotness <span class=\"sy0\">==</span> myHotness <span class=\"br0\">)</span> <span class=\"br0\">{</span></span><br/><span class=\"sc5\">            <span class=\"kw5\">arrayAppend</span><span class=\"br0\">(</span> getPersonalHistory<span class=\"br0\">(</span><span class=\"br0\">)</span>, <span class=\"st0\">\"#getName()# (her ###myHotness#) was made for #spouse.getName()# (his ###spouseHotness#). How precious.\"</span><span class=\"br0\">)</span>;</span><br/><span class=\"sc5\">        <span class=\"br0\">}</span></span><br/><span class=\"sc5\">        <span class=\"kw4\">else</span> <span class=\"kw4\">if</span><span class=\"br0\">(</span> spouseHotness <span class=\"sy0\">&gt;</span></span> myHotness ) {<br/>            arrayAppend( getPersonalHistory(), \"<span class=\"sc2\">#getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (her ##<span class=\"sc2\">#myHotness#</span>) could have done better than <span class=\"sc2\">#spouse.getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (his ##<span class=\"sc2\">#spouseHotness#</span>). Poor slob.\");<br/>        }<br/>        else {<br/>            arrayAppend( getPersonalHistory(), \"<span class=\"sc2\">#getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (her ##<span class=\"sc2\">#myHotness#</span>) is a lucky bastard to have landed <span class=\"sc2\">#spouse.getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (his ##<span class=\"sc2\">#spouseHotness#</span>).\");<br/>        }<br/>    }<br/>\u00a0<br/>    private Void function logNuptuals() {<br/>        arrayAppend( getPersonalHistory(), \"<span class=\"sc2\">#getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> has settled for <span class=\"sc2\">#getMrOrMrsGoodEnough<span class=\"br0\">(</span><span class=\"br0\">)</span>.getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span>.\" );<br/>    }<br/>\u00a0<br/>    private Void function logHookup( required Person person ) {<br/>        var winnerHotness = getHotness( this, arguments.person );<br/>        var myHotness = getHotness( arguments.person, this );<br/>        arrayAppend( getPersonalHistory(), \"<span class=\"sc2\">#getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (her ##<span class=\"sc2\">#myHotness#</span>) is checking out <span class=\"sc2\">#arguments.person.getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (his ##<span class=\"sc2\">#winnerHotness#</span>), but wants to keep his options open.\");<br/>    }<br/>\u00a0<br/>    private Void function logBreakup( required Person person ) {<br/>        var scrub = person.getMrOrMrsGoodEnough();<br/>        var scrubHotness = getHotness( person, scrub );<br/>        var myHotness = getHotness( person, this );<br/>        arrayAppend( getPersonalHistory(), \"<span class=\"sc2\">#getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> is so hot (her ##<span class=\"sc2\">#myHotness#</span>) that <span class=\"sc2\">#person.getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> is dumping <span class=\"sc2\">#scrub.getName<span class=\"br0\">(</span><span class=\"br0\">)</span>#</span> (her ##<span class=\"sc2\">#scrubHotness#</span>)\");<br/>    }<br/>}<br/>\u00a0</pre>"}, {"lang": "D", "loc": 130, "block": "<pre class=\"d highlighted_source\"><span class=\"kw2\">import</span> std.<span class=\"me1\">stdio</span><span class=\"sy0\">,</span> std.<span class=\"me1\">array</span><span class=\"sy0\">,</span> std.<span class=\"me1\">algorithm</span><span class=\"sy0\">,</span> std.<span class=\"kw4\">string</span><span class=\"sy0\">;</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> matchmaker<span class=\"br0\">(</span><span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> guyPrefers<span class=\"sy0\">,</span><br/>                          <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> girlPrefers<span class=\"br0\">)</span> <span class=\"coMULTI\">/*@safe*/</span> <span class=\"br0\">{</span><br/>    <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> engagedTo<span class=\"sy0\">;</span><br/>    <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span> freeGuys <span class=\"sy0\">=</span> guyPrefers.<span class=\"me1\">keys</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw1\">while</span> <span class=\"br0\">(</span>freeGuys.<span class=\"me1\">length</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw4\">const</span> <span class=\"kw4\">string</span> thisGuy <span class=\"sy0\">=</span> freeGuys<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        freeGuys.<span class=\"me1\">popFront</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"kw4\">const</span> <span class=\"kw4\">auto</span> thisGuyPrefers <span class=\"sy0\">=</span> guyPrefers<span class=\"br0\">[</span>thisGuy<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>girl<span class=\"sy0\">;</span> thisGuyPrefers<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>girl <span class=\"sy0\">!</span><span class=\"kw2\">in</span> engagedTo<span class=\"br0\">)</span> <span class=\"br0\">{</span> <span class=\"co1\">// girl is free</span><br/>                engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span> <span class=\"sy0\">=</span> thisGuy<span class=\"sy0\">;</span><br/>                <span class=\"kw1\">break</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span> <span class=\"kw1\">else</span> <span class=\"br0\">{</span><br/>                <span class=\"kw4\">string</span> otherGuy <span class=\"sy0\">=</span> engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>                <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span> thisGirlPrefers <span class=\"sy0\">=</span> girlPrefers<span class=\"br0\">[</span>girl<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">if</span> <span class=\"br0\">(</span>thisGirlPrefers.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>thisGuy<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span><br/>                    thisGirlPrefers.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>otherGuy<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    <span class=\"co1\">// this girl prefers this guy to</span><br/>                    <span class=\"co1\">// the guy she's engagedTo to.</span><br/>                    engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span> <span class=\"sy0\">=</span> thisGuy<span class=\"sy0\">;</span><br/>                    freeGuys <span class=\"sy0\">~=</span> otherGuy<span class=\"sy0\">;</span><br/>                    <span class=\"kw1\">break</span><span class=\"sy0\">;</span><br/>                <span class=\"br0\">}</span><br/>                <span class=\"co1\">// else no change, keep looking for this guy</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">return</span> engagedTo<span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw4\">bool</span> check<span class=\"br0\">(</span><span class=\"kw4\">bool</span> doPrint<span class=\"sy0\">=</span><span class=\"kw2\">false</span><span class=\"br0\">)</span><span class=\"br0\">(</span><span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> engagedTo<span class=\"sy0\">,</span><br/>                               <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> guyPrefers<span class=\"sy0\">,</span><br/>                               <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> galPrefers<span class=\"br0\">)</span> @<span class=\"kw4\">safe</span> <span class=\"br0\">{</span><br/>    <span class=\"kw4\">enum</span> MSG <span class=\"sy0\">=</span> <span class=\"st0\">\"%s likes\u00a0%s better than\u00a0%s and\u00a0%s \"</span> <span class=\"sy0\">~</span><br/>               <span class=\"st0\">\"likes\u00a0%s better than their current partner\"</span><span class=\"sy0\">;</span><br/>    <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> inverseEngaged<span class=\"sy0\">;</span><br/>    <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>k<span class=\"sy0\">,</span> v<span class=\"sy0\">;</span> engagedTo<span class=\"br0\">)</span><br/>        inverseEngaged<span class=\"br0\">[</span>v<span class=\"br0\">]</span> <span class=\"sy0\">=</span> k<span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>she<span class=\"sy0\">,</span> he<span class=\"sy0\">;</span> engagedTo<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw4\">auto</span> sheLikes <span class=\"sy0\">=</span> galPrefers<span class=\"br0\">[</span>she<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        <span class=\"kw4\">auto</span> sheLikesBetter <span class=\"sy0\">=</span> sheLikes<span class=\"br0\">[</span><span class=\"nu0\">0</span> <span class=\"sy0\">..</span> <span class=\"me1\">sheLikes</span>.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>he<span class=\"br0\">)</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        <span class=\"kw4\">auto</span> heLikes <span class=\"sy0\">=</span> guyPrefers<span class=\"br0\">[</span>he<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        <span class=\"kw4\">auto</span> heLikesBetter <span class=\"sy0\">=</span> heLikes<span class=\"br0\">[</span><span class=\"nu0\">0</span> <span class=\"sy0\">..</span> <span class=\"me1\">heLikes</span>.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>she<span class=\"br0\">)</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>guy<span class=\"sy0\">;</span> sheLikesBetter<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw4\">auto</span> guysGirl <span class=\"sy0\">=</span> inverseEngaged<span class=\"br0\">[</span>guy<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>            <span class=\"kw4\">auto</span> guyLikes <span class=\"sy0\">=</span> guyPrefers<span class=\"br0\">[</span>guy<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>guyLikes.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>guysGirl<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span><br/>                guyLikes.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>she<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <span class=\"kw4\">static</span> <span class=\"kw1\">if</span> <span class=\"br0\">(</span>doPrint<span class=\"br0\">)</span><br/>                    writefln<span class=\"br0\">(</span>MSG<span class=\"sy0\">,</span> she<span class=\"sy0\">,</span> guy<span class=\"sy0\">,</span> he<span class=\"sy0\">,</span> guy<span class=\"sy0\">,</span> she<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>gal<span class=\"sy0\">;</span> heLikesBetter<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw4\">auto</span> girlsGuy <span class=\"sy0\">=</span> engagedTo<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>            <span class=\"kw4\">auto</span> galLikes <span class=\"sy0\">=</span> galPrefers<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>galLikes.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>girlsGuy<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span><br/>                galLikes.<span class=\"me1\">countUntil</span><span class=\"br0\">(</span>he<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <span class=\"kw4\">static</span> <span class=\"kw1\">if</span> <span class=\"br0\">(</span>doPrint<span class=\"br0\">)</span><br/>                    writefln<span class=\"br0\">(</span>MSG<span class=\"sy0\">,</span> he<span class=\"sy0\">,</span> gal<span class=\"sy0\">,</span> she<span class=\"sy0\">,</span> gal<span class=\"sy0\">,</span> he<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">return</span> <span class=\"kw2\">true</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw4\">void</span> main<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"coMULTI\">/*@safe*/</span> <span class=\"br0\">{</span><br/>    <span class=\"kw4\">auto</span> guyData <span class=\"sy0\">=</span> <span class=\"st0\">\"abe  abi eve cath ivy jan dee fay bea hope gay<br/>                    bob  cath hope abi dee eve fay bea jan ivy gay<br/>                    col  hope eve abi dee bea fay ivy gay cath jan<br/>                    dan  ivy fay dee gay hope eve jan bea cath abi<br/>                    ed   jan dee bea cath fay eve abi ivy hope gay<br/>                    fred bea abi dee gay eve ivy cath jan hope fay<br/>                    gav  gay eve ivy bea cath abi dee hope jan fay<br/>                    hal  abi eve hope fay ivy cath jan bea gay dee<br/>                    ian  hope cath dee gay bea abi fay ivy jan eve<br/>                    jon  abi fay jan gay eve bea dee cath ivy hope\"</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw4\">auto</span> galData <span class=\"sy0\">=</span> <span class=\"st0\">\"abi  bob fred jon gav ian abe dan ed col hal<br/>                    bea  bob abe col fred gav dan ian ed jon hal<br/>                    cath fred bob ed gav hal col ian abe dan jon<br/>                    dee  fred jon col abe ian hal gav dan bob ed<br/>                    eve  jon hal fred dan abe gav col ed ian bob<br/>                    fay  bob abe ed ian jon dan fred gav col hal<br/>                    gay  jon gav hal fred bob abe col ed dan ian<br/>                    hope gav jon bob abe ian dan hal ed col fred<br/>                    ivy  ian col hal gav fred bob abe ed jon dan<br/>                    jan  ed hal gav abe bob jon col ian fred dan\"</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">[</span><span class=\"kw4\">string</span><span class=\"br0\">]</span> guyPrefers<span class=\"sy0\">,</span> galPrefers<span class=\"sy0\">;</span><br/>    <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>line<span class=\"sy0\">;</span> guyData.<span class=\"me1\">splitLines</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        guyPrefers<span class=\"br0\">[</span>split<span class=\"br0\">(</span>line<span class=\"br0\">)</span><span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span> <span class=\"sy0\">=</span> split<span class=\"br0\">(</span>line<span class=\"br0\">)</span><span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"sy0\">..</span>$<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>line<span class=\"sy0\">;</span> galData.<span class=\"me1\">splitLines</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        galPrefers<span class=\"br0\">[</span>split<span class=\"br0\">(</span>line<span class=\"br0\">)</span><span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span> <span class=\"sy0\">=</span> split<span class=\"br0\">(</span>line<span class=\"br0\">)</span><span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"sy0\">..</span>$<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    writeln<span class=\"br0\">(</span><span class=\"st0\">\"Engagements:\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw4\">auto</span> engagedTo <span class=\"sy0\">=</span> matchmaker<span class=\"br0\">(</span>guyPrefers<span class=\"sy0\">,</span> galPrefers<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    writeln<span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es1\">\\n</span>Couples:\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw4\">string</span><span class=\"br0\">[</span><span class=\"br0\">]</span> parts<span class=\"sy0\">;</span><br/>    <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>k<span class=\"sy0\">;</span> engagedTo.<span class=\"me1\">keys</span>.<span class=\"me1\">sort</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        writefln<span class=\"br0\">(</span><span class=\"st0\">\"%s is engagedTo to\u00a0%s\"</span><span class=\"sy0\">,</span> k<span class=\"sy0\">,</span> engagedTo<span class=\"br0\">[</span>k<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    writeln<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw4\">bool</span> c <span class=\"sy0\">=</span> check<span class=\"sy0\">!</span><span class=\"br0\">(</span><span class=\"kw2\">true</span><span class=\"br0\">)</span><span class=\"br0\">(</span>engagedTo<span class=\"sy0\">,</span> guyPrefers<span class=\"sy0\">,</span> galPrefers<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    writeln<span class=\"br0\">(</span><span class=\"st0\">\"Marriages are \"</span><span class=\"sy0\">,</span> c <span class=\"sy0\">?</span> <span class=\"st0\">\"stable\"</span> <span class=\"sy0\">:</span> <span class=\"st0\">\"unstable\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    writeln<span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es1\">\\n</span><span class=\"es1\">\\n</span>Swapping two fiances to introduce an error\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw4\">auto</span> gals <span class=\"sy0\">=</span> galPrefers.<span class=\"me1\">keys</span>.<span class=\"me1\">sort</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    swap<span class=\"br0\">(</span>engagedTo<span class=\"br0\">[</span>gals<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"sy0\">,</span> engagedTo<span class=\"br0\">[</span>gals<span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">foreach</span> <span class=\"br0\">(</span>gal<span class=\"sy0\">;</span> gals<span class=\"br0\">[</span><span class=\"nu0\">0</span> <span class=\"sy0\">..</span> <span class=\"nu0\">2</span><span class=\"br0\">]</span><span class=\"br0\">)</span><br/>        writefln<span class=\"br0\">(</span><span class=\"st0\">\" \u00a0%s is now engagedTo to\u00a0%s\"</span><span class=\"sy0\">,</span> gal<span class=\"sy0\">,</span> engagedTo<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    writeln<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    c <span class=\"sy0\">=</span> check<span class=\"sy0\">!</span><span class=\"br0\">(</span><span class=\"kw2\">true</span><span class=\"br0\">)</span><span class=\"br0\">(</span>engagedTo<span class=\"sy0\">,</span> guyPrefers<span class=\"sy0\">,</span> galPrefers<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    writeln<span class=\"br0\">(</span><span class=\"st0\">\"Marriages are \"</span><span class=\"sy0\">,</span> c <span class=\"sy0\">?</span> <span class=\"st0\">\"stable\"</span> <span class=\"sy0\">:</span> <span class=\"st0\">\"unstable\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "EchoLisp", "loc": 76, "block": "<pre class=\"scheme highlighted_source\">\u00a0<br/><span class=\"br0\">(</span>lib 'hash<span class=\"br0\">)</span><br/><span class=\"co1\">;; input data</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> M<span class=\"sy0\">-</span>RANKS <br/>'<span class=\"br0\">(</span><span class=\"br0\">(</span> abe abi eve cath ivy jan dee fay bea hope gay<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  bob cath hope abi dee eve fay bea jan ivy gay<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  col hope eve abi dee bea fay ivy gay cath jan<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  dan ivy fay dee gay hope eve jan bea cath abi<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>   ed jan dee bea cath fay eve abi ivy hope gay<span class=\"br0\">)</span><br/><span class=\"br0\">(</span> fred bea abi dee gay eve ivy cath jan hope fay<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  gav gay eve ivy bea cath abi dee hope jan fay<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  hal abi eve hope fay ivy cath jan bea gay dee<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  ian hope cath dee gay bea abi fay ivy jan eve<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  jon abi fay jan gay eve bea dee cath ivy hope<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> W<span class=\"sy0\">-</span>RANKS <br/>'<span class=\"br0\">(</span><span class=\"br0\">(</span>  abi bob fred jon gav ian abe dan ed col hal<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  bea bob abe col fred gav dan ian ed jon hal<span class=\"br0\">)</span><br/><span class=\"br0\">(</span> cath fred bob ed gav hal col ian abe dan jon<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  dee fred jon col abe ian hal gav dan bob ed<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  eve jon hal fred dan abe gav col ed ian bob<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  fay bob abe ed ian jon dan fred gav col hal<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  gay jon gav hal fred bob abe col ed dan ian<span class=\"br0\">)</span><br/><span class=\"br0\">(</span> hope gav jon bob abe ian dan hal ed col fred<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  ivy ian col hal gav fred bob abe ed jon dan<span class=\"br0\">)</span><br/><span class=\"br0\">(</span>  jan ed hal gav abe bob jon col ian fred dan<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">;; build preferences hash</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>set<span class=\"sy0\">-</span>prefs ranks  prefs<span class=\"br0\">)</span><br/>    <span class=\"br0\">(</span>for<span class=\"sy0\">/</span><span class=\"kw1\">list</span> <span class=\"br0\">(</span><span class=\"br0\">(</span>r ranks<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>set prefs <span class=\"br0\">(</span>first r<span class=\"br0\">)</span> <span class=\"br0\">(</span>rest r<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"br0\">(</span>first r<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>engage  m w<span class=\"br0\">)</span>    <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>set ENGAGED m w<span class=\"br0\">)</span> <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>set ENGAGED w m<span class=\"br0\">)</span> <span class=\"br0\">(</span>writeln  m w '\ud83d\udc6b <span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>disengage  m w<span class=\"br0\">)</span> <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>remove<span class=\"sy0\">!</span> ENGAGED m <span class=\"br0\">)</span> <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>remove<span class=\"sy0\">!</span> ENGAGED w<span class=\"br0\">)</span> <span class=\"br0\">(</span>writeln '\ud83d\udc94 m w<span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>engaged x<span class=\"br0\">)</span>      <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>ref ENGAGED x<span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>free? x<span class=\"br0\">)</span>        <span class=\"br0\">(</span><span class=\"kw1\">not</span> <span class=\"br0\">(</span>engaged x<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>free<span class=\"sy0\">-</span>man men<span class=\"br0\">)</span>   <span class=\"br0\">(</span>for <span class=\"br0\">(</span><span class=\"br0\">(</span>man men<span class=\"br0\">)</span><span class=\"br0\">)</span> #:break <span class=\"br0\">(</span>free? man<span class=\"br0\">)</span> <span class=\"sy0\">=&gt;</span> man  #f<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>prefers? prefs x a b<span class=\"br0\">)</span> <span class=\"br0\">(</span><span class=\"kw1\">member</span> b  <span class=\"br0\">(</span><span class=\"kw1\">member</span> a <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>ref prefs x<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"co1\">;; get first choice and remove it from prefs list</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>first<span class=\"sy0\">-</span>choice prefs m<span class=\"br0\">)</span> <br/>    <span class=\"br0\">(</span><span class=\"kw1\">define</span> w <span class=\"br0\">(</span>first <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>ref prefs m<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>set prefs m <span class=\"br0\">(</span>rest <span class=\"br0\">(</span>hash<span class=\"sy0\">-</span>ref prefs m<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    w<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">;; sets ENGAGED couples</span><br/><span class=\"co1\">;;  https//en.wikipedia.org/wiki/Stable_marriage_problem</span><br/>\u00a0<br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>stableMatching  <span class=\"br0\">(</span>prefs <span class=\"br0\">(</span>make<span class=\"sy0\">-</span>hash<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">(</span>m<span class=\"br0\">)</span> <span class=\"br0\">(</span>w<span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"br0\">(</span>define<span class=\"sy0\">-</span>global 'ENGAGED <span class=\"br0\">(</span>make<span class=\"sy0\">-</span>hash<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"br0\">(</span><span class=\"kw1\">define</span> men   <span class=\"br0\">(</span>set<span class=\"sy0\">-</span>prefs  M<span class=\"sy0\">-</span>RANKS prefs<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"br0\">(</span><span class=\"kw1\">define</span> women <span class=\"br0\">(</span>set<span class=\"sy0\">-</span>prefs  W<span class=\"sy0\">-</span>RANKS prefs<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"br0\">(</span>while <span class=\"br0\">(</span>setv<span class=\"sy0\">!</span> m <span class=\"br0\">(</span>free<span class=\"sy0\">-</span>man men<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"br0\">(</span><span class=\"kw1\">set!</span> w <span class=\"br0\">(</span>first<span class=\"sy0\">-</span>choice prefs m<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"br0\">(</span><span class=\"kw1\">if</span> <span class=\"br0\">(</span>free? w<span class=\"br0\">)</span><br/>            <span class=\"br0\">(</span>engage m w<span class=\"br0\">)</span><br/>            <span class=\"br0\">(</span><span class=\"kw1\">let</span> <span class=\"br0\">[</span><span class=\"br0\">(</span>dumped <span class=\"br0\">(</span>engaged w<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">]</span><br/>            <span class=\"br0\">(</span>when <span class=\"br0\">(</span>prefers? prefs w m dumped<span class=\"br0\">)</span><br/>                <span class=\"br0\">(</span>disengage w dumped<span class=\"br0\">)</span><br/>                <span class=\"br0\">(</span>engage w m<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/> <span class=\"br0\">(</span>hash<span class=\"sy0\">-&gt;</span><span class=\"kw1\">list</span> ENGAGED<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">;; input\u00a0: ENGAGED couples</span><br/><span class=\"br0\">(</span><span class=\"kw1\">define</span> <span class=\"br0\">(</span>checkStable <span class=\"br0\">(</span>prefs <span class=\"br0\">(</span>make<span class=\"sy0\">-</span>hash<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"br0\">(</span><span class=\"kw1\">define</span> men   <span class=\"br0\">(</span>set<span class=\"sy0\">-</span>prefs  M<span class=\"sy0\">-</span>RANKS  prefs<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"br0\">(</span><span class=\"kw1\">define</span> women <span class=\"br0\">(</span>set<span class=\"sy0\">-</span>prefs  W<span class=\"sy0\">-</span>RANKS  prefs<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\t<span class=\"br0\">(</span>for<span class=\"sy0\">*</span> <span class=\"br0\">[</span><span class=\"br0\">(</span>man men<span class=\"br0\">)</span> <span class=\"br0\">(</span>woman women<span class=\"br0\">)</span><span class=\"br0\">]</span><br/>\t#:continue <span class=\"br0\">(</span><span class=\"kw1\">equal?</span> woman <span class=\"br0\">(</span>engaged man<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\t\t\t<span class=\"br0\">(</span>when <span class=\"br0\">(</span><span class=\"kw1\">and</span> <br/>\t\t\t\t\t<span class=\"br0\">(</span>prefers? prefs man woman <span class=\"br0\">(</span>engaged man<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\t\t\t\t\t<span class=\"br0\">(</span>prefers? prefs woman man <span class=\"br0\">(</span>engaged woman<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\t\t\t\t\t<span class=\"br0\">(</span>error 'not<span class=\"sy0\">-</span>stable <span class=\"br0\">(</span><span class=\"kw1\">list</span> man woman<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0</pre>"}, {"lang": "F#", "loc": 147, "block": "<pre class=\"fsharp highlighted_source\"><span class=\"kw1\">let</span> menPrefs <span class=\"sy0\">=</span><br/>  <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">ofList</span><br/>            <span class=\"br0\">[</span><span class=\"st0\">\"abe\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"bob\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"col\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"dan\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"ed\"</span>,   <span class=\"br0\">[</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"fred\"</span>, <span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"gav\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"hal\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"ian\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>             <span class=\"st0\">\"jon\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"kw1\">let</span> womenPrefs <span class=\"sy0\">=</span><br/>   <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">ofList</span><br/>              <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"bea\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"cath\"</span>, <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"dee\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"eve\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"fay\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"gay\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"hope\"</span>, <span class=\"br0\">[</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"ivy\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>               <span class=\"st0\">\"jan\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>              <span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"kw1\">let</span> men <span class=\"sy0\">=</span> menPrefs <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">toList</span> <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">map</span> <span class=\"kw3\">fst</span> <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">sort</span><br/><span class=\"kw1\">let</span> women <span class=\"sy0\">=</span> womenPrefs <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">toList</span> <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">map</span> <span class=\"kw3\">fst</span> <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">sort</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">type</span> Configuration <span class=\"sy0\">=</span><br/> <span class=\"br0\">{</span><br/>   proposed: <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>,<span class=\"kw4\">string</span> list<span class=\"sy0\">&gt;;</span> <span class=\"co1\">// man -&gt; list of women</span><br/>   wifeOf: <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>, <span class=\"kw4\">string</span><span class=\"sy0\">&gt;;</span> <span class=\"co1\">// man -&gt; woman</span><br/>   husbandOf: <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>, <span class=\"kw4\">string</span><span class=\"sy0\">&gt;;</span>  <span class=\"co1\">// woman -&gt; man</span><br/> <span class=\"br0\">}</span><br/>\u00a0<br/>\u00a0<br/><span class=\"co1\">// query functions</span><br/>\u00a0<br/><span class=\"kw1\">let</span> isFreeMan config man <span class=\"sy0\">=</span> config.<span class=\"me1\">wifeOf</span>.<span class=\"me1\">TryFind</span> man <span class=\"sy0\">=</span> None<br/>\u00a0<br/><span class=\"kw1\">let</span> isFreeWoman config woman <span class=\"sy0\">=</span> config.<span class=\"me1\">husbandOf</span>.<span class=\"me1\">TryFind</span> woman <span class=\"sy0\">=</span> None<br/>\u00a0<br/><span class=\"kw1\">let</span> hasProposedTo config man woman <span class=\"sy0\">=</span><br/>  defaultArg <span class=\"br0\">(</span>config.<span class=\"me1\">proposed</span>.<span class=\"me1\">TryFind</span><span class=\"br0\">(</span>man<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">[</span><span class=\"br0\">]</span><br/>  <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">exists</span> <span class=\"br0\">(</span><span class=\"br0\">(</span><span class=\"sy0\">=</span><span class=\"br0\">)</span> woman<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">// helper</span><br/><span class=\"kw1\">let</span> negate f <span class=\"sy0\">=</span> <span class=\"kw1\">fun</span> x <span class=\"sy0\">-&gt;</span> <span class=\"kw1\">not</span> <span class=\"br0\">(</span>f x<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">// returns those 'women' who 'man' has not proposed to before</span><br/><span class=\"kw1\">let</span> notProposedBy config man women <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">filter</span> <span class=\"br0\">(</span>negate <span class=\"br0\">(</span>hasProposedTo config man<span class=\"br0\">)</span><span class=\"br0\">)</span> women<br/>\u00a0<br/><span class=\"kw1\">let</span> prefers <span class=\"br0\">(</span>prefs:<a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>,<span class=\"kw4\">string</span> list<span class=\"sy0\">&gt;</span><span class=\"br0\">)</span> w m1 m2 <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> order <span class=\"sy0\">=</span> prefs.<span class=\"br0\">[</span>w<span class=\"br0\">]</span><br/>  <span class=\"kw1\">let</span> m1i <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">findIndex</span> <span class=\"br0\">(</span><span class=\"br0\">(</span><span class=\"sy0\">=</span><span class=\"br0\">)</span> m1<span class=\"br0\">)</span> order<br/>  <span class=\"kw1\">let</span> m2i <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">findIndex</span> <span class=\"br0\">(</span><span class=\"br0\">(</span><span class=\"sy0\">=</span><span class=\"br0\">)</span> m2<span class=\"br0\">)</span> order<br/>  m1i <span class=\"sy0\">&lt;</span> m2i<br/>\u00a0<br/><span class=\"kw1\">let</span> womanPrefers <span class=\"sy0\">=</span> prefers womenPrefs<br/><span class=\"kw1\">let</span> manPrefers <span class=\"sy0\">=</span> prefers menPrefs<br/>\u00a0<br/><span class=\"co1\">// returns the women that m likes better than his current fianc\u00e9e</span><br/><span class=\"kw1\">let</span> preferredWomen config m <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> w <span class=\"sy0\">=</span> config.<span class=\"me1\">wifeOf</span>.<span class=\"br0\">[</span>m<span class=\"br0\">]</span><br/>  women<br/>  <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">filter</span> <span class=\"br0\">(</span><span class=\"kw1\">fun</span> w<span class=\"st0\">' -&gt; manPrefers m w'</span> w<span class=\"br0\">)</span>  <span class=\"co1\">// '</span><br/>\u00a0<br/><span class=\"co1\">// whether there is a woman who m likes better than his current fianc\u00e9e</span><br/><span class=\"co1\">// and who also likes him better than her current fianc\u00e9</span><br/><span class=\"kw1\">let</span> prefersAWomanWhoAlsoPrefersHim config m <span class=\"sy0\">=</span><br/>  preferredWomen config m<br/>  <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">exists</span> <span class=\"br0\">(</span><span class=\"kw1\">fun</span> w <span class=\"sy0\">-&gt;</span> womanPrefers w m config.<span class=\"me1\">husbandOf</span>.<span class=\"br0\">[</span>w<span class=\"br0\">]</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">let</span> isStable config <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">not</span> <span class=\"br0\">(</span><a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">exists</span> <span class=\"br0\">(</span>prefersAWomanWhoAlsoPrefersHim config<span class=\"br0\">)</span> men<span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/><span class=\"co1\">// modifiers (return new configurations)</span><br/>\u00a0<br/><span class=\"kw1\">let</span> engage config man woman <span class=\"sy0\">=</span><br/>  <span class=\"br0\">{</span> config <span class=\"kw1\">with</span> wifeOf <span class=\"sy0\">=</span> config.<span class=\"me1\">wifeOf</span>.<span class=\"me1\">Add</span><span class=\"br0\">(</span>man, woman<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                husbandOf <span class=\"sy0\">=</span> config.<span class=\"me1\">husbandOf</span>.<span class=\"me1\">Add</span><span class=\"br0\">(</span>woman, man<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">let</span> breakOff config man <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> woman <span class=\"sy0\">=</span> config.<span class=\"me1\">wifeOf</span>.<span class=\"br0\">[</span>man<span class=\"br0\">]</span><br/>  <span class=\"br0\">{</span> config <span class=\"kw1\">with</span> wifeOf <span class=\"sy0\">=</span> config.<span class=\"me1\">wifeOf</span>.<span class=\"me1\">Remove</span><span class=\"br0\">(</span>man<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                husbandOf <span class=\"sy0\">=</span> config.<span class=\"me1\">husbandOf</span>.<span class=\"me1\">Remove</span><span class=\"br0\">(</span>woman<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">let</span> propose config m w <span class=\"sy0\">=</span><br/>  <span class=\"co1\">// remember the proposition</span><br/>  <span class=\"kw1\">let</span> proposedByM <span class=\"sy0\">=</span> defaultArg <span class=\"br0\">(</span>config.<span class=\"me1\">proposed</span>.<span class=\"me1\">TryFind</span> m<span class=\"br0\">)</span> <span class=\"br0\">[</span><span class=\"br0\">]</span><br/>  <span class=\"kw1\">let</span> proposed<span class=\"st0\">' = config.proposed.Add(m, w::proposedByM) // '</span><br/>  <span class=\"kw1\">let</span> config <span class=\"sy0\">=</span> <span class=\"br0\">{</span> config <span class=\"kw1\">with</span> proposed <span class=\"sy0\">=</span> proposed<span class=\"st0\">'}  // '</span><br/>  <span class=\"co1\">// actually try to engage</span><br/>  <span class=\"kw1\">if</span> isFreeWoman config w <span class=\"kw1\">then</span> engage config m w<br/>  <span class=\"kw1\">else</span><br/>    <span class=\"kw1\">let</span> m<span class=\"st0\">' = config.husbandOf.[w] // '</span><br/>    <span class=\"kw1\">if</span> womanPrefers w m m<span class=\"st0\">' then // '</span><br/>      <span class=\"kw1\">let</span> config <span class=\"sy0\">=</span> breakOff config m<span class=\"st0\">' // '</span><br/>      engage config m w<br/>    <span class=\"kw1\">else</span><br/>      config<br/>\u00a0<br/><span class=\"co1\">// do one step of the algorithm; returns None if no more steps are possible</span><br/><span class=\"kw1\">let</span> step config\u00a0: Configuration <span class=\"kw4\">option</span> <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> freeMen <span class=\"sy0\">=</span> men <span class=\"sy0\">|&gt;</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">filter</span> <span class=\"br0\">(</span>isFreeMan config<span class=\"br0\">)</span><br/>  <span class=\"kw1\">let</span> menWhoCanPropose <span class=\"sy0\">=</span><br/>    freeMen <span class=\"sy0\">|&gt;</span><br/>    <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">filter</span> <span class=\"br0\">(</span><span class=\"kw1\">fun</span> man <span class=\"sy0\">-&gt;</span> <span class=\"br0\">(</span>notProposedBy config man women<span class=\"br0\">)</span> <span class=\"sy0\">&lt;&gt;</span> <span class=\"br0\">[</span><span class=\"br0\">]</span> <span class=\"br0\">)</span><br/>  <span class=\"kw1\">match</span> menWhoCanPropose <span class=\"kw1\">with</span><br/>  | <span class=\"br0\">[</span><span class=\"br0\">]</span> <span class=\"sy0\">-&gt;</span> None<br/>  | m::_ <span class=\"sy0\">-&gt;</span> <span class=\"kw1\">let</span> unproposedByM <span class=\"sy0\">=</span> menPrefs.<span class=\"br0\">[</span>m<span class=\"br0\">]</span> <span class=\"sy0\">|&gt;</span> notProposedBy config m<br/>            <span class=\"co1\">// w is automatically the highest ranked because menPrefs.[m] is the source</span><br/>            <span class=\"kw1\">let</span> w <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">List</span></a>.<span class=\"me1\">head</span> unproposedByM<br/>            Some<span class=\"br0\">(</span> propose config m w <span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">let</span> <span class=\"kw1\">rec</span> loop config <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">match</span> step config <span class=\"kw1\">with</span><br/>  | None <span class=\"sy0\">-&gt;</span> config<br/>  | Some config<span class=\"st0\">' -&gt; loop config'</span> <span class=\"co1\">// '</span><br/>\u00a0<br/>\u00a0<br/><span class=\"co1\">// find solution and print it</span><br/><span class=\"kw1\">let</span> solution <span class=\"sy0\">=</span> loop <span class=\"br0\">{</span> proposed <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">empty</span><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>, <span class=\"kw4\">string</span> list<span class=\"sy0\">&gt;;</span><br/>                      wifeOf <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">empty</span><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>, <span class=\"kw4\">string</span><span class=\"sy0\">&gt;;</span><br/>                      husbandOf <span class=\"sy0\">=</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">empty</span><span class=\"sy0\">&lt;</span><span class=\"kw4\">string</span>, <span class=\"kw4\">string</span><span class=\"sy0\">&gt;</span> <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">for</span> woman, man <span class=\"kw1\">in</span> <a href=\"http://research.microsoft.com/en-us/um/cambridge/projects/fsharp/manual/namespaces.html\"><span class=\"kw2\">Map</span></a>.<span class=\"me1\">toList</span> solution.<span class=\"me1\">husbandOf</span> <span class=\"kw1\">do</span><br/>  printfn <span class=\"st0\">\"%s is engaged to\u00a0%s\"</span> woman man<br/>\u00a0<br/>printfn <span class=\"st0\">\"Solution is stable:\u00a0%A\"</span> <span class=\"br0\">(</span>isStable solution<span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/><span class=\"co1\">// create unstable configuration by perturbing the solution</span><br/><span class=\"kw1\">let</span> perturbed <span class=\"sy0\">=</span> <br/>  <span class=\"kw1\">let</span> gal0 <span class=\"sy0\">=</span> women.<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><br/>  <span class=\"kw1\">let</span> gal1 <span class=\"sy0\">=</span> women.<span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><br/>  <span class=\"kw1\">let</span> guy0 <span class=\"sy0\">=</span> solution.<span class=\"me1\">husbandOf</span>.<span class=\"br0\">[</span>gal0<span class=\"br0\">]</span><br/>  <span class=\"kw1\">let</span> guy1 <span class=\"sy0\">=</span> solution.<span class=\"me1\">husbandOf</span>.<span class=\"br0\">[</span>gal1<span class=\"br0\">]</span><br/>  <span class=\"br0\">{</span> solution <span class=\"kw1\">with</span> wifeOf <span class=\"sy0\">=</span> solution.<span class=\"me1\">wifeOf</span>.<span class=\"me1\">Add</span><span class=\"br0\">(</span> guy0, gal1 <span class=\"br0\">)</span>.<span class=\"me1\">Add</span><span class=\"br0\">(</span> guy1, gal0 <span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                  husbandOf <span class=\"sy0\">=</span> solution.<span class=\"me1\">husbandOf</span>.<span class=\"me1\">Add</span><span class=\"br0\">(</span> gal0, guy1 <span class=\"br0\">)</span>.<span class=\"me1\">Add</span><span class=\"br0\">(</span> gal1, guy0 <span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/>printfn <span class=\"st0\">\"Perturbed is stable:\u00a0%A\"</span> <span class=\"br0\">(</span>isStable perturbed<span class=\"br0\">)</span></pre>"}, {"lang": "Go", "loc": 204, "block": "<pre class=\"go highlighted_source\"><span class=\"kw1\">package</span> main<br/>\u00a0<br/><span class=\"kw1\">import</span> <span class=\"st0\">\"fmt\"</span><br/>\u00a0<br/><span class=\"co1\">// Asymetry in the algorithm suggests different data structures for the</span><br/><span class=\"co1\">// map value types of the proposers and the recipients.  Proposers go down</span><br/><span class=\"co1\">// their list of preferences in order, and do not need random access.</span><br/><span class=\"co1\">// Recipients on the other hand must compare their preferences to arbitrary</span><br/><span class=\"co1\">// proposers.  A slice is adequate for proposers, but a map allows direct</span><br/><span class=\"co1\">// lookups for recipients and avoids looping code.</span><br/><span class=\"kw1\">type</span> proposers <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">][]</span><span class=\"kw4\">string</span><br/>\u00a0<br/><span class=\"kw1\">var</span> mPref <span class=\"sy2\">=</span> proposers<span class=\"sy1\">{</span><br/>    <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hope\"</span><span class=\"sy1\">},</span><br/><span class=\"sy1\">}</span><br/>\u00a0<br/><span class=\"kw1\">type</span> recipients <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><br/>\u00a0<br/><span class=\"kw1\">var</span> wPref <span class=\"sy2\">=</span> recipients<span class=\"sy1\">{</span><br/>    <span class=\"st0\">\"abi\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"bea\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"cath\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"dee\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"eve\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"fay\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"gay\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"hope\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"ivy\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/>    <span class=\"st0\">\"jan\"</span><span class=\"sy1\">:</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><span class=\"sy1\">{</span><br/>        <span class=\"st0\">\"ed\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">1</span><span class=\"sy1\">,</span> <span class=\"st0\">\"hal\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">2</span><span class=\"sy1\">,</span> <span class=\"st0\">\"gav\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">3</span><span class=\"sy1\">,</span> <span class=\"st0\">\"abe\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">4</span><span class=\"sy1\">,</span> <span class=\"st0\">\"bob\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">5</span><span class=\"sy1\">,</span><br/>        <span class=\"st0\">\"jon\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">6</span><span class=\"sy1\">,</span> <span class=\"st0\">\"col\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">7</span><span class=\"sy1\">,</span> <span class=\"st0\">\"ian\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">8</span><span class=\"sy1\">,</span> <span class=\"st0\">\"fred\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">9</span><span class=\"sy1\">,</span> <span class=\"st0\">\"dan\"</span><span class=\"sy1\">:</span> <span class=\"nu0\">10</span><span class=\"sy1\">},</span><br/><span class=\"sy1\">}</span><br/>\u00a0<br/><span class=\"kw4\">func</span> main<span class=\"sy1\">()</span> <span class=\"sy1\">{</span><br/>    <span class=\"co1\">// get parings by Gale/Shapley algorithm</span><br/>    ps <span class=\"sy2\">:=</span> pair<span class=\"sy1\">(</span>mPref<span class=\"sy1\">,</span> wPref<span class=\"sy1\">)</span><br/>    <span class=\"co1\">// show results</span><br/>    fmt<span class=\"sy3\">.</span><span class=\"me1\">Println</span><span class=\"sy1\">(</span><span class=\"st0\">\"<span class=\"es1\">\\n</span>result:\"</span><span class=\"sy1\">)</span><br/>    <span class=\"kw1\">if</span> <span class=\"sy3\">!</span>validateStable<span class=\"sy1\">(</span>ps<span class=\"sy1\">,</span> mPref<span class=\"sy1\">,</span> wPref<span class=\"sy1\">)</span> <span class=\"sy1\">{</span><br/>        <span class=\"kw1\">return</span> <br/>    <span class=\"sy1\">}</span><br/>    <span class=\"co1\">// perturb</span><br/>    <span class=\"kw1\">for</span> <span class=\"sy1\">{</span><br/>        <span class=\"nu2\">i</span> <span class=\"sy2\">:=</span> <span class=\"nu0\">0</span> <br/>        <span class=\"kw1\">var</span> w2<span class=\"sy1\">,</span> m2 <span class=\"sy1\">[</span><span class=\"nu0\">2</span><span class=\"sy1\">]</span><span class=\"kw4\">string</span><br/>        <span class=\"kw1\">for</span> w<span class=\"sy1\">,</span> m <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> ps <span class=\"sy1\">{</span><br/>            w2<span class=\"sy1\">[</span><span class=\"nu2\">i</span><span class=\"sy1\">]</span> <span class=\"sy2\">=</span> w<br/>            m2<span class=\"sy1\">[</span><span class=\"nu2\">i</span><span class=\"sy1\">]</span> <span class=\"sy2\">=</span> m<br/>            <span class=\"kw1\">if</span> <span class=\"nu2\">i</span> <span class=\"sy3\">==</span> <span class=\"nu0\">1</span> <span class=\"sy1\">{</span><br/>                <span class=\"kw1\">break</span><br/>            <span class=\"sy1\">}</span><br/>            <span class=\"nu2\">i</span><span class=\"sy2\">++</span><br/>        <span class=\"sy1\">}</span><br/>        fmt<span class=\"sy3\">.</span>Println<span class=\"sy1\">(</span><span class=\"st0\">\"<span class=\"es1\">\\n</span>exchanging partners of\"</span><span class=\"sy1\">,</span> m2<span class=\"sy1\">[</span><span class=\"nu0\">0</span><span class=\"sy1\">],</span> <span class=\"st0\">\"and\"</span><span class=\"sy1\">,</span> m2<span class=\"sy1\">[</span><span class=\"nu0\">1</span><span class=\"sy1\">])</span><br/>        ps<span class=\"sy1\">[</span>w2<span class=\"sy1\">[</span><span class=\"nu0\">0</span><span class=\"sy1\">]]</span> <span class=\"sy2\">=</span> m2<span class=\"sy1\">[</span><span class=\"nu0\">1</span><span class=\"sy1\">]</span><br/>        ps<span class=\"sy1\">[</span>w2<span class=\"sy1\">[</span><span class=\"nu0\">1</span><span class=\"sy1\">]]</span> <span class=\"sy2\">=</span> m2<span class=\"sy1\">[</span><span class=\"nu0\">0</span><span class=\"sy1\">]</span> <br/>        <span class=\"co1\">// validate perturbed parings</span><br/>        <span class=\"kw1\">if</span> <span class=\"sy3\">!</span>validateStable<span class=\"sy1\">(</span>ps<span class=\"sy1\">,</span> mPref<span class=\"sy1\">,</span> wPref<span class=\"sy1\">)</span> <span class=\"sy1\">{</span><br/>            <span class=\"kw1\">return</span><br/>        <span class=\"sy1\">}</span><br/>        <span class=\"co1\">// if those happened to be stable as well, perturb more</span><br/>    <span class=\"sy1\">}</span><br/><span class=\"sy1\">}</span>   <br/>\u00a0<br/><span class=\"kw1\">type</span> parings <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">string</span> <span class=\"co1\">// map[recipient]proposer (or map[w]m)</span><br/>\u00a0<br/><span class=\"co1\">// Pair implements the Gale/Shapley algorithm.</span><br/><span class=\"kw4\">func</span> pair<span class=\"sy1\">(</span>pPref proposers<span class=\"sy1\">,</span> rPref recipients<span class=\"sy1\">)</span> parings <span class=\"sy1\">{</span><br/>    <span class=\"co1\">// code is destructive on the maps, so work with copies</span><br/>    pFree <span class=\"sy2\">:=</span> proposers<span class=\"sy1\">{}</span><br/>    <span class=\"kw1\">for</span> k<span class=\"sy1\">,</span> v <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> pPref <span class=\"sy1\">{</span><br/>        pFree<span class=\"sy1\">[</span>k<span class=\"sy1\">]</span> <span class=\"sy2\">=</span> append<span class=\"sy1\">([]</span><span class=\"kw4\">string</span><span class=\"sy1\">{},</span> v<span class=\"sy4\">...</span><span class=\"sy1\">)</span><br/>    <span class=\"sy1\">}</span><br/>    rFree <span class=\"sy2\">:=</span> recipients<span class=\"sy1\">{}</span><br/>    <span class=\"kw1\">for</span> k<span class=\"sy1\">,</span> v <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> rPref <span class=\"sy1\">{</span><br/>        rFree<span class=\"sy1\">[</span>k<span class=\"sy1\">]</span> <span class=\"sy2\">=</span> v<br/>    <span class=\"sy1\">}</span><br/>    <span class=\"co1\">// struct only used in this function.</span><br/>    <span class=\"co1\">// preferences must be saved in case engagement is broken.</span><br/>    <span class=\"kw1\">type</span> save <span class=\"kw4\">struct</span> <span class=\"sy1\">{</span><br/>        proposer <span class=\"kw4\">string</span><br/>        pPref    <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><br/>        rPref    <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><br/>    <span class=\"sy1\">}</span><br/>    proposals <span class=\"sy2\">:=</span> <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span>save<span class=\"sy1\">{}</span> <span class=\"co1\">// key is recipient (w)</span><br/>\u00a0<br/>    <span class=\"co1\">// WP pseudocode comments prefaced with WP: m is proposer, w is recipient.</span><br/>    <span class=\"co1\">// WP: while \u2203 free man m who still has a woman w to propose to</span><br/>    <span class=\"kw1\">for</span> <span class=\"kw3\">len</span><span class=\"sy1\">(</span>pFree<span class=\"sy1\">)</span> &gt; <span class=\"nu0\">0</span> <span class=\"sy1\">{</span> <span class=\"co1\">// while there is a free proposer,</span><br/>        <span class=\"kw1\">var</span> proposer <span class=\"kw4\">string</span><br/>        <span class=\"kw1\">var</span> ppref <span class=\"sy1\">[]</span><span class=\"kw4\">string</span><br/>        <span class=\"kw1\">for</span> proposer<span class=\"sy1\">,</span> ppref <span class=\"sy2\">=</span> <span class=\"kw1\">range</span> pFree <span class=\"sy1\">{</span><br/>            <span class=\"kw1\">break</span> <span class=\"co1\">// pick a proposer at random, whatever range delivers first.</span><br/>        <span class=\"sy1\">}</span><br/>        <span class=\"kw1\">if</span> <span class=\"kw3\">len</span><span class=\"sy1\">(</span>ppref<span class=\"sy1\">)</span> <span class=\"sy3\">==</span> <span class=\"nu0\">0</span> <span class=\"sy1\">{</span><br/>            <span class=\"kw1\">continue</span> <span class=\"co1\">// if proposer has no possible recipients, skip</span><br/>        <span class=\"sy1\">}</span><br/>        <span class=\"co1\">// WP: w = m's highest ranked such woman to whom he has not yet proposed</span><br/>        recipient <span class=\"sy2\">:=</span> ppref<span class=\"sy1\">[</span><span class=\"nu0\">0</span><span class=\"sy1\">]</span> <span class=\"co1\">// highest ranged is first in list.</span><br/>        ppref <span class=\"sy2\">=</span> ppref<span class=\"sy1\">[</span><span class=\"nu0\">1</span><span class=\"sy1\">:]</span>     <span class=\"co1\">// pop from list</span><br/>        <span class=\"kw1\">var</span> rpref <span class=\"kw4\">map</span><span class=\"sy1\">[</span><span class=\"kw4\">string</span><span class=\"sy1\">]</span><span class=\"kw4\">int</span><br/>        <span class=\"kw1\">var</span> ok <span class=\"kw4\">bool</span><br/>        <span class=\"co1\">// WP: if w is free</span><br/>        <span class=\"kw1\">if</span> rpref<span class=\"sy1\">,</span> ok <span class=\"sy2\">=</span> rFree<span class=\"sy1\">[</span>recipient<span class=\"sy1\">];</span> ok <span class=\"sy1\">{</span><br/>            <span class=\"co1\">// WP: (m, w) become engaged</span><br/>            <span class=\"co1\">// (common code follows if statement)</span><br/>        <span class=\"sy1\">}</span> <span class=\"kw1\">else</span> <span class=\"sy1\">{</span><br/>            <span class=\"co1\">// WP: else some pair (m', w) already exists</span><br/>            s <span class=\"sy2\">:=</span> proposals<span class=\"sy1\">[</span>recipient<span class=\"sy1\">]</span> <span class=\"co1\">// get proposal saved preferences</span><br/>            <span class=\"co1\">// WP: if w prefers m to m'</span><br/>            <span class=\"kw1\">if</span> s<span class=\"sy3\">.</span>rPref<span class=\"sy1\">[</span>proposer<span class=\"sy1\">]</span> &lt; s<span class=\"sy3\">.</span>rPref<span class=\"sy1\">[</span>s<span class=\"sy3\">.</span>proposer<span class=\"sy1\">]</span> <span class=\"sy1\">{</span><br/>                fmt<span class=\"sy3\">.</span>Println<span class=\"sy1\">(</span><span class=\"st0\">\"engagement broken:\"</span><span class=\"sy1\">,</span> recipient<span class=\"sy1\">,</span> s<span class=\"sy3\">.</span><span class=\"me1\">proposer</span><span class=\"sy1\">)</span><br/>                <span class=\"co1\">// WP: m' becomes free</span><br/>                pFree<span class=\"sy1\">[</span>s<span class=\"sy3\">.</span><span class=\"me1\">proposer</span><span class=\"sy1\">]</span> <span class=\"sy2\">=</span> s<span class=\"sy3\">.</span><span class=\"me1\">pPref</span> <span class=\"co1\">// return proposer to the map</span><br/>                <span class=\"co1\">// WP: (m, w) become engaged</span><br/>                rpref <span class=\"sy2\">=</span> s<span class=\"sy3\">.</span><span class=\"me1\">rPref</span><br/>                <span class=\"co1\">// (common code follows if statement)</span><br/>            <span class=\"sy1\">}</span> <span class=\"kw1\">else</span> <span class=\"sy1\">{</span><br/>                <span class=\"co1\">// WP: else (m', w) remain engaged</span><br/>                pFree<span class=\"sy1\">[</span>proposer<span class=\"sy1\">]</span> <span class=\"sy2\">=</span> ppref <span class=\"co1\">// update preferences in map</span><br/>                <span class=\"kw1\">continue</span><br/>            <span class=\"sy1\">}</span> <br/>        <span class=\"sy1\">}</span><br/>        fmt<span class=\"sy3\">.</span>Println<span class=\"sy1\">(</span><span class=\"st0\">\"engagement:\"</span><span class=\"sy1\">,</span> recipient<span class=\"sy1\">,</span> proposer<span class=\"sy1\">)</span><br/>        proposals<span class=\"sy1\">[</span>recipient<span class=\"sy1\">]</span> <span class=\"sy2\">=</span> save<span class=\"sy1\">{</span>proposer<span class=\"sy1\">,</span> ppref<span class=\"sy1\">,</span> rpref<span class=\"sy1\">}</span><br/>        delete<span class=\"sy1\">(</span>pFree<span class=\"sy1\">,</span> proposer<span class=\"sy1\">)</span><br/>        delete<span class=\"sy1\">(</span>rFree<span class=\"sy1\">,</span> recipient<span class=\"sy1\">)</span><br/>    <span class=\"sy1\">}</span><br/>    <span class=\"co1\">// construct return value </span><br/>    ps <span class=\"sy2\">:=</span> parings<span class=\"sy1\">{}</span><br/>    <span class=\"kw1\">for</span> recipient<span class=\"sy1\">,</span> s <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> proposals <span class=\"sy1\">{</span><br/>        ps<span class=\"sy1\">[</span>recipient<span class=\"sy1\">]</span> <span class=\"sy2\">=</span> s<span class=\"sy3\">.</span>proposer<br/>    <span class=\"sy1\">}</span><br/>    <span class=\"kw1\">return</span> ps<br/><span class=\"sy1\">}</span><br/>\u00a0<br/><span class=\"kw4\">func</span> validateStable<span class=\"sy1\">(</span>ps parings<span class=\"sy1\">,</span> pPref proposers<span class=\"sy1\">,</span> rPref recipients<span class=\"sy1\">)</span> <span class=\"kw4\">bool</span> <span class=\"sy1\">{</span><br/>    <span class=\"kw1\">for</span> r<span class=\"sy1\">,</span> p <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> ps <span class=\"sy1\">{</span><br/>        fmt<span class=\"sy3\">.</span>Println<span class=\"sy1\">(</span>r<span class=\"sy1\">,</span> p<span class=\"sy1\">)</span><br/>    <span class=\"sy1\">}</span><br/>    <span class=\"kw1\">for</span> r<span class=\"sy1\">,</span> p <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> ps <span class=\"sy1\">{</span><br/>        <span class=\"kw1\">for</span> _<span class=\"sy1\">,</span> rp <span class=\"sy2\">:=</span> <span class=\"kw1\">range</span> pPref<span class=\"sy1\">[</span>p<span class=\"sy1\">]</span> <span class=\"sy1\">{</span><br/>            <span class=\"kw1\">if</span> rp <span class=\"sy3\">==</span> r <span class=\"sy1\">{</span><br/>                <span class=\"kw1\">break</span><br/>            <span class=\"sy1\">}</span><br/>            rprefs <span class=\"sy2\">:=</span> rPref<span class=\"sy1\">[</span>rp<span class=\"sy1\">]</span><br/>            <span class=\"kw1\">if</span> rprefs<span class=\"sy1\">[</span>p<span class=\"sy1\">]</span> &lt; rprefs<span class=\"sy1\">[</span>ps<span class=\"sy1\">[</span>rp<span class=\"sy1\">]]</span> <span class=\"sy1\">{</span><br/>                fmt<span class=\"sy3\">.</span>Println<span class=\"sy1\">(</span><span class=\"st0\">\"unstable.\"</span><span class=\"sy1\">)</span><br/>                fmt<span class=\"sy3\">.</span><span class=\"me1\">Printf</span><span class=\"sy1\">(</span><span class=\"st0\">\"%s and\u00a0%s would prefer each other over\"</span><span class=\"sy3\">+</span><br/>                    <span class=\"st0\">\" their current pairings.<span class=\"es1\">\\n</span>\"</span><span class=\"sy1\">,</span> p<span class=\"sy1\">,</span> rp<span class=\"sy1\">)</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><br/>            <span class=\"sy1\">}</span><br/>        <span class=\"sy1\">}</span><br/>    <span class=\"sy1\">}</span><br/>    fmt<span class=\"sy3\">.</span>Println<span class=\"sy1\">(</span><span class=\"st0\">\"stable.\"</span><span class=\"sy1\">)</span><br/>    <span class=\"kw1\">return</span> <span class=\"kw2\">true</span><br/><span class=\"sy1\">}</span></pre>"}, {"lang": "Groovy", "loc": 26, "block": "<pre class=\"groovy highlighted_source\"><a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20import\"><span class=\"kw2\">import</span></a> <span class=\"co2\">static</span> Man.<span class=\"sy0\">*</span><br/><a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20import\"><span class=\"kw2\">import</span></a> <span class=\"co2\">static</span> Woman.<span class=\"sy0\">*</span><br/>\u00a0<br/>Map<span class=\"sy0\">&lt;</span>Woman,Man<span class=\"sy0\">&gt;</span> match<span class=\"br0\">(</span>Map<span class=\"sy0\">&lt;</span>Man,Map<span class=\"sy0\">&lt;</span>Woman,Integer<span class=\"sy0\">&gt;&gt;</span> guysGalRanking, Map<span class=\"sy0\">&lt;</span>Woman,Map<span class=\"sy0\">&lt;</span>Man,Integer<span class=\"sy0\">&gt;&gt;</span> galsGuyRanking<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    Map<span class=\"sy0\">&lt;</span>Woman,Man<span class=\"sy0\">&gt;</span> engagedTo <span class=\"sy0\">=</span> <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20new\"><span class=\"kw2\">new</span></a> <a href=\"http://www.google.de/search?as_q=TreeMap&amp;num=100&amp;hl=en&amp;as_occt=url&amp;as_sitesearch=java.sun.com%2Fj2se%2F1%2E5%2E0%2Fdocs%2Fapi%2F\"><span class=\"kw3\">TreeMap</span></a><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    List<span class=\"sy0\">&lt;</span>Man<span class=\"sy0\">&gt;</span> freeGuys <span class=\"sy0\">=</span> <span class=\"br0\">(</span>Man.<span class=\"me1\">values</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span>.<span class=\"me1\">clone</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20while\"><span class=\"kw1\">while</span></a><span class=\"br0\">(</span>freeGuys<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        Man thisGuy <span class=\"sy0\">=</span> freeGuys<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><br/>        freeGuys <span class=\"sy0\">-=</span> thisGuy<br/>        List<span class=\"sy0\">&lt;</span>Woman<span class=\"sy0\">&gt;</span> guyChoices <span class=\"sy0\">=</span> Woman.<span class=\"me1\">values</span><span class=\"br0\">(</span><span class=\"br0\">)</span>.<a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20sort\"><span class=\"kw5\">sort</span></a><span class=\"br0\">{</span> she <span class=\"sy0\">-&gt;</span> <span class=\"sy0\">-</span> guysGalRanking<span class=\"br0\">[</span>thisGuy<span class=\"br0\">]</span><span class=\"br0\">[</span>she<span class=\"br0\">]</span> <span class=\"br0\">}</span><br/>        <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20for\"><span class=\"kw1\">for</span></a><span class=\"br0\">(</span>Woman girl <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20in\"><span class=\"kw1\">in</span></a> guyChoices<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20if\"><span class=\"kw1\">if</span></a><span class=\"br0\">(</span><span class=\"sy0\">!</span> engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span> <span class=\"sy0\">=</span> thisGuy<br/>                <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20break\"><span class=\"kw2\">break</span></a><br/>            <span class=\"br0\">}</span> <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20else\"><span class=\"kw1\">else</span></a> <span class=\"br0\">{</span><br/>                Man thatGuy <span class=\"sy0\">=</span> engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span><br/>                <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20if\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span>galsGuyRanking<span class=\"br0\">[</span>girl<span class=\"br0\">]</span><span class=\"br0\">[</span>thisGuy<span class=\"br0\">]</span> <span class=\"sy0\">&gt;</span> galsGuyRanking<span class=\"br0\">[</span>girl<span class=\"br0\">]</span><span class=\"br0\">[</span>thatGuy<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    engagedTo<span class=\"br0\">[</span>girl<span class=\"br0\">]</span> <span class=\"sy0\">=</span> thisGuy<br/>                    freeGuys <span class=\"sy0\">&lt;&lt;</span> thatGuy<br/>                    <a href=\"http://www.google.de/search?q=site%3Agroovy.codehaus.org/%20break\"><span class=\"kw2\">break</span></a><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>    engagedTo<br/><span class=\"br0\">}</span></pre>"}, {"lang": "Haskell", "loc": 12, "block": "<pre class=\"haskell highlighted_source\"><span class=\"coMULTI\">{-# LANGUAGE TemplateHaskell #-}</span><br/><span class=\"kw1\">import</span> Lens<span class=\"sy0\">.</span>Micro<br/><span class=\"kw1\">import</span> Lens<span class=\"sy0\">.</span>Micro<span class=\"sy0\">.</span>TH<br/><span class=\"kw1\">import</span> Data<span class=\"sy0\">.</span>List <span class=\"br0\">(</span>union<span class=\"sy0\">,</span> delete<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">type</span> Preferences a <span class=\"sy0\">=</span> <span class=\"br0\">(</span>a<span class=\"sy0\">,</span> <span class=\"br0\">[</span>a<span class=\"br0\">]</span><span class=\"br0\">)</span><br/><span class=\"kw1\">type</span> Couple a <span class=\"sy0\">=</span> <span class=\"br0\">(</span>a<span class=\"sy0\">,</span>a<span class=\"br0\">)</span><br/><span class=\"kw1\">data</span> State a <span class=\"sy0\">=</span> State <span class=\"br0\">{</span> <span class=\"sy0\">_</span>freeGuys <span class=\"sy0\">::</span> <span class=\"br0\">[</span>a<span class=\"br0\">]</span><br/>                     <span class=\"sy0\">,</span> <span class=\"sy0\">_</span>guys <span class=\"sy0\">::</span> <span class=\"br0\">[</span>Preferences a<span class=\"br0\">]</span><br/>                     <span class=\"sy0\">,</span> <span class=\"sy0\">_</span>girls <span class=\"sy0\">::</span> <span class=\"br0\">[</span>Preferences a<span class=\"br0\">]</span><span class=\"br0\">}</span><br/>\u00a0<br/>makeLenses <span class=\"st0\">''</span>State</pre>"}, {"lang": "Icon and Unicon", "loc": 113, "block": "<pre class=\"icon highlighted_source\"><span class=\"kw1\">link</span> printf<br/>\u00a0<br/><span class=\"kw1\">procedure</span> main<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>   smd <span class=\"sy1\">:=</span> IsStable<span class=\"br0\">(</span>ShowEngaged<span class=\"br0\">(</span>StableMatching<span class=\"br0\">(</span>setup<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span>   <br/>   IsStable<span class=\"br0\">(</span>ShowEngaged<span class=\"br0\">(</span>Swap<span class=\"br0\">(</span><span class=\"sy1\">\\</span>smd<span class=\"sy1\">,</span>smd<span class=\"sy1\">.</span><span class=\"me1\">women</span><span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"sy1\">,</span>smd<span class=\"sy1\">.</span><span class=\"me1\">women</span><span class=\"br0\">[</span><span class=\"nu0\">2</span><span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">procedure</span> index<span class=\"br0\">(</span>L<span class=\"sy1\">,</span>x<span class=\"br0\">)</span>                         <span class=\"co1\">#: return index of value or fail</span><br/>   <span class=\"kw1\">return</span> <span class=\"br0\">(</span> L<span class=\"br0\">[</span>i <span class=\"sy1\">:=</span> <span class=\"nu0\">1</span> <span class=\"kw1\">to</span> <span class=\"sy1\">*</span>L<span class=\"br0\">]</span> <span class=\"sy1\">===</span> x<span class=\"sy1\">,</span> i<span class=\"br0\">)</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">procedure</span> ShowEngaged<span class=\"br0\">(</span>smd<span class=\"br0\">)</span>                   <span class=\"co1\">#: Show who's hooked up</span><br/>   printf<span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es0\">\\n</span>Engagements:<span class=\"es0\">\\n</span>\"</span><span class=\"br0\">)</span><br/>   <span class=\"kw1\">every</span> w <span class=\"sy1\">:=</span> <span class=\"sy1\">!</span>smd<span class=\"sy1\">.</span><span class=\"me1\">women</span> <span class=\"kw1\">do</span><br/>      printf<span class=\"br0\">(</span><span class=\"st0\">\"%s is engaged to\u00a0%s<span class=\"es0\">\\n</span>\"</span><span class=\"sy1\">,</span>w<span class=\"sy1\">,</span>smd<span class=\"sy1\">.</span><span class=\"me1\">engaged</span><span class=\"br0\">[</span>w<span class=\"br0\">]</span><span class=\"br0\">)</span><br/>   <span class=\"kw1\">return</span> smd<br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">procedure</span> Swap<span class=\"br0\">(</span>smd<span class=\"sy1\">,</span>x0<span class=\"sy1\">,</span>x1<span class=\"br0\">)</span>                    <span class=\"co1\">#: swap two couples by m or w   </span><br/>   printf<span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es0\">\\n</span>Swapping\u00a0%s and\u00a0%s<span class=\"es0\">\\n</span>\"</span><span class=\"sy1\">,</span>x0<span class=\"sy1\">,</span>x1<span class=\"br0\">)</span><br/>   e <span class=\"sy1\">:=</span> smd<span class=\"sy1\">.</span><span class=\"me1\">engaged</span><br/>   e<span class=\"br0\">[</span>x0<span class=\"br0\">]</span> <span class=\"sy1\">:=:</span> e<span class=\"br0\">[</span>x1<span class=\"br0\">]</span>                           <span class=\"co1\"># swap partners</span><br/>   e<span class=\"br0\">[</span>e<span class=\"br0\">[</span>x0<span class=\"br0\">]</span><span class=\"br0\">]</span> <span class=\"sy1\">:=</span> e<span class=\"br0\">[</span>e<span class=\"br0\">[</span>x1<span class=\"br0\">]</span><span class=\"br0\">]</span><br/>   <span class=\"kw1\">return</span> smd<br/><span class=\"kw1\">end</span>   <br/>\u00a0<br/><span class=\"kw1\">procedure</span> IsStable<span class=\"br0\">(</span>smd<span class=\"br0\">)</span>                      <span class=\"co1\">#: validate stability</span><br/>   stable <span class=\"sy1\">:=</span> <span class=\"nu0\">1</span>                                               <span class=\"co1\"># assumption</span><br/>   printf<span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es0\">\\n</span>\"</span><span class=\"br0\">)</span><br/>   <span class=\"kw1\">every</span> mp <span class=\"sy1\">:=</span> smd<span class=\"sy1\">.</span><span class=\"me1\">prefs</span><span class=\"br0\">[</span>m <span class=\"sy1\">:=</span> <span class=\"sy1\">!</span>smd<span class=\"sy1\">.</span><span class=\"me1\">men</span><span class=\"br0\">]</span> <span class=\"sy1\">&amp;</span>                    <span class=\"co1\"># man &amp; pref</span><br/>         w <span class=\"sy1\">:=</span> mp<span class=\"br0\">[</span>index<span class=\"br0\">(</span>mp<span class=\"sy1\">,</span>smd<span class=\"sy1\">.</span><span class=\"me1\">engaged</span><span class=\"br0\">[</span>m<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy1\">-</span><span class=\"nu0\">1</span> <span class=\"kw1\">to</span> <span class=\"nu0\">1</span> by <span class=\"sy1\">-</span><span class=\"nu0\">1</span><span class=\"br0\">]</span> <span class=\"kw1\">do</span> <span class=\"br0\">{</span> <span class=\"co1\"># better choices </span><br/>      wp <span class=\"sy1\">:=</span> smd<span class=\"sy1\">.</span><span class=\"me1\">prefs</span><span class=\"br0\">[</span>w<span class=\"br0\">]</span>                                     <span class=\"co1\"># her choices</span><br/>      <span class=\"kw1\">if</span> index<span class=\"br0\">(</span>wp<span class=\"sy1\">,</span>smd<span class=\"sy1\">.</span><span class=\"me1\">engaged</span><span class=\"br0\">[</span>w<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"sy1\">&gt;</span> index<span class=\"br0\">(</span>wp<span class=\"sy1\">,</span>m<span class=\"br0\">)</span> <span class=\"kw1\">then</span> <span class=\"br0\">{</span><br/>         printf<span class=\"br0\">(</span><span class=\"st0\">\"Engagement of\u00a0%s to\u00a0%s is unstable.<span class=\"es0\">\\n</span>\"</span><span class=\"sy1\">,</span>w<span class=\"sy1\">,</span>m<span class=\"br0\">)</span><br/>         stable <span class=\"sy1\">:=</span> <span class=\"sy1\">&amp;</span><span class=\"kw3\">null</span>                                     <span class=\"co1\"># broken</span><br/>         <span class=\"br0\">}</span><br/>      <span class=\"br0\">}</span><br/>   <span class=\"kw1\">if</span> <span class=\"sy1\">\\</span>stable <span class=\"kw1\">then</span> <span class=\"br0\">{</span><br/>      printf<span class=\"br0\">(</span><span class=\"st0\">\"Engagments are all stable.<span class=\"es0\">\\n</span>\"</span><span class=\"br0\">)</span><br/>      <span class=\"kw1\">return</span> smd<br/>      <span class=\"br0\">}</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">procedure</span> StableMatching<span class=\"br0\">(</span>smd<span class=\"br0\">)</span>                <span class=\"co1\">#: match making </span><br/>   freemen   <span class=\"sy1\">:=</span> <span class=\"kw4\">copy</span><span class=\"br0\">(</span>smd<span class=\"sy1\">.</span><span class=\"me1\">men</span><span class=\"br0\">)</span>                <span class=\"co1\"># Initialize all m memberof M </span><br/>   freewomen <span class=\"sy1\">:=</span> <span class=\"kw4\">set</span><span class=\"br0\">(</span>smd<span class=\"sy1\">.</span><span class=\"me1\">women</span><span class=\"br0\">)</span>               <span class=\"co1\"># ... and w memberof W to free</span><br/>   <span class=\"kw1\">every</span> <span class=\"br0\">(</span>prefmen <span class=\"sy1\">:=</span> <span class=\"kw4\">table</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">[</span>m <span class=\"sy1\">:=</span> <span class=\"sy1\">!</span>freemen<span class=\"br0\">]</span> <span class=\"sy1\">:=</span> <span class=\"kw4\">copy</span><span class=\"br0\">(</span>smd<span class=\"sy1\">.</span><span class=\"me1\">prefs</span><span class=\"br0\">[</span>m<span class=\"br0\">]</span><span class=\"br0\">)</span><br/>   smd<span class=\"sy1\">.</span><span class=\"me1\">engaged</span> <span class=\"sy1\">:=</span> engaged <span class=\"sy1\">:=</span> <span class=\"kw4\">table</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>   printf<span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es0\">\\n</span>Matching:<span class=\"es0\">\\n</span>\"</span><span class=\"br0\">)</span>   <br/>   <span class=\"kw1\">while</span> m <span class=\"sy1\">:=</span> <span class=\"kw4\">get</span><span class=\"br0\">(</span>freemen<span class=\"br0\">)</span> <span class=\"kw1\">do</span> <span class=\"br0\">{</span>                 <span class=\"co1\"># next freeman</span><br/>      <span class=\"kw1\">while</span> w <span class=\"sy1\">:=</span> <span class=\"kw4\">get</span><span class=\"br0\">(</span>prefmen<span class=\"br0\">[</span>m<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"kw1\">do</span>  <span class=\"br0\">{</span>          <span class=\"co1\"># . with prpoposals left</span><br/>         <span class=\"kw1\">if</span> <span class=\"kw4\">member</span><span class=\"br0\">(</span>freewomen<span class=\"sy1\">,</span>w<span class=\"br0\">)</span> <span class=\"kw1\">then</span> <span class=\"br0\">{</span>          <span class=\"co1\"># . . is she free?</span><br/>            engaged<span class=\"br0\">[</span>m<span class=\"br0\">]</span> <span class=\"sy1\">:=</span> w                     <span class=\"co1\"># . . . (m, w) </span><br/>            engaged<span class=\"br0\">[</span>w<span class=\"br0\">]</span> <span class=\"sy1\">:=</span> m<br/>            <span class=\"kw4\">delete</span><span class=\"br0\">(</span>freewomen<span class=\"sy1\">,</span>w<span class=\"br0\">)</span><br/>            printf<span class=\"br0\">(</span><span class=\"st0\">\"%s accepted\u00a0%s's proposal<span class=\"es0\">\\n</span>\"</span><span class=\"sy1\">,</span>w<span class=\"sy1\">,</span>m<span class=\"br0\">)</span><br/>            <span class=\"kw1\">break</span><br/>            <span class=\"br0\">}</span><br/>         <span class=\"kw1\">else</span> <span class=\"br0\">{</span>                                 <span class=\"co1\"># . . no, she's engaged         </span><br/>            m0 <span class=\"sy1\">:=</span> engaged<span class=\"br0\">[</span>w<span class=\"br0\">]</span>                    <span class=\"co1\">#     to m0                  </span><br/>            <span class=\"kw1\">if</span> index<span class=\"br0\">(</span>smd<span class=\"sy1\">.</span><span class=\"me1\">prefs</span><span class=\"br0\">[</span>w<span class=\"br0\">]</span><span class=\"sy1\">,</span>m<span class=\"br0\">)</span> <span class=\"sy1\">&lt;</span> index<span class=\"br0\">(</span>smd<span class=\"sy1\">.</span><span class=\"me1\">prefs</span><span class=\"br0\">[</span>w<span class=\"br0\">]</span><span class=\"sy1\">,</span>m0<span class=\"br0\">)</span> <span class=\"kw1\">then</span> <span class=\"br0\">{</span>  <br/>               engaged<span class=\"br0\">[</span>m<span class=\"br0\">]</span> <span class=\"sy1\">:=</span> w                  <span class=\"co1\"># (m, w) become engaged</span><br/>               engaged<span class=\"br0\">[</span>w<span class=\"br0\">]</span> <span class=\"sy1\">:=</span> m<br/>               <span class=\"kw4\">delete</span><span class=\"br0\">(</span>freewomen<span class=\"sy1\">,</span>w<span class=\"br0\">)</span><br/>               engaged<span class=\"br0\">[</span>m0<span class=\"br0\">]</span> <span class=\"sy1\">:=</span> <span class=\"sy1\">&amp;</span><span class=\"kw3\">null</span>             <span class=\"co1\"># m' becomes free</span><br/>               <span class=\"kw4\">put</span><span class=\"br0\">(</span>freemen<span class=\"sy1\">,</span>m0<span class=\"br0\">)</span>   <br/>               printf<span class=\"br0\">(</span><span class=\"st0\">\"%s chose\u00a0%s over\u00a0%s<span class=\"es0\">\\n</span>\"</span><span class=\"sy1\">,</span>w<span class=\"sy1\">,</span>m<span class=\"sy1\">,</span>m0<span class=\"br0\">)</span><br/>               <span class=\"kw1\">break</span><br/>               <span class=\"br0\">}</span><br/>            <span class=\"kw1\">else</span> <span class=\"kw1\">next</span>                          <span class=\"co1\"># she's happier as is </span><br/>         <span class=\"br0\">}</span><br/>      <span class=\"br0\">}</span><br/>   <span class=\"br0\">}</span><br/>   <span class=\"kw1\">return</span> smd<br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">record</span> sm_data<span class=\"br0\">(</span>men<span class=\"sy1\">,</span>women<span class=\"sy1\">,</span>prefs<span class=\"sy1\">,</span>engaged<span class=\"br0\">)</span>  <span class=\"co1\">#: everyones data</span><br/>\u00a0<br/><span class=\"kw1\">procedure</span> setup<span class=\"br0\">(</span><span class=\"br0\">)</span>                        <span class=\"co1\">#: setup everyones data</span><br/>   X <span class=\"sy1\">:=</span> sm_data<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>   X<span class=\"sy1\">.</span><span class=\"me1\">men</span>   <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span><br/>   X<span class=\"sy1\">.</span><span class=\"me1\">women</span> <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span><br/>\u00a0<br/>   <span class=\"kw1\">if</span> <span class=\"sy1\">*</span>X<span class=\"sy1\">.</span><span class=\"me1\">men</span> <span class=\"sy1\">~=</span> <span class=\"sy1\">*</span><span class=\"br0\">(</span>M <span class=\"sy1\">:=</span> <span class=\"kw4\">set</span><span class=\"br0\">(</span>X<span class=\"sy1\">.</span><span class=\"me1\">men</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"kw1\">then</span> <span class=\"kw4\">runerr</span><span class=\"br0\">(</span><span class=\"nu0\">500</span><span class=\"sy1\">,</span>X<span class=\"sy1\">.</span><span class=\"me1\">men</span><span class=\"br0\">)</span>       <span class=\"co1\"># duplicate? </span><br/>   <span class=\"kw1\">if</span> <span class=\"sy1\">*</span>X<span class=\"sy1\">.</span><span class=\"me1\">women</span> <span class=\"sy1\">~=</span> <span class=\"sy1\">*</span><span class=\"br0\">(</span>W <span class=\"sy1\">:=</span> <span class=\"kw4\">set</span><span class=\"br0\">(</span>X<span class=\"sy1\">.</span><span class=\"me1\">women</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"kw1\">then</span> <span class=\"kw4\">runerr</span><span class=\"br0\">(</span><span class=\"nu0\">500</span><span class=\"sy1\">,</span>X<span class=\"sy1\">.</span><span class=\"me1\">women</span><span class=\"br0\">)</span> <span class=\"co1\"># duplicate?</span><br/>   <span class=\"kw1\">if</span> <span class=\"sy1\">*</span><span class=\"br0\">(</span>B <span class=\"sy1\">:=</span> M<span class=\"sy1\">**</span>W<span class=\"br0\">)</span> <span class=\"sy1\">~=</span> <span class=\"nu0\">0</span> <span class=\"kw1\">then</span> <span class=\"kw4\">runerr</span><span class=\"br0\">(</span><span class=\"nu0\">500</span><span class=\"sy1\">,</span>B<span class=\"br0\">)</span>                      <span class=\"co1\"># intersect?</span><br/>\u00a0<br/>   X<span class=\"sy1\">.</span><span class=\"me1\">prefs</span> <span class=\"sy1\">:=</span> p <span class=\"sy1\">:=</span> <span class=\"kw4\">table</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>\u00a0<br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"abe\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"col\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"ed\"</span><span class=\"br0\">]</span>   <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"br0\">]</span> <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"gav\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"ian\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gay\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"eve\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bea\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dee\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"cath\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ivy\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hope\"</span><span class=\"br0\">]</span><br/>\u00a0<br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"cath\"</span><span class=\"br0\">]</span> <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"dee\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"eve\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"br0\">]</span> <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"ivy\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><br/>   p<span class=\"br0\">[</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span>  <span class=\"sy1\">:=</span> <span class=\"br0\">[</span><span class=\"st0\">\"ed\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"hal\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"gav\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"abe\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"bob\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"jon\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"col\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"ian\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"fred\"</span><span class=\"sy1\">,</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><br/>\u00a0<br/>   <span class=\"kw1\">return</span> X<br/><span class=\"kw1\">end</span></pre>"}, {"lang": "J", "loc": 72, "block": "<pre class=\"j highlighted_source\">Mraw=:\u00a0;:\u00a0;.<span class=\"nu0\">_2</span> noun define -. <span class=\"st_h\">':,'</span><br/>  abe: abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay<br/>  bob: cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay<br/>  col: hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan<br/>  dan: ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi<br/>   ed: jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay<br/> fred: bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay<br/>  gav: gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay<br/>  hal: abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee<br/>  ian: hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve<br/>  jon: abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope<br/><span class=\"sy0\">)</span><br/>\u00a0<br/>Fraw=:\u00a0;:\u00a0;.<span class=\"nu0\">_2</span> noun define -. <span class=\"st_h\">':,'</span><br/>  abi: bob, fred, jon, gav, ian, abe, dan, ed, col, hal<br/>  bea: bob, abe, col, fred, gav, dan, ian, ed, jon, hal<br/> cath: fred, bob, ed, gav, hal, col, ian, abe, dan, jon<br/>  dee: fred, jon, col, abe, ian, hal, gav, dan, bob, ed<br/>  eve: jon, hal, fred, dan, abe, gav, col, ed, ian, bob<br/>  fay: bob, abe, ed, ian, jon, dan, fred, gav, col, hal<br/>  gay: jon, gav, hal, fred, bob, abe, col, ed, dan, ian<br/> hope: gav, jon, bob, abe, ian, dan, hal, ed, col, fred<br/>  ivy: ian, col, hal, gav, fred, bob, abe, ed, jon, dan<br/>  jan: ed, hal, gav, abe, bob, jon, col, ian, fred, dan<br/><span class=\"sy0\">)</span><br/>\u00a0<br/>GuyNames=: {.\"<span class=\"nu0\">1</span> Mraw<br/>GalNames=: {.\"<span class=\"nu0\">1</span> Fraw<br/>\u00a0<br/>Mprefs=: GalNames i. }.\"<span class=\"nu0\">1</span> Mraw<br/>Fprefs=: GuyNames i. }.\"<span class=\"nu0\">1</span> Fraw<br/>\u00a0<br/>propose=: dyad define<br/>  engaged=. <span class=\"kw2\">x</span><br/>  <span class=\"st_h\">'guy gal'</span>=. <span class=\"kw2\">y</span><br/>  <span class=\"kw1\">if.</span> gal e. engaged <span class=\"kw1\">do.</span><br/>    fiance=. engaged i. gal<br/>    <span class=\"kw1\">if.</span> guy &lt;&amp;<span class=\"sy0\">((</span>gal{Fprefs<span class=\"sy0\">)</span>&amp;i.<span class=\"sy0\">)</span> fiance <span class=\"kw1\">do.</span><br/>      engaged=. gal guy} <span class=\"nu0\">_</span> fiance} engaged<br/>    <span class=\"kw1\">end.</span><br/>  <span class=\"kw1\">else.</span><br/>    engaged=. gal guy} engaged<br/>  <span class=\"kw1\">end.</span><br/>  engaged<br/><span class=\"sy0\">)</span><br/>\u00a0<br/>matchMake=: monad define<br/>  engaged=. <span class=\"nu0\">_</span>\"<span class=\"nu0\">0</span> GuyNames <span class=\"co1\">NB. initially no one is engaged</span><br/>  fallback=. <span class=\"nu0\">0</span>\"<span class=\"nu0\">0</span> engaged <span class=\"co1\">NB. and each guy will first propose to his favorite</span><br/>  <span class=\"kw1\">whilst.</span> <span class=\"nu0\">_</span> e. engaged <span class=\"kw1\">do.</span><br/>    <span class=\"re0\">for_guy.</span> I. <span class=\"nu0\">_</span> = engaged <span class=\"kw1\">do.</span><br/>      next=. guy{fallback<br/>      gal=. <span class=\"sy0\">(</span>&lt;guy,next<span class=\"sy0\">)</span>{Mprefs<br/>      engaged=. engaged propose guy,gal<br/>      fallback=. <span class=\"sy0\">(</span>next+<span class=\"nu0\">1</span><span class=\"sy0\">)</span> guy} fallback<br/>    <span class=\"kw1\">end.</span><br/>  <span class=\"kw1\">end.</span><br/>  GuyNames,:engaged{GalNames<br/><span class=\"sy0\">)</span><br/>\u00a0<br/>checkStable=: monad define<br/>  <span class=\"st_h\">'guys gals'</span>=. <span class=\"sy0\">(</span>GuyNames,:GalNames<span class=\"sy0\">)</span> i.\"<span class=\"nu0\">1</span> <span class=\"kw2\">y</span><br/>  satisfied=. ] &gt;: <span class=\"sy0\">(</span>&lt;<span class=\"nu0\">0</span> <span class=\"nu0\">1</span><span class=\"sy0\">)</span> |: ]<br/>  guyshappy=. satisfied <span class=\"sy0\">(</span>guys{Mprefs<span class=\"sy0\">)</span> i.\"<span class=\"nu0\">1</span> <span class=\"nu0\">0</span>/ gals<br/>  galshappy=. satisfied <span class=\"sy0\">(</span>gals{Fprefs<span class=\"sy0\">)</span> i.\"<span class=\"nu0\">1</span> <span class=\"nu0\">0</span>/ guys<br/>  unstable=. <span class=\"nu0\">4</span>$.$.-. guyshappy +. |:galshappy<br/>  <span class=\"kw1\">if.</span> bad=. <span class=\"nu0\">0</span> &lt; #unstable <span class=\"kw1\">do.</span><br/>    smoutput <span class=\"st_h\">'Engagements preferred by both members to their current ones:'</span><br/>    smoutput <span class=\"kw2\">y</span> {~\"<span class=\"nu0\">1</span> <span class=\"nu0\">0</span>\"<span class=\"nu0\">2</span> <span class=\"nu0\">1</span> unstable<br/>  <span class=\"kw1\">end.</span><br/>  assert-.bad<br/><span class=\"sy0\">)</span></pre>"}, {"lang": "Java", "loc": 180, "block": "<pre class=\"java5 highlighted_source\"><span class=\"kw2\">import</span> <span class=\"co2\">java.util.*</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw2\">public</span> <span class=\"kw2\">class</span> Stable <span class=\"br0\">{</span><br/>    <span class=\"kw2\">static</span> <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> guys = <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><br/>            <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">{</span><br/>        <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"jon\"</span><span class=\"br0\">}</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw2\">static</span> <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> girls = <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><br/>            <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">{</span><br/>        <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span><span class=\"br0\">}</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw2\">static</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span> guyPrefers =<br/>            <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/HashMap.html\"><span class=\"kw46\">HashMap</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">{</span><span class=\"br0\">{</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"abe\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"fay\"</span>,<br/>            <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"bea\"</span>,<br/>            <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"col\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>,<br/>            <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"dan\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"jan\"</span>,<br/>            <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"abi\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"ed\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"abi\"</span>,<br/>            <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"cath\"</span>,<br/>            <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"gav\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>,<br/>            <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"hal\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span>,<br/>            <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"dee\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"ian\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"fay\"</span>,<br/>            <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"eve\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"dee\"</span>,<br/>            <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"hope\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>    <span class=\"kw2\">static</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span> girlPrefers =<br/>            <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/HashMap.html\"><span class=\"kw46\">HashMap</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">{</span><span class=\"br0\">{</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"dan\"</span>,<br/>            <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"bea\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ian\"</span>,<br/>            <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"cath\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ian\"</span>,<br/>            <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"jon\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"dee\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>,<br/>            <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"ed\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"eve\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"col\"</span>,<br/>            <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"bob\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"fay\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"fred\"</span>,<br/>            <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"gay\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"col\"</span>,<br/>            <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ian\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"hal\"</span>,<br/>            <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"fred\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"ivy\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>,<br/>            <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        put<span class=\"br0\">(</span><span class=\"st0\">\"jan\"</span>,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Arrays.html\"><span class=\"kw46\">Arrays</span></a>.<span class=\"me1\">asList</span><span class=\"br0\">(</span><span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"col\"</span>,<br/>            <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>    <span class=\"kw2\">public</span> <span class=\"kw2\">static</span> <span class=\"kw3\">void</span> main<span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"br0\">[</span><span class=\"br0\">]</span> args<span class=\"br0\">)</span><span class=\"br0\">{</span><br/>        <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> matches = match<span class=\"br0\">(</span>guys, guyPrefers, girlPrefers<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">for</span><span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.Entry.html\"><span class=\"kw46\">Map.<span class=\"me1\">Entry</span></span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> couple:matches.<span class=\"me1\">entrySet</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">println</span><span class=\"br0\">(</span><br/>                    couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span> + <span class=\"st0\">\" is engaged to \"</span> + couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">if</span><span class=\"br0\">(</span>checkMatches<span class=\"br0\">(</span>guys, girls, matches, guyPrefers, girlPrefers<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">println</span><span class=\"br0\">(</span><span class=\"st0\">\"Marriages are stable\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><span class=\"kw1\">else</span><span class=\"br0\">{</span><br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">println</span><span class=\"br0\">(</span><span class=\"st0\">\"Marriages are unstable\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> tmp = matches.<span class=\"me1\">get</span><span class=\"br0\">(</span>girls.<span class=\"me1\">get</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        matches.<span class=\"me1\">put</span><span class=\"br0\">(</span>girls.<span class=\"me1\">get</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span>, matches.<span class=\"me1\">get</span><span class=\"br0\">(</span>girls.<span class=\"me1\">get</span><span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        matches.<span class=\"me1\">put</span><span class=\"br0\">(</span>girls.<span class=\"me1\">get</span><span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span>, tmp<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">println</span><span class=\"br0\">(</span><br/>                girls.<span class=\"me1\">get</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span> +<span class=\"st0\">\" and \"</span> + girls.<span class=\"me1\">get</span><span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span> + <span class=\"st0\">\" have switched partners\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">if</span><span class=\"br0\">(</span>checkMatches<span class=\"br0\">(</span>guys, girls, matches, guyPrefers, girlPrefers<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">println</span><span class=\"br0\">(</span><span class=\"st0\">\"Marriages are stable\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><span class=\"kw1\">else</span><span class=\"br0\">{</span><br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">println</span><span class=\"br0\">(</span><span class=\"st0\">\"Marriages are unstable\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw2\">private</span> <span class=\"kw2\">static</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> match<span class=\"br0\">(</span><a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> guys,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span> guyPrefers,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span> girlPrefers<span class=\"br0\">)</span><span class=\"br0\">{</span><br/>        <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> engagedTo = <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/TreeMap.html\"><span class=\"kw46\">TreeMap</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> freeGuys = <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/LinkedList.html\"><span class=\"kw46\">LinkedList</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        freeGuys.<span class=\"me1\">addAll</span><span class=\"br0\">(</span>guys<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">while</span><span class=\"br0\">(</span><span class=\"sy0\">!</span>freeGuys.<span class=\"me1\">isEmpty</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> thisGuy = freeGuys.<span class=\"me1\">remove</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span><span class=\"sy0\">;</span> <span class=\"co1\">//get a load of THIS guy</span><br/>            <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> thisGuyPrefers = guyPrefers.<span class=\"me1\">get</span><span class=\"br0\">(</span>thisGuy<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <span class=\"kw1\">for</span><span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> girl:thisGuyPrefers<span class=\"br0\">)</span><span class=\"br0\">{</span><br/>                <span class=\"kw1\">if</span><span class=\"br0\">(</span>engagedTo.<span class=\"me1\">get</span><span class=\"br0\">(</span>girl<span class=\"br0\">)</span> == <span class=\"kw4\">null</span><span class=\"br0\">)</span><span class=\"br0\">{</span><span class=\"co1\">//girl is free</span><br/>                    engagedTo.<span class=\"me1\">put</span><span class=\"br0\">(</span>girl, thisGuy<span class=\"br0\">)</span><span class=\"sy0\">;</span> <span class=\"co1\">//awww</span><br/>                    <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br/>                <span class=\"br0\">}</span><span class=\"kw1\">else</span><span class=\"br0\">{</span><br/>                    <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> otherGuy = engagedTo.<span class=\"me1\">get</span><span class=\"br0\">(</span>girl<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                    <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> thisGirlPrefers = girlPrefers.<span class=\"me1\">get</span><span class=\"br0\">(</span>girl<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                    <span class=\"kw1\">if</span><span class=\"br0\">(</span>thisGirlPrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>thisGuy<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span><br/>                            thisGirlPrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>otherGuy<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>                        <span class=\"co1\">//this girl prefers this guy to the guy she's engaged to</span><br/>                        engagedTo.<span class=\"me1\">put</span><span class=\"br0\">(</span>girl, thisGuy<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                        freeGuys.<span class=\"me1\">add</span><span class=\"br0\">(</span>otherGuy<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                        <span class=\"kw2\">break</span><span class=\"sy0\">;</span><br/>                    <span class=\"br0\">}</span><span class=\"co1\">//else no change...keep looking for this guy</span><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw2\">return</span> engagedTo<span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw2\">private</span> <span class=\"kw2\">static</span> <span class=\"kw3\">boolean</span> checkMatches<span class=\"br0\">(</span><a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> guys, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> girls,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> matches, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span> guyPrefers,<br/>            <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;&gt;</span> girlPrefers<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"sy0\">!</span>matches.<span class=\"me1\">keySet</span><span class=\"br0\">(</span><span class=\"br0\">)</span>.<span class=\"me1\">containsAll</span><span class=\"br0\">(</span>girls<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <span class=\"kw2\">return</span> <span class=\"kw4\">false</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        <span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"sy0\">!</span>matches.<span class=\"me1\">values</span><span class=\"br0\">(</span><span class=\"br0\">)</span>.<span class=\"me1\">containsAll</span><span class=\"br0\">(</span>guys<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <span class=\"kw2\">return</span> <span class=\"kw4\">false</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.html\"><span class=\"kw46\">Map</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> invertedMatches = <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/TreeMap.html\"><span class=\"kw46\">TreeMap</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">for</span><span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.Entry.html\"><span class=\"kw46\">Map.<span class=\"me1\">Entry</span></span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> couple:matches.<span class=\"me1\">entrySet</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            invertedMatches.<span class=\"me1\">put</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span>, couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        <span class=\"kw1\">for</span><span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/Map.Entry.html\"><span class=\"kw46\">Map.<span class=\"me1\">Entry</span></span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a>, <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> couple:matches.<span class=\"me1\">entrySet</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>            <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> shePrefers = girlPrefers.<span class=\"me1\">get</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> sheLikesBetter = <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/LinkedList.html\"><span class=\"kw46\">LinkedList</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            sheLikesBetter.<span class=\"me1\">addAll</span><span class=\"br0\">(</span>shePrefers.<span class=\"me1\">subList</span><span class=\"br0\">(</span><span class=\"nu0\">0</span>, shePrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> hePrefers = guyPrefers.<span class=\"me1\">get</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> heLikesBetter = <span class=\"kw2\">new</span> <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/util/LinkedList.html\"><span class=\"kw46\">LinkedList</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            heLikesBetter.<span class=\"me1\">addAll</span><span class=\"br0\">(</span>hePrefers.<span class=\"me1\">subList</span><span class=\"br0\">(</span><span class=\"nu0\">0</span>, hePrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>            <span class=\"kw1\">for</span><span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> guy\u00a0: sheLikesBetter<span class=\"br0\">)</span><span class=\"br0\">{</span><br/>                <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> guysFinace = invertedMatches.<span class=\"me1\">get</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> thisGuyPrefers = guyPrefers.<span class=\"me1\">get</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">if</span><span class=\"br0\">(</span>thisGuyPrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>guysFinace<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span><br/>                        thisGuyPrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>                    <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">printf</span><span class=\"br0\">(</span><span class=\"st0\">\"%s likes\u00a0%s better than\u00a0%s and\u00a0%s\"</span><br/>                            + <span class=\"st0\">\" likes\u00a0%s better than their current partner<span class=\"es0\">\\n</span>\"</span>,<br/>                       couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span>, guy, couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span>,<br/>                       guy, couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                    <span class=\"kw2\">return</span> <span class=\"kw4\">false</span><span class=\"sy0\">;</span><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>\u00a0<br/>            <span class=\"kw1\">for</span><span class=\"br0\">(</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> girl\u00a0: heLikesBetter<span class=\"br0\">)</span><span class=\"br0\">{</span><br/>                <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a> girlsFinace = matches.<span class=\"me1\">get</span><span class=\"br0\">(</span>girl<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <a href=\"http://www.google.com/search?sitesearch=java.sun.com&amp;q=allinurl%3Aj2se%2F1+5+0%2Fdocs%2Fapi+List\"><span class=\"kw166\">List</span></a><span class=\"sy0\">&lt;</span><a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/String.html\"><span class=\"kw21\">String</span></a><span class=\"sy0\">&gt;</span> thisGirlPrefers = girlPrefers.<span class=\"me1\">get</span><span class=\"br0\">(</span>girl<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">if</span><span class=\"br0\">(</span>thisGirlPrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>girlsFinace<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span><br/>                        thisGirlPrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">{</span><br/>                    <a href=\"http://java.sun.com/j2se/1%2E5%2E0/docs/api/java/lang/System.html\"><span class=\"kw21\">System</span></a>.<span class=\"me1\">out</span>.<span class=\"me1\">printf</span><span class=\"br0\">(</span><span class=\"st0\">\"%s likes\u00a0%s better than\u00a0%s and\u00a0%s\"</span><br/>                            + <span class=\"st0\">\" likes\u00a0%s better than their current partner<span class=\"es0\">\\n</span>\"</span>,<br/>                       couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span>, girl, couple.<span class=\"me1\">getKey</span><span class=\"br0\">(</span><span class=\"br0\">)</span>,<br/>                       girl, couple.<span class=\"me1\">getValue</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                    <span class=\"kw2\">return</span> <span class=\"kw4\">false</span><span class=\"sy0\">;</span><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw2\">return</span> <span class=\"kw4\">true</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "JavaScript", "loc": 122, "block": "<pre class=\"javascript highlighted_source\"><span class=\"kw1\">function</span> Person<span class=\"br0\">(</span>name<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\u00a0<br/>    <span class=\"kw1\">var</span> candidateIndex <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">name</span> <span class=\"sy0\">=</span> name<span class=\"sy0\">;</span><br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">fiance</span> <span class=\"sy0\">=</span> <span class=\"kw2\">null</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">candidates</span> <span class=\"sy0\">=</span> <span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">rank</span> <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><span class=\"br0\">(</span>p<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span>i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> <span class=\"kw1\">this</span>.<span class=\"me1\">candidates</span>.<span class=\"me1\">length</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"kw1\">this</span>.<span class=\"me1\">candidates</span><span class=\"br0\">[</span>i<span class=\"br0\">]</span> <span class=\"sy0\">===</span> p<span class=\"br0\">)</span> <span class=\"kw1\">return</span> i<span class=\"sy0\">;</span><br/>        <span class=\"kw1\">return</span> <span class=\"kw1\">this</span>.<span class=\"me1\">candidates</span>.<span class=\"me1\">length</span> <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">prefers</span> <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><span class=\"br0\">(</span>p<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">return</span> <span class=\"kw1\">this</span>.<span class=\"me1\">rank</span><span class=\"br0\">(</span>p<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> <span class=\"kw1\">this</span>.<span class=\"me1\">rank</span><span class=\"br0\">(</span><span class=\"kw1\">this</span>.<span class=\"me1\">fiance</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">nextCandidate</span> <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span>candidateIndex <span class=\"sy0\">&gt;=</span> <span class=\"kw1\">this</span>.<span class=\"me1\">candidates</span>.<span class=\"me1\">length</span><span class=\"br0\">)</span> <span class=\"kw1\">return</span> <span class=\"kw2\">null</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">return</span> <span class=\"kw1\">this</span>.<span class=\"me1\">candidates</span><span class=\"br0\">[</span>candidateIndex<span class=\"sy0\">++</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">engageTo</span> <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><span class=\"br0\">(</span>p<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span>p.<span class=\"me1\">fiance</span><span class=\"br0\">)</span> p.<span class=\"me1\">fiance</span>.<span class=\"me1\">fiance</span> <span class=\"sy0\">=</span> <span class=\"kw2\">null</span><span class=\"sy0\">;</span><br/>        p.<span class=\"me1\">fiance</span> <span class=\"sy0\">=</span> <span class=\"kw1\">this</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"kw1\">this</span>.<span class=\"me1\">fiance</span><span class=\"br0\">)</span> <span class=\"kw1\">this</span>.<span class=\"me1\">fiance</span>.<span class=\"me1\">fiance</span> <span class=\"sy0\">=</span> <span class=\"kw2\">null</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">this</span>.<span class=\"me1\">fiance</span> <span class=\"sy0\">=</span> p<span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">this</span>.<span class=\"me1\">swapWith</span> <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><span class=\"br0\">(</span>p<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        console.<span class=\"me1\">log</span><span class=\"br0\">(</span><span class=\"st0\">\"%s &amp;\u00a0%s swap partners\"</span><span class=\"sy0\">,</span> <span class=\"kw1\">this</span>.<span class=\"me1\">name</span><span class=\"sy0\">,</span> p.<span class=\"me1\">name</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">var</span> thisFiance <span class=\"sy0\">=</span> <span class=\"kw1\">this</span>.<span class=\"me1\">fiance</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">var</span> pFiance <span class=\"sy0\">=</span> p.<span class=\"me1\">fiance</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">this</span>.<span class=\"me1\">engageTo</span><span class=\"br0\">(</span>pFiance<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        p.<span class=\"me1\">engageTo</span><span class=\"br0\">(</span>thisFiance<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">function</span> isStable<span class=\"br0\">(</span>guys<span class=\"sy0\">,</span> gals<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span><span class=\"kw1\">var</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> guys.<span class=\"me1\">length</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span><br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span><span class=\"kw1\">var</span> j <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> j <span class=\"sy0\">&lt;</span> gals.<span class=\"me1\">length</span><span class=\"sy0\">;</span> j<span class=\"sy0\">++</span><span class=\"br0\">)</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>guys<span class=\"br0\">[</span>i<span class=\"br0\">]</span>.<span class=\"me1\">prefers</span><span class=\"br0\">(</span>gals<span class=\"br0\">[</span>j<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"sy0\">&amp;&amp;</span> gals<span class=\"br0\">[</span>j<span class=\"br0\">]</span>.<span class=\"me1\">prefers</span><span class=\"br0\">(</span>guys<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">return</span> <span class=\"kw2\">true</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">function</span> engageEveryone<span class=\"br0\">(</span>guys<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <span class=\"kw1\">var</span> done<span class=\"sy0\">;</span><br/>    <span class=\"kw1\">do</span> <span class=\"br0\">{</span><br/>        done <span class=\"sy0\">=</span> <span class=\"kw2\">true</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span><span class=\"kw1\">var</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> guys.<span class=\"me1\">length</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">var</span> guy <span class=\"sy0\">=</span> guys<span class=\"br0\">[</span>i<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"sy0\">!</span>guy.<span class=\"me1\">fiance</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                done <span class=\"sy0\">=</span> <span class=\"kw2\">false</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">var</span> gal <span class=\"sy0\">=</span> guy.<span class=\"me1\">nextCandidate</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"sy0\">!</span>gal.<span class=\"me1\">fiance</span> <span class=\"sy0\">||</span> gal.<span class=\"me1\">prefers</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>                    guy.<span class=\"me1\">engageTo</span><span class=\"br0\">(</span>gal<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span> while <span class=\"br0\">(</span><span class=\"sy0\">!</span>done<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">function</span> doMarriage<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\u00a0<br/>    <span class=\"kw1\">var</span> abe  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Abe\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> bob  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Bob\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> col  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Col\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> dan  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Dan\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> ed   <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Ed\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> fred <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Fred\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> gav  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Gav\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> hal  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Hal\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> ian  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Ian\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> jon  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Jon\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> abi  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Abi\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> bea  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Bea\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> cath <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Cath\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> dee  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Dee\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> eve  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Eve\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> fay  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Fay\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> gay  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Gay\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> hope <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Hope\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> ivy  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Ivy\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> jan  <span class=\"sy0\">=</span> <span class=\"kw1\">new</span> Person<span class=\"br0\">(</span><span class=\"st0\">\"Jan\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    abe.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>abi<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> gay<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    bob.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>cath<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> gay<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    col.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>hope<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> jan<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    dan.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>ivy<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> abi<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    ed.<span class=\"me1\">candidates</span>   <span class=\"sy0\">=</span> <span class=\"br0\">[</span>jan<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> gay<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    fred.<span class=\"me1\">candidates</span> <span class=\"sy0\">=</span> <span class=\"br0\">[</span>bea<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> fay<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    gav.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>gay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> fay<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    hal.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>abi<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> dee<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    ian.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>hope<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> eve<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    jon.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>abi<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> hope<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    abi.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>bob<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> hal<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    bea.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> hal<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    cath.<span class=\"me1\">candidates</span> <span class=\"sy0\">=</span> <span class=\"br0\">[</span>fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> jon<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    dee.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>fred<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> ed<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    eve.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>jon<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> bob<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    fay.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> hal<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    gay.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>jon<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ian<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    hope.<span class=\"me1\">candidates</span> <span class=\"sy0\">=</span> <span class=\"br0\">[</span>gav<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> fred<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    ivy.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>ian<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> dan<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    jan.<span class=\"me1\">candidates</span>  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>ed<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> abe<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> dan<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw1\">var</span> guys <span class=\"sy0\">=</span> <span class=\"br0\">[</span>abe<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span> col<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span> ed<span class=\"sy0\">,</span> fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span> hal<span class=\"sy0\">,</span> ian<span class=\"sy0\">,</span> jon<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">var</span> gals <span class=\"sy0\">=</span> <span class=\"br0\">[</span>abi<span class=\"sy0\">,</span> bea<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span> gay<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span> jan<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    engageEveryone<span class=\"br0\">(</span>guys<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span><span class=\"kw1\">var</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span> i <span class=\"sy0\">&lt;</span> guys.<span class=\"me1\">length</span><span class=\"sy0\">;</span> i<span class=\"sy0\">++</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        console.<span class=\"me1\">log</span><span class=\"br0\">(</span><span class=\"st0\">\"%s is engaged to\u00a0%s\"</span><span class=\"sy0\">,</span> guys<span class=\"br0\">[</span>i<span class=\"br0\">]</span>.<span class=\"me1\">name</span><span class=\"sy0\">,</span> guys<span class=\"br0\">[</span>i<span class=\"br0\">]</span>.<span class=\"me1\">fiance</span>.<span class=\"me1\">name</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>    console.<span class=\"me1\">log</span><span class=\"br0\">(</span><span class=\"st0\">\"Stable =\u00a0%s\"</span><span class=\"sy0\">,</span> isStable<span class=\"br0\">(</span>guys<span class=\"sy0\">,</span> gals<span class=\"br0\">)</span> <span class=\"sy0\">?</span> <span class=\"st0\">\"Yes\"</span> <span class=\"sy0\">:</span> <span class=\"st0\">\"No\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    jon.<span class=\"me1\">swapWith</span><span class=\"br0\">(</span>fred<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    console.<span class=\"me1\">log</span><span class=\"br0\">(</span><span class=\"st0\">\"Stable =\u00a0%s\"</span><span class=\"sy0\">,</span> isStable<span class=\"br0\">(</span>guys<span class=\"sy0\">,</span> gals<span class=\"br0\">)</span> <span class=\"sy0\">?</span> <span class=\"st0\">\"Yes\"</span> <span class=\"sy0\">:</span> <span class=\"st0\">\"No\"</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>doMarriage<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0</pre>"}, {"lang": "Julia", "loc": 128, "block": "<pre class=\"text highlighted_source\">\u00a0<br/># This is not optimized, but tries to follow the pseudocode given the Wikipedia entry below.<br/># Reference: https://en.wikipedia.org/wiki/Stable_marriage_problem#Algorithm<br/>\u00a0<br/>const males = [\"abe\", \"bob\", \"col\", \"dan\", \"ed\", \"fred\", \"gav\", \"hal\", \"ian\", \"jon\"]<br/>const females = [\"abi\", \"bea\", \"cath\", \"dee\", \"eve\", \"fay\", \"gay\", \"hope\", \"ivy\", \"jan\"]<br/>\u00a0<br/>const malepreferences = Dict(<br/>  \"abe\" =&gt; [\"abi\", \"eve\", \"cath\", \"ivy\", \"jan\", \"dee\", \"fay\", \"bea\", \"hope\", \"gay\"],<br/>  \"bob\" =&gt; [\"cath\", \"hope\", \"abi\", \"dee\", \"eve\", \"fay\", \"bea\", \"jan\", \"ivy\", \"gay\"],<br/>  \"col\" =&gt; [\"hope\", \"eve\", \"abi\", \"dee\", \"bea\", \"fay\", \"ivy\", \"gay\", \"cath\", \"jan\"],<br/>  \"dan\" =&gt; [\"ivy\", \"fay\", \"dee\", \"gay\", \"hope\", \"eve\", \"jan\", \"bea\", \"cath\", \"abi\"],<br/>   \"ed\" =&gt; [\"jan\", \"dee\", \"bea\", \"cath\", \"fay\", \"eve\", \"abi\", \"ivy\", \"hope\", \"gay\"],<br/> \"fred\" =&gt; [\"bea\", \"abi\", \"dee\", \"gay\", \"eve\", \"ivy\", \"cath\", \"jan\", \"hope\", \"fay\"],<br/>  \"gav\" =&gt; [\"gay\", \"eve\", \"ivy\", \"bea\", \"cath\", \"abi\", \"dee\", \"hope\", \"jan\", \"fay\"],<br/>  \"hal\" =&gt; [\"abi\", \"eve\", \"hope\", \"fay\", \"ivy\", \"cath\", \"jan\", \"bea\", \"gay\", \"dee\"],<br/>  \"ian\" =&gt; [\"hope\", \"cath\", \"dee\", \"gay\", \"bea\", \"abi\", \"fay\", \"ivy\", \"jan\", \"eve\"],<br/>  \"jon\" =&gt; [\"abi\", \"fay\", \"jan\", \"gay\", \"eve\", \"bea\", \"dee\", \"cath\", \"ivy\", \"hope\"]<br/>)<br/>\u00a0<br/>const femalepreferences = Dict(<br/>  \"abi\"=&gt; [\"bob\", \"fred\", \"jon\", \"gav\", \"ian\", \"abe\", \"dan\", \"ed\", \"col\", \"hal\"],<br/>  \"bea\"=&gt; [\"bob\", \"abe\", \"col\", \"fred\", \"gav\", \"dan\", \"ian\", \"ed\", \"jon\", \"hal\"],<br/> \"cath\"=&gt; [\"fred\", \"bob\", \"ed\", \"gav\", \"hal\", \"col\", \"ian\", \"abe\", \"dan\", \"jon\"],<br/>  \"dee\"=&gt; [\"fred\", \"jon\", \"col\", \"abe\", \"ian\", \"hal\", \"gav\", \"dan\", \"bob\", \"ed\"],<br/>  \"eve\"=&gt; [\"jon\", \"hal\", \"fred\", \"dan\", \"abe\", \"gav\", \"col\", \"ed\", \"ian\", \"bob\"],<br/>  \"fay\"=&gt; [\"bob\", \"abe\", \"ed\", \"ian\", \"jon\", \"dan\", \"fred\", \"gav\", \"col\", \"hal\"],<br/>  \"gay\"=&gt; [\"jon\", \"gav\", \"hal\", \"fred\", \"bob\", \"abe\", \"col\", \"ed\", \"dan\", \"ian\"],<br/> \"hope\"=&gt; [\"gav\", \"jon\", \"bob\", \"abe\", \"ian\", \"dan\", \"hal\", \"ed\", \"col\", \"fred\"],<br/>  \"ivy\"=&gt; [\"ian\", \"col\", \"hal\", \"gav\", \"fred\", \"bob\", \"abe\", \"ed\", \"jon\", \"dan\"],<br/>  \"jan\"=&gt; [\"ed\", \"hal\", \"gav\", \"abe\", \"bob\", \"jon\", \"col\", \"ian\", \"fred\", \"dan\"]<br/>)<br/>\u00a0<br/>function pshuf(d)<br/>    ret = Dict()<br/>    for (k,v) in d<br/>        ret[k] = shuffle(v)<br/>    end<br/>    ret<br/>end<br/>\u00a0<br/># helper functions for the verb: p1 \"prefers\" p2 over p3<br/>pindexin(a, p) = ([i for i in 1:length(a) if a[i] == p])[1]<br/>prefers(d, p1, p2, p3) = (pindexin(d[p1], p2) &lt; pindexin(d[p1], p3))<br/>\u00a0<br/>function isstable(mmatchup, fmatchup, mpref, fpref)<br/>    for (mmatch, fmatch) in mmatchup<br/>        for f in mpref[mmatch]<br/>            if(f\u00a0!= fmatch &amp;&amp; prefers(mpref, mmatch, f, fmatch)<br/>                           &amp;&amp; prefers(fpref, f, mmatch, fmatchup[f]))<br/>                println(\"$mmatch prefers $f and $f prefers $mmatch over their current partners.\")<br/>                return false<br/>            end<br/>        end<br/>    end<br/>    true<br/>end<br/>\u00a0<br/>function galeshapley(men, women, malepref, femalepref)<br/>    # Initialize all m \u2208 M and w \u2208 W to free<br/>    mfree = Dict([(p, true) for p in men])<br/>    wfree = Dict([(p, true) for p in women])<br/>    mpairs = Dict()<br/>    wpairs = Dict()<br/>    while true                    # while \u2203 free man m who still has a woman w to propose to<br/>        bachelors = [p for p in keys(mfree) if mfree[p]]<br/>        if(length(bachelors) == 0)<br/>            return mpairs, wpairs<br/>        end<br/>        for m in bachelors<br/>            for w in malepref[m]  # w = first woman on m\u2019s list to whom m has not yet proposed<br/>                if(wfree[w])      # if w is free (else some pair (m', w) already exists)<br/>                    #println(\"Free match: $m, $w\")<br/>                    mpairs[m] = w # (m, w) become engaged<br/>                    wpairs[w] = m # double entry bookeeping<br/>                    mfree[m] = false<br/>                    wfree[w] = false<br/>                    break<br/>                elseif(prefers(femalepref, w, m, wpairs[w])) # if w prefers m to m'<br/>                    #println(\"Unmatch $(wpairs[w]), match: $m, $w\")<br/>                    mfree[wpairs[w]] = true # m' becomes free<br/>                    mpairs[m] = w           # (m, w) become engaged<br/>                    wpairs[w] = m<br/>                    mfree[m] = false<br/>                    break<br/>                end                         # else (m', w) remain engaged, so continue<br/>            end<br/>        end<br/>    end<br/>end<br/>\u00a0<br/>function tableprint(txt, ans, stab)<br/>    println(txt)<br/>    println(\"   Man     Woman\")<br/>    println(\"   -----   -----\")<br/>    show(STDOUT, \"text/plain\", ans)<br/>    if(stab)<br/>        println(\"\\n  ----STABLE----\\n\\n\")<br/>    else<br/>        println(\"\\n  ---UNSTABLE---\\n\\n\")<br/>    end<br/>end<br/>\u00a0<br/>println(\"Use the Gale Shapley algorithm to find a stable set of engagements.\")<br/>answer = galeshapley(males, females, malepreferences, femalepreferences)<br/>stabl = isstable(answer[1], answer[2], malepreferences, femalepreferences)<br/>tableprint(\"Original Data Table\", answer[1], stabl)<br/>\u00a0<br/>println(\"To check this is not a one-off solution, run the function on a randomized sample.\")<br/>newmpref = pshuf(malepreferences)<br/>newfpref = pshuf(femalepreferences)<br/>answer = galeshapley(males, females, newmpref, newfpref)<br/>stabl = isstable(answer[1], answer[2], newmpref, newfpref)<br/>tableprint(\"Shuffled Preferences\", answer[1], stabl)<br/>\u00a0<br/># trade abe with bob<br/>println(\"Perturb this set of engagements to form an unstable set of engagements then check this new set for stability.\")<br/>answer = galeshapley(males, females, malepreferences, femalepreferences)<br/>fia1 = (answer[1])[\"abe\"]<br/>fia2 = (answer[1])[\"bob\"]<br/>answer[1][\"abe\"] = fia2<br/>answer[1][\"bob\"] = fia1<br/>answer[2][fia1] = \"bob\"<br/>answer[2][fia2] = \"abe\"<br/>stabl = isstable(answer[1], answer[2], malepreferences, femalepreferences)<br/>tableprint(\"Original Data With Bob and Abe Switched\", answer[1], stabl)<br/>\u00a0<br/>\u00a0</pre>"}, {"lang": "Kotlin", "loc": 108, "block": "<pre class=\"java highlighted_source\">\u00a0<br/>data <span class=\"kw1\">class</span> Person<span class=\"br0\">(</span>val name<span class=\"sy0\">:</span> <a href=\"http://www.google.com/search?hl=en&amp;q=allinurl%3Astring+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span class=\"kw3\">String</span></a><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    val preferences <span class=\"sy0\">=</span> mutableListOf<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    var matchedTo<span class=\"sy0\">:</span> Person<span class=\"sy0\">?</span> <span class=\"sy0\">=</span> <span class=\"kw2\">null</span><br/>\u00a0<br/>    fun trySwap<span class=\"br0\">(</span>p<span class=\"sy0\">:</span> Person<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span>prefers<span class=\"br0\">(</span>p<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            matchedTo<span class=\"sy0\">?</span>.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">=</span> <span class=\"kw2\">null</span><br/>            matchedTo <span class=\"sy0\">=</span> p<br/>            p.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">=</span> <span class=\"kw1\">this</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    fun prefers<span class=\"br0\">(</span>p<span class=\"sy0\">:</span> Person<span class=\"br0\">)</span> <span class=\"sy0\">=</span> when <span class=\"br0\">(</span>matchedTo<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw2\">null</span> <span class=\"sy0\">-&gt;</span> <span class=\"kw2\">true</span><br/>        <span class=\"kw1\">else</span> <span class=\"sy0\">-&gt;</span> preferences.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>p<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> preferences.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>matchedTo<span class=\"sy0\">!!</span><span class=\"br0\">)</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    fun showMatch<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"sy0\">=</span> <span class=\"st0\">\"$name &lt;=&gt; ${matchedTo?.name}\"</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>fun match<span class=\"br0\">(</span>males<span class=\"sy0\">:</span> Collection<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <span class=\"kw1\">while</span> <span class=\"br0\">(</span>males.<span class=\"me1\">find</span> <span class=\"br0\">{</span> it.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">==</span> <span class=\"kw2\">null</span> <span class=\"br0\">}</span><span class=\"sy0\">?</span>.<span class=\"me1\">also</span> <span class=\"br0\">{</span> match<span class=\"br0\">(</span>it<span class=\"br0\">)</span> <span class=\"br0\">}</span> <span class=\"sy0\">!=</span> <span class=\"kw2\">null</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>fun match<span class=\"br0\">(</span>male<span class=\"sy0\">:</span> Person<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <span class=\"kw1\">while</span> <span class=\"br0\">(</span>male.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">==</span> <span class=\"kw2\">null</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        male.<span class=\"me1\">preferences</span>.<span class=\"me1\">removeAt</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span>.<span class=\"me1\">trySwap</span><span class=\"br0\">(</span>male<span class=\"br0\">)</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>fun isStableMatch<span class=\"br0\">(</span>males<span class=\"sy0\">:</span> Collection<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span>, females<span class=\"sy0\">:</span> Collection<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">)</span><span class=\"sy0\">:</span> <a href=\"http://www.google.com/search?hl=en&amp;q=allinurl%3Aboolean+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span class=\"kw3\">Boolean</span></a> <span class=\"br0\">{</span><br/>    <span class=\"kw1\">return</span> males.<span class=\"me1\">all</span> <span class=\"br0\">{</span> isStableMatch<span class=\"br0\">(</span>it, females<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>fun isStableMatch<span class=\"br0\">(</span>male<span class=\"sy0\">:</span> Person, females<span class=\"sy0\">:</span> Collection<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">)</span><span class=\"sy0\">:</span> <a href=\"http://www.google.com/search?hl=en&amp;q=allinurl%3Aboolean+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span class=\"kw3\">Boolean</span></a> <span class=\"br0\">{</span><br/>\u00a0<br/>    val likesBetter <span class=\"sy0\">=</span> females.<span class=\"me1\">filter</span> <span class=\"br0\">{</span> <span class=\"sy0\">!</span>male.<span class=\"me1\">preferences</span>.<span class=\"me1\">contains</span><span class=\"br0\">(</span>it<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>    val stable <span class=\"sy0\">=</span> <span class=\"sy0\">!</span>likesBetter.<span class=\"me1\">any</span> <span class=\"br0\">{</span> it.<span class=\"me1\">prefers</span><span class=\"br0\">(</span>male<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"sy0\">!</span>stable<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        println<span class=\"br0\">(</span><span class=\"st0\">\"#### Unstable pair: ${male.showMatch()}\"</span><span class=\"br0\">)</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> stable<br/><span class=\"br0\">}</span><br/>\u00a0<br/>\u00a0<br/>fun main<span class=\"br0\">(</span>args<span class=\"sy0\">:</span> Array<span class=\"sy0\">&lt;</span>String<span class=\"sy0\">&gt;</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    val inMales <span class=\"sy0\">=</span> mapOf<span class=\"br0\">(</span><br/>            <span class=\"st0\">\"abe\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"bob\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"col\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"dan\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"abi\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"ed\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"fred\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"gav\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"hal\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"dee\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"ian\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"eve\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"jon\"</span> to mutableListOf<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"hope\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>    val inFemales <span class=\"sy0\">=</span> mapOf<span class=\"br0\">(</span><br/>            <span class=\"st0\">\"abi\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"bea\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"cath\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"jon\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"dee\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"ed\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"eve\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"bob\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"fay\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"gay\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ian\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"hope\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"fred\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"ivy\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span>,<br/>            <span class=\"st0\">\"jan\"</span> to listOf<span class=\"br0\">(</span><span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/>    fun buildPrefs<span class=\"br0\">(</span>person<span class=\"sy0\">:</span> Person, stringPrefs<span class=\"sy0\">:</span> List<span class=\"sy0\">&lt;</span>String<span class=\"sy0\">&gt;</span>, population<span class=\"sy0\">:</span> List<span class=\"sy0\">&lt;</span>Person<span class=\"sy0\">&gt;</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        person.<span class=\"me1\">preferences</span>.<span class=\"me1\">addAll</span><span class=\"br0\">(</span><br/>                stringPrefs.<span class=\"me1\">map</span> <span class=\"br0\">{</span> name <span class=\"sy0\">-&gt;</span> population.<span class=\"me1\">single</span> <span class=\"br0\">{</span> it.<span class=\"me1\">name</span> <span class=\"sy0\">==</span> name <span class=\"br0\">}</span> <span class=\"br0\">}</span><br/>        <span class=\"br0\">)</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    val males <span class=\"sy0\">=</span> inMales.<span class=\"me1\">keys</span>.<span class=\"me1\">map</span> <span class=\"br0\">{</span> Person<span class=\"br0\">(</span>it<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>    val females <span class=\"sy0\">=</span> inFemales.<span class=\"me1\">keys</span>.<span class=\"me1\">map</span> <span class=\"br0\">{</span> Person<span class=\"br0\">(</span>it<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/>    males.<span class=\"kw1\">forEach</span> <span class=\"br0\">{</span> buildPrefs<span class=\"br0\">(</span>it, inMales<span class=\"br0\">[</span>it.<span class=\"me1\">name</span><span class=\"br0\">]</span><span class=\"sy0\">!!</span>, females<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>    females.<span class=\"kw1\">forEach</span> <span class=\"br0\">{</span> buildPrefs<span class=\"br0\">(</span>it, inFemales<span class=\"br0\">[</span>it.<span class=\"me1\">name</span><span class=\"br0\">]</span><span class=\"sy0\">!!</span>, males<span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/>\u00a0<br/>    match<span class=\"br0\">(</span>males<span class=\"br0\">)</span><br/>    males.<span class=\"kw1\">forEach</span> <span class=\"br0\">{</span> println<span class=\"br0\">(</span>it.<span class=\"me1\">showMatch</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>    println<span class=\"br0\">(</span><span class=\"st0\">\"#### match is stable: ${isStableMatch(males, females)}\"</span><span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/>    fun swapMatch<span class=\"br0\">(</span>male1<span class=\"sy0\">:</span> Person, male2<span class=\"sy0\">:</span> Person<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        val female1 <span class=\"sy0\">=</span> male1.<span class=\"me1\">matchedTo</span><span class=\"sy0\">!!</span><br/>        val female2 <span class=\"sy0\">=</span> male2.<span class=\"me1\">matchedTo</span><span class=\"sy0\">!!</span><br/>\u00a0<br/>        male1.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">=</span> female2<br/>        male2.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">=</span> female1<br/>\u00a0<br/>        female1.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">=</span> male2<br/>        female2.<span class=\"me1\">matchedTo</span> <span class=\"sy0\">=</span> male1<br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    swapMatch<span class=\"br0\">(</span>males.<span class=\"me1\">single</span> <span class=\"br0\">{</span> it.<span class=\"me1\">name</span> <span class=\"sy0\">==</span> <span class=\"st0\">\"fred\"</span> <span class=\"br0\">}</span>, males.<span class=\"me1\">single</span> <span class=\"br0\">{</span> it.<span class=\"me1\">name</span> <span class=\"sy0\">==</span> <span class=\"st0\">\"jon\"</span> <span class=\"br0\">}</span><span class=\"br0\">)</span><br/>    males.<span class=\"kw1\">forEach</span> <span class=\"br0\">{</span> println<span class=\"br0\">(</span>it.<span class=\"me1\">showMatch</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>    println<span class=\"br0\">(</span><span class=\"st0\">\"#### match is stable: ${isStableMatch(males, females)}\"</span><span class=\"br0\">)</span><br/><span class=\"br0\">}</span><br/>\u00a0</pre>"}, {"lang": "Lua", "loc": 129, "block": "<pre class=\"lua highlighted_source\"><span class=\"kw1\">local</span> Person <span class=\"sy0\">=</span> <span class=\"br0\">{</span><span class=\"br0\">}</span><br/>Person<span class=\"sy0\">.</span>__index <span class=\"sy0\">=</span> Person<br/>\u00a0<br/><span class=\"kw1\">function</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span>inName<span class=\"br0\">)</span><br/>    <span class=\"kw1\">local</span> o <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/>        name            <span class=\"sy0\">=</span> inName<span class=\"sy0\">,</span><br/>        prefs           <span class=\"sy0\">=</span> <span class=\"kw4\">nil</span><span class=\"sy0\">,</span><br/>        fiance          <span class=\"sy0\">=</span> <span class=\"kw4\">nil</span><span class=\"sy0\">,</span><br/>        _candidateIndex <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">,</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> <span class=\"kw3\">setmetatable</span><span class=\"br0\">(</span>o<span class=\"sy0\">,</span> Person<span class=\"br0\">)</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">function</span> Person<span class=\"sy0\">:</span>indexOf<span class=\"br0\">(</span>other<span class=\"br0\">)</span><br/>    <span class=\"kw1\">for</span> i<span class=\"sy0\">,</span> p <span class=\"kw2\">in</span> <span class=\"kw3\">pairs</span><span class=\"br0\">(</span>self<span class=\"sy0\">.</span>prefs<span class=\"br0\">)</span> <span class=\"kw1\">do</span><br/>        <span class=\"kw1\">if</span> p <span class=\"sy0\">==</span> other <span class=\"kw1\">then</span> <span class=\"kw1\">return</span> i <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">return</span> <span class=\"nu0\">999</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">function</span> Person<span class=\"sy0\">:</span>prefers<span class=\"br0\">(</span>other<span class=\"br0\">)</span><br/>    <span class=\"kw1\">return</span> self<span class=\"sy0\">:</span>indexOf<span class=\"br0\">(</span>other<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> self<span class=\"sy0\">:</span>indexOf<span class=\"br0\">(</span>self<span class=\"sy0\">.</span>fiance<span class=\"br0\">)</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">function</span> Person<span class=\"sy0\">:</span>nextCandidateNotYetProposedTo<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">if</span> self<span class=\"sy0\">.</span>_candidateIndex <span class=\"sy0\">&gt;=</span> <span class=\"sy0\">#</span>self<span class=\"sy0\">.</span>prefs <span class=\"kw1\">then</span> <span class=\"kw1\">return</span> <span class=\"kw4\">nil</span> <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">local</span> c <span class=\"sy0\">=</span> self<span class=\"sy0\">.</span>prefs<span class=\"br0\">[</span>self<span class=\"sy0\">.</span>_candidateIndex<span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>    self<span class=\"sy0\">.</span>_candidateIndex <span class=\"sy0\">=</span> self<span class=\"sy0\">.</span>_candidateIndex <span class=\"sy0\">+</span> <span class=\"nu0\">1</span><br/>    <span class=\"kw1\">return</span> c<span class=\"sy0\">;</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">function</span> Person<span class=\"sy0\">:</span>engageTo<span class=\"br0\">(</span>other<span class=\"br0\">)</span><br/>    <span class=\"kw1\">if</span> other<span class=\"sy0\">.</span>fiance <span class=\"kw1\">then</span><br/>        other<span class=\"sy0\">.</span>fiance<span class=\"sy0\">.</span>fiance <span class=\"sy0\">=</span> <span class=\"kw4\">nil</span><br/>    <span class=\"kw1\">end</span><br/>    other<span class=\"sy0\">.</span>fiance <span class=\"sy0\">=</span> self<br/>    <span class=\"kw1\">if</span> self<span class=\"sy0\">.</span>fiance <span class=\"kw1\">then</span><br/>        self<span class=\"sy0\">.</span>fiance<span class=\"sy0\">.</span>fiance <span class=\"sy0\">=</span> <span class=\"kw4\">nil</span><br/>    <span class=\"kw1\">end</span><br/>    self<span class=\"sy0\">.</span>fiance <span class=\"sy0\">=</span> other<span class=\"sy0\">;</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">local</span> <span class=\"kw1\">function</span> isStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><br/>    <span class=\"kw1\">local</span> women <span class=\"sy0\">=</span> men<span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"sy0\">.</span>prefs<br/>    <span class=\"kw1\">local</span> stable <span class=\"sy0\">=</span> <span class=\"kw4\">true</span><br/>    <span class=\"kw1\">for</span> _<span class=\"sy0\">,</span> guy <span class=\"kw2\">in</span> <span class=\"kw3\">pairs</span><span class=\"br0\">(</span>men<span class=\"br0\">)</span> <span class=\"kw1\">do</span><br/>        <span class=\"kw1\">for</span> _<span class=\"sy0\">,</span> gal <span class=\"kw2\">in</span> <span class=\"kw3\">pairs</span><span class=\"br0\">(</span>women<span class=\"br0\">)</span> <span class=\"kw1\">do</span><br/>            <span class=\"kw1\">if</span> guy<span class=\"sy0\">:</span>prefers<span class=\"br0\">(</span>gal<span class=\"br0\">)</span> <span class=\"kw2\">and</span> gal<span class=\"sy0\">:</span>prefers<span class=\"br0\">(</span>guy<span class=\"br0\">)</span> <span class=\"kw1\">then</span><br/>                stable <span class=\"sy0\">=</span> <span class=\"kw4\">false</span><br/>                <span class=\"kw3\">print</span><span class=\"br0\">(</span>guy<span class=\"sy0\">.</span>name <span class=\"sy0\">..</span> <span class=\"st0\">' and '</span> <span class=\"sy0\">..</span> gal<span class=\"sy0\">.</span>name <span class=\"sy0\">..</span><br/>                      <span class=\"st0\">' prefer each other over their partners '</span> <span class=\"sy0\">..</span><br/>                      guy<span class=\"sy0\">.</span>fiance<span class=\"sy0\">.</span>name <span class=\"sy0\">..</span> <span class=\"st0\">' and '</span> <span class=\"sy0\">..</span> gal<span class=\"sy0\">.</span>fiance<span class=\"sy0\">.</span>name<span class=\"br0\">)</span><br/>            <span class=\"kw1\">end</span><br/>        <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">return</span> stable<br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw1\">local</span> abe  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Abe\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> bob  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Bob\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> col  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Col\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> dan  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Dan\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> ed   <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Ed\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> fred <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Fred\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> gav  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Gav\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> hal  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Hal\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> ian  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Ian\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> jon  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Jon\"</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">local</span> abi  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Abi\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> bea  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Bea\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> cath <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Cath\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> dee  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Dee\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> eve  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Eve\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> fay  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Fay\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> gay  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Gay\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> hope <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Hope\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> ivy  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Ivy\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">local</span> jan  <span class=\"sy0\">=</span> Person<span class=\"sy0\">.</span>new<span class=\"br0\">(</span><span class=\"st0\">\"Jan\"</span><span class=\"br0\">)</span><br/>\u00a0<br/>abe<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> abi<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span>  jan<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  fay<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  hope<span class=\"sy0\">,</span> gay  <span class=\"br0\">}</span><br/>bob<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> cath<span class=\"sy0\">,</span> hope<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  fay<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  jan<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  gay  <span class=\"br0\">}</span><br/>col<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> hope<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span>  abi<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  fay<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  gay<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> jan  <span class=\"br0\">}</span><br/>dan<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> ivy<span class=\"sy0\">,</span>  fay<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  gay<span class=\"sy0\">,</span>  hope<span class=\"sy0\">,</span> eve<span class=\"sy0\">,</span>  jan<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> abi  <span class=\"br0\">}</span><br/>ed<span class=\"sy0\">.</span>prefs   <span class=\"sy0\">=</span> <span class=\"br0\">{</span> jan<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  abi<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  hope<span class=\"sy0\">,</span> gay  <span class=\"br0\">}</span><br/>fred<span class=\"sy0\">.</span>prefs <span class=\"sy0\">=</span> <span class=\"br0\">{</span> bea<span class=\"sy0\">,</span>  abi<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  gay<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span>  hope<span class=\"sy0\">,</span> fay  <span class=\"br0\">}</span><br/>gav<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> gay<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> abi<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  hope<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span>  fay  <span class=\"br0\">}</span><br/>hal<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> abi<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  hope<span class=\"sy0\">,</span> fay<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> jan<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  gay<span class=\"sy0\">,</span>  dee  <span class=\"br0\">}</span><br/>ian<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> hope<span class=\"sy0\">,</span> cath<span class=\"sy0\">,</span> dee<span class=\"sy0\">,</span>  gay<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  abi<span class=\"sy0\">,</span>  fay<span class=\"sy0\">,</span>  ivy<span class=\"sy0\">,</span>  jan<span class=\"sy0\">,</span>  eve  <span class=\"br0\">}</span><br/>jon<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> abi<span class=\"sy0\">,</span>  fay<span class=\"sy0\">,</span>  jan<span class=\"sy0\">,</span>  gay<span class=\"sy0\">,</span>  eve<span class=\"sy0\">,</span>  bea<span class=\"sy0\">,</span>  dee<span class=\"sy0\">,</span>  cath<span class=\"sy0\">,</span> ivy<span class=\"sy0\">,</span>  hope <span class=\"br0\">}</span><br/>\u00a0<br/>abi<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> bob<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span>  gav<span class=\"sy0\">,</span>  ian<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  dan<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   col<span class=\"sy0\">,</span>  hal  <span class=\"br0\">}</span><br/>bea<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> bob<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span>  dan<span class=\"sy0\">,</span>  ian<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   jon<span class=\"sy0\">,</span>  hal  <span class=\"br0\">}</span><br/>cath<span class=\"sy0\">.</span>prefs <span class=\"sy0\">=</span> <span class=\"br0\">{</span> fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   gav<span class=\"sy0\">,</span>  hal<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  ian<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  dan<span class=\"sy0\">,</span>  jon  <span class=\"br0\">}</span><br/>dee<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> fred<span class=\"sy0\">,</span> jon<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  ian<span class=\"sy0\">,</span>  hal<span class=\"sy0\">,</span>  gav<span class=\"sy0\">,</span>  dan<span class=\"sy0\">,</span>  bob<span class=\"sy0\">,</span>  ed   <span class=\"br0\">}</span><br/>eve<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> jon<span class=\"sy0\">,</span>  hal<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> dan<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  gav<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   ian<span class=\"sy0\">,</span>  bob  <span class=\"br0\">}</span><br/>fay<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> bob<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   ian<span class=\"sy0\">,</span>  jon<span class=\"sy0\">,</span>  dan<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> gav<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  hal  <span class=\"br0\">}</span><br/>gay<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> jon<span class=\"sy0\">,</span>  gav<span class=\"sy0\">,</span>  hal<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   dan<span class=\"sy0\">,</span>  ian  <span class=\"br0\">}</span><br/>hope<span class=\"sy0\">.</span>prefs <span class=\"sy0\">=</span> <span class=\"br0\">{</span> gav<span class=\"sy0\">,</span>  jon<span class=\"sy0\">,</span>  bob<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  ian<span class=\"sy0\">,</span>  dan<span class=\"sy0\">,</span>  hal<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   col<span class=\"sy0\">,</span>  fred <span class=\"br0\">}</span><br/>ivy<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> ian<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  hal<span class=\"sy0\">,</span>  gav<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> bob<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  ed<span class=\"sy0\">,</span>   jon<span class=\"sy0\">,</span>  dan  <span class=\"br0\">}</span><br/>jan<span class=\"sy0\">.</span>prefs  <span class=\"sy0\">=</span> <span class=\"br0\">{</span> ed<span class=\"sy0\">,</span>   hal<span class=\"sy0\">,</span>  gav<span class=\"sy0\">,</span>  abe<span class=\"sy0\">,</span>  bob<span class=\"sy0\">,</span>  jon<span class=\"sy0\">,</span>  col<span class=\"sy0\">,</span>  ian<span class=\"sy0\">,</span>  fred<span class=\"sy0\">,</span> dan  <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">local</span> men <span class=\"sy0\">=</span> abi<span class=\"sy0\">.</span>prefs<br/><span class=\"kw1\">local</span> freeMenCount <span class=\"sy0\">=</span> <span class=\"sy0\">#</span>men<br/><span class=\"kw1\">while</span> freeMenCount <span class=\"sy0\">&gt;</span> <span class=\"nu0\">0</span> <span class=\"kw1\">do</span><br/>    <span class=\"kw1\">for</span> _<span class=\"sy0\">,</span> guy <span class=\"kw2\">in</span> <span class=\"kw3\">pairs</span><span class=\"br0\">(</span>men<span class=\"br0\">)</span> <span class=\"kw1\">do</span><br/>        <span class=\"kw1\">if</span> <span class=\"kw2\">not</span> guy<span class=\"sy0\">.</span>fiance <span class=\"kw1\">then</span><br/>            <span class=\"kw1\">local</span> gal <span class=\"sy0\">=</span> guy<span class=\"sy0\">:</span>nextCandidateNotYetProposedTo<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>            <span class=\"kw1\">if</span> <span class=\"kw2\">not</span> gal<span class=\"sy0\">.</span>fiance <span class=\"kw1\">then</span><br/>                guy<span class=\"sy0\">:</span>engageTo<span class=\"br0\">(</span>gal<span class=\"br0\">)</span><br/>                freeMenCount <span class=\"sy0\">=</span> freeMenCount <span class=\"sy0\">-</span> <span class=\"nu0\">1</span><br/>            <span class=\"kw1\">elseif</span> gal<span class=\"sy0\">:</span>prefers<span class=\"br0\">(</span>guy<span class=\"br0\">)</span> <span class=\"kw1\">then</span><br/>                guy<span class=\"sy0\">:</span>engageTo<span class=\"br0\">(</span>gal<span class=\"br0\">)</span><br/>            <span class=\"kw1\">end</span><br/>        <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">end</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw3\">print</span><span class=\"br0\">(</span><span class=\"st0\">' '</span><span class=\"br0\">)</span><br/><span class=\"kw1\">for</span> _<span class=\"sy0\">,</span> guy <span class=\"kw2\">in</span> <span class=\"kw3\">pairs</span><span class=\"br0\">(</span>men<span class=\"br0\">)</span> <span class=\"kw1\">do</span><br/>    <span class=\"kw3\">print</span><span class=\"br0\">(</span>guy<span class=\"sy0\">.</span>name <span class=\"sy0\">..</span> <span class=\"st0\">' is engaged to '</span> <span class=\"sy0\">..</span> guy<span class=\"sy0\">.</span>fiance<span class=\"sy0\">.</span>name<span class=\"br0\">)</span><br/><span class=\"kw1\">end</span><br/><span class=\"kw3\">print</span><span class=\"br0\">(</span><span class=\"st0\">'Stable: '</span><span class=\"sy0\">,</span> isStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw3\">print</span><span class=\"br0\">(</span><span class=\"st0\">' '</span><span class=\"br0\">)</span><br/><span class=\"kw3\">print</span><span class=\"br0\">(</span><span class=\"st0\">'Switching '</span> <span class=\"sy0\">..</span> fred<span class=\"sy0\">.</span>name <span class=\"sy0\">..</span> <span class=\"st0\">\"'s &amp; \"</span> <span class=\"sy0\">..</span> jon<span class=\"sy0\">.</span>name <span class=\"sy0\">..</span> <span class=\"st0\">\"'s partners\"</span><span class=\"br0\">)</span><br/>jon<span class=\"sy0\">.</span>fiance<span class=\"sy0\">,</span> fred<span class=\"sy0\">.</span>fiance <span class=\"sy0\">=</span> fred<span class=\"sy0\">.</span>fiance<span class=\"sy0\">,</span> jon<span class=\"sy0\">.</span>fiance<br/><span class=\"kw3\">print</span><span class=\"br0\">(</span><span class=\"st0\">'Stable: '</span><span class=\"sy0\">,</span> isStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0</pre>"}, {"lang": "Objective-C", "loc": 137, "block": "<pre class=\"objc highlighted_source\"><span class=\"co2\">//--------------------------------------------------------------------</span><br/><span class=\"co2\">// Person class</span><br/>\u00a0<br/><span class=\"kw1\">@interface</span> Person <span class=\"sy0\">:</span> <a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/\"><span class=\"kw5\">NSObject</span></a> <span class=\"br0\">{</span><br/>    NSUInteger _candidateIndex;<br/><span class=\"br0\">}</span><br/><span class=\"kw1\">@property</span> <span class=\"br0\">(</span>nonatomic, strong<span class=\"br0\">)</span>   <a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/\"><span class=\"kw5\">NSString</span></a><span class=\"sy0\">*</span>   name;<br/><span class=\"kw1\">@property</span> <span class=\"br0\">(</span>nonatomic, strong<span class=\"br0\">)</span>   <a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/\"><span class=\"kw5\">NSArray</span></a><span class=\"sy0\">*</span>    prefs;<br/><span class=\"kw1\">@property</span> <span class=\"br0\">(</span>nonatomic, weak<span class=\"br0\">)</span>     Person<span class=\"sy0\">*</span>     fiance;<br/><span class=\"kw1\">@end</span><br/>\u00a0<br/><span class=\"kw1\">@implementation</span> Person<br/><span class=\"sy0\">+</span> <span class=\"br0\">(</span>instancetype<span class=\"br0\">)</span>named<span class=\"sy0\">:</span><span class=\"br0\">(</span><a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/\"><span class=\"kw5\">NSString</span></a> <span class=\"sy0\">*</span><span class=\"br0\">)</span>name <span class=\"br0\">{</span><br/>    <span class=\"kw1\">return</span> <span class=\"br0\">[</span><span class=\"br0\">[</span>self alloc<span class=\"br0\">]</span> initWithName<span class=\"sy0\">:</span>name<span class=\"br0\">]</span>;<br/><span class=\"br0\">}</span><br/><span class=\"sy0\">-</span> <span class=\"br0\">(</span>instancetype<span class=\"br0\">)</span>initWithName<span class=\"sy0\">:</span><span class=\"br0\">(</span><a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/\"><span class=\"kw5\">NSString</span></a> <span class=\"sy0\">*</span><span class=\"br0\">)</span>name <span class=\"br0\">{</span><br/>    <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"br0\">(</span>self <span class=\"sy0\">=</span> <span class=\"br0\">[</span>super init<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        _name <span class=\"sy0\">=</span> name;<br/>        _prefs <span class=\"sy0\">=</span> <span class=\"kw2\">nil</span>;<br/>        _fiance <span class=\"sy0\">=</span> <span class=\"kw2\">nil</span>;<br/>        _candidateIndex <span class=\"sy0\">=</span> <span class=\"nu0\">0</span>;<br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> self;<br/><span class=\"br0\">}</span><br/><span class=\"sy0\">-</span> <span class=\"br0\">(</span><span class=\"kw4\">BOOL</span><span class=\"br0\">)</span>prefers<span class=\"sy0\">:</span><span class=\"br0\">(</span>Person <span class=\"sy0\">*</span><span class=\"br0\">)</span>p <span class=\"br0\">{</span><br/>    <span class=\"kw1\">return</span> <span class=\"br0\">[</span>_prefs indexOfObject<span class=\"sy0\">:</span>p<span class=\"br0\">]</span> &lt; <span class=\"br0\">[</span>_prefs indexOfObject<span class=\"sy0\">:</span>_fiance<span class=\"br0\">]</span>;<br/><span class=\"br0\">}</span><br/><span class=\"sy0\">-</span> <span class=\"br0\">(</span>Person <span class=\"sy0\">*</span><span class=\"br0\">)</span>nextCandidateNotYetProposedTo <span class=\"br0\">{</span><br/>    <span class=\"kw1\">if</span> <span class=\"br0\">(</span>_candidateIndex &gt;<span class=\"sy0\">=</span> _prefs.count<span class=\"br0\">)</span> <span class=\"kw1\">return</span> <span class=\"kw2\">nil</span>;<br/>    <span class=\"kw1\">return</span> _prefs<span class=\"br0\">[</span>_candidateIndex<span class=\"sy0\">++</span><span class=\"br0\">]</span>;<br/><span class=\"br0\">}</span><br/><span class=\"sy0\">-</span> <span class=\"br0\">(</span><span class=\"kw4\">void</span><span class=\"br0\">)</span>engageTo<span class=\"sy0\">:</span><span class=\"br0\">(</span>Person <span class=\"sy0\">*</span><span class=\"br0\">)</span>p <span class=\"br0\">{</span><br/>    <span class=\"kw1\">if</span> <span class=\"br0\">(</span>p.fiance<span class=\"br0\">)</span> p.fiance.fiance <span class=\"sy0\">=</span> <span class=\"kw2\">nil</span>;<br/>    p.fiance <span class=\"sy0\">=</span> self;<br/>    <span class=\"kw1\">if</span> <span class=\"br0\">(</span>self.fiance<span class=\"br0\">)</span> self.fiance.fiance <span class=\"sy0\">=</span> <span class=\"kw2\">nil</span>;<br/>    self.fiance <span class=\"sy0\">=</span> p;<br/><span class=\"br0\">}</span><br/><span class=\"sy0\">-</span> <span class=\"br0\">(</span><a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/\"><span class=\"kw5\">NSString</span></a> <span class=\"sy0\">*</span><span class=\"br0\">)</span>description <span class=\"br0\">{</span><br/>    <span class=\"kw1\">return</span> _name;<br/><span class=\"br0\">}</span><br/><span class=\"kw1\">@end</span><br/>\u00a0<br/><span class=\"co2\">//--------------------------------------------------------------------</span><br/>\u00a0<br/><span class=\"kw4\">BOOL</span> isStable<span class=\"br0\">(</span><a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/\"><span class=\"kw5\">NSArray</span></a> <span class=\"sy0\">*</span>men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/\"><span class=\"kw5\">NSArray</span></a> <span class=\"sy0\">*</span>women <span class=\"sy0\">=</span> <span class=\"br0\">(</span><span class=\"br0\">(</span>Person <span class=\"sy0\">*</span><span class=\"br0\">)</span>men<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">)</span>.prefs;<br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span>Person <span class=\"sy0\">*</span>guy <span class=\"kw1\">in</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span>Person <span class=\"sy0\">*</span>gal <span class=\"kw1\">in</span> women<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"br0\">[</span>guy prefers<span class=\"sy0\">:</span>gal<span class=\"br0\">]</span> <span class=\"sy0\">&amp;&amp;</span> <span class=\"br0\">[</span>gal prefers<span class=\"sy0\">:</span>guy<span class=\"br0\">]</span><span class=\"br0\">)</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">NO</span>;<br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> <span class=\"kw2\">YES</span>;<br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co2\">//--------------------------------------------------------------------</span><br/>\u00a0<br/><span class=\"kw4\">void</span> doMarriage<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    Person <span class=\"sy0\">*</span>abe  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"abe\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>bob  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"bob\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>col  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"col\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>dan  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>ed   <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"ed\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>fred <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"fred\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>gav  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"gav\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>hal  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>ian  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"ian\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>jon  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>abi  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>bea  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"bea\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>cath <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"cath\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>dee  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"dee\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>eve  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"eve\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>fay  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>gay  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>hope <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"hope\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>ivy  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"ivy\"</span><span class=\"br0\">]</span>;<br/>    Person <span class=\"sy0\">*</span>jan  <span class=\"sy0\">=</span> <span class=\"br0\">[</span>Person named<span class=\"sy0\">:</span><span class=\"co3\">@</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span>;<br/>\u00a0<br/>    abe.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay <span class=\"br0\">]</span>;<br/>    bob.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay <span class=\"br0\">]</span>;<br/>    col.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan <span class=\"br0\">]</span>;<br/>    dan.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi <span class=\"br0\">]</span>;<br/>    ed.prefs   <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay <span class=\"br0\">]</span>;<br/>    fred.prefs <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay <span class=\"br0\">]</span>;<br/>    gav.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay <span class=\"br0\">]</span>;<br/>    hal.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee <span class=\"br0\">]</span>;<br/>    ian.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve <span class=\"br0\">]</span>;<br/>    jon.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope <span class=\"br0\">]</span>;<br/>    abi.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> bob, fred, jon, gav, ian, abe, dan, ed, col, hal <span class=\"br0\">]</span>;<br/>    bea.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> bob, abe, col, fred, gav, dan, ian, ed, jon, hal <span class=\"br0\">]</span>;<br/>    cath.prefs <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> fred, bob, ed, gav, hal, col, ian, abe, dan, jon <span class=\"br0\">]</span>;<br/>    dee.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> fred, jon, col, abe, ian, hal, gav, dan, bob, ed <span class=\"br0\">]</span>;<br/>    eve.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> jon, hal, fred, dan, abe, gav, col, ed, ian, bob <span class=\"br0\">]</span>;<br/>    fay.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> bob, abe, ed, ian, jon, dan, fred, gav, col, hal <span class=\"br0\">]</span>;<br/>    gay.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> jon, gav, hal, fred, bob, abe, col, ed, dan, ian <span class=\"br0\">]</span>;<br/>    hope.prefs <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> gav, jon, bob, abe, ian, dan, hal, ed, col, fred <span class=\"br0\">]</span>;<br/>    ivy.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> ian, col, hal, gav, fred, bob, abe, ed, jon, dan <span class=\"br0\">]</span>;<br/>    jan.prefs  <span class=\"sy0\">=</span> @<span class=\"br0\">[</span> ed, hal, gav, abe, bob, jon, col, ian, fred, dan <span class=\"br0\">]</span>;<br/>\u00a0<br/>    <a href=\"http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/\"><span class=\"kw5\">NSArray</span></a> <span class=\"sy0\">*</span>men <span class=\"sy0\">=</span> abi.prefs;<br/>\u00a0<br/>    NSUInteger freeMenCount <span class=\"sy0\">=</span> men.count;<br/>    <span class=\"kw1\">while</span> <span class=\"br0\">(</span>freeMenCount &gt; <span class=\"nu0\">0</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">for</span> <span class=\"br0\">(</span>Person <span class=\"sy0\">*</span>guy <span class=\"kw1\">in</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span> <span class=\"br0\">(</span>guy.fiance <span class=\"sy0\">==</span> <span class=\"kw2\">nil</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                Person <span class=\"sy0\">*</span>gal <span class=\"sy0\">=</span> <span class=\"br0\">[</span>guy nextCandidateNotYetProposedTo<span class=\"br0\">]</span>;<br/>                <span class=\"kw1\">if</span> <span class=\"br0\">(</span>gal.fiance <span class=\"sy0\">==</span> <span class=\"kw2\">nil</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    <span class=\"br0\">[</span>guy engageTo<span class=\"sy0\">:</span>gal<span class=\"br0\">]</span>;<br/>                    freeMenCount<span class=\"sy0\">--</span>;<br/>                <span class=\"br0\">}</span> <span class=\"kw1\">else</span> <span class=\"kw1\">if</span> <span class=\"br0\">(</span><span class=\"br0\">[</span>gal prefers<span class=\"sy0\">:</span>guy<span class=\"br0\">]</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    <span class=\"br0\">[</span>guy engageTo<span class=\"sy0\">:</span>gal<span class=\"br0\">]</span>;<br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw1\">for</span> <span class=\"br0\">(</span>Person <span class=\"sy0\">*</span>guy <span class=\"kw1\">in</span> men<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"%s is engaged to\u00a0%s<span class=\"es0\">\\n</span>\"</span>, <span class=\"br0\">[</span>guy.name UTF8String<span class=\"br0\">]</span>, <span class=\"br0\">[</span>guy.fiance.name UTF8String<span class=\"br0\">]</span><span class=\"br0\">)</span>;<br/>    <span class=\"br0\">}</span><br/>    <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"Stable =\u00a0%d<span class=\"es0\">\\n</span>\"</span>, <span class=\"br0\">(</span><span class=\"kw4\">int</span><span class=\"br0\">)</span>isStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><span class=\"br0\">)</span>;<br/>\u00a0<br/>    <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"<span class=\"es0\">\\n</span>Switching fred &amp; jon's partners<span class=\"es0\">\\n</span>\"</span><span class=\"br0\">)</span>;<br/>    <span class=\"br0\">[</span>fred engageTo<span class=\"sy0\">:</span>abi<span class=\"br0\">]</span>;<br/>    <span class=\"br0\">[</span>jon engageTo<span class=\"sy0\">:</span>bea<span class=\"br0\">]</span>;<br/>    <a href=\"http://www.opengroup.org/onlinepubs/009695399/functions/printf.html\"><span class=\"kw3\">printf</span></a><span class=\"br0\">(</span><span class=\"st0\">\"Stable =\u00a0%d<span class=\"es0\">\\n</span>\"</span>, <span class=\"br0\">(</span><span class=\"kw4\">int</span><span class=\"br0\">)</span>isStable<span class=\"br0\">(</span>men<span class=\"br0\">)</span><span class=\"br0\">)</span>;<br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co2\">//--------------------------------------------------------------------</span><br/>\u00a0<br/><span class=\"kw4\">int</span> main<span class=\"br0\">(</span><span class=\"kw4\">int</span> argc, <span class=\"kw4\">const</span> <span class=\"kw4\">char</span> <span class=\"sy0\">*</span> argv<span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"br0\">)</span><br/><span class=\"br0\">{</span><br/>    @autoreleasepool <span class=\"br0\">{</span><br/>        doMarriage<span class=\"br0\">(</span><span class=\"br0\">)</span>;<br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> <span class=\"nu0\">0</span>;<br/><span class=\"br0\">}</span></pre>"}, {"lang": "OCaml", "loc": 158, "block": "<pre class=\"ocaml highlighted_source\"><span class=\"kw1\">let</span> men <span class=\"sy0\">=</span> <span class=\"br0\">[</span><br/>  <span class=\"st0\">\"abe\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"bob\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"col\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"dan\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"ed\"</span>,   <span class=\"br0\">[</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"fred\"</span>, <span class=\"br0\">[</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"gav\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"hal\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"ian\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"hope\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"jon\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"abi\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gay\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"eve\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bea\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dee\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"cath\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ivy\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hope\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"kw1\">let</span> women <span class=\"sy0\">=</span> <span class=\"br0\">[</span><br/>  <span class=\"st0\">\"abi\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"bea\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"cath\"</span>, <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"dee\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"eve\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"fay\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"gay\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"hope\"</span>, <span class=\"br0\">[</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"ivy\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/>  <span class=\"st0\">\"jan\"</span>,  <span class=\"br0\">[</span><span class=\"st0\">\"ed\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"hal\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"gav\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"abe\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"bob\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"jon\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"col\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"ian\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"fred\"</span><span class=\"sy0\">;</span><span class=\"st0\">\"dan\"</span><span class=\"br0\">]</span><span class=\"sy0\">;</span><br/><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"kw1\">type</span> woman_name <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPEstring\"><span class=\"kw4\">string</span></a><br/><span class=\"kw1\">type</span> man_name <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPEstring\"><span class=\"kw4\">string</span></a><br/>\u00a0<br/><span class=\"kw1\">type</span> man <span class=\"sy0\">=</span><br/>  <span class=\"br0\">{</span> m_name<span class=\"sy0\">:</span> man_name<span class=\"sy0\">;</span><br/>    <span class=\"kw1\">mutable</span> free<span class=\"sy0\">:</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPEbool\"><span class=\"kw4\">bool</span></a><span class=\"sy0\">;</span><br/>    women_rank<span class=\"sy0\">:</span> woman_name <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPElist\"><span class=\"kw4\">list</span></a><span class=\"sy0\">;</span><br/>    has_proposed<span class=\"sy0\">:</span> <span class=\"br0\">(</span>woman_name, <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPEunit\"><span class=\"kw4\">unit</span></a><span class=\"br0\">)</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>t <span class=\"co1\">(* a set *)</span><br/>  <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw1\">type</span> woman <span class=\"sy0\">=</span><br/>  <span class=\"br0\">{</span> w_name<span class=\"sy0\">:</span> woman_name<span class=\"sy0\">;</span><br/>    men_rank<span class=\"sy0\">:</span> man_name <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPElist\"><span class=\"kw4\">list</span></a><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">mutable</span> engaged<span class=\"sy0\">:</span> man_name <span class=\"kw1\">option</span><br/>  <span class=\"br0\">}</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">let</span> prefers w m1 m2 <span class=\"sy0\">=</span><br/>  <span class=\"co1\">(* returns true if w has a lower (better) rank for m1 than m2 *)</span><br/>  <span class=\"kw1\">let</span> <span class=\"kw1\">rec</span> aux <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><br/>  <span class=\"sy0\">|</span> <span class=\"br0\">[</span><span class=\"br0\">]</span> <span class=\"sy0\">-&gt;</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#VALinvalid_arg\"><span class=\"kw3\">invalid_arg</span></a> <span class=\"st0\">\"rank_cmp\"</span><br/>  <span class=\"sy0\">|</span> x<span class=\"sy0\">::</span>_ <span class=\"kw1\">when</span> x <span class=\"sy0\">=</span> m1 <span class=\"sy0\">-&gt;</span> <span class=\"kw1\">true</span><br/>  <span class=\"sy0\">|</span> x<span class=\"sy0\">::</span>_ <span class=\"kw1\">when</span> x <span class=\"sy0\">=</span> m2 <span class=\"sy0\">-&gt;</span> <span class=\"kw1\">false</span><br/>  <span class=\"sy0\">|</span> _<span class=\"sy0\">::</span>xs <span class=\"sy0\">-&gt;</span> aux xs<br/>  <span class=\"kw1\">in</span><br/>  aux w<span class=\"sy0\">.</span>men_rank<br/>\u00a0<br/><span class=\"kw1\">let</span> take_while f lst <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> <span class=\"kw1\">rec</span> aux acc <span class=\"sy0\">=</span> <span class=\"kw1\">function</span><br/>  <span class=\"sy0\">|</span> x<span class=\"sy0\">::</span>xs <span class=\"kw1\">when</span> f x <span class=\"sy0\">-&gt;</span> aux <span class=\"br0\">(</span>x<span class=\"sy0\">::</span>acc<span class=\"br0\">)</span> xs<br/>  <span class=\"sy0\">|</span> _ <span class=\"sy0\">-&gt;</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>rev acc<br/>  <span class=\"kw1\">in</span><br/>  aux <span class=\"br0\">[</span><span class=\"br0\">]</span> lst<br/>\u00a0<br/><span class=\"kw1\">let</span> more_ranked_than name <span class=\"sy0\">=</span><br/>  take_while <span class=\"br0\">(</span><span class=\"br0\">(</span><span class=\"sy0\">&lt;&gt;</span><span class=\"br0\">)</span> name<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">let</span> build_structs <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> <span class=\"sy0\">=</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>map <span class=\"br0\">(</span><span class=\"kw1\">fun</span> <span class=\"br0\">(</span>name, rank<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>    <span class=\"br0\">{</span> m_name <span class=\"sy0\">=</span> name<span class=\"sy0\">;</span><br/>      women_rank <span class=\"sy0\">=</span> rank<span class=\"sy0\">;</span><br/>      free <span class=\"sy0\">=</span> <span class=\"kw1\">true</span><span class=\"sy0\">;</span><br/>      has_proposed <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>create <span class=\"nu0\">42</span> <span class=\"br0\">}</span><br/>  <span class=\"br0\">)</span> men,<br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>map <span class=\"br0\">(</span><span class=\"kw1\">fun</span> <span class=\"br0\">(</span>name, rank<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>    <span class=\"br0\">{</span> w_name <span class=\"sy0\">=</span> name<span class=\"sy0\">;</span><br/>      men_rank <span class=\"sy0\">=</span> rank<span class=\"sy0\">;</span><br/>      engaged <span class=\"sy0\">=</span> None <span class=\"br0\">}</span><br/>  <span class=\"br0\">)</span> women<br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">let</span> _stable_matching ms ws <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> men_by_name <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>create <span class=\"nu0\">42</span> <span class=\"kw1\">in</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>iter <span class=\"br0\">(</span><span class=\"kw1\">fun</span> m <span class=\"sy0\">-&gt;</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>add men_by_name m<span class=\"sy0\">.</span>m_name m<span class=\"br0\">)</span> ms<span class=\"sy0\">;</span><br/>  <span class=\"kw1\">let</span> women_by_name <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>create <span class=\"nu0\">42</span> <span class=\"kw1\">in</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>iter <span class=\"br0\">(</span><span class=\"kw1\">fun</span> w <span class=\"sy0\">-&gt;</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>add women_by_name w<span class=\"sy0\">.</span>w_name w<span class=\"br0\">)</span> ws<span class=\"sy0\">;</span><br/>  <span class=\"kw1\">try</span><br/>    <span class=\"kw1\">while</span> <span class=\"kw1\">true</span> <span class=\"kw1\">do</span><br/>      <span class=\"co1\">(*TODO free men who still has some w to propose to *)</span><br/>      <span class=\"kw1\">let</span> m <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>find <span class=\"br0\">(</span><span class=\"kw1\">fun</span> m <span class=\"sy0\">-&gt;</span> m<span class=\"sy0\">.</span>free<span class=\"br0\">)</span> ms <span class=\"kw1\">in</span><br/>      <span class=\"co1\">(* highest ranked woman who the man has not proposed to yet *)</span><br/>      <span class=\"kw1\">let</span> w_name <span class=\"sy0\">=</span><br/>        <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>find <span class=\"br0\">(</span><span class=\"kw1\">fun</span> w <span class=\"sy0\">-&gt;</span> <span class=\"kw1\">not</span> <span class=\"br0\">(</span><a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>mem m<span class=\"sy0\">.</span>has_proposed w<span class=\"br0\">)</span><span class=\"br0\">)</span> m<span class=\"sy0\">.</span>women_rank <span class=\"kw1\">in</span><br/>      <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>add m<span class=\"sy0\">.</span>has_proposed w_name <span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>      <span class=\"kw1\">let</span> w <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>find women_by_name w_name <span class=\"kw1\">in</span><br/>      <span class=\"kw1\">match</span> w<span class=\"sy0\">.</span>engaged <span class=\"kw1\">with</span><br/>      <span class=\"sy0\">|</span> None <span class=\"sy0\">-&gt;</span> <span class=\"co1\">(* w is free *)</span><br/>          <span class=\"co1\">(* (m, w) become engaged *)</span><br/>          w<span class=\"sy0\">.</span>engaged <span class=\"sy0\">&lt;-</span> Some m<span class=\"sy0\">.</span>m_name<span class=\"sy0\">;</span><br/>          m<span class=\"sy0\">.</span>free <span class=\"sy0\">&lt;-</span> <span class=\"kw1\">false</span><br/>      <span class=\"sy0\">|</span> Some m<span class=\"sy0\">'</span>_name <span class=\"sy0\">-&gt;</span> <span class=\"co1\">(* some pair (m', w) already exists *)</span><br/>          <span class=\"kw1\">if</span> prefers w m<span class=\"sy0\">.</span>m_name m<span class=\"sy0\">'</span>_name<br/>          <span class=\"kw1\">then</span> <span class=\"kw1\">begin</span> <span class=\"co1\">(* w prefers m to m' *)</span><br/>            w<span class=\"sy0\">.</span>engaged <span class=\"sy0\">&lt;-</span> Some m<span class=\"sy0\">.</span>m_name<span class=\"sy0\">;</span><br/>            <span class=\"kw1\">let</span> m<span class=\"sy0\">'</span> <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Hashtbl.html\"><span class=\"kw2\">Hashtbl</span></a><span class=\"sy0\">.</span>find men_by_name m<span class=\"sy0\">'</span>_name <span class=\"kw1\">in</span><br/>            m<span class=\"sy0\">'.</span>free <span class=\"sy0\">&lt;-</span> <span class=\"kw1\">true</span><span class=\"sy0\">;</span><br/>            m<span class=\"sy0\">.</span>free <span class=\"sy0\">&lt;-</span> <span class=\"kw1\">false</span><br/>          <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">done</span><span class=\"sy0\">;</span><br/>    assert <span class=\"kw1\">false</span><br/>  <span class=\"kw1\">with</span> Not_found <span class=\"sy0\">-&gt;</span> <span class=\"br0\">(</span><span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">let</span> stable_matching <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> ms, ws <span class=\"sy0\">=</span> build_structs <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> <span class=\"kw1\">in</span><br/>  _stable_matching ms ws<span class=\"sy0\">;</span><br/>  <span class=\"kw1\">let</span> some <span class=\"sy0\">=</span> <span class=\"kw1\">function</span> Some v <span class=\"sy0\">-&gt;</span> v <span class=\"sy0\">|</span> None <span class=\"sy0\">-&gt;</span> <span class=\"st0\">\"\"</span> <span class=\"kw1\">in</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>map <span class=\"br0\">(</span><span class=\"kw1\">fun</span> w <span class=\"sy0\">-&gt;</span> w<span class=\"sy0\">.</span>w_name, some w<span class=\"sy0\">.</span>engaged<span class=\"br0\">)</span> ws<br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">let</span> is_stable <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> eng <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> ms, ws <span class=\"sy0\">=</span> build_structs <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> <span class=\"kw1\">in</span><br/>  <span class=\"kw1\">not</span> <span class=\"br0\">(</span><a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>exists <span class=\"br0\">(</span><span class=\"kw1\">fun</span> <span class=\"br0\">(</span>wn, mn<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>      <span class=\"kw1\">let</span> m <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>find <span class=\"br0\">(</span><span class=\"kw1\">fun</span> m <span class=\"sy0\">-&gt;</span> m<span class=\"sy0\">.</span>m_name <span class=\"sy0\">=</span> mn<span class=\"br0\">)</span> ms <span class=\"kw1\">in</span><br/>      <span class=\"kw1\">let</span> prefered_women <span class=\"sy0\">=</span> more_ranked_than wn m<span class=\"sy0\">.</span>women_rank <span class=\"kw1\">in</span><br/>      <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>exists <span class=\"br0\">(</span><span class=\"kw1\">fun</span> pref_w <span class=\"sy0\">-&gt;</span><br/>        <span class=\"kw1\">let</span> w <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>find <span class=\"br0\">(</span><span class=\"kw1\">fun</span> w <span class=\"sy0\">-&gt;</span> w<span class=\"sy0\">.</span>w_name <span class=\"sy0\">=</span> pref_w<span class=\"br0\">)</span> ws <span class=\"kw1\">in</span><br/>        <span class=\"kw1\">let</span> eng_m <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>assoc pref_w eng <span class=\"kw1\">in</span><br/>        <span class=\"kw1\">let</span> prefered_men <span class=\"sy0\">=</span> more_ranked_than eng_m w<span class=\"sy0\">.</span>men_rank <span class=\"kw1\">in</span><br/>        <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>mem m<span class=\"sy0\">.</span>m_name prefered_men <span class=\"co1\">(* exists unstable engagement *)</span><br/>      <span class=\"br0\">)</span> prefered_women<br/>    <span class=\"br0\">)</span> eng<span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">let</span> perturb_engagements eng <span class=\"sy0\">=</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Random.html\"><span class=\"kw2\">Random</span></a><span class=\"sy0\">.</span>self_init<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>  <span class=\"kw1\">let</span> eng <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Array.html\"><span class=\"kw2\">Array</span></a><span class=\"sy0\">.</span>of_list eng <span class=\"kw1\">in</span><br/>  <span class=\"kw1\">let</span> len <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Array.html\"><span class=\"kw2\">Array</span></a><span class=\"sy0\">.</span>length eng <span class=\"kw1\">in</span><br/>  <span class=\"kw1\">for</span> n <span class=\"sy0\">=</span> <span class=\"nu0\">1</span> <span class=\"kw1\">to</span> <span class=\"nu0\">3</span> <span class=\"kw1\">do</span><br/>    <span class=\"kw1\">let</span> i <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Random.html\"><span class=\"kw2\">Random</span></a><span class=\"sy0\">.</span><a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPEint\"><span class=\"kw4\">int</span></a> len<br/>    <span class=\"kw1\">and</span> j <span class=\"sy0\">=</span> <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Random.html\"><span class=\"kw2\">Random</span></a><span class=\"sy0\">.</span><a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#TYPEint\"><span class=\"kw4\">int</span></a> len <span class=\"kw1\">in</span><br/>    <span class=\"kw1\">let</span> w1, m1 <span class=\"sy0\">=</span> eng<span class=\"sy0\">.</span><span class=\"br0\">(</span>i<span class=\"br0\">)</span><br/>    <span class=\"kw1\">and</span> w2, m2 <span class=\"sy0\">=</span> eng<span class=\"sy0\">.</span><span class=\"br0\">(</span>j<span class=\"br0\">)</span> <span class=\"kw1\">in</span><br/>    eng<span class=\"sy0\">.</span><span class=\"br0\">(</span>i<span class=\"br0\">)</span> <span class=\"sy0\">&lt;-</span> <span class=\"br0\">(</span>w1, m2<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    eng<span class=\"sy0\">.</span><span class=\"br0\">(</span>j<span class=\"br0\">)</span> <span class=\"sy0\">&lt;-</span> <span class=\"br0\">(</span>w2, m1<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>  <span class=\"kw1\">done</span><span class=\"sy0\">;</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Array.html\"><span class=\"kw2\">Array</span></a><span class=\"sy0\">.</span>to_list eng<br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">let</span> print engs <span class=\"sy0\">=</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/List.html\"><span class=\"kw2\">List</span></a><span class=\"sy0\">.</span>iter <span class=\"br0\">(</span><span class=\"kw1\">fun</span> <span class=\"br0\">(</span>w,m<span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span><br/>    <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Printf.html\"><span class=\"kw2\">Printf</span></a><span class=\"sy0\">.</span>printf <span class=\"st0\">\"\u00a0%4s is engaged with\u00a0%s\\n\"</span> w m<span class=\"br0\">)</span> engs<span class=\"sy0\">;</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Printf.html\"><span class=\"kw2\">Printf</span></a><span class=\"sy0\">.</span>printf <span class=\"st0\">\"# Engagements\u00a0%s stable\\n\"</span><br/>    <span class=\"br0\">(</span><span class=\"kw1\">if</span> is_stable <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> engs <span class=\"kw1\">then</span> <span class=\"st0\">\"are\"</span> <span class=\"kw1\">else</span> <span class=\"st0\">\"are not\"</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">let</span> <span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"sy0\">=</span><br/>  <span class=\"kw1\">let</span> engagements <span class=\"sy0\">=</span> stable_matching <span class=\"re1\">~men</span> <span class=\"re1\">~women</span> <span class=\"kw1\">in</span><br/>  print engagements<span class=\"sy0\">;</span><br/>  <a href=\"http://caml.inria.fr/pub/docs/manual-ocaml/libref/Pervasives.html#VALprint_endline\"><span class=\"kw3\">print_endline</span></a> <span class=\"st0\">\"========================\"</span><span class=\"sy0\">;</span><br/>  <span class=\"kw1\">let</span> engagements <span class=\"sy0\">=</span> perturb_engagements engagements <span class=\"kw1\">in</span><br/>  print engagements<span class=\"sy0\">;</span><br/><span class=\"sy0\">;;</span></pre>"}, {"lang": "Perl", "loc": 117, "block": "<pre class=\"perl highlighted_source\"><span class=\"co1\">#!/usr/bin/env perl </span><br/><span class=\"kw2\">use</span> strict<span class=\"sy0\">;</span><br/><span class=\"kw2\">use</span> warnings<span class=\"sy0\">;</span><br/><span class=\"kw2\">use</span> feature <span class=\"co2\">qw/say/</span><span class=\"sy0\">;</span><br/><span class=\"kw2\">use</span> List<span class=\"sy0\">::</span><span class=\"me2\">Util</span> <a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"br0\">(</span>first<span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw1\">my</span> <span class=\"re0\">%Likes</span> <span class=\"sy0\">=</span> <span class=\"br0\">(</span><br/>  M <span class=\"sy0\">=&gt;</span> <span class=\"br0\">{</span><br/>    abe  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> abi eve cath ivy jan dee fay bea hope gay <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    bob  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> cath hope abi dee eve fay bea jan ivy gay <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    col  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> hope eve abi dee bea fay ivy gay cath jan <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    dan  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> ivy fay dee gay hope eve jan bea cath abi <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    ed   <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> jan dee bea cath fay eve abi ivy hope gay <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    fred <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> bea abi dee gay eve ivy cath jan hope fay <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    gav  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> gay eve ivy bea cath abi dee hope jan fay <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    hal  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> abi eve hope fay ivy cath jan bea gay dee <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    ian  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> hope cath dee gay bea abi fay ivy jan eve <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    jon  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> abi fay jan gay eve bea dee cath ivy hope <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>  <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/>\u00a0<br/>  W <span class=\"sy0\">=&gt;</span> <span class=\"br0\">{</span><br/>    abi  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> bob fred jon gav ian abe dan ed col hal <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    bea  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> bob abe col fred gav dan ian ed jon hal <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    cath <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> fred bob ed gav hal col ian abe dan jon <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    dee  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> fred jon col abe ian hal gav dan bob ed <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    eve  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> jon hal fred dan abe gav col ed ian bob <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    fay  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> bob abe ed ian jon dan fred gav col hal <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    gay  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> jon gav hal fred bob abe col ed dan ian <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    hope <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> gav jon bob abe ian dan hal ed col fred <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    ivy  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> ian col hal gav fred bob abe ed jon dan <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>    jan  <span class=\"sy0\">=&gt;</span> <span class=\"br0\">[</span><a href=\"http://perldoc.perl.org/functions/qw.html\"><span class=\"kw3\">qw</span></a><span class=\"sy0\">/</span> ed hal gav abe bob jon col ian fred dan <span class=\"sy0\">/</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/>  <span class=\"br0\">}</span><span class=\"sy0\">,</span><br/><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw1\">my</span> <span class=\"re0\">%Engaged</span><span class=\"sy0\">;</span><br/><span class=\"kw1\">my</span> <span class=\"re0\">%Proposed</span><span class=\"sy0\">;</span><br/>\u00a0<br/>match_them<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>check_stability<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>perturb<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>check_stability<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> match_them <span class=\"br0\">{</span><br/>    say <span class=\"st_h\">'Matchmaking:'</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">while</span><span class=\"br0\">(</span><span class=\"kw1\">my</span> <span class=\"re0\">$man</span> <span class=\"sy0\">=</span> unmatched_man<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">my</span> <span class=\"re0\">$woman</span> <span class=\"sy0\">=</span> preferred_choice<span class=\"br0\">(</span><span class=\"re0\">$man</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"re0\">$Proposed</span><span class=\"br0\">{</span><span class=\"re0\">$man</span><span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$woman</span><span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"sy0\">!</span> <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span>W<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$woman</span><span class=\"br0\">}</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            engage<span class=\"br0\">(</span><span class=\"re0\">$man</span><span class=\"sy0\">,</span> <span class=\"re0\">$woman</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            say <span class=\"st0\">\"<span class=\"es0\">\\t</span>$woman and $man\"</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">else</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span><span class=\"br0\">(</span>woman_prefers<span class=\"br0\">(</span><span class=\"re0\">$woman</span><span class=\"sy0\">,</span> <span class=\"re0\">$man</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <span class=\"kw1\">my</span> <span class=\"re0\">$engaged_man</span> <span class=\"sy0\">=</span> <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span>W<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$woman</span><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>                engage<span class=\"br0\">(</span><span class=\"re0\">$man</span><span class=\"sy0\">,</span> <span class=\"re0\">$woman</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>                <a href=\"http://perldoc.perl.org/functions/undef.html\"><span class=\"kw3\">undef</span></a> <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span>M<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$engaged_man</span><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>                say <span class=\"st0\">\"<span class=\"es0\">\\t</span>$woman dumped $engaged_man for $man\"</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> check_stability <span class=\"br0\">{</span><br/>    say <span class=\"st_h\">'Stablility:'</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">my</span> <span class=\"re0\">$stable</span> <span class=\"sy0\">=</span> <span class=\"nu0\">1</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">foreach</span> <span class=\"kw1\">my</span> <span class=\"re0\">$m</span> <span class=\"br0\">(</span>men<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">foreach</span> <span class=\"kw1\">my</span> <span class=\"re0\">$w</span> <span class=\"br0\">(</span>women<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <span class=\"kw1\">if</span><span class=\"br0\">(</span>man_prefers<span class=\"br0\">(</span><span class=\"re0\">$m</span><span class=\"sy0\">,</span> <span class=\"re0\">$w</span><span class=\"br0\">)</span> <span class=\"sy0\">&amp;&amp;</span> woman_prefers<span class=\"br0\">(</span><span class=\"re0\">$w</span><span class=\"sy0\">,</span> <span class=\"re0\">$m</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                say <span class=\"st0\">\"<span class=\"es0\">\\t</span>$w prefers $m to $Engaged{W}{$w} and $m prefers $w to $Engaged{M}{$m}\"</span><span class=\"sy0\">;</span><br/>                <span class=\"re0\">$stable</span> <span class=\"sy0\">=</span> <span class=\"nu0\">0</span><span class=\"sy0\">;</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">if</span><span class=\"br0\">(</span><span class=\"re0\">$stable</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        say <span class=\"st0\">\"<span class=\"es0\">\\t</span>(all marriages stable)\"</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> unmatched_man <span class=\"br0\">{</span><br/>    <a href=\"http://perldoc.perl.org/functions/return.html\"><span class=\"kw3\">return</span></a> first <span class=\"br0\">{</span> <span class=\"sy0\">!</span> <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span>M<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"co5\">$_</span><span class=\"br0\">}</span> <span class=\"br0\">}</span> men<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> preferred_choice <span class=\"br0\">{</span><br/>    <span class=\"kw1\">my</span> <span class=\"re0\">$man</span> <span class=\"sy0\">=</span> <a href=\"http://perldoc.perl.org/functions/shift.html\"><span class=\"kw3\">shift</span></a><span class=\"sy0\">;</span><br/>    <a href=\"http://perldoc.perl.org/functions/return.html\"><span class=\"kw3\">return</span></a> first <span class=\"br0\">{</span> <span class=\"sy0\">!</span> <span class=\"re0\">$Proposed</span><span class=\"br0\">{</span><span class=\"re0\">$man</span><span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"co5\">$_</span><span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"sy0\">@</span><span class=\"br0\">{</span> <span class=\"re0\">$Likes</span><span class=\"br0\">{</span>M<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$man</span><span class=\"br0\">}</span> <span class=\"br0\">}</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> engage <span class=\"br0\">{</span><br/>    <span class=\"kw1\">my</span> <span class=\"br0\">(</span><span class=\"re0\">$man</span><span class=\"sy0\">,</span> <span class=\"re0\">$woman</span><span class=\"br0\">)</span> <span class=\"sy0\">=</span> <span class=\"co5\">@_</span><span class=\"sy0\">;</span><br/>    <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span>W<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$woman</span><span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"re0\">$man</span><span class=\"sy0\">;</span><br/>    <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span>M<span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$man</span><span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"re0\">$woman</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> prefers <span class=\"br0\">{</span><br/>    <span class=\"kw1\">my</span> <span class=\"re0\">$sex</span> <span class=\"sy0\">=</span> <a href=\"http://perldoc.perl.org/functions/shift.html\"><span class=\"kw3\">shift</span></a><span class=\"sy0\">;</span><br/>    <a href=\"http://perldoc.perl.org/functions/return.html\"><span class=\"kw3\">return</span></a> <span class=\"kw2\">sub</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">my</span> <span class=\"br0\">(</span><span class=\"re0\">$person</span><span class=\"sy0\">,</span> <span class=\"re0\">$prospect</span><span class=\"br0\">)</span> <span class=\"sy0\">=</span> <span class=\"co5\">@_</span><span class=\"sy0\">;</span><br/>\u00a0<br/>        <span class=\"kw1\">my</span> <span class=\"re0\">$choices</span> <span class=\"sy0\">=</span> <a href=\"http://perldoc.perl.org/functions/join.html\"><span class=\"kw3\">join</span></a> <span class=\"st_h\">' '</span><span class=\"sy0\">,</span> <span class=\"sy0\">@</span><span class=\"br0\">{</span> <span class=\"re0\">$Likes</span><span class=\"br0\">{</span><span class=\"re0\">$sex</span><span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$person</span><span class=\"br0\">}</span> <span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>        <a href=\"http://perldoc.perl.org/functions/return.html\"><span class=\"kw3\">return</span></a> <a href=\"http://perldoc.perl.org/functions/index.html\"><span class=\"kw3\">index</span></a><span class=\"br0\">(</span><span class=\"re0\">$choices</span><span class=\"sy0\">,</span> <span class=\"re0\">$prospect</span><span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> <a href=\"http://perldoc.perl.org/functions/index.html\"><span class=\"kw3\">index</span></a><span class=\"br0\">(</span><span class=\"re0\">$choices</span><span class=\"sy0\">,</span> <span class=\"re0\">$Engaged</span><span class=\"br0\">{</span><span class=\"re0\">$sex</span><span class=\"br0\">}</span><span class=\"br0\">{</span><span class=\"re0\">$person</span><span class=\"br0\">}</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">BEGIN</span> <span class=\"br0\">{</span><br/>    <span class=\"re0\">*woman_prefers</span> <span class=\"sy0\">=</span> prefers<span class=\"br0\">(</span><span class=\"st_h\">'W'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    <span class=\"re0\">*man_prefers</span>   <span class=\"sy0\">=</span> prefers<span class=\"br0\">(</span><span class=\"st_h\">'M'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> perturb <span class=\"br0\">{</span><br/>    say <span class=\"st_h\">'Perturb:'</span><span class=\"sy0\">;</span><br/>    say <span class=\"st0\">\"<span class=\"es0\">\\t</span>engage abi with fred and bea with jon\"</span><span class=\"sy0\">;</span><br/>    engage<span class=\"br0\">(</span><span class=\"st_h\">'fred'</span> <span class=\"sy0\">=&gt;</span> <span class=\"st_h\">'abi'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    engage<span class=\"br0\">(</span><span class=\"st_h\">'jon'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"st_h\">'bea'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> men   <span class=\"br0\">{</span> <a href=\"http://perldoc.perl.org/functions/keys.html\"><span class=\"kw3\">keys</span></a> <span class=\"sy0\">%</span><span class=\"br0\">{</span> <span class=\"re0\">$Likes</span><span class=\"br0\">{</span>M<span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span><br/><span class=\"kw2\">sub</span> women <span class=\"br0\">{</span> <a href=\"http://perldoc.perl.org/functions/keys.html\"><span class=\"kw3\">keys</span></a> <span class=\"sy0\">%</span><span class=\"br0\">{</span> <span class=\"re0\">$Likes</span><span class=\"br0\">{</span>W<span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span></pre>"}, {"lang": "Perl 6", "loc": 88, "block": "<pre class=\"perl6 highlighted_source\"><span class=\"kw1\">my</span> <span class=\"re0\">%he</span><span class=\"sy0\">-</span>likes <span class=\"sy0\">=</span><br/>    abe  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> abi eve cath ivy jan dee fay bea hope gay <span class=\"sy0\">&gt;,</span><br/>    bob  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> cath hope abi dee eve fay bea jan ivy gay <span class=\"sy0\">&gt;,</span><br/>    col  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> hope eve abi dee bea fay ivy gay cath jan <span class=\"sy0\">&gt;,</span><br/>    dan  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> ivy fay dee gay hope eve jan bea cath abi <span class=\"sy0\">&gt;,</span><br/>    ed   <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> jan dee bea cath fay eve abi ivy hope gay <span class=\"sy0\">&gt;,</span><br/>    fred <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bea abi dee gay eve ivy cath jan hope fay <span class=\"sy0\">&gt;,</span><br/>    gav  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> gay eve ivy bea cath abi dee hope jan fay <span class=\"sy0\">&gt;,</span><br/>    hal  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> abi eve hope fay ivy cath jan bea gay dee <span class=\"sy0\">&gt;,</span><br/>    ian  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> hope cath dee gay bea abi fay ivy jan eve <span class=\"sy0\">&gt;,</span><br/>    jon  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> abi fay jan gay eve bea dee cath ivy hope <span class=\"sy0\">&gt;,</span><br/><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw1\">my</span> <span class=\"re0\">%she</span><span class=\"sy0\">-</span>likes <span class=\"sy0\">=</span><br/>    abi  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bob fred jon gav ian abe dan ed col hal <span class=\"sy0\">&gt;,</span><br/>    bea  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bob abe col fred gav dan ian ed jon hal <span class=\"sy0\">&gt;,</span><br/>    cath <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> fred bob ed gav hal col ian abe dan jon <span class=\"sy0\">&gt;,</span><br/>    dee  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> fred jon col abe ian hal gav dan bob ed <span class=\"sy0\">&gt;,</span><br/>    eve  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> jon hal fred dan abe gav col ed ian bob <span class=\"sy0\">&gt;,</span><br/>    fay  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bob abe ed ian jon dan fred gav col hal <span class=\"sy0\">&gt;,</span><br/>    gay  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> jon gav hal fred bob abe col ed dan ian <span class=\"sy0\">&gt;,</span><br/>    hope <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> gav jon bob abe ian dan hal ed col fred <span class=\"sy0\">&gt;,</span><br/>    ivy  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> ian col hal gav fred bob abe ed jon dan <span class=\"sy0\">&gt;,</span><br/>    jan  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> ed hal gav abe bob jon col ian fred dan <span class=\"sy0\">&gt;,</span><br/><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw1\">my</span> <span class=\"re0\">%fianc</span>\u00e9<span class=\"sy0\">;</span><br/><span class=\"kw1\">my</span> <span class=\"re0\">%fianc</span>\u00e9e<span class=\"sy0\">;</span><br/><span class=\"kw1\">my</span> <span class=\"re0\">%proposed</span><span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> she<span class=\"sy0\">-</span>prefers <span class=\"br0\">(</span><span class=\"re0\">$her</span><span class=\"sy0\">,</span> <span class=\"re0\">$hottie</span><span class=\"br0\">)</span> <span class=\"br0\">{</span> <span class=\"sy0\">.</span><span class=\"kw3\">index</span><span class=\"br0\">(</span><span class=\"re0\">$hottie</span><span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> <span class=\"sy0\">.</span><span class=\"kw3\">index</span><span class=\"br0\">(</span><span class=\"re0\">%fianc</span>\u00e9<span class=\"br0\">{</span><span class=\"re0\">$her</span><span class=\"br0\">}</span><span class=\"br0\">)</span> <span class=\"kw1\">given</span> <span class=\"sy0\">~</span><span class=\"re0\">%she</span><span class=\"sy0\">-</span>likes<span class=\"br0\">{</span><span class=\"re0\">$her</span><span class=\"br0\">}</span> <span class=\"br0\">}</span><br/><span class=\"kw2\">sub</span> he<span class=\"sy0\">-</span>prefers  <span class=\"br0\">(</span><span class=\"re0\">$him</span><span class=\"sy0\">,</span> <span class=\"re0\">$hottie</span><span class=\"br0\">)</span> <span class=\"br0\">{</span> <span class=\"sy0\">.</span><span class=\"kw3\">index</span><span class=\"br0\">(</span><span class=\"re0\">$hottie</span><span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> <span class=\"sy0\">.</span><span class=\"kw3\">index</span><span class=\"br0\">(</span><span class=\"re0\">%fianc</span>\u00e9e<span class=\"br0\">{</span><span class=\"re0\">$him</span><span class=\"br0\">}</span><span class=\"br0\">)</span> <span class=\"kw1\">given</span> <span class=\"sy0\">~</span><span class=\"re0\">%he</span><span class=\"sy0\">-</span>likes<span class=\"br0\">{</span><span class=\"re0\">$him</span><span class=\"br0\">}</span> <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw3\">match</span><span class=\"st_h\">'em;<br/>check-stability;<br/>\u00a0<br/>perturb'</span>em<span class=\"sy0\">;</span><br/>check<span class=\"sy0\">-</span>stability<span class=\"sy0\">;</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> <span class=\"kw3\">match</span><span class=\"st_h\">'em {                                          #'</span><br/>    <span class=\"kw3\">say</span> <span class=\"st_h\">'Matchmaking:'</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">while</span> unmatched<span class=\"sy0\">-</span>guy<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"sy0\">-&gt;</span> <span class=\"re0\">$guy</span> <span class=\"br0\">{</span><br/>        <span class=\"kw1\">my</span> <span class=\"re0\">$gal</span> <span class=\"sy0\">=</span> preferred<span class=\"sy0\">-</span>choice<span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>        <span class=\"re0\">%proposed</span><span class=\"br0\">{</span><span class=\"st0\">\"$guy $gal\"</span><span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"st_h\">'\u2764'</span><span class=\"sy0\">;</span><br/>        <span class=\"kw1\">if</span> <span class=\"kw1\">not</span> <span class=\"re0\">%fianc</span>\u00e9<span class=\"br0\">{</span><span class=\"re0\">$gal</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>            engage<span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"sy0\">,</span> <span class=\"re0\">$gal</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>            <span class=\"kw3\">say</span> <span class=\"st0\">\"<span class=\"es0\">\\t</span>$gal and $guy\"</span><span class=\"sy0\">;</span><br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">elsif</span> she<span class=\"sy0\">-</span>prefers<span class=\"br0\">(</span><span class=\"re0\">$gal</span><span class=\"sy0\">,</span> <span class=\"re0\">$guy</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t    <span class=\"kw1\">my</span> <span class=\"re0\">$engaged</span><span class=\"sy0\">-</span>guy <span class=\"sy0\">=</span> <span class=\"re0\">%fianc</span>\u00e9<span class=\"br0\">{</span><span class=\"re0\">$gal</span><span class=\"br0\">}</span><span class=\"sy0\">;</span><br/>\t    engage<span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"sy0\">,</span> <span class=\"re0\">$gal</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>\t    <span class=\"re0\">%fianc</span>\u00e9e<span class=\"br0\">{</span><span class=\"re0\">$engaged</span><span class=\"sy0\">-</span>guy<span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"st_h\">''</span><span class=\"sy0\">;</span><br/>\t    <span class=\"kw3\">say</span> <span class=\"st0\">\"<span class=\"es0\">\\t</span>$gal dumped $engaged-guy for $guy\"</span><span class=\"sy0\">;</span><br/>\t<span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> check<span class=\"sy0\">-</span>stability <span class=\"br0\">{</span><br/>    <span class=\"kw1\">my</span> <span class=\"re0\">@instabilities</span> <span class=\"sy0\">=</span> gather <span class=\"kw1\">for</span> flat <span class=\"re0\">%he</span><span class=\"sy0\">-</span>likes<span class=\"sy0\">.</span><span class=\"kw3\">keys</span> <span class=\"kw1\">X</span> <span class=\"re0\">%she</span><span class=\"sy0\">-</span>likes<span class=\"sy0\">.</span><span class=\"kw3\">keys</span> <span class=\"sy0\">-&gt;</span> <span class=\"re0\">$m</span><span class=\"sy0\">,</span> <span class=\"re0\">$w</span> <span class=\"br0\">{</span><br/>\t<span class=\"kw1\">if</span> he<span class=\"sy0\">-</span>prefers<span class=\"br0\">(</span><span class=\"re0\">$m</span><span class=\"sy0\">,</span> <span class=\"re0\">$w</span><span class=\"br0\">)</span> <span class=\"kw1\">and</span> she<span class=\"sy0\">-</span>prefers<span class=\"br0\">(</span><span class=\"re0\">$w</span><span class=\"sy0\">,</span> <span class=\"re0\">$m</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>\t    take <span class=\"st0\">\"<span class=\"es0\">\\t</span>$w prefers $m to\u00a0%fianc\u00e9{$w} and $m prefers $w to\u00a0%fianc\u00e9e{$m}\"</span><span class=\"sy0\">;</span><br/>\t<span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <span class=\"kw3\">say</span> <span class=\"st_h\">'Stablility:'</span><span class=\"sy0\">;</span><br/>    <span class=\"kw1\">if</span> <span class=\"re0\">@instabilities</span> <span class=\"br0\">{</span><br/>\t<span class=\"sy0\">.</span><span class=\"kw3\">say</span> <span class=\"kw1\">for</span> <span class=\"re0\">@instabilities</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">else</span> <span class=\"br0\">{</span><br/>        <span class=\"kw3\">say</span> <span class=\"st0\">\"<span class=\"es0\">\\t</span>(all marriages stable)\"</span><span class=\"sy0\">;</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> unmatched<span class=\"sy0\">-</span>guy <span class=\"br0\">{</span> <span class=\"re0\">%he</span><span class=\"sy0\">-</span>likes<span class=\"sy0\">.</span><span class=\"kw3\">keys</span><span class=\"sy0\">.</span><span class=\"kw3\">first</span><span class=\"sy0\">:</span> <span class=\"br0\">{</span> <span class=\"kw1\">not</span> <span class=\"re0\">%fianc</span>\u00e9e<span class=\"br0\">{</span><span class=\"re0\">$_</span><span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> preferred<span class=\"sy0\">-</span>choice<span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"br0\">)</span> <span class=\"br0\">{</span> <span class=\"re0\">%he</span><span class=\"sy0\">-</span>likes<span class=\"br0\">{</span><span class=\"re0\">$guy</span><span class=\"br0\">}</span><span class=\"sy0\">.</span><span class=\"kw3\">first</span><span class=\"sy0\">:</span> <span class=\"br0\">{</span> <span class=\"kw1\">not</span> <span class=\"re0\">%proposed</span><span class=\"br0\">{</span><span class=\"st0\">\"$guy $_\"</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> engage<span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"sy0\">,</span> <span class=\"re0\">$gal</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    <span class=\"re0\">%fianc</span>\u00e9<span class=\"br0\">{</span><span class=\"re0\">$gal</span><span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"re0\">$guy</span><span class=\"sy0\">;</span><br/>    <span class=\"re0\">%fianc</span>\u00e9e<span class=\"br0\">{</span><span class=\"re0\">$guy</span><span class=\"br0\">}</span> <span class=\"sy0\">=</span> <span class=\"re0\">$gal</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"kw2\">sub</span> perturb<span class=\"st_h\">'em {                                            #'</span><br/>    <span class=\"kw3\">say</span> <span class=\"st_h\">'Perturb:'</span><span class=\"sy0\">;</span><br/>    <span class=\"kw3\">say</span> <span class=\"st0\">\"<span class=\"es0\">\\t</span>engage abi with fred and bea with jon\"</span><span class=\"sy0\">;</span><br/>    engage<span class=\"br0\">(</span><span class=\"st_h\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st_h\">'abi'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/>    engage<span class=\"br0\">(</span><span class=\"st_h\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st_h\">'bea'</span><span class=\"br0\">)</span><span class=\"sy0\">;</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "Phix", "loc": 87, "block": "<pre class=\"text highlighted_source\">constant men = {\"abe\",\"bob\",\"col\",\"dan\",\"ed\",\"fred\",\"gav\",\"hal\",\"ian\",\"jon\"}<br/>enum             abe , bob , col , dan , ed , fred , gav , hal , ian , jon<br/>constant hen = {\"abi\",\"bea\",\"cath\",\"dee\",\"eve\",\"fay\",\"gay\",\"hope\",\"ivy\",\"jan\"}<br/>enum             abi , bea , cath , dee , eve , fay , gay , hope , ivy , jan<br/>\u00a0<br/>-- Given a complete list of ranked preferences, where the most liked is to the left: <br/>sequence mpref = repeat(0,length(men))<br/>    mpref[abe]  = {abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay}<br/>    mpref[bob]  = {cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay}<br/>    mpref[col]  = {hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan}<br/>    mpref[dan]  = {ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi}<br/>    mpref[ed]   = {jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay}<br/>    mpref[fred] = {bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay}<br/>    mpref[gav]  = {gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay}<br/>    mpref[hal]  = {abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee}<br/>    mpref[ian]  = {hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve}<br/>    mpref[jon]  = {abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope}<br/>\u00a0<br/>sequence hpref = repeat(0,length(hen))<br/>    hpref[abi]  = {bob, fred, jon, gav, ian, abe, dan, ed, col, hal}<br/>    hpref[bea]  = {bob, abe, col, fred, gav, dan, ian, ed, jon, hal}<br/>    hpref[cath] = {fred, bob, ed, gav, hal, col, ian, abe, dan, jon}<br/>    hpref[dee]  = {fred, jon, col, abe, ian, hal, gav, dan, bob, ed}<br/>    hpref[eve]  = {jon, hal, fred, dan, abe, gav, col, ed, ian, bob}<br/>    hpref[fay]  = {bob, abe, ed, ian, jon, dan, fred, gav, col, hal}<br/>    hpref[gay]  = {jon, gav, hal, fred, bob, abe, col, ed, dan, ian}<br/>    hpref[hope] = {gav, jon, bob, abe, ian, dan, hal, ed, col, fred}<br/>    hpref[ivy]  = {ian, col, hal, gav, fred, bob, abe, ed, jon, dan}<br/>    hpref[jan]  = {ed, hal, gav, abe, bob, jon, col, ian, fred, dan}<br/>\u00a0<br/>sequence engagements\u00a0:= repeat(0,length(hen))<br/>sequence freemen = tagset(length(men))<br/>printf(1,\"Engagements:\\n\")<br/>\u00a0<br/>-- use the Gale Shapley algorithm to find a stable set of engagements:<br/>while length(freemen) do<br/>    integer man = freemen[1]<br/>    freemen = freemen[2..$]<br/>    integer fem, dumpee<br/>    -- each male loops through all females in order of his preference until one accepts him<br/>    for j=1 to length(mpref[man]) do<br/>        fem = mpref[man][j]<br/>        dumpee = engagements[fem]<br/>        if dumpee=0<br/>        or find(man,hpref[fem])&lt;find(dumpee,hpref[fem]) then<br/>            exit<br/>        end if<br/>    end for<br/>    if dumpee!=0 then       -- if she was previously engaged<br/>        freemen &amp;= dumpee   -- he goes to the bottom of the list<br/>        printf(1,\"%s dumped\u00a0%s and accepted\u00a0%s\\n\",{hen[fem],men[dumpee],men[man]})<br/>    else<br/>        printf(1,\"%s accepted\u00a0%s\\n\",{hen[fem],men[man]})<br/>    end if<br/>    engagements[fem]\u00a0:= man -- the new engagement is registered<br/>end while<br/>\u00a0<br/>printf(1,\"\\nCouples:\\n\")<br/>for fem=1 to length(hen) do<br/>    printf(1,\"%s is engaged to\u00a0%s\\n\",{hen[fem],men[engagements[fem]]})<br/>end for<br/>\u00a0<br/>procedure stable()<br/>bool unstable = false<br/>    for fem=1 to length(hen) do<br/>        integer man = engagements[fem]<br/>        for j=1 to length(hen) do<br/>            if find(fem,mpref[man])&gt;find(j,mpref[man])<br/>            and find(engagements[j],hpref[j])&gt;find(man,hpref[j]) then<br/>                if unstable=false then<br/>                    printf(1,\"\\nThese couples are not stable.\\n\")<br/>                    unstable = true<br/>                end if<br/>                printf(1,\"%s is engaged to\u00a0%s but would prefer\u00a0%s and\u00a0%s is engaged to\u00a0%s but would prefer\u00a0%s\\n\",<br/>                         {men[man],hen[fem],hen[j],hen[j],men[engagements[j]],men[man]})<br/>            end if<br/>        end for<br/>    end for<br/>    if not unstable then<br/>        printf(1,\"\\nThese couples are stable.\\n\")<br/>    end if<br/>end procedure<br/>\u00a0<br/>stable()<br/>printf(1,\"\\nWhat if cath and ivy swap?\\n\")<br/>engagements[cath]:=abe; engagements[ivy]:=bob<br/>stable()</pre>"}, {"lang": "PicoLisp", "loc": 65, "block": "<pre class=\"text highlighted_source\">(setq<br/>   *Boys (list<br/>      (de abe  abi eve cath ivy jan dee fay bea hope gay)<br/>      (de bob  cath hope abi dee eve fay bea jan ivy gay)<br/>      (de col  hope eve abi dee bea fay ivy gay cath jan)<br/>      (de dan  ivy fay dee gay hope eve jan bea cath abi)<br/>      (de ed   jan dee bea cath fay eve abi ivy hope gay)<br/>      (de fred bea abi dee gay eve ivy cath jan hope fay)<br/>      (de gav  gay eve ivy bea cath abi dee hope jan fay)<br/>      (de hal  abi eve hope fay ivy cath jan bea gay dee)<br/>      (de ian  hope cath dee gay bea abi fay ivy jan eve)<br/>      (de jon  abi fay jan gay eve bea dee cath ivy hope) )<br/>   *Girls (list<br/>      (de bi   bob fred jon gav ian abe dan ed col hal)<br/>      (de bea  bob abe col fred gav dan ian ed jon hal)<br/>      (de cath fred bob ed gav hal col ian abe dan jon)<br/>      (de dee  fred jon col abe ian hal gav dan bob ed)<br/>      (de eve  jon hal fred dan abe gav col ed ian bob)<br/>      (de fay  bob abe ed ian jon dan fred gav col hal)<br/>      (de gay  jon gav hal fred bob abe col ed dan ian)<br/>      (de hope gav jon bob abe ian dan hal ed col fred)<br/>      (de ivy  ian col hal gav fred bob abe ed jon dan)<br/>      (de jan  ed hal gav abe bob jon col ian fred dan) )<br/>   *Couples NIL )<br/>\u00a0<br/>(bind *Boys<br/>   (while<br/>      (find<br/>         '((Boy) (and (val Boy) (not (asoq Boy *Couples))))<br/>         *Boys )<br/>      (let (Boy @  Girl (pop Boy)  Pair (find '((P) (== Girl (cdr P))) *Couples))<br/>         (nond<br/>            (Pair (push '*Couples (cons Boy Girl)))   # Girl is free<br/>            ((memq Boy (memq (car Pair) (val Girl)))  # Girl prefers Boy<br/>               (set Pair Boy) ) ) ) ) )<br/>\u00a0<br/>(for Pair *Couples<br/>   (prinl (cdr Pair) \" is engaged to \" (car Pair)) )<br/>\u00a0<br/>(de checkCouples ()<br/>   (unless<br/>      (filter<br/>         '((Pair)<br/>            (let (Boy (car Pair)  Girl (cdr Pair))<br/>               (find<br/>                  '((B)<br/>                     (and<br/>                        (memq Boy (cdr (memq B (val Girl))))  # Girl prefers B<br/>                        (memq<br/>                           (cdr (asoq B *Couples))            # and B prefers Girl<br/>                           (cdr (memq Girl (val B))) )<br/>                        (prinl<br/>                           Girl \" likes \" B \" better than \" Boy \" and \"<br/>                           B \" likes \" Girl \" better than \"<br/>                           (cdr (asoq B *Couples)) ) ) )<br/>                  (val Girl) ) ) )<br/>         *Couples )<br/>      (prinl \"All marriages are stable\") ) )<br/>\u00a0<br/>(checkCouples)<br/>(prinl)<br/>(prinl \"Engage fred with abi and jon with bea\")<br/>(con (asoq 'fred *Couples) 'abi)<br/>(con (asoq 'jon *Couples) 'bea)<br/>(checkCouples)</pre>"}, {"lang": "Prolog", "loc": 274, "block": "<pre class=\"prolog highlighted_source\"><span class=\"co1\">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><br/><span class=\"co1\">% facts</span><br/>prefere<span class=\"br0\">(</span>abe<span class=\"sy4\">,</span><span class=\"br0\">[</span> abi<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> gay<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  bob<span class=\"sy4\">,</span><span class=\"br0\">[</span> cath<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> abi<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> gay<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  col<span class=\"sy4\">,</span><span class=\"br0\">[</span> hope<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> abi<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> gay<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> jan<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  dan<span class=\"sy4\">,</span><span class=\"br0\">[</span> ivy<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> gay<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> abi<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>   ed<span class=\"sy4\">,</span><span class=\"br0\">[</span> jan<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> abi<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> gay<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span> fred<span class=\"sy4\">,</span><span class=\"br0\">[</span> bea<span class=\"sy4\">,</span> abi<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> gay<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> fay<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  gav<span class=\"sy4\">,</span><span class=\"br0\">[</span> gay<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> abi<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> fay<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  hal<span class=\"sy4\">,</span><span class=\"br0\">[</span> abi<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> hope<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> gay<span class=\"sy4\">,</span> dee<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  ian<span class=\"sy4\">,</span><span class=\"br0\">[</span> hope<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> gay<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> abi<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> eve<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  jon<span class=\"sy4\">,</span><span class=\"br0\">[</span> abi<span class=\"sy4\">,</span> fay<span class=\"sy4\">,</span> jan<span class=\"sy4\">,</span> gay<span class=\"sy4\">,</span> eve<span class=\"sy4\">,</span> bea<span class=\"sy4\">,</span> dee<span class=\"sy4\">,</span> cath<span class=\"sy4\">,</span> ivy<span class=\"sy4\">,</span> hope<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>prefere<span class=\"br0\">(</span>  abi<span class=\"sy4\">,</span><span class=\"br0\">[</span> bob<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> hal<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  bea<span class=\"sy4\">,</span><span class=\"br0\">[</span> bob<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> hal<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span> cath<span class=\"sy4\">,</span><span class=\"br0\">[</span> fred<span class=\"sy4\">,</span> bob<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> jon<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  dee<span class=\"sy4\">,</span><span class=\"br0\">[</span> fred<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> bob<span class=\"sy4\">,</span> ed<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  eve<span class=\"sy4\">,</span><span class=\"br0\">[</span> jon<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> bob<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  fay<span class=\"sy4\">,</span><span class=\"br0\">[</span> bob<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> hal<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  gay<span class=\"sy4\">,</span><span class=\"br0\">[</span> jon<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> bob<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> ian<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span> hope<span class=\"sy4\">,</span><span class=\"br0\">[</span> gav<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> bob<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> dan<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> fred<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  ivy<span class=\"sy4\">,</span><span class=\"br0\">[</span> ian<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> bob<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> ed<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> dan<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>prefere<span class=\"br0\">(</span>  jan<span class=\"sy4\">,</span><span class=\"br0\">[</span> ed<span class=\"sy4\">,</span> hal<span class=\"sy4\">,</span> gav<span class=\"sy4\">,</span> abe<span class=\"sy4\">,</span> bob<span class=\"sy4\">,</span> jon<span class=\"sy4\">,</span> col<span class=\"sy4\">,</span> ian<span class=\"sy4\">,</span> fred<span class=\"sy4\">,</span> dan<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>\u00a0<br/>man<span class=\"br0\">(</span>abe<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>bob<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>col<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>dan<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>ed<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>fred<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>gav<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>hal<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>ian<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>man<span class=\"br0\">(</span>jon<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>woman<span class=\"br0\">(</span>abi<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>bea<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>cath<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>dee<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>eve<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>fay<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>gay<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>hope<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>ivy<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>woman<span class=\"br0\">(</span>jan<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><br/><span class=\"co1\">% rules</span><br/>\u00a0<br/>stable_mariage <span class=\"sy1\">:-</span><br/>\tnew<span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tforall<span class=\"br0\">(</span>man<span class=\"br0\">(</span>X<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t       <span class=\"br0\">(</span>   prefere<span class=\"br0\">(</span>X<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t\t   new<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> man<span class=\"br0\">(</span>X<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t\t   send<span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> P<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\tnew<span class=\"br0\">(</span>LstWoman<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tforall<span class=\"br0\">(</span>woman<span class=\"br0\">(</span>X<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t       <span class=\"br0\">(</span>   prefere<span class=\"br0\">(</span>X<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t\t   new<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> woman<span class=\"br0\">(</span>X<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t\t   send<span class=\"br0\">(</span>LstWoman<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> P<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> for_all<span class=\"sy4\">,</span> message<span class=\"br0\">(</span><span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> init_liste<span class=\"sy4\">,</span> LstWoman<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LstWoman<span class=\"sy4\">,</span> for_all<span class=\"sy4\">,</span> message<span class=\"br0\">(</span><span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> init_liste<span class=\"sy4\">,</span> LstMan<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">round</span></a><span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> LstWoman<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnew<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<span class=\"co1\">% creation of the couple.</span><br/>\tsend<span class=\"br0\">(</span>LstWoman<span class=\"sy4\">,</span> for_all<span class=\"sy4\">,</span> and<span class=\"br0\">(</span>message<span class=\"br0\">(</span><span class=\"sy5\">@</span>prolog<span class=\"sy4\">,</span> create_couple<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> LstCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t\t\t\t   message<span class=\"br0\">(</span><span class=\"sy5\">@</span>pce<span class=\"sy4\">,</span> write_ln<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1?name<span class=\"sy4\">,</span> with<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1?elu?name<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">nl</span></a><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<span class=\"co1\">% test of the stability of couples</span><br/>\tstability<span class=\"br0\">(</span>LstCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">nl</span></a><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<span class=\"co1\">% Perturbation of couples</span><br/>\tget<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> size<span class=\"sy4\">,</span> Len<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget_two_random_couples<span class=\"br0\">(</span>Len<span class=\"sy4\">,</span> V1<span class=\"sy4\">,</span> V2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\tget<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> nth0<span class=\"sy4\">,</span> V1<span class=\"sy4\">,</span> C1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> nth0<span class=\"sy4\">,</span> V2<span class=\"sy4\">,</span> C2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnew<span class=\"br0\">(</span>NC1<span class=\"sy4\">,</span> tuple<span class=\"br0\">(</span>C1?first<span class=\"sy4\">,</span> C2?second<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnew<span class=\"br0\">(</span>NC2<span class=\"sy4\">,</span> tuple<span class=\"br0\">(</span>C2?first<span class=\"sy4\">,</span> C1?second<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> nth0<span class=\"sy4\">,</span> V1<span class=\"sy4\">,</span> NC1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> nth0<span class=\"sy4\">,</span> V2<span class=\"sy4\">,</span> NC2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\tsend<span class=\"br0\">(</span><span class=\"sy5\">@</span>pce<span class=\"sy4\">,</span> write_ln<span class=\"sy4\">,</span> <span class=\"st_h\">'perturbation of couples'</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span><span class=\"sy5\">@</span>pce<span class=\"sy4\">,</span> write_ln<span class=\"sy4\">,</span> NC1?second<span class=\"sy4\">,</span> with<span class=\"sy4\">,</span> NC1?first<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span><span class=\"sy5\">@</span>pce<span class=\"sy4\">,</span> write_ln<span class=\"sy4\">,</span> NC2?second<span class=\"sy4\">,</span> with<span class=\"sy4\">,</span> NC2?first<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">nl</span></a><span class=\"sy4\">,</span><br/>\u00a0<br/>\tstability<span class=\"br0\">(</span>LstCouple<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>get_two_random_couples<span class=\"br0\">(</span>Len<span class=\"sy4\">,</span> C1<span class=\"sy4\">,</span> C2<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tC1 <a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">is</span></a> random<span class=\"br0\">(</span>Len<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">repeat</span></a><span class=\"sy4\">,</span><br/>\tC2 <a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">is</span></a> random<span class=\"br0\">(</span>Len<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tC1 \\<span class=\"sy6\">=</span> C2<span class=\"sy4\">.</span><br/>\u00a0<br/>create_couple<span class=\"br0\">(</span>Woman<span class=\"sy4\">,</span> LstCouple <span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tsend<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> new<span class=\"br0\">(</span>_<span class=\"sy4\">,</span> tuple<span class=\"br0\">(</span>Woman?elu?name<span class=\"sy4\">,</span> Woman?name<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">% iterations of the algorithm</span><br/><a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">round</span></a><span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> LstWoman<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tsend<span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> for_some<span class=\"sy4\">,</span> message<span class=\"br0\">(</span><span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> propose<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LstWoman<span class=\"sy4\">,</span> for_some<span class=\"sy4\">,</span> message<span class=\"br0\">(</span><span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> dispose<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<span class=\"br0\">(</span>   <span class=\"sy2\">\\+</span>send<span class=\"br0\">(</span>LstWoman<span class=\"sy4\">,</span> for_all<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1?status <span class=\"sy6\">==</span> maybe<span class=\"br0\">)</span><br/>\t<span class=\"sy3\">-</span><span class=\"sy6\">&gt;</span><br/>\t    <a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">round</span></a><span class=\"br0\">(</span>LstMan<span class=\"sy4\">,</span> LstWoman<span class=\"br0\">)</span><br/>\t<span class=\"sy4\">;</span><br/>\t    <a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">true</span></a><br/>\t<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"sy1\">:-</span>pce_begin_class<span class=\"br0\">(</span>person<span class=\"sy4\">,</span> object<span class=\"sy4\">,</span> \"description of a person\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>variable<span class=\"br0\">(</span>name<span class=\"sy4\">,</span> object<span class=\"sy4\">,</span> both<span class=\"sy4\">,</span> \"name of the person\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>variable<span class=\"br0\">(</span>preference<span class=\"sy4\">,</span> chain<span class=\"sy4\">,</span> both<span class=\"sy4\">,</span> \"list of priority\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>variable<span class=\"br0\">(</span>status<span class=\"sy4\">,</span> object<span class=\"sy4\">,</span> both<span class=\"sy4\">,</span> \"statut of engagement <span class=\"sy4\">:</span> maybe <span class=\"sy3\">/</span> free\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>initialise<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> Name<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> send_super<span class=\"sy4\">,</span> initialise<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> name<span class=\"sy4\">,</span> Name<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> preference<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> status<span class=\"sy4\">,</span> free<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">% reception of the list of partners</span><br/>init_liste<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\t<span class=\"co1\">% we replace the list of name of partners</span><br/>\t<span class=\"co1\">% with the list of persons partners.</span><br/>\tnew<span class=\"br0\">(</span>NLP<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> preference<span class=\"sy4\">,</span> LP<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LP<span class=\"sy4\">,</span> for_all<span class=\"sy4\">,</span> message<span class=\"br0\">(</span><span class=\"sy5\">@</span>prolog<span class=\"sy4\">,</span> find_person<span class=\"sy4\">,</span><span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> Lst<span class=\"sy4\">,</span> NLP<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> preference<span class=\"sy4\">,</span> NLP<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"sy1\">:-</span> pce_end_class<span class=\"br0\">(</span>person<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>\u00a0<br/>\u00a0<br/>find_person<span class=\"br0\">(</span>Name<span class=\"sy4\">,</span> LstPerson<span class=\"sy4\">,</span> LstPref<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tget<span class=\"br0\">(</span>LstPerson<span class=\"sy4\">,</span> find<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1?name <span class=\"sy6\">==</span> Name<span class=\"sy4\">,</span> Elem<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>LstPref<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> Elem<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"sy1\">:-</span>pce_begin_class<span class=\"br0\">(</span>man<span class=\"sy4\">,</span> person<span class=\"sy4\">,</span> \"description of a man\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>initialise<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> Name<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> send_super<span class=\"sy4\">,</span> initialise<span class=\"sy4\">,</span> Name<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">% a man propose \"la botte\" to a woman</span><br/>propose<span class=\"br0\">(</span>P<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> status<span class=\"sy4\">,</span> free<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> preference<span class=\"sy4\">,</span> XPref<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>XPref<span class=\"sy4\">,</span> delete_head<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> preference<span class=\"sy4\">,</span> XPref<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>Pref<span class=\"sy4\">,</span> proposition<span class=\"sy4\">,</span> P<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>refuse<span class=\"br0\">(</span>P<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> status<span class=\"sy4\">,</span> free<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>accept<span class=\"br0\">(</span>P<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> status<span class=\"sy4\">,</span> maybe<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"sy1\">:-</span> pce_end_class<span class=\"br0\">(</span>man<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"sy1\">:-</span>pce_begin_class<span class=\"br0\">(</span>woman<span class=\"sy4\">,</span> person<span class=\"sy4\">,</span> \"description of a woman\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>variable<span class=\"br0\">(</span>elu<span class=\"sy4\">,</span> object<span class=\"sy4\">,</span> both<span class=\"sy4\">,</span> \"name of the elu\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>variable<span class=\"br0\">(</span>contact<span class=\"sy4\">,</span> chain<span class=\"sy4\">,</span> both<span class=\"sy4\">,</span> \"men that have contact this woman\"<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>initialise<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> Name<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> send_super<span class=\"sy4\">,</span> initialise<span class=\"sy4\">,</span> Name<span class=\"sy4\">,</span> Pref<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> contact<span class=\"sy4\">,</span> new<span class=\"br0\">(</span>_<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> elu<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>nil<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">% a woman decide Maybe/No</span><br/>dispose<span class=\"br0\">(</span>P<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> contact<span class=\"sy4\">,</span> Contact<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> elu<span class=\"sy4\">,</span> Elu<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<span class=\"br0\">(</span>   Elu \\<span class=\"sy6\">=</span> <span class=\"sy5\">@</span>nil<br/>\t<span class=\"sy3\">-</span><span class=\"sy6\">&gt;</span><br/>\t    send<span class=\"br0\">(</span>Contact<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> Elu<span class=\"br0\">)</span><br/>\t<span class=\"sy4\">;</span><br/>\t    <a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">true</span></a><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\tnew<span class=\"br0\">(</span>R<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>Contact<span class=\"sy4\">,</span> for_all<span class=\"sy4\">,</span> message<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> fetch<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1<span class=\"sy4\">,</span> R<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>R<span class=\"sy4\">,</span> sort<span class=\"sy4\">,</span>\u00a0?<span class=\"br0\">(</span><span class=\"sy5\">@</span>arg1?first<span class=\"sy4\">,</span> compare<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg2?first<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>R<span class=\"sy4\">,</span> delete_head<span class=\"sy4\">,</span> Tete<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>Tete?second<span class=\"sy4\">,</span> accept<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> status<span class=\"sy4\">,</span> maybe<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> elu<span class=\"sy4\">,</span> Tete?second<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>R<span class=\"sy4\">,</span> for_some<span class=\"sy4\">,</span> message<span class=\"br0\">(</span><span class=\"sy5\">@</span>arg1?second<span class=\"sy4\">,</span> refuse<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> contact<span class=\"sy4\">,</span> new<span class=\"br0\">(</span>_<span class=\"sy4\">,</span> chain<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"sy4\">.</span><br/>\u00a0<br/>\u00a0<br/><span class=\"co1\">% looking for the person of the given name  Contact</span><br/><span class=\"co1\">% Adding it in the chain Chain</span><br/>fetch<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> Contact<span class=\"sy4\">,</span> Chain<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> preference<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>Lst<span class=\"sy4\">,</span> find<span class=\"sy4\">,</span> <span class=\"sy5\">@</span>arg1?name <span class=\"sy6\">==</span> Contact?name<span class=\"sy4\">,</span> Elem<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>Lst<span class=\"sy4\">,</span> index<span class=\"sy4\">,</span> Elem<span class=\"sy4\">,</span> Ind<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>Chain<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> new<span class=\"br0\">(</span>_<span class=\"sy4\">,</span> tuple<span class=\"br0\">(</span>Ind<span class=\"sy4\">,</span> Contact<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">% a woman receive a proposition from a man</span><br/>proposition<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> Name<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><span class=\"sy6\">&gt;</span><br/>\tget<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> contact<span class=\"sy4\">,</span> C<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>C<span class=\"sy4\">,</span> append<span class=\"sy4\">,</span> Name<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tsend<span class=\"br0\">(</span>P<span class=\"sy4\">,</span> slot<span class=\"sy4\">,</span> contact<span class=\"sy4\">,</span> C<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"sy1\">:-</span> pce_end_class<span class=\"br0\">(</span>woman<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/><span class=\"co1\">% computation of the stability od couple</span><br/>stability<span class=\"br0\">(</span>LstCouple<span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tchain_list<span class=\"br0\">(</span>LstCouple<span class=\"sy4\">,</span> LstPceCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tmaplist<span class=\"br0\">(</span>transform<span class=\"sy4\">,</span> LstPceCouple<span class=\"sy4\">,</span> PrologLstCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tstudy_couples<span class=\"br0\">(</span>PrologLstCouple<span class=\"sy4\">,</span> <span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"sy4\">,</span> UnstableCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<span class=\"br0\">(</span>   UnstableCouple <span class=\"sy6\">=</span> <span class=\"br0\">[</span><span class=\"br0\">]</span><br/>\t<span class=\"sy3\">-</span><span class=\"sy6\">&gt;</span><br/>\t    writeln<span class=\"br0\">(</span><span class=\"st_h\">'Couples are stable'</span><span class=\"br0\">)</span><br/>\t<span class=\"sy4\">;</span><br/>\t    sort<span class=\"br0\">(</span>UnstableCouple<span class=\"sy4\">,</span> SortUnstableCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t    writeln<span class=\"br0\">(</span><span class=\"st_h\">'Unstable couples are'</span><span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t    maplist<span class=\"br0\">(</span>print_unstable_couple<span class=\"sy4\">,</span> SortUnstableCouple<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t    <a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">nl</span></a><br/>\t<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>\u00a0<br/>print_unstable_couple<span class=\"br0\">(</span><span class=\"br0\">(</span>C1<span class=\"sy4\">,</span> C2<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tformat<span class=\"br0\">(</span><span class=\"st_h\">'~w and ~w~n'</span><span class=\"sy4\">,</span> <span class=\"br0\">[</span>C1<span class=\"sy4\">,</span> C2<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>transform<span class=\"br0\">(</span>PceCouple<span class=\"sy4\">,</span> couple<span class=\"br0\">(</span>First<span class=\"sy4\">,</span> Second<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy1\">:-</span><br/>\tget<span class=\"br0\">(</span>PceCouple?first<span class=\"sy4\">,</span> value<span class=\"sy4\">,</span> First<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tget<span class=\"br0\">(</span>PceCouple?second<span class=\"sy4\">,</span> value<span class=\"sy4\">,</span> Second<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>study_couples<span class=\"br0\">(</span><span class=\"br0\">[</span><span class=\"br0\">]</span><span class=\"sy4\">,</span> UnstableCouple<span class=\"sy4\">,</span> UnstableCouple<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>study_couples<span class=\"br0\">(</span><span class=\"br0\">[</span>H <span class=\"sy5\">|</span> T<span class=\"br0\">]</span><span class=\"sy4\">,</span> CurrentUnstableCouple<span class=\"sy4\">,</span> UnstableCouple<span class=\"br0\">)</span><span class=\"sy1\">:-</span><br/>\t<a href=\"http://pauillac.inria.fr/~deransar/prolog/bips.html\"><span class=\"kw1\">include</span></a><span class=\"br0\">(</span>unstable_couple<span class=\"br0\">(</span>H<span class=\"br0\">)</span><span class=\"sy4\">,</span> T<span class=\"sy4\">,</span> Lst<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<span class=\"br0\">(</span>   Lst \\<span class=\"sy6\">=</span> <span class=\"br0\">[</span><span class=\"br0\">]</span><br/>\t<span class=\"sy3\">-</span><span class=\"sy6\">&gt;</span><br/>\t    maplist<span class=\"br0\">(</span>build_one_couple<span class=\"br0\">(</span>H<span class=\"br0\">)</span><span class=\"sy4\">,</span> Lst<span class=\"sy4\">,</span> Lst1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t    append<span class=\"br0\">(</span>CurrentUnstableCouple<span class=\"sy4\">,</span> Lst1<span class=\"sy4\">,</span>CurrentUnstableCouple1<span class=\"br0\">)</span><br/>\t<span class=\"sy4\">;</span><br/>\t    CurrentUnstableCouple1 <span class=\"sy6\">=</span> CurrentUnstableCouple<br/>\t<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tstudy_couples<span class=\"br0\">(</span>T<span class=\"sy4\">,</span> CurrentUnstableCouple1<span class=\"sy4\">,</span> UnstableCouple<span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>\u00a0<br/>build_one_couple<span class=\"br0\">(</span>C1<span class=\"sy4\">,</span> C2<span class=\"sy4\">,</span> <span class=\"br0\">(</span>C1<span class=\"sy4\">,</span> C2<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0<br/>unstable_couple<span class=\"br0\">(</span>couple<span class=\"br0\">(</span>X1<span class=\"sy4\">,</span> Y1<span class=\"br0\">)</span><span class=\"sy4\">,</span> couple<span class=\"br0\">(</span>X2<span class=\"sy4\">,</span> Y2<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"sy1\">:-</span><br/>\tprefere<span class=\"br0\">(</span>X1<span class=\"sy4\">,</span> PX1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tprefere<span class=\"br0\">(</span>X2<span class=\"sy4\">,</span> PX2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tprefere<span class=\"br0\">(</span>Y1<span class=\"sy4\">,</span> PY1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tprefere<span class=\"br0\">(</span>Y2<span class=\"sy4\">,</span> PY2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<span class=\"co1\">% index of women for X1</span><br/>\tnth0<span class=\"br0\">(</span>IY12<span class=\"sy4\">,</span> PX1<span class=\"sy4\">,</span> Y2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnth0<span class=\"br0\">(</span>IY11<span class=\"sy4\">,</span> PX1<span class=\"sy4\">,</span> Y1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<span class=\"co1\">% index of men for Y2</span><br/>\tnth0<span class=\"br0\">(</span>IX21<span class=\"sy4\">,</span> PY2<span class=\"sy4\">,</span> X1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnth0<span class=\"br0\">(</span>IX22<span class=\"sy4\">,</span> PY2<span class=\"sy4\">,</span> X2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<span class=\"co1\">% index of women for X2</span><br/>\tnth0<span class=\"br0\">(</span>IY21<span class=\"sy4\">,</span> PX2<span class=\"sy4\">,</span> Y1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnth0<span class=\"br0\">(</span>IY22<span class=\"sy4\">,</span> PX2<span class=\"sy4\">,</span> Y2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\t<span class=\"co1\">% index of men for Y1</span><br/>\tnth0<span class=\"br0\">(</span>IX11<span class=\"sy4\">,</span> PY1<span class=\"sy4\">,</span> X1<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\tnth0<span class=\"br0\">(</span>IX12<span class=\"sy4\">,</span> PY1<span class=\"sy4\">,</span> X2<span class=\"br0\">)</span><span class=\"sy4\">,</span><br/>\u00a0<br/>\t<span class=\"co1\">% A couple is unstable</span><br/>\t<span class=\"br0\">(</span> <span class=\"br0\">(</span>IY12 <span class=\"sy6\">&lt;</span> IY11 <span class=\"sy4\">,</span> IX21 <span class=\"sy6\">&lt;</span> IX22<span class=\"br0\">)</span><span class=\"sy4\">;</span><br/>\t  <span class=\"br0\">(</span>IY21 <span class=\"sy6\">&lt;</span> IY22 <span class=\"sy4\">,</span> IX12 <span class=\"sy6\">&lt;</span> IX11<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"sy4\">.</span><br/>\u00a0</pre>"}, {"lang": "PureBasic", "loc": 174, "block": "<pre class=\"purebasic highlighted_source\">#coupleCount <span class=\"sy0\">=</span> <span class=\"nu0\">10</span><br/>\u00a0<br/><span class=\"kw1\">DataSection</span><br/>  <span class=\"co1\">;guys</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"abe: abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"bob: cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"col: hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"dan: ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"ed: jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"fred: bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"gav: gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"hal: abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"ian: hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"jon: abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope\"</span><br/>  <span class=\"co1\">;gals</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"abi: bob, fred, jon, gav, ian, abe, dan, ed, col, hal\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"bea: bob, abe, col, fred, gav, dan, ian, ed, jon, hal\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"cath: fred, bob, ed, gav, hal, col, ian, abe, dan, jon\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"dee: fred, jon, col, abe, ian, hal, gav, dan, bob, ed\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"eve: jon, hal, fred, dan, abe, gav, col, ed, ian, bob\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"fay: bob, abe, ed, ian, jon, dan, fred, gav, col, hal\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"gay: jon, gav, hal, fred, bob, abe, col, ed, dan, ian\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"hope: gav, jon, bob, abe, ian, dan, hal, ed, col, fred\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"ivy: ian, col, hal, gav, fred, bob, abe, ed, jon, dan\"</span><br/>  <span class=\"kw1\">Data</span>.s <span class=\"st0\">\"jan: ed, hal, gav, abe, bob, jon, col, ian, fred, dan\"</span><br/><span class=\"kw1\">EndDataSection</span><br/>\u00a0<br/><span class=\"kw1\">Structure</span> message<br/>  source.s <span class=\"co1\">;person that message is from</span><br/>  dest.s   <span class=\"co1\">;person that message is for</span><br/>  action.s <span class=\"co1\">;{'P', 'A', 'D', 'B'} for proposal, accept, decline, break-up</span><br/><span class=\"kw1\">EndStructure</span><br/>\u00a0<br/><span class=\"kw1\">Structure</span> person<br/>  name.s<br/>  isEngagedTo.s<br/>  List prefs.s<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"kw1\">EndStructure</span><br/>\u00a0<br/><span class=\"kw1\">Global</span> <span class=\"kw1\">NewList</span> messages.message<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">Procedure</span> setupPersons<span class=\"br0\">(</span>List persons.person<span class=\"br0\">(</span><span class=\"br0\">)</span>, count<span class=\"br0\">)</span> <br/>  <span class=\"kw1\">Protected</span> i, j, start, pref$<br/>  <span class=\"kw1\">For</span> i <span class=\"sy0\">=</span> <span class=\"nu0\">1</span> <span class=\"kw1\">To</span> count<br/>    <span class=\"kw1\">Read</span>.s pref$<br/>    pref$ <span class=\"sy0\">=</span> <span class=\"kw2\">LCase</span><span class=\"br0\">(</span>pref$<span class=\"br0\">)</span><br/>    start <span class=\"sy0\">=</span> <span class=\"kw2\">FindString</span><span class=\"br0\">(</span>pref$, <span class=\"st0\">\":\"</span>, <span class=\"nu0\">1</span><span class=\"br0\">)</span><br/>    <span class=\"kw2\">AddElement</span><span class=\"br0\">(</span>persons<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    persons<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">=</span> <span class=\"kw2\">Left</span><span class=\"br0\">(</span>pref$, start <span class=\"sy0\">-</span> <span class=\"nu0\">1</span><span class=\"br0\">)</span><br/>    pref$ <span class=\"sy0\">=</span> <span class=\"kw2\">Trim</span><span class=\"br0\">(</span><span class=\"kw2\">Right</span><span class=\"br0\">(</span>pref$, <span class=\"kw2\">Len</span><span class=\"br0\">(</span>pref$<span class=\"br0\">)</span> <span class=\"sy0\">-</span> start<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">For</span> j <span class=\"sy0\">=</span> <span class=\"nu0\">1</span> <span class=\"kw1\">To</span> count<br/>      <span class=\"kw2\">AddElement</span><span class=\"br0\">(</span>persons<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>      persons<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"sy0\">=</span> <span class=\"kw2\">Trim</span><span class=\"br0\">(</span><span class=\"kw2\">StringField</span><span class=\"br0\">(</span>pref$, j, <span class=\"st0\">\",\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">Next</span><br/>  <span class=\"kw1\">Next</span><br/><span class=\"kw1\">EndProcedure</span><br/>\u00a0<br/><span class=\"kw1\">Procedure</span> sendMessage<span class=\"br0\">(</span>source.s, dest.s, action.s<span class=\"br0\">)</span> <br/>  <span class=\"kw2\">LastElement</span><span class=\"br0\">(</span>messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw2\">AddElement</span><span class=\"br0\">(</span>messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">With</span> messages<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    <span class=\"sy0\">\\</span>source <span class=\"sy0\">=</span> source<br/>    <span class=\"sy0\">\\</span>dest <span class=\"sy0\">=</span> dest<br/>    <span class=\"sy0\">\\</span>action <span class=\"sy0\">=</span> action<br/>  <span class=\"kw1\">EndWith</span><br/>  <span class=\"kw2\">ResetList</span><span class=\"br0\">(</span>messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"kw1\">EndProcedure</span><br/>\u00a0<br/><span class=\"kw1\">Procedure</span> selectPerson<span class=\"br0\">(</span>name.s, List persons.person<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">ForEach</span> persons<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">If</span> persons<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">=</span> name<br/>      <span class=\"kw1\">Break</span><br/>    <span class=\"kw1\">EndIf</span> <br/>  <span class=\"kw1\">Next</span> <br/><span class=\"kw1\">EndProcedure</span><br/>\u00a0<br/><span class=\"kw1\">Procedure</span> rankPerson<span class=\"br0\">(</span>name.s, List prefs.s<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">ForEach</span> prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">If</span> prefs<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"sy0\">=</span> name<br/>      <span class=\"kw1\">ProcedureReturn</span> #coupleCount <span class=\"sy0\">-</span> <span class=\"kw2\">ListIndex</span><span class=\"br0\">(</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"co1\">;higher is better</span><br/>    <span class=\"kw1\">EndIf</span> <br/>  <span class=\"kw1\">Next</span> <br/>  <span class=\"kw1\">ProcedureReturn</span> <span class=\"sy0\">-</span><span class=\"nu0\">1</span> <span class=\"co1\">;no rank, shouldn't occur</span><br/><span class=\"kw1\">EndProcedure</span><br/>\u00a0<br/><span class=\"kw1\">Procedure</span> stabilityCheck<span class=\"br0\">(</span>List guys.person<span class=\"br0\">(</span><span class=\"br0\">)</span>, List gals.person<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Protected</span> isStable <span class=\"sy0\">=</span> #True<br/>  <span class=\"kw1\">ForEach</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    rankPerson<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">While</span> <span class=\"kw2\">PreviousElement</span><span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>      selectPerson<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span>, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>      <span class=\"kw1\">If</span> rankPerson<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> rankPerson<span class=\"br0\">(</span>gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"kw2\">Print</span><span class=\"br0\">(</span><span class=\"st0\">\"  \"</span> <span class=\"sy0\">+</span> gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" loves \"</span> <span class=\"sy0\">+</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" more than \"</span> <span class=\"sy0\">+</span> gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">+</span> <span class=\"st0\">\",\"</span><span class=\"br0\">)</span><br/>        <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span><span class=\"st0\">\" And \"</span> <span class=\"sy0\">+</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" loves \"</span> <span class=\"sy0\">+</span> gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" more than \"</span> <span class=\"sy0\">+</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">+</span> <span class=\"st0\">\".\"</span><span class=\"br0\">)</span><br/>        isStable <span class=\"sy0\">=</span> #False<br/>      <span class=\"kw1\">EndIf</span><br/>    <span class=\"kw1\">Wend</span> <br/>  <span class=\"kw1\">Next</span><br/>  <span class=\"kw1\">If</span> isStable<br/>    <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span>#CRLF$ <span class=\"sy0\">+</span> <span class=\"st0\">\"Marriage stability check PASSED.\"</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Else</span> <br/>    <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span>#CRLF$ <span class=\"sy0\">+</span> <span class=\"st0\">\"Marriage stability check FAILED.\"</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">EndIf</span><br/><span class=\"kw1\">EndProcedure</span><br/>\u00a0<br/><span class=\"kw1\">NewList</span> guys.person<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"kw1\">NewList</span> gals.person<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>setupPersons<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span>, #coupleCount<span class=\"br0\">)</span><br/>setupPersons<span class=\"br0\">(</span>gals<span class=\"br0\">(</span><span class=\"br0\">)</span>, #coupleCount<span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"co1\">;make initial round of proposals</span><br/><span class=\"kw1\">ForEach</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  <span class=\"kw2\">FirstElement</span><span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  sendMessage<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span>, <span class=\"st0\">\"P\"</span><span class=\"br0\">)</span><br/><span class=\"kw1\">Next</span><br/>\u00a0<br/><span class=\"co1\">;dispatch messages</span><br/><span class=\"kw1\">Define</span> source.s, dest.s, action.s<br/><span class=\"kw1\">ForEach</span> messages<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  source <span class=\"sy0\">=</span> messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>source<br/>  dest <span class=\"sy0\">=</span> messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>dest<br/>  action <span class=\"sy0\">=</span> messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>action<br/>\u00a0<br/>  <span class=\"kw2\">DeleteElement</span><span class=\"br0\">(</span>messages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Select</span> action<br/>    <span class=\"kw1\">Case</span> <span class=\"st0\">\"P\"</span> <span class=\"co1\">;propose\u00a0;only message received by gals</span><br/>      selectPerson<span class=\"br0\">(</span>dest, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>      selectPerson<span class=\"br0\">(</span>source, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>      <span class=\"kw1\">If</span> rankPerson<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> rankPerson<span class=\"br0\">(</span>gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        sendMessage<span class=\"br0\">(</span>dest, source, <span class=\"st0\">\"D\"</span><span class=\"br0\">)</span> <span class=\"co1\">;decline proposal</span><br/>      <span class=\"kw1\">ElseIf</span> rankPerson<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> rankPerson<span class=\"br0\">(</span>gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"kw1\">If</span> gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo<br/>          sendMessage<span class=\"br0\">(</span>dest, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo, <span class=\"st0\">\"B\"</span><span class=\"br0\">)</span>  <span class=\"co1\">;break-up engagement</span><br/>        <span class=\"kw1\">EndIf</span> <br/>        gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">=</span> source<br/>        sendMessage<span class=\"br0\">(</span>dest, source, <span class=\"st0\">\"A\"</span><span class=\"br0\">)</span> <span class=\"co1\">;accept proposal</span><br/>      <span class=\"kw1\">EndIf</span> <br/>    <span class=\"kw1\">Case</span> <span class=\"st0\">\"A\"</span>, <span class=\"st0\">\"D\"</span>, <span class=\"st0\">\"B\"</span> <span class=\"co1\">;messages received by guys</span><br/>      selectPerson<span class=\"br0\">(</span>dest, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>      <span class=\"kw1\">If</span> action <span class=\"sy0\">=</span> <span class=\"st0\">\"A\"</span> <span class=\"co1\">;proposal accepted</span><br/>        guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">=</span> source <br/>      <span class=\"kw1\">Else</span><br/>        <span class=\"kw1\">If</span> action <span class=\"sy0\">=</span> <span class=\"st0\">\"B\"</span> <span class=\"co1\">;broke-up</span><br/>          guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">=</span> <span class=\"st0\">\"\"</span><br/>        <span class=\"kw1\">EndIf</span> <br/>        <span class=\"kw2\">NextElement</span><span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        sendMessage<span class=\"br0\">(</span>dest, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>prefs<span class=\"br0\">(</span><span class=\"br0\">)</span>,<span class=\"st0\">\"P\"</span><span class=\"br0\">)</span> <span class=\"co1\">;propose to next pref</span><br/>      <span class=\"kw1\">EndIf</span>  <br/>  <span class=\"kw1\">EndSelect</span><br/><span class=\"kw1\">Next</span> <br/>\u00a0<br/><span class=\"kw1\">If</span> <span class=\"kw2\">OpenConsole</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span><span class=\"st0\">\"Marriages:\"</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">ForEach</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span><span class=\"st0\">\"  \"</span> <span class=\"sy0\">+</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" And \"</span> <span class=\"sy0\">+</span> guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">+</span> <span class=\"st0\">\".\"</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Next</span><br/>  stabilityCheck<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span>, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>  <span class=\"kw1\">Define</span> <span class=\"sy0\">*</span>person_1.person, <span class=\"sy0\">*</span>person_2.person<br/>  <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span>#CRLF$ <span class=\"sy0\">+</span> <span class=\"st0\">\"Introducing an error by swapping partners of abi and bea.\"</span><span class=\"br0\">)</span><br/>  selectPerson<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span>: <span class=\"sy0\">*</span>person_1 <span class=\"sy0\">=</span> @gals<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  selectPerson<span class=\"br0\">(</span><span class=\"st0\">\"bea\"</span>, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span>: <span class=\"sy0\">*</span>person_2 <span class=\"sy0\">=</span> @gals<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Swap</span> <span class=\"sy0\">*</span>person_1<span class=\"sy0\">\\</span>isEngagedTo, <span class=\"sy0\">*</span>person_2<span class=\"sy0\">\\</span>isEngagedTo<br/>  selectPerson<span class=\"br0\">(</span><span class=\"sy0\">*</span>person_1<span class=\"sy0\">\\</span>isEngagedTo, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span>: <span class=\"sy0\">*</span>person_1 <span class=\"sy0\">=</span> @guys<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  selectPerson<span class=\"br0\">(</span><span class=\"sy0\">*</span>person_1<span class=\"sy0\">\\</span>isEngagedTo, guys<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span>: <span class=\"sy0\">*</span>person_2 <span class=\"sy0\">=</span> @guys<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Swap</span> <span class=\"sy0\">*</span>person_1<span class=\"sy0\">\\</span>isEngagedTo, <span class=\"sy0\">*</span>person_2<span class=\"sy0\">\\</span>isEngagedTo<br/>  <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span><span class=\"st0\">\"  \"</span> <span class=\"sy0\">+</span> <span class=\"sy0\">*</span>person_1<span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" is now with \"</span> <span class=\"sy0\">+</span> <span class=\"sy0\">*</span>person_1<span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">+</span> <span class=\"st0\">\".\"</span><span class=\"br0\">)</span><br/>  <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span><span class=\"st0\">\"  \"</span> <span class=\"sy0\">+</span> <span class=\"sy0\">*</span>person_2<span class=\"sy0\">\\</span>name <span class=\"sy0\">+</span> <span class=\"st0\">\" is now with \"</span> <span class=\"sy0\">+</span> <span class=\"sy0\">*</span>person_2<span class=\"sy0\">\\</span>isEngagedTo <span class=\"sy0\">+</span> <span class=\"st0\">\".\"</span><span class=\"br0\">)</span><br/>  <span class=\"kw2\">PrintN</span><span class=\"br0\">(</span><span class=\"st0\">\"\"</span><span class=\"br0\">)</span><br/>  stabilityCheck<span class=\"br0\">(</span>guys<span class=\"br0\">(</span><span class=\"br0\">)</span>, gals<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>  <span class=\"kw2\">Print</span><span class=\"br0\">(</span>#CRLF$ <span class=\"sy0\">+</span> #CRLF$ <span class=\"sy0\">+</span> <span class=\"st0\">\"Press ENTER to exit\"</span><span class=\"br0\">)</span>: <span class=\"kw2\">Input</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>  <span class=\"kw2\">CloseConsole</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"kw1\">EndIf</span></pre>"}, {"lang": "Python", "loc": 103, "block": "<pre class=\"python highlighted_source\"><span class=\"kw1\">import</span> <span class=\"kw3\">copy</span><br/>\u00a0<br/>guyprefers <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/> <span class=\"st0\">'abe'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'bob'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'col'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'dan'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'ed'</span>:   <span class=\"br0\">[</span><span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'fred'</span>: <span class=\"br0\">[</span><span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'gav'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'hal'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'ian'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'hope'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'jon'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'abi'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gay'</span><span class=\"sy0\">,</span> <span class=\"st0\">'eve'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bea'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dee'</span><span class=\"sy0\">,</span> <span class=\"st0\">'cath'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ivy'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hope'</span><span class=\"br0\">]</span><span class=\"br0\">}</span><br/>galprefers <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/> <span class=\"st0\">'abi'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'bea'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'cath'</span>: <span class=\"br0\">[</span><span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'dee'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'eve'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'fay'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'gay'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'hope'</span>: <span class=\"br0\">[</span><span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'ivy'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"br0\">]</span><span class=\"sy0\">,</span><br/> <span class=\"st0\">'jan'</span>:  <span class=\"br0\">[</span><span class=\"st0\">'ed'</span><span class=\"sy0\">,</span> <span class=\"st0\">'hal'</span><span class=\"sy0\">,</span> <span class=\"st0\">'gav'</span><span class=\"sy0\">,</span> <span class=\"st0\">'abe'</span><span class=\"sy0\">,</span> <span class=\"st0\">'bob'</span><span class=\"sy0\">,</span> <span class=\"st0\">'jon'</span><span class=\"sy0\">,</span> <span class=\"st0\">'col'</span><span class=\"sy0\">,</span> <span class=\"st0\">'ian'</span><span class=\"sy0\">,</span> <span class=\"st0\">'fred'</span><span class=\"sy0\">,</span> <span class=\"st0\">'dan'</span><span class=\"br0\">]</span><span class=\"br0\">}</span><br/>\u00a0<br/>guys <span class=\"sy0\">=</span> <span class=\"kw2\">sorted</span><span class=\"br0\">(</span>guyprefers.<span class=\"me1\">keys</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>gals <span class=\"sy0\">=</span> <span class=\"kw2\">sorted</span><span class=\"br0\">(</span>galprefers.<span class=\"me1\">keys</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">def</span> check<span class=\"br0\">(</span>engaged<span class=\"br0\">)</span>:<br/>    inverseengaged <span class=\"sy0\">=</span> <span class=\"kw2\">dict</span><span class=\"br0\">(</span><span class=\"br0\">(</span>v<span class=\"sy0\">,</span>k<span class=\"br0\">)</span> <span class=\"kw1\">for</span> k<span class=\"sy0\">,</span>v <span class=\"kw1\">in</span> engaged.<span class=\"me1\">items</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"kw1\">for</span> she<span class=\"sy0\">,</span> he <span class=\"kw1\">in</span> engaged.<span class=\"me1\">items</span><span class=\"br0\">(</span><span class=\"br0\">)</span>:<br/>        shelikes <span class=\"sy0\">=</span> galprefers<span class=\"br0\">[</span>she<span class=\"br0\">]</span><br/>        shelikesbetter <span class=\"sy0\">=</span> shelikes<span class=\"br0\">[</span>:shelikes.<span class=\"me1\">index</span><span class=\"br0\">(</span>he<span class=\"br0\">)</span><span class=\"br0\">]</span><br/>        helikes <span class=\"sy0\">=</span> guyprefers<span class=\"br0\">[</span>he<span class=\"br0\">]</span><br/>        helikesbetter <span class=\"sy0\">=</span> helikes<span class=\"br0\">[</span>:helikes.<span class=\"me1\">index</span><span class=\"br0\">(</span>she<span class=\"br0\">)</span><span class=\"br0\">]</span><br/>        <span class=\"kw1\">for</span> guy <span class=\"kw1\">in</span> shelikesbetter:<br/>            guysgirl <span class=\"sy0\">=</span> inverseengaged<span class=\"br0\">[</span>guy<span class=\"br0\">]</span><br/>            guylikes <span class=\"sy0\">=</span> guyprefers<span class=\"br0\">[</span>guy<span class=\"br0\">]</span><br/>            <span class=\"kw1\">if</span> guylikes.<span class=\"me1\">index</span><span class=\"br0\">(</span>guysgirl<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> guylikes.<span class=\"me1\">index</span><span class=\"br0\">(</span>she<span class=\"br0\">)</span>:<br/>                <span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">\"%s and\u00a0%s like each other better than \"</span><br/>                      <span class=\"st0\">\"their present partners:\u00a0%s and\u00a0%s, respectively\"</span><br/>                     \u00a0% <span class=\"br0\">(</span>she<span class=\"sy0\">,</span> guy<span class=\"sy0\">,</span> he<span class=\"sy0\">,</span> guysgirl<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">False</span><br/>        <span class=\"kw1\">for</span> gal <span class=\"kw1\">in</span> helikesbetter:<br/>            girlsguy <span class=\"sy0\">=</span> engaged<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><br/>            gallikes <span class=\"sy0\">=</span> galprefers<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><br/>            <span class=\"kw1\">if</span> gallikes.<span class=\"me1\">index</span><span class=\"br0\">(</span>girlsguy<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> gallikes.<span class=\"me1\">index</span><span class=\"br0\">(</span>he<span class=\"br0\">)</span>:<br/>                <span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">\"%s and\u00a0%s like each other better than \"</span><br/>                      <span class=\"st0\">\"their present partners:\u00a0%s and\u00a0%s, respectively\"</span><br/>                     \u00a0% <span class=\"br0\">(</span>he<span class=\"sy0\">,</span> gal<span class=\"sy0\">,</span> she<span class=\"sy0\">,</span> girlsguy<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>                <span class=\"kw1\">return</span> <span class=\"kw2\">False</span><br/>    <span class=\"kw1\">return</span> <span class=\"kw2\">True</span><br/>\u00a0<br/><span class=\"kw1\">def</span> matchmaker<span class=\"br0\">(</span><span class=\"br0\">)</span>:<br/>    guysfree <span class=\"sy0\">=</span> guys<span class=\"br0\">[</span>:<span class=\"br0\">]</span><br/>    engaged  <span class=\"sy0\">=</span> <span class=\"br0\">{</span><span class=\"br0\">}</span><br/>    guyprefers2 <span class=\"sy0\">=</span> <span class=\"kw3\">copy</span>.<span class=\"me1\">deepcopy</span><span class=\"br0\">(</span>guyprefers<span class=\"br0\">)</span><br/>    galprefers2 <span class=\"sy0\">=</span> <span class=\"kw3\">copy</span>.<span class=\"me1\">deepcopy</span><span class=\"br0\">(</span>galprefers<span class=\"br0\">)</span><br/>    <span class=\"kw1\">while</span> guysfree:<br/>        guy <span class=\"sy0\">=</span> guysfree.<span class=\"me1\">pop</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span><br/>        guyslist <span class=\"sy0\">=</span> guyprefers2<span class=\"br0\">[</span>guy<span class=\"br0\">]</span><br/>        gal <span class=\"sy0\">=</span> guyslist.<span class=\"me1\">pop</span><span class=\"br0\">(</span><span class=\"nu0\">0</span><span class=\"br0\">)</span><br/>        fiance <span class=\"sy0\">=</span> engaged.<span class=\"me1\">get</span><span class=\"br0\">(</span>gal<span class=\"br0\">)</span><br/>        <span class=\"kw1\">if</span> <span class=\"kw1\">not</span> fiance:<br/>            <span class=\"co1\"># She's free</span><br/>            engaged<span class=\"br0\">[</span>gal<span class=\"br0\">]</span> <span class=\"sy0\">=</span> guy<br/>            <span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">\" \u00a0%s and\u00a0%s\"</span>\u00a0% <span class=\"br0\">(</span>guy<span class=\"sy0\">,</span> gal<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>        <span class=\"kw1\">else</span>:<br/>            <span class=\"co1\"># The bounder proposes to an engaged lass!</span><br/>            galslist <span class=\"sy0\">=</span> galprefers2<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><br/>            <span class=\"kw1\">if</span> galslist.<span class=\"me1\">index</span><span class=\"br0\">(</span>fiance<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> galslist.<span class=\"me1\">index</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span>:<br/>                <span class=\"co1\"># She prefers new guy</span><br/>                engaged<span class=\"br0\">[</span>gal<span class=\"br0\">]</span> <span class=\"sy0\">=</span> guy<br/>                <span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">\" \u00a0%s dumped\u00a0%s for\u00a0%s\"</span>\u00a0% <span class=\"br0\">(</span>gal<span class=\"sy0\">,</span> fiance<span class=\"sy0\">,</span> guy<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>                <span class=\"kw1\">if</span> guyprefers2<span class=\"br0\">[</span>fiance<span class=\"br0\">]</span>:<br/>                    <span class=\"co1\"># Ex has more girls to try</span><br/>                    guysfree.<span class=\"me1\">append</span><span class=\"br0\">(</span>fiance<span class=\"br0\">)</span><br/>            <span class=\"kw1\">else</span>:<br/>                <span class=\"co1\"># She is faithful to old fiance</span><br/>                <span class=\"kw1\">if</span> guyslist:<br/>                    <span class=\"co1\"># Look again</span><br/>                    guysfree.<span class=\"me1\">append</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span><br/>    <span class=\"kw1\">return</span> engaged<br/>\u00a0<br/>\u00a0<br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">'<span class=\"es0\">\\n</span>Engagements:'</span><span class=\"br0\">)</span><br/>engaged <span class=\"sy0\">=</span> matchmaker<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">'<span class=\"es0\">\\n</span>Couples:'</span><span class=\"br0\">)</span><br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">'  '</span> + <span class=\"st0\">',<span class=\"es0\">\\n</span>  '</span>.<span class=\"me1\">join</span><span class=\"br0\">(</span><span class=\"st0\">'%s is engaged to\u00a0%s'</span>\u00a0% couple<br/>                          <span class=\"kw1\">for</span> couple <span class=\"kw1\">in</span> <span class=\"kw2\">sorted</span><span class=\"br0\">(</span>engaged.<span class=\"me1\">items</span><span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">'Engagement stability check PASSED'</span><br/>      <span class=\"kw1\">if</span> check<span class=\"br0\">(</span>engaged<span class=\"br0\">)</span> <span class=\"kw1\">else</span> <span class=\"st0\">'Engagement stability check FAILED'</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">'<span class=\"es0\">\\n</span><span class=\"es0\">\\n</span>Swapping two fiances to introduce an error'</span><span class=\"br0\">)</span><br/>engaged<span class=\"br0\">[</span>gals<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"sy0\">,</span> engaged<span class=\"br0\">[</span>gals<span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"br0\">]</span> <span class=\"sy0\">=</span> engaged<span class=\"br0\">[</span>gals<span class=\"br0\">[</span><span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"br0\">]</span><span class=\"sy0\">,</span> engaged<span class=\"br0\">[</span>gals<span class=\"br0\">[</span><span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span><br/><span class=\"kw1\">for</span> gal <span class=\"kw1\">in</span> gals<span class=\"br0\">[</span>:<span class=\"nu0\">2</span><span class=\"br0\">]</span>:<br/>    <span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">' \u00a0%s is now engaged to\u00a0%s'</span>\u00a0% <span class=\"br0\">(</span>gal<span class=\"sy0\">,</span> engaged<span class=\"br0\">[</span>gal<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"kw1\">print</span><span class=\"br0\">(</span><span class=\"st0\">'Engagement stability check PASSED'</span><br/>      <span class=\"kw1\">if</span> check<span class=\"br0\">(</span>engaged<span class=\"br0\">)</span> <span class=\"kw1\">else</span> <span class=\"st0\">'Engagement stability check FAILED'</span><span class=\"br0\">)</span></pre>"}, {"lang": "Ruby", "loc": 171, "block": "<pre class=\"ruby highlighted_source\"><span class=\"kw1\">class</span> Person<br/>  <span class=\"kw1\">def</span> initialize<span class=\"br0\">(</span>name<span class=\"br0\">)</span><br/>    <span class=\"re1\">@name</span> = name<br/>    <span class=\"re1\">@fiance</span> = <span class=\"kw2\">nil</span><br/>    <span class=\"re1\">@preferences</span> = <span class=\"br0\">[</span><span class=\"br0\">]</span><br/>    <span class=\"re1\">@proposals</span> = <span class=\"br0\">[</span><span class=\"br0\">]</span><br/>  <span class=\"kw1\">end</span><br/>  attr_reader <span class=\"re3\">:name</span>, <span class=\"re3\">:proposals</span><br/>  attr_accessor <span class=\"re3\">:fiance</span>, <span class=\"re3\">:preferences</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> to_s<br/>    <span class=\"re1\">@name</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> free<br/>    <span class=\"re1\">@fiance</span> = <span class=\"kw2\">nil</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> single?<br/>    <span class=\"re1\">@fiance</span> == <span class=\"kw2\">nil</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> engage<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>    <span class=\"kw2\">self</span>.<span class=\"me1\">fiance</span> = person<br/>    person.<span class=\"me1\">fiance</span> = <span class=\"kw2\">self</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> better_choice?<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>    <span class=\"re1\">@preferences</span>.<span class=\"me1\">index</span><span class=\"br0\">(</span>person<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> <span class=\"re1\">@preferences</span>.<span class=\"me1\">index</span><span class=\"br0\">(</span>@fiance<span class=\"br0\">)</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> propose_to<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>    <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{self} proposes to #{person}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>    <span class=\"re1\">@proposals</span> <span class=\"sy0\">&lt;&lt;</span> person<br/>    person.<span class=\"me1\">respond_to_proposal_from</span><span class=\"br0\">(</span><span class=\"kw2\">self</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">def</span> respond_to_proposal_from<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>    <span class=\"kw1\">if</span> single?<br/>      <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{self} accepts proposal from #{person}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>      engage<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>    <span class=\"kw1\">elsif</span> better_choice?<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>      <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{self} dumps #{@fiance} for #{person}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>      <span class=\"re1\">@fiance</span>.<span class=\"me1\">free</span><br/>      engage<span class=\"br0\">(</span>person<span class=\"br0\">)</span><br/>    <span class=\"kw1\">else</span><br/>      <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{self} rejects proposal from #{person}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>    <span class=\"kw1\">end</span><br/>  <span class=\"kw1\">end</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"co1\">########################################################################</span><br/><span class=\"co1\"># initialize data</span><br/>\u00a0<br/>prefs = <span class=\"br0\">{</span><br/>  <span class=\"st0\">'abe'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>abi eve cath ivy jan dee fay bea hope gay<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'bob'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>cath hope abi dee eve fay bea jan ivy gay<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'col'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>hope eve abi dee bea fay ivy gay cath jan<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'dan'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>ivy fay dee gay hope eve jan bea cath abi<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'ed'</span>   <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>jan dee bea cath fay eve abi ivy hope gay<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'fred'</span> <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>bea abi dee gay eve ivy cath jan hope fay<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'gav'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>gay eve ivy bea cath abi dee hope jan fay<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'hal'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>abi eve hope fay ivy cath jan bea gay dee<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'ian'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>hope cath dee gay bea abi fay ivy jan eve<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'jon'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>abi fay jan gay eve bea dee cath ivy hope<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'abi'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>bob fred jon gav ian abe dan ed col hal<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'bea'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>bob abe col fred gav dan ian ed jon hal<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'cath'</span> <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>fred bob ed gav hal col ian abe dan jon<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'dee'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>fred jon col abe ian hal gav dan bob ed<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'eve'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>jon hal fred dan abe gav col ed ian bob<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'fay'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>bob abe ed ian jon dan fred gav col hal<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'gay'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>jon gav hal fred bob abe col ed dan ian<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'hope'</span> <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>gav jon bob abe ian dan hal ed col fred<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'ivy'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>ian col hal gav fred bob abe ed jon dan<span class=\"br0\">]</span>,<br/>  <span class=\"st0\">'jan'</span>  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>ed hal gav abe bob jon col ian fred dan<span class=\"br0\">]</span>,<br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"re1\">@men</span> = <span class=\"kw4\">Hash</span><span class=\"br0\">[</span><br/>  <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>abe bob col dan ed fred gav hal ian jon<span class=\"br0\">]</span>.<span class=\"me1\">collect</span> <span class=\"kw1\">do</span> <span class=\"sy0\">|</span>name<span class=\"sy0\">|</span><br/>    <span class=\"br0\">[</span>name, Person.<span class=\"me1\">new</span><span class=\"br0\">(</span>name<span class=\"br0\">)</span><span class=\"br0\">]</span><br/>  <span class=\"kw1\">end</span><br/><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"re1\">@women</span> = <span class=\"kw4\">Hash</span><span class=\"br0\">[</span><br/>  <span class=\"sy0\">%</span>w<span class=\"br0\">[</span>abi bea cath dee eve fay gay hope ivy jan<span class=\"br0\">]</span>.<span class=\"me1\">collect</span> <span class=\"kw1\">do</span> <span class=\"sy0\">|</span>name<span class=\"sy0\">|</span><br/>    <span class=\"br0\">[</span>name, Person.<span class=\"me1\">new</span><span class=\"br0\">(</span>name<span class=\"br0\">)</span><span class=\"br0\">]</span><br/>  <span class=\"kw1\">end</span><br/><span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"re1\">@men</span>.<span class=\"me1\">each</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>name, man<span class=\"sy0\">|</span> man.<span class=\"me1\">preferences</span> = <span class=\"re1\">@women</span>.<span class=\"me1\">values_at</span><span class=\"br0\">(</span><span class=\"sy0\">*</span>prefs<span class=\"br0\">[</span>name<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">}</span><br/><span class=\"re1\">@women</span>.<span class=\"me1\">each</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>name, woman<span class=\"sy0\">|</span> woman.<span class=\"me1\">preferences</span> = <span class=\"re1\">@men</span>.<span class=\"me1\">values_at</span><span class=\"br0\">(</span><span class=\"sy0\">*</span>prefs<span class=\"br0\">[</span>name<span class=\"br0\">]</span><span class=\"br0\">)</span><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co1\">########################################################################</span><br/><span class=\"co1\"># perform the matching</span><br/>\u00a0<br/><span class=\"kw1\">def</span> match_couples<span class=\"br0\">(</span>men, women<span class=\"br0\">)</span><br/>  men.<span class=\"me1\">each_value</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>man<span class=\"sy0\">|</span> man.<span class=\"me1\">free</span><span class=\"br0\">}</span><br/>  women.<span class=\"me1\">each_value</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>woman<span class=\"sy0\">|</span> woman.<span class=\"me1\">free</span><span class=\"br0\">}</span><br/>\u00a0<br/>  <span class=\"kw1\">while</span> m = men.<span class=\"me1\">values</span>.<span class=\"me1\">find</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>man<span class=\"sy0\">|</span> man.<span class=\"me1\">single</span>?<span class=\"br0\">}</span> <span class=\"kw1\">do</span><br/>    <span class=\"kw3\">puts</span> <span class=\"st0\">\"considering single man #{m}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>    w = m.<span class=\"me1\">preferences</span>.<span class=\"me1\">find</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>woman<span class=\"sy0\">|</span> <span class=\"kw1\">not</span> m.<span class=\"me1\">proposals</span>.<span class=\"kw1\">include</span>?<span class=\"br0\">(</span>woman<span class=\"br0\">)</span><span class=\"br0\">}</span><br/>    m.<span class=\"me1\">propose_to</span><span class=\"br0\">(</span>w<span class=\"br0\">)</span><br/>  <span class=\"kw1\">end</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/>match_couples <span class=\"re1\">@men</span>, <span class=\"re1\">@women</span><br/>\u00a0<br/><span class=\"re1\">@men</span>.<span class=\"me1\">each_value</span>.<span class=\"me1\">collect</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>man<span class=\"sy0\">|</span> <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{man} + #{man.fiance}\"</span><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co1\">########################################################################</span><br/><span class=\"co1\"># check for stability</span><br/>\u00a0<br/><span class=\"kw1\">class</span> Person<br/>  <span class=\"kw1\">def</span> more_preferable_people<br/>    <span class=\"br0\">(</span> <span class=\"re1\">@preferences</span>.<span class=\"me1\">partition</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span><span class=\"kw3\">p</span><span class=\"sy0\">|</span> better_choice?<span class=\"br0\">(</span><span class=\"kw3\">p</span><span class=\"br0\">)</span><span class=\"br0\">}</span> <span class=\"br0\">)</span>.<span class=\"me1\">first</span><br/>  <span class=\"kw1\">end</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/><span class=\"kw3\">require</span> <span class=\"st0\">'set'</span><br/>\u00a0<br/><span class=\"kw1\">def</span> stability<span class=\"br0\">(</span>men<span class=\"br0\">)</span><br/>  unstable = <span class=\"kw4\">Set</span>.<span class=\"me1\">new</span><br/>  men.<span class=\"me1\">each_value</span> <span class=\"kw1\">do</span> <span class=\"sy0\">|</span>man<span class=\"sy0\">|</span><br/>    woman = man.<span class=\"me1\">fiance</span><br/>    <span class=\"kw3\">puts</span> <span class=\"st0\">\"considering #{man} and #{woman}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>\u00a0<br/>    man.<span class=\"me1\">more_preferable_people</span>.<span class=\"me1\">each</span> <span class=\"kw1\">do</span> <span class=\"sy0\">|</span>other_woman<span class=\"sy0\">|</span><br/>      <span class=\"kw1\">if</span> other_woman.<span class=\"me1\">more_preferable_people</span>.<span class=\"kw1\">include</span>?<span class=\"br0\">(</span>man<span class=\"br0\">)</span><br/>        <span class=\"kw3\">puts</span> <span class=\"st0\">\"an unstable pairing: #{man} and #{other_woman}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>        unstable <span class=\"sy0\">&lt;&lt;</span> <span class=\"br0\">[</span>man, other_woman<span class=\"br0\">]</span><br/>      <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">end</span><br/>    woman.<span class=\"me1\">more_preferable_people</span>.<span class=\"me1\">each</span> <span class=\"kw1\">do</span> <span class=\"sy0\">|</span>other_man<span class=\"sy0\">|</span><br/>      <span class=\"kw1\">if</span> other_man.<span class=\"me1\">more_preferable_people</span>.<span class=\"kw1\">include</span>?<span class=\"br0\">(</span>woman<span class=\"br0\">)</span><br/>        <span class=\"kw3\">puts</span> <span class=\"st0\">\"an unstable pairing: #{woman} and #{other_man}\"</span> <span class=\"kw1\">if</span> <span class=\"re0\">$DEBUG</span><br/>        unstable <span class=\"sy0\">&lt;&lt;</span> <span class=\"br0\">[</span>other_man, woman<span class=\"br0\">]</span><br/>      <span class=\"kw1\">end</span><br/>    <span class=\"kw1\">end</span><br/>  <span class=\"kw1\">end</span><br/>\u00a0<br/>  <span class=\"kw1\">if</span> unstable.<span class=\"me1\">empty</span>?<br/>    <span class=\"kw3\">puts</span> <span class=\"st0\">\"these couples are stable\"</span><br/>  <span class=\"kw1\">else</span><br/>    <span class=\"kw3\">puts</span> <span class=\"st0\">\"uh oh\"</span><br/>    unstable.<span class=\"me1\">each</span> <span class=\"kw1\">do</span> <span class=\"sy0\">|</span>a,b<span class=\"sy0\">|</span><br/>      <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{a} is engaged to #{a.fiance} but would prefer #{b}, and #{b} is engaged to #{b.fiance} but would prefer #{a}\"</span><br/>    <span class=\"kw1\">end</span><br/>  <span class=\"kw1\">end</span><br/><span class=\"kw1\">end</span><br/>\u00a0<br/>stability <span class=\"re1\">@men</span><br/>\u00a0<br/><span class=\"co1\">########################################################################</span><br/><span class=\"co1\"># perturb</span><br/>\u00a0<br/><span class=\"kw3\">puts</span> <span class=\"st0\">\"<span class=\"es0\">\\n</span>what if abe and bob swap...\"</span><br/>\u00a0<br/><span class=\"kw1\">def</span> swap<span class=\"br0\">(</span>m1, m2<span class=\"br0\">)</span><br/>  w1 = m1.<span class=\"me1\">fiance</span><br/>  w2 = m2.<span class=\"me1\">fiance</span><br/>  m1.<span class=\"me1\">fiance</span> = w2<br/>  w1.<span class=\"me1\">fiance</span> = m2<br/>  m2.<span class=\"me1\">fiance</span> = w1<br/>  w2.<span class=\"me1\">fiance</span> = m1<br/><span class=\"kw1\">end</span><br/>\u00a0<br/>swap <span class=\"sy0\">*</span>@men.<span class=\"me1\">values_at</span><span class=\"br0\">(</span><span class=\"st0\">'abe'</span>,<span class=\"st0\">'bob'</span><span class=\"br0\">)</span><br/>\u00a0<br/><span class=\"re1\">@men</span>.<span class=\"me1\">each_value</span>.<span class=\"me1\">collect</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>man<span class=\"sy0\">|</span> <span class=\"kw3\">puts</span> <span class=\"st0\">\"#{man} + #{man.fiance}\"</span><span class=\"br0\">}</span><br/>stability <span class=\"re1\">@men</span></pre>"}, {"lang": "Racket", "loc": 87, "block": "<pre class=\"text highlighted_source\">\u00a0<br/>#lang racket<br/>\u00a0<br/>(define MEN<br/>  '([abe  abi  eve  cath ivy  jan  dee  fay  bea  hope gay ]<br/>    [bob  cath hope abi  dee  eve  fay  bea  jan  ivy  gay ]<br/>    [col  hope eve  abi  dee  bea  fay  ivy  gay  cath jan ]<br/>    [dan  ivy  fay  dee  gay  hope eve  jan  bea  cath abi ]<br/>    [ed   jan  dee  bea  cath fay  eve  abi  ivy  hope gay ]<br/>    [fred bea  abi  dee  gay  eve  ivy  cath jan  hope fay ]<br/>    [gav  gay  eve  ivy  bea  cath abi  dee  hope jan  fay ]<br/>    [hal  abi  eve  hope fay  ivy  cath jan  bea  gay  dee ]<br/>    [ian  hope cath dee  gay  bea  abi  fay  ivy  jan  eve ]<br/>    [jon  abi  fay  jan  gay  eve  bea  dee  cath ivy  hope]))<br/>(define WOMEN<br/>  '([abi  bob  fred jon  gav  ian  abe  dan  ed   col  hal ]<br/>    [bea  bob  abe  col  fred gav  dan  ian  ed   jon  hal ]<br/>    [cath fred bob  ed   gav  hal  col  ian  abe  dan  jon ]<br/>    [dee  fred jon  col  abe  ian  hal  gav  dan  bob  ed  ]<br/>    [eve  jon  hal  fred dan  abe  gav  col  ed   ian  bob ]<br/>    [fay  bob  abe  ed   ian  jon  dan  fred gav  col  hal ]<br/>    [gay  jon  gav  hal  fred bob  abe  col  ed   dan  ian ]<br/>    [hope gav  jon  bob  abe  ian  dan  hal  ed   col  fred]<br/>    [ivy  ian  col  hal  gav  fred bob  abe  ed   jon  dan ]<br/>    [jan  ed   hal  gav  abe  bob  jon  col  ian  fred dan ]))<br/>\u00a0<br/>;; x is better than y according to the l order<br/>(define (better? x y l) (memq y (cdr (memq x l))))<br/>\u00a0<br/>(define (stable-matching Mprefs Wprefs)<br/>  (define M (map car Mprefs))<br/>  (define engagements (make-hasheq))<br/>  (define preferences (make-hasheq))<br/>  (define (engage! m w)<br/>    (hash-set! engagements m w)<br/>    (hash-set! engagements w m))<br/>  (for ([m Mprefs]) (hash-set! preferences (car m) (cdr m)))<br/>  (for ([w Wprefs]) (hash-set! preferences (car w) (cdr w)))<br/>  (let loop ()<br/>    (define m+w<br/>      (for/or ([m M])<br/>        (and (not (hash-ref engagements m #f))  \u00a0; m is free<br/>             (let ([p (hash-ref preferences m)])\u00a0; can propose<br/>               (and (pair? p)<br/>                    (let ([w (car p)])<br/>                      (hash-set! preferences m (cdr p))\u00a0; drop w from m<br/>                      (cons m w)))))))<br/>    (when m+w<br/>      (define m (car m+w))<br/>      (define w (cdr m+w))<br/>      (define m* (hash-ref engagements w #f))   \u00a0; m* is w's prev engagement<br/>      (cond [(not m*) (engage! m w)]            \u00a0; w is free<br/>            [(better? m m* (hash-ref preferences w))\u00a0; w prefers m over m*<br/>             (engage! m w)<br/>             (hash-set! engagements m* #f)])    \u00a0; m* becomes free<br/>      (loop)))<br/>  engagements)<br/>\u00a0<br/>(define (find-unstable Mprefs Wprefs matches)<br/>  (for*/or ([m (map car Mprefs)] [w (map car Wprefs)])<br/>    (define w* (hash-ref matches m))<br/>    (define m* (hash-ref matches w))<br/>    (and (not (eq? m m*))<br/>         (better? w w* (cdr (assq m Mprefs)))<br/>         (better? m m* (cdr (assq w Wprefs)))<br/>         (cons m w))))<br/>\u00a0<br/>(define (check-stability)<br/>  (let ([u (find-unstable MEN WOMEN matches)])<br/>    (if u<br/>      (printf \"Unstable: ~a and ~a prefer each other over partners.\\n\"<br/>              (car u) (cdr u))<br/>      (printf \"The match is stable.\\n\"))))<br/>(define matches (stable-matching MEN WOMEN))<br/>(printf \"Found matches:\\n\")<br/>(for ([m (map car MEN)]) (printf \"  ~a, ~a\\n\" m (hash-ref matches m)))<br/>(check-stability)<br/>(let ([M (map car (take (shuffle MEN) 2))])<br/>  (printf \"Swapping wives of ~a and ~a\\n\" (car M) (cadr M))<br/>  (define (swap! x y)<br/>    (define t (hash-ref matches x))<br/>    (hash-set! matches x (hash-ref matches y))<br/>    (hash-set! matches y t))<br/>  (swap! (car M) (cadr M))<br/>  (swap! (hash-ref matches (car M)) (hash-ref matches (cadr M))))<br/>(check-stability)<br/>\u00a0</pre>"}, {"lang": "REXX", "loc": 205, "block": "<pre class=\"rexx highlighted_source\"><span class=\"coMULTI\">/*- REXX --------------------------------------------------------------<br/>* pref.b  Preferences of boy b<br/>* pref.g  Preferences of girl g<br/>* boys    List of boys<br/>* girls   List of girls<br/>* plist   List of proposals<br/>* mlist   List of (current) matches<br/>* glist   List of girls to be matched<br/>* glist.b List of girls that proposed to boy b<br/>* blen    maximum length of boys' names<br/>* glen    maximum length of girls' names<br/>---------------------------------------------------------------------*/</span><br/>\u00a0<br/>pref<span class=\"sy0\">.</span>Charlotte=<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Bingley Darcy Collins Wickham '</span><span class=\"br0\">)</span><br/>pref<span class=\"sy0\">.</span>Elisabeth=<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Wickham Darcy Bingley Collins '</span><span class=\"br0\">)</span><br/>pref<span class=\"sy0\">.</span>Jane     =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Bingley Wickham Darcy Collins '</span><span class=\"br0\">)</span><br/>pref<span class=\"sy0\">.</span>Lydia    =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Bingley Wickham Darcy Collins '</span><span class=\"br0\">)</span><br/>\u00a0<br/>pref<span class=\"sy0\">.</span>Bingley  =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Jane Elisabeth Lydia Charlotte'</span><span class=\"br0\">)</span><br/>pref<span class=\"sy0\">.</span>Collins  =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Jane Elisabeth Lydia Charlotte'</span><span class=\"br0\">)</span><br/>pref<span class=\"sy0\">.</span>Darcy    =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Elisabeth Jane Charlotte Lydia'</span><span class=\"br0\">)</span><br/>pref<span class=\"sy0\">.</span>Wickham  =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Lydia Jane Elisabeth Charlotte'</span><span class=\"br0\">)</span><br/>\u00a0<br/>pref<span class=\"sy0\">.</span>ABE=<span class=\"st0\">'ABI EVE CATH IVY JAN DEE FAY BEA HOPE GAY'</span><br/>pref<span class=\"sy0\">.</span>BOB=<span class=\"st0\">'CATH HOPE ABI DEE EVE FAY BEA JAN IVY GAY'</span><br/>pref<span class=\"sy0\">.</span>COL=<span class=\"st0\">'HOPE EVE ABI DEE BEA FAY IVY GAY CATH JAN'</span><br/>pref<span class=\"sy0\">.</span>DAN=<span class=\"st0\">'IVY FAY DEE GAY HOPE EVE JAN BEA CATH ABI'</span><br/>pref<span class=\"sy0\">.</span>ED=<span class=\"st0\">'JAN DEE BEA CATH FAY EVE ABI IVY HOPE GAY'</span><br/>pref<span class=\"sy0\">.</span>FRED=<span class=\"st0\">'BEA ABI DEE GAY EVE IVY CATH JAN HOPE FAY'</span><br/>pref<span class=\"sy0\">.</span>GAV=<span class=\"st0\">'GAY EVE IVY BEA CATH ABI DEE HOPE JAN FAY'</span><br/>pref<span class=\"sy0\">.</span>HAL=<span class=\"st0\">'ABI EVE HOPE FAY IVY CATH JAN BEA GAY DEE'</span><br/>pref<span class=\"sy0\">.</span>IAN=<span class=\"st0\">'HOPE CATH DEE GAY BEA ABI FAY IVY JAN EVE'</span><br/>pref<span class=\"sy0\">.</span>JON=<span class=\"st0\">'ABI FAY JAN GAY EVE BEA DEE CATH IVY HOPE'</span><br/>\u00a0<br/>pref<span class=\"sy0\">.</span>ABI=<span class=\"st0\">'BOB FRED JON GAV IAN ABE DAN ED COL HAL'</span><br/>pref<span class=\"sy0\">.</span>BEA=<span class=\"st0\">'BOB ABE COL FRED GAV DAN IAN ED JON HAL'</span><br/>pref<span class=\"sy0\">.</span>CATH=<span class=\"st0\">'FRED BOB ED GAV HAL COL IAN ABE DAN JON'</span><br/>pref<span class=\"sy0\">.</span>DEE=<span class=\"st0\">'FRED JON COL ABE IAN HAL GAV DAN BOB ED'</span><br/>pref<span class=\"sy0\">.</span>EVE=<span class=\"st0\">'JON HAL FRED DAN ABE GAV COL ED IAN BOB'</span><br/>pref<span class=\"sy0\">.</span>FAY=<span class=\"st0\">'BOB ABE ED IAN JON DAN FRED GAV COL HAL'</span><br/>pref<span class=\"sy0\">.</span>GAY=<span class=\"st0\">'JON GAV HAL FRED BOB ABE COL ED DAN IAN'</span><br/>pref<span class=\"sy0\">.</span>HOPE=<span class=\"st0\">'GAV JON BOB ABE IAN DAN HAL ED COL FRED'</span><br/>pref<span class=\"sy0\">.</span>IVY=<span class=\"st0\">'IAN COL HAL GAV FRED BOB ABE ED JON DAN'</span><br/>pref<span class=\"sy0\">.</span>JAN=<span class=\"st0\">'ED HAL GAV ABE BOB JON COL IAN FRED DAN'</span><br/>\u00a0<br/><span class=\"kw1\">If</span> <span class=\"kw1\">arg</span><span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span><span class=\"sy0\">&gt;</span><span class=\"st0\">''</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span><br/>  <span class=\"kw1\">Say</span> <span class=\"st0\">'Input from task description'</span><br/>  boys=<span class=\"st0\">'ABE BOB COL DAN ED FRED GAV HAL IAN JON'</span><br/>  girls=<span class=\"st0\">'ABI BEA CATH DEE EVE FAY GAY HOPE IVY JAN'</span><br/>  <span class=\"kw3\">End</span><br/><span class=\"kw3\">Else</span> <span class=\"kw1\">Do</span><br/>  <span class=\"kw1\">Say</span> <span class=\"st0\">'Input from link'</span><br/>  girls=<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Charlotte Elisabeth Jane  Lydia'</span><span class=\"br0\">)</span><br/>  boys =<span class=\"kw6\">translate</span><span class=\"br0\">(</span><span class=\"st0\">'Bingley   Collins   Darcy Wickham'</span><span class=\"br0\">)</span><br/>  <span class=\"kw3\">End</span><br/>\u00a0<br/>debug=<span class=\"nu0\">0</span><br/>blen=<span class=\"nu0\">0</span><br/><span class=\"kw1\">Do</span> i=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>boys<span class=\"br0\">)</span><br/>  blen=<span class=\"kw6\">max</span><span class=\"br0\">(</span>blen,<span class=\"kw6\">length</span><span class=\"br0\">(</span><span class=\"kw6\">word</span><span class=\"br0\">(</span>boys,i<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw3\">End</span><br/>glen=<span class=\"nu0\">0</span><br/><span class=\"kw1\">Do</span> i=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>girls<span class=\"br0\">)</span><br/>  glen=<span class=\"kw6\">max</span><span class=\"br0\">(</span>glen,<span class=\"kw6\">length</span><span class=\"br0\">(</span><span class=\"kw6\">word</span><span class=\"br0\">(</span>girls,i<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw3\">End</span><br/>glist=girls<br/>mlist=<span class=\"st0\">''</span><br/><span class=\"kw1\">Do</span> ri=<span class=\"nu0\">1</span> <span class=\"kw2\">By</span> <span class=\"nu0\">1</span> <span class=\"kw2\">Until</span> glist=<span class=\"st0\">''</span>            <span class=\"coMULTI\">/* as long as there are girls */</span><br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'Round'</span> ri<br/>  plist=<span class=\"st0\">''</span>                             <span class=\"coMULTI\">/* no proposals in this round */</span><br/>  glist<span class=\"sy0\">.</span>=<span class=\"st0\">''</span><br/>  <span class=\"kw1\">Do</span> gi=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>glist<span class=\"br0\">)</span>              <span class=\"coMULTI\">/* loop over free girls       */</span><br/>    gg=<span class=\"kw6\">word</span><span class=\"br0\">(</span>glist,gi<span class=\"br0\">)</span>                  <span class=\"coMULTI\">/* an unmathed girl           */</span><br/>    b=<span class=\"kw6\">word</span><span class=\"br0\">(</span>pref<span class=\"sy0\">.</span>gg,<span class=\"nu0\">1</span><span class=\"br0\">)</span>                  <span class=\"coMULTI\">/* her preferred boy          */</span><br/>    plist=plist gg<span class=\"st0\">'-'</span><span class=\"sy0\">||</span>b               <span class=\"coMULTI\">/* remember this proposal     */</span><br/>    glist<span class=\"sy0\">.</span>b=glist<span class=\"sy0\">.</span>b gg                 <span class=\"coMULTI\">/* add girl to the boy's list */</span><br/>    <span class=\"kw1\">Call</span> dbg <span class=\"kw6\">left</span><span class=\"br0\">(</span>gg,glen<span class=\"br0\">)</span> <span class=\"st0\">'proposes to'</span> b  <span class=\"coMULTI\">/* tell the user              */</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Do</span> bi=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>boys<span class=\"br0\">)</span>               <span class=\"coMULTI\">/* loop over all boys         */</span><br/>    b=<span class=\"kw6\">word</span><span class=\"br0\">(</span>boys,bi<span class=\"br0\">)</span>                    <span class=\"coMULTI\">/* one of them                */</span><br/>    <span class=\"kw1\">If</span> glist<span class=\"sy0\">.</span>b<span class=\"sy0\">&gt;</span><span class=\"st0\">''</span> <span class=\"kw3\">Then</span>                 <span class=\"coMULTI\">/* if he's got proposals      */</span><br/>      <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'has these proposals'</span> glist<span class=\"sy0\">.</span>b <span class=\"coMULTI\">/* show them               */</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Do</span> bi=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>boys<span class=\"br0\">)</span>               <span class=\"coMULTI\">/* loop over all boys         */</span><br/>    b=<span class=\"kw6\">word</span><span class=\"br0\">(</span>boys,bi<span class=\"br0\">)</span>                    <span class=\"coMULTI\">/* one of them                */</span><br/>    bm=<span class=\"kw6\">pos</span><span class=\"br0\">(</span>b<span class=\"st0\">'*'</span>,mlist<span class=\"br0\">)</span>                 <span class=\"coMULTI\">/* has he been matched yet?   */</span><br/>    <span class=\"kw1\">Select</span><br/>      <span class=\"kw3\">When</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>glist<span class=\"sy0\">.</span>b<span class=\"br0\">)</span>=<span class=\"nu0\">1</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span>    <span class=\"coMULTI\">/* one girl proposed for him  */</span><br/>        gg=<span class=\"kw6\">word</span><span class=\"br0\">(</span>glist<span class=\"sy0\">.</span>b,<span class=\"nu0\">1</span><span class=\"br0\">)</span>             <span class=\"coMULTI\">/* the proposing girl         */</span><br/>        <span class=\"kw1\">If</span> bm=<span class=\"nu0\">0</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span>                <span class=\"coMULTI\">/* no, he hasn't              */</span><br/>          <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'accepts'</span> gg           <span class=\"coMULTI\">/* is accepted                */</span><br/>          <span class=\"kw1\">Call</span> set_mlist <span class=\"st0\">'A'</span>,mlist b<span class=\"sy0\">||</span><span class=\"st0\">'*'</span><span class=\"sy0\">||</span>gg <span class=\"coMULTI\">/* add match to mlist  */</span><br/>          <span class=\"kw1\">Call</span> set_glist <span class=\"st0\">'A'</span>,remove<span class=\"br0\">(</span>gg,glist<span class=\"br0\">)</span> <span class=\"coMULTI\">/* remove gg from glist*/</span><br/>          pref<span class=\"sy0\">.</span>gg=remove<span class=\"br0\">(</span>b,pref<span class=\"sy0\">.</span>gg<span class=\"br0\">)</span>    <span class=\"coMULTI\">/* remove b from gg's preflist*/</span><br/>          <span class=\"kw3\">End</span><br/>        <span class=\"kw3\">Else</span> <span class=\"kw1\">Do</span>                        <span class=\"coMULTI\">/* boy has been matched       */</span><br/>          <span class=\"kw1\">Parse</span> <span class=\"kw2\">Var</span> mlist =<span class=\"br0\">(</span>bm<span class=\"br0\">)</span> <span class=\"st0\">'*'</span> go <span class=\"st0\">' '</span> <span class=\"coMULTI\">/* to girl go             */</span><br/>          <span class=\"kw1\">If</span> <span class=\"kw6\">wordpos</span><span class=\"br0\">(</span>gg,pref<span class=\"sy0\">.</span>b<span class=\"br0\">)</span><span class=\"sy0\">&lt;</span><span class=\"kw6\">wordpos</span><span class=\"br0\">(</span>go,pref<span class=\"sy0\">.</span>b<span class=\"br0\">)</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span><br/>               <span class=\"coMULTI\">/* the proposing girl is preferred to the current one */</span><br/>                                       <span class=\"coMULTI\">/* so we replace go by gg     */</span><br/>            <span class=\"kw1\">Call</span> set_mlist <span class=\"st0\">'B'</span>,repl<span class=\"br0\">(</span>mlist,b<span class=\"sy0\">||</span><span class=\"st0\">'*'</span><span class=\"sy0\">||</span>gg,b<span class=\"sy0\">||</span><span class=\"st0\">'*'</span><span class=\"sy0\">||</span>go<span class=\"br0\">)</span><br/>            <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'releases'</span> go<br/>            <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'accepts '</span> gg<br/>            <span class=\"kw1\">Call</span> set_glist <span class=\"st0\">'B'</span>,glist go  <span class=\"coMULTI\">/* add go to list of girls  */</span><br/>            <span class=\"kw1\">Call</span> set_glist <span class=\"st0\">'C'</span>,remove<span class=\"br0\">(</span>gg,glist<span class=\"br0\">)</span> <span class=\"coMULTI\">/* and remove gg     */</span><br/>            <span class=\"kw3\">End</span><br/>          pref<span class=\"sy0\">.</span>gg=remove<span class=\"br0\">(</span>b,pref<span class=\"sy0\">.</span>gg<span class=\"br0\">)</span>    <span class=\"coMULTI\">/* remove b from gg's preflist*/</span><br/>          <span class=\"kw3\">End</span><br/>        <span class=\"kw3\">End</span><br/>      <span class=\"kw3\">When</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>glist<span class=\"sy0\">.</span>b<span class=\"br0\">)</span><span class=\"sy0\">&gt;</span><span class=\"nu0\">1</span> <span class=\"kw3\">Then</span><br/>        <span class=\"kw1\">Call</span> pick_1<br/>      <span class=\"kw3\">Otherwise</span> <span class=\"kw1\">Nop</span><br/>      <span class=\"kw3\">End</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'Matches  \u00a0:'</span> mlist<br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'free girls:'</span> glist<br/>  <span class=\"kw1\">Call</span> check <span class=\"st0\">'L'</span><br/>  <span class=\"kw3\">End</span><br/><span class=\"kw1\">Say</span> <span class=\"st0\">'Success at round'</span> <span class=\"br0\">(</span>ri-<span class=\"nu0\">1</span><span class=\"br0\">)</span><br/><span class=\"kw1\">Do</span> <span class=\"kw2\">While</span> mlist<span class=\"sy0\">&gt;</span><span class=\"st0\">''</span><br/>  <span class=\"kw1\">Parse</span> <span class=\"kw2\">Var</span> mlist boy <span class=\"st0\">'*'</span> girl mlist<br/>  <span class=\"kw1\">Say</span> <span class=\"kw6\">left</span><span class=\"br0\">(</span>boy,blen<span class=\"br0\">)</span> <span class=\"st0\">'matches'</span> girl<br/>  <span class=\"kw3\">End</span><br/><span class=\"kw1\">Exit</span><br/>\u00a0<br/>pick_1:<br/>  <span class=\"kw1\">If</span> bm<span class=\"sy0\">&gt;</span><span class=\"nu0\">0</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span>                <span class=\"coMULTI\">/* boy has been matched       */</span><br/>    <span class=\"kw1\">Parse</span> <span class=\"kw2\">Var</span> mlist =<span class=\"br0\">(</span>bm<span class=\"br0\">)</span> <span class=\"st0\">'*'</span> go <span class=\"st0\">' '</span> <span class=\"coMULTI\">/* to girl go             */</span><br/>    pmin=<span class=\"kw6\">wordpos</span><span class=\"br0\">(</span>go,pref<span class=\"sy0\">.</span>b<span class=\"br0\">)</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw3\">Else</span> <span class=\"kw1\">Do</span><br/>    go=<span class=\"st0\">''</span><br/>    pmin=<span class=\"nu0\">99</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Do</span> gi=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>glist<span class=\"sy0\">.</span>b<span class=\"br0\">)</span><br/>    gt=<span class=\"kw6\">word</span><span class=\"br0\">(</span>glist<span class=\"sy0\">.</span>b,gi<span class=\"br0\">)</span><br/>    gp=<span class=\"kw6\">wordpos</span><span class=\"br0\">(</span>gt,pref<span class=\"sy0\">.</span>b<span class=\"br0\">)</span><br/>    <span class=\"kw1\">If</span> gp<span class=\"sy0\">&lt;</span>pmin <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span><br/>      pmin=gp<br/>      gg=gt<br/>      <span class=\"kw3\">End</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">If</span> bm=<span class=\"nu0\">0</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span><br/>    <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'accepts'</span> gg           <span class=\"coMULTI\">/* is accepted                */</span><br/>    <span class=\"kw1\">Call</span> set_mlist <span class=\"st0\">'A'</span>,mlist b<span class=\"sy0\">||</span><span class=\"st0\">'*'</span><span class=\"sy0\">||</span>gg <span class=\"coMULTI\">/* add match to mlist  */</span><br/>    <span class=\"kw1\">Call</span> set_glist <span class=\"st0\">'A'</span>,remove<span class=\"br0\">(</span>gg,glist<span class=\"br0\">)</span> <span class=\"coMULTI\">/* remove gg from glist*/</span><br/>    pref<span class=\"sy0\">.</span>gg=remove<span class=\"br0\">(</span>b,pref<span class=\"sy0\">.</span>gg<span class=\"br0\">)</span>    <span class=\"coMULTI\">/* remove b from gg's preflist*/</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw3\">Else</span> <span class=\"kw1\">Do</span><br/>    <span class=\"kw1\">If</span> gg<span class=\"sy0\">&lt;&gt;</span>go <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span><br/>      <span class=\"kw1\">Call</span> set_mlist <span class=\"st0\">'B'</span>,repl<span class=\"br0\">(</span>mlist,b<span class=\"sy0\">||</span><span class=\"st0\">'*'</span><span class=\"sy0\">||</span>gg,b<span class=\"sy0\">||</span><span class=\"st0\">'*'</span><span class=\"sy0\">||</span>go<span class=\"br0\">)</span><br/>      <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'releases'</span> go<br/>      <span class=\"kw1\">Call</span> dbg b <span class=\"st0\">'accepts '</span> gg<br/>      <span class=\"kw1\">Call</span> set_glist <span class=\"st0\">'B'</span>,glist go  <span class=\"coMULTI\">/* add go to list of girls  */</span><br/>      <span class=\"kw1\">Call</span> set_glist <span class=\"st0\">'C'</span>,remove<span class=\"br0\">(</span>gg,glist<span class=\"br0\">)</span> <span class=\"coMULTI\">/* and remove gg     */</span><br/>      pref<span class=\"sy0\">.</span>gg=remove<span class=\"br0\">(</span>b,pref<span class=\"sy0\">.</span>gg<span class=\"br0\">)</span>  <span class=\"coMULTI\">/* remove b from gg's preflist*/</span><br/>      <span class=\"kw3\">End</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Return</span><br/>\u00a0<br/>remove:<br/>  <span class=\"kw1\">Parse</span> <span class=\"kw1\">Arg</span> needle,haystack<br/>  pp=<span class=\"kw6\">pos</span><span class=\"br0\">(</span>needle,haystack<span class=\"br0\">)</span><br/>  <span class=\"kw1\">If</span> pp<span class=\"sy0\">&gt;</span><span class=\"nu0\">0</span> <span class=\"kw3\">Then</span><br/>    res=<span class=\"kw6\">left</span><span class=\"br0\">(</span>haystack,pp-<span class=\"nu0\">1</span><span class=\"br0\">)</span> <span class=\"kw6\">substr</span><span class=\"br0\">(</span>haystack,pp+<span class=\"kw6\">length</span><span class=\"br0\">(</span>needle<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>  <span class=\"kw3\">Else</span><br/>    res=haystack<br/>  <span class=\"kw1\">Return</span> <span class=\"kw6\">space</span><span class=\"br0\">(</span>res<span class=\"br0\">)</span><br/>\u00a0<br/>set_mlist:<br/>  <span class=\"kw1\">Parse</span> <span class=\"kw1\">Arg</span> where,new_mlist<br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'set_mlist'</span> where<span class=\"st0\">':'</span> mlist<br/>  mlist=<span class=\"kw6\">space</span><span class=\"br0\">(</span>new_mlist<span class=\"br0\">)</span><br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'set_mlist -&gt;'</span> mlist<br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">''</span><br/>  <span class=\"kw1\">Return</span><br/>\u00a0<br/>set_glist:<br/>  <span class=\"kw1\">Parse</span> <span class=\"kw1\">Arg</span> where,new_glist<br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'set_glist'</span> where<span class=\"st0\">':'</span> glist<br/>  glist=new_glist<br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'set_glist -&gt;'</span> glist<br/>  <span class=\"kw1\">Call</span> dbg <span class=\"st0\">''</span><br/>  <span class=\"kw1\">Return</span><br/>\u00a0<br/>check:<br/>  <span class=\"kw1\">If</span> <span class=\"kw6\">words</span><span class=\"br0\">(</span>mlist<span class=\"br0\">)</span>+<span class=\"kw6\">words</span><span class=\"br0\">(</span>glist<span class=\"br0\">)</span><span class=\"sy0\">&lt;&gt;</span><span class=\"kw6\">words</span><span class=\"br0\">(</span>boys<span class=\"br0\">)</span> <span class=\"kw3\">Then</span> <span class=\"kw1\">Do</span><br/>    <span class=\"kw1\">Call</span> dbg <span class=\"st0\">'FEHLER bei'</span> <span class=\"kw1\">arg</span><span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span> <span class=\"br0\">(</span><span class=\"kw6\">words</span><span class=\"br0\">(</span>mlist<span class=\"br0\">)</span>+<span class=\"kw6\">words</span><span class=\"br0\">(</span>glist<span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"st0\">'&lt;&gt;10'</span><br/>    <span class=\"kw1\">say</span> <span class=\"st0\">'match='</span>mlist<span class=\"st0\">'&lt;'</span><br/>    <span class=\"kw1\">say</span> <span class=\"st0\">'   glist='</span>glist<span class=\"st0\">'&lt;'</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Return</span><br/>\u00a0<br/>dbg:<br/>  <span class=\"kw1\">If</span> debug <span class=\"kw3\">Then</span><br/>    <span class=\"kw1\">Call</span> dbg <span class=\"kw1\">arg</span><span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span><br/>  <span class=\"kw1\">Return</span><br/>repl: <span class=\"kw1\">Procedure</span><br/>  <span class=\"kw1\">Parse</span> <span class=\"kw1\">Arg</span> s,new,old<br/>  <span class=\"kw1\">Do</span> i=<span class=\"nu0\">1</span> <span class=\"kw2\">To</span> <span class=\"nu0\">100</span> <span class=\"kw2\">Until</span> p=<span class=\"nu0\">0</span><br/>    p=<span class=\"kw6\">pos</span><span class=\"br0\">(</span>old,s<span class=\"br0\">)</span><br/>    <span class=\"kw1\">If</span> p<span class=\"sy0\">&gt;</span><span class=\"nu0\">0</span> <span class=\"kw3\">Then</span><br/>      s=<span class=\"kw6\">left</span><span class=\"br0\">(</span>s,p-<span class=\"nu0\">1</span><span class=\"br0\">)</span><span class=\"sy0\">||</span>new<span class=\"sy0\">||</span><span class=\"kw6\">substr</span><span class=\"br0\">(</span>s,p+<span class=\"kw6\">length</span><span class=\"br0\">(</span>old<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <span class=\"kw3\">End</span><br/>  <span class=\"kw1\">Return</span> s     </pre>"}, {"lang": "Scala", "loc": 107, "block": "<pre class=\"scala highlighted_source\"><a href=\"http://scala-lang.org\"><span class=\"kw1\">object</span></a> SMP <a href=\"http://scala-lang.org\"><span class=\"kw1\">extends</span></a> App <span class=\"br0\">{</span><br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">def</span></a> checkMarriages<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"sy0\">:</span> Unit <span class=\"sy0\">=</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span>check<span class=\"br0\">)</span><br/>            println<span class=\"br0\">(</span><span class=\"st0\">\"Marriages are stable\"</span><span class=\"br0\">)</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">else</span></a><br/>            println<span class=\"br0\">(</span><span class=\"st0\">\"Marriages are unstable\"</span><span class=\"br0\">)</span><br/>\u00a0<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">def</span></a> swap<span class=\"br0\">(</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> girl1 <span class=\"sy0\">=</span> girls.<span class=\"me1\">head</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> girl2 <span class=\"sy0\">=</span> girls<span class=\"br0\">(</span><span class=\"nu0\">1</span><span class=\"br0\">)</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> tmp <span class=\"sy0\">=</span> girl2 -<span class=\"sy0\">&gt;</span> matches<span class=\"br0\">(</span>girl1<span class=\"br0\">)</span><br/>        matches +<span class=\"sy0\">=</span> girl1 -<span class=\"sy0\">&gt;</span> matches<span class=\"br0\">(</span>girl2<span class=\"br0\">)</span><br/>        matches +<span class=\"sy0\">=</span> tmp<br/>        println<span class=\"br0\">(</span>girl1 + <span class=\"st0\">\" and \"</span> + girl2 + <span class=\"st0\">\" have switched partners\"</span><span class=\"br0\">)</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">type</span></a> TM <span class=\"sy0\">=</span> scala.<span class=\"me1\">collection</span>.<span class=\"me1\">mutable</span>.<span class=\"me1\">TreeMap</span><span class=\"br0\">[</span>String, String<span class=\"br0\">]</span><br/>\u00a0<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">def</span></a> check<span class=\"sy0\">:</span> Boolean <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span><span class=\"sy0\">!</span>girls.<span class=\"me1\">toSet</span>.<span class=\"me1\">subsetOf</span><span class=\"br0\">(</span>matches.<span class=\"me1\">keySet</span><span class=\"br0\">)</span> || <span class=\"sy0\">!</span>guys.<span class=\"me1\">toSet</span>.<span class=\"me1\">subsetOf</span><span class=\"br0\">(</span>matches.<span class=\"me1\">values</span>.<span class=\"me1\">toSet</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">return</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">false</span></a><br/>\u00a0<br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> invertedMatches <span class=\"sy0\">=</span> <a href=\"http://scala-lang.org\"><span class=\"kw1\">new</span></a> TM<br/>        matches foreach <span class=\"br0\">{</span> invertedMatches +<span class=\"sy0\">=</span> <span class=\"sy0\">_</span>.<span class=\"me1\">swap</span> <span class=\"br0\">}</span><br/>\u00a0<br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">for</span></a> <span class=\"br0\">(</span><span class=\"br0\">(</span>k, v<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span>- matches<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> shePrefers <span class=\"sy0\">=</span> girlPrefers<span class=\"br0\">(</span>k<span class=\"br0\">)</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> sheLikesBetter <span class=\"sy0\">=</span> shePrefers.<span class=\"me1\">slice</span><span class=\"br0\">(</span><span class=\"nu0\">0</span>, shePrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>v<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> hePrefers <span class=\"sy0\">=</span> guyPrefers<span class=\"br0\">(</span>v<span class=\"br0\">)</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> heLikesBetter <span class=\"sy0\">=</span> hePrefers.<span class=\"me1\">slice</span><span class=\"br0\">(</span><span class=\"nu0\">0</span>, hePrefers.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>k<span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">for</span></a> <span class=\"br0\">(</span>guy <span class=\"sy0\">&lt;</span>- sheLikesBetter<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> fiance <span class=\"sy0\">=</span> invertedMatches<span class=\"br0\">(</span>guy<span class=\"br0\">)</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> guy<span class=\"sy0\">_</span>p <span class=\"sy0\">=</span> guyPrefers<span class=\"br0\">(</span>guy<span class=\"br0\">)</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span>guy<span class=\"sy0\">_</span>p.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>fiance<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> guy<span class=\"sy0\">_</span>p.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>k<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    println<span class=\"br0\">(</span>s<span class=\"st0\">\"$k likes $guy better than $v and $guy likes $k better than their current partner\"</span><span class=\"br0\">)</span><br/>                    <a href=\"http://scala-lang.org\"><span class=\"kw1\">return</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">false</span></a><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>\u00a0<br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">for</span></a> <span class=\"br0\">(</span>girl <span class=\"sy0\">&lt;</span>- heLikesBetter<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> fiance <span class=\"sy0\">=</span> matches<span class=\"br0\">(</span>girl<span class=\"br0\">)</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> girl<span class=\"sy0\">_</span>p <span class=\"sy0\">=</span> girlPrefers<span class=\"br0\">(</span>girl<span class=\"br0\">)</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span>girl<span class=\"sy0\">_</span>p.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>fiance<span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> girl<span class=\"sy0\">_</span>p.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>v<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    println<span class=\"br0\">(</span>s<span class=\"st0\">\"$v likes $girl better than $k and $girl likes $v better than their current partner\"</span><span class=\"br0\">)</span><br/>                    <a href=\"http://scala-lang.org\"><span class=\"kw1\">return</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">false</span></a><br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">true</span></a><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> guys <span class=\"sy0\">=</span> <span class=\"st0\">\"abe\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"bob\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"col\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"dan\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"ed\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"fred\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"gav\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"hal\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"ian\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"jon\"</span> <span class=\"sy0\">::</span> Nil<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> girls <span class=\"sy0\">=</span> <span class=\"st0\">\"abi\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"bea\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"cath\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"dee\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"eve\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"fay\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"gay\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"hope\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"ivy\"</span> <span class=\"sy0\">::</span> <span class=\"st0\">\"jan\"</span> <span class=\"sy0\">::</span> Nil<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> guyPrefers <span class=\"sy0\">=</span> Map<span class=\"br0\">(</span><span class=\"st0\">\"abe\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"bob\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"col\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"dan\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"abi\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"ed\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"gay\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"fred\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"gav\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"fay\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"hal\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"dee\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"ian\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"hope\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"eve\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"jon\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span>, <span class=\"st0\">\"fay\"</span>, <span class=\"st0\">\"jan\"</span>, <span class=\"st0\">\"gay\"</span>, <span class=\"st0\">\"eve\"</span>, <span class=\"st0\">\"bea\"</span>, <span class=\"st0\">\"dee\"</span>, <span class=\"st0\">\"cath\"</span>, <span class=\"st0\">\"ivy\"</span>, <span class=\"st0\">\"hope\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> girlPrefers <span class=\"sy0\">=</span> Map<span class=\"br0\">(</span><span class=\"st0\">\"abi\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"bea\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"cath\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"jon\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"dee\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"ed\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"eve\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"bob\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"fay\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"gay\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"ian\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"hope\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"dan\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"fred\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"ivy\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span>,<br/>        <span class=\"st0\">\"jan\"</span> -<span class=\"sy0\">&gt;</span> List<span class=\"br0\">(</span><span class=\"st0\">\"ed\"</span>, <span class=\"st0\">\"hal\"</span>, <span class=\"st0\">\"gav\"</span>, <span class=\"st0\">\"abe\"</span>, <span class=\"st0\">\"bob\"</span>, <span class=\"st0\">\"jon\"</span>, <span class=\"st0\">\"col\"</span>, <span class=\"st0\">\"ian\"</span>, <span class=\"st0\">\"fred\"</span>, <span class=\"st0\">\"dan\"</span><span class=\"br0\">)</span><span class=\"br0\">)</span><br/>\u00a0<br/>    <a href=\"http://scala-lang.org\"><span class=\"kw1\">private</span></a> lazy <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> matches <span class=\"sy0\">=</span> <span class=\"br0\">{</span><br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> engagements <span class=\"sy0\">=</span> <a href=\"http://scala-lang.org\"><span class=\"kw1\">new</span></a> TM<br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> freeGuys <span class=\"sy0\">=</span> scala.<span class=\"me1\">collection</span>.<span class=\"me1\">mutable</span>.<span class=\"me1\">Queue</span>.<span class=\"me1\">empty</span> ++ guys<br/>        <a href=\"http://scala-lang.org\"><span class=\"kw1\">while</span></a> <span class=\"br0\">(</span>freeGuys.<span class=\"me1\">nonEmpty</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> guy <span class=\"sy0\">=</span> freeGuys.<span class=\"me1\">dequeue</span><span class=\"br0\">(</span><span class=\"br0\">)</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> guy<span class=\"sy0\">_</span>p <span class=\"sy0\">=</span> guyPrefers<span class=\"br0\">(</span>guy<span class=\"br0\">)</span><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">var</span></a> break <span class=\"sy0\">=</span> <a href=\"http://scala-lang.org\"><span class=\"kw1\">false</span></a><br/>            <a href=\"http://scala-lang.org\"><span class=\"kw1\">for</span></a> <span class=\"br0\">(</span>girl <span class=\"sy0\">&lt;</span>- guy<span class=\"sy0\">_</span>p<span class=\"br0\">)</span><br/>                <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span><span class=\"sy0\">!</span>break<span class=\"br0\">)</span><br/>                    <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span><span class=\"sy0\">!</span>engagements.<span class=\"me1\">contains</span><span class=\"br0\">(</span>girl<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                        engagements<span class=\"br0\">(</span>girl<span class=\"br0\">)</span> <span class=\"sy0\">=</span> guy<br/>                        break <span class=\"sy0\">=</span> <a href=\"http://scala-lang.org\"><span class=\"kw1\">true</span></a><br/>                    <span class=\"br0\">}</span><br/>                    <a href=\"http://scala-lang.org\"><span class=\"kw1\">else</span></a> <span class=\"br0\">{</span><br/>                        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> other<span class=\"sy0\">_</span>guy <span class=\"sy0\">=</span> engagements<span class=\"br0\">(</span>girl<span class=\"br0\">)</span><br/>                        <a href=\"http://scala-lang.org\"><span class=\"kw1\">val</span></a> girl<span class=\"sy0\">_</span>p <span class=\"sy0\">=</span> girlPrefers<span class=\"br0\">(</span>girl<span class=\"br0\">)</span><br/>                        <a href=\"http://scala-lang.org\"><span class=\"kw1\">if</span></a> <span class=\"br0\">(</span>girl<span class=\"sy0\">_</span>p.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>guy<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> girl<span class=\"sy0\">_</span>p.<span class=\"me1\">indexOf</span><span class=\"br0\">(</span>other<span class=\"sy0\">_</span>guy<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                            engagements<span class=\"br0\">(</span>girl<span class=\"br0\">)</span> <span class=\"sy0\">=</span> guy<br/>                            freeGuys +<span class=\"sy0\">=</span> other<span class=\"sy0\">_</span>guy<br/>                            break <span class=\"sy0\">=</span> <a href=\"http://scala-lang.org\"><span class=\"kw1\">true</span></a><br/>                        <span class=\"br0\">}</span><br/>                    <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>\u00a0<br/>        engagements foreach <span class=\"br0\">{</span> e <span class=\"sy0\">=&gt;</span> println<span class=\"br0\">(</span>s<span class=\"st0\">\"${e._1} is engaged to ${e._2}\"</span><span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>        engagements<br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    checkMarriages<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    swap<span class=\"br0\">(</span><span class=\"br0\">)</span><br/>    checkMarriages<span class=\"br0\">(</span><span class=\"br0\">)</span><br/><span class=\"br0\">}</span></pre>"}, {"lang": "Seed7", "loc": 150, "block": "<pre class=\"text highlighted_source\">$ include \"seed7_05.s7i\";<br/>\u00a0<br/>const type: preferences is hash [string] array string;<br/>const type: engaged is hash [string] string;<br/>\u00a0<br/>const func integer: pos (in array string: area, in string: searched) is func<br/>  result<br/>    var integer: pos is 1;<br/>  begin<br/>    while pos &lt;= length(area) and area[pos] &lt;&gt; searched do<br/>      incr(pos);<br/>    end while;<br/>    if pos &gt; length(area) then<br/>      pos\u00a0:= 0;<br/>    end if;<br/>  end func;<br/>\u00a0<br/>const func engaged: matchmaker (in preferences: guyPrefers, in preferences: girlPrefers) is func<br/>  result<br/>    var engaged: engagedTo is engaged.value;<br/>  local<br/>    var array string: freeGuys is 0 times \"\";<br/>    var string: guy is \"\";<br/>    var string: girl is \"\";<br/>    var string: fiance is \"\";<br/>    var array string: guyPreferencList is 0 times \"\";<br/>    var array string: girlPreferenceList is 0 times \"\";<br/>    var boolean: searching is TRUE;<br/>  begin<br/>    freeGuys\u00a0:= sort(keys(guyPrefers));<br/>    while length(freeGuys) &lt;&gt; 0 do<br/>      guy\u00a0:= freeGuys[1];<br/>      freeGuys\u00a0:= freeGuys[2 ..];<br/>      guyPreferencList\u00a0:= guyPrefers[guy];<br/>      searching\u00a0:= TRUE;<br/>      while searching and length(guyPreferencList) &lt;&gt; 0 do<br/>        girl\u00a0:= guyPreferencList[1];<br/>        guyPreferencList\u00a0:= guyPreferencList[2 ..];<br/>        if girl not in engagedTo then<br/>          engagedTo @:= [girl] guy;<br/>          writeln(\"  \" &lt;&amp; girl &lt;&amp; \" and \" &lt;&amp; guy);<br/>          searching\u00a0:= FALSE;<br/>        else<br/>          fiance\u00a0:= engagedTo[girl];<br/>          girlPreferenceList\u00a0:= girlPrefers[girl];<br/>          if pos(girlPreferenceList, guy) &lt; pos(girlPreferenceList, fiance) then<br/>            # She prefers new guy<br/>            engagedTo @:= [girl] guy;<br/>            freeGuys &amp;:= fiance;<br/>            writeln(\"  \" &lt;&amp; girl &lt;&amp; \" dumped \" &lt;&amp; fiance &lt;&amp; \" for \" &lt;&amp; guy);<br/>            searching\u00a0:= FALSE;<br/>          end if;<br/>        end if;<br/>      end while;<br/>    end while;<br/>  end func;<br/>\u00a0<br/>const func boolean: check (in engaged: engagedTo,<br/>    in preferences: guyPrefers, in preferences: girlPrefers) is func<br/>  result<br/>    var boolean: stable is TRUE;<br/>  local<br/>    var string: he is \"\";<br/>    var string: she is \"\";<br/>    var string: guy is \"\";<br/>    var string: girl is \"\";<br/>    var engaged: inverseEngaged is engaged.value;<br/>    var array string: sheLikes is 0 times \"\";<br/>    var array string: sheLikesBetter is 0 times \"\";<br/>    var array string: heLikes is 0 times \"\";<br/>    var array string: heLikesBetter is 0 times \"\";<br/>    var string: guysGirl is \"\";<br/>    var array string: guyLikes is 0 times \"\";<br/>    var string: girlsGuy is \"\";<br/>    var array string: girlLikes is 0 times \"\";<br/>  begin<br/>    for he key she range engagedTo do<br/>      inverseEngaged @:= [he] she;<br/>    end for;<br/>    for he key she range engagedTo do<br/>      sheLikes\u00a0:= girlPrefers[she];<br/>      sheLikesBetter\u00a0:= sheLikes[.. pred(pos(sheLikes, he))];<br/>      heLikes\u00a0:= guyPrefers[he];<br/>      heLikesBetter\u00a0:= heLikes[.. pred(pos(heLikes, she))];<br/>      for guy range sheLikesBetter do<br/>        guysGirl\u00a0:= inverseEngaged[guy];<br/>        guyLikes\u00a0:= guyPrefers[guy];<br/>        if pos(guyLikes, guysGirl) &gt; pos(guyLikes, she) and stable then<br/>          writeln(she &lt;&amp; \" likes \" &lt;&amp; guy &lt;&amp; \" better than \" &lt;&amp; he &lt;&amp; \" and \" &lt;&amp;<br/>                  guy &lt;&amp; \" likes \" &lt;&amp; she &lt;&amp; \" better than their current partner\");<br/>          stable\u00a0:= FALSE;<br/>        end if;<br/>      end for;<br/>      for girl range heLikesBetter do<br/>        girlsGuy\u00a0:= engagedTo[girl];<br/>        girlLikes\u00a0:= girlPrefers[girl];<br/>        if pos(girlLikes, girlsGuy) &gt; pos(girlLikes, he) and stable then<br/>          writeln(he &lt;&amp; \" likes \" &lt;&amp; girl &lt;&amp; \" better than \" &lt;&amp; she &lt;&amp; \" and \" &lt;&amp;<br/>                  girl &lt;&amp; \" likes \" &lt;&amp; he &lt;&amp; \" better than their current partner\");<br/>          stable\u00a0:= FALSE;<br/>        end if;<br/>      end for;<br/>    end for;<br/>  end func;<br/>\u00a0<br/>var preferences: guyPrefers is preferences.value;<br/>var preferences: girlPrefers is preferences.value;<br/>guyPrefers @:= [\"abe\"]  [] (\"abi\", \"eve\", \"cath\", \"ivy\", \"jan\", \"dee\", \"fay\", \"bea\", \"hope\", \"gay\");<br/>guyPrefers @:= [\"bob\"]  [] (\"cath\", \"hope\", \"abi\", \"dee\", \"eve\", \"fay\", \"bea\", \"jan\", \"ivy\", \"gay\");<br/>guyPrefers @:= [\"col\"]  [] (\"hope\", \"eve\", \"abi\", \"dee\", \"bea\", \"fay\", \"ivy\", \"gay\", \"cath\", \"jan\");<br/>guyPrefers @:= [\"dan\"]  [] (\"ivy\", \"fay\", \"dee\", \"gay\", \"hope\", \"eve\", \"jan\", \"bea\", \"cath\", \"abi\");<br/>guyPrefers @:= [\"ed\"]   [] (\"jan\", \"dee\", \"bea\", \"cath\", \"fay\", \"eve\", \"abi\", \"ivy\", \"hope\", \"gay\");<br/>guyPrefers @:= [\"fred\"] [] (\"bea\", \"abi\", \"dee\", \"gay\", \"eve\", \"ivy\", \"cath\", \"jan\", \"hope\", \"fay\");<br/>guyPrefers @:= [\"gav\"]  [] (\"gay\", \"eve\", \"ivy\", \"bea\", \"cath\", \"abi\", \"dee\", \"hope\", \"jan\", \"fay\");<br/>guyPrefers @:= [\"hal\"]  [] (\"abi\", \"eve\", \"hope\", \"fay\", \"ivy\", \"cath\", \"jan\", \"bea\", \"gay\", \"dee\");<br/>guyPrefers @:= [\"ian\"]  [] (\"hope\", \"cath\", \"dee\", \"gay\", \"bea\", \"abi\", \"fay\", \"ivy\", \"jan\", \"eve\");<br/>guyPrefers @:= [\"jon\"]  [] (\"abi\", \"fay\", \"jan\", \"gay\", \"eve\", \"bea\", \"dee\", \"cath\", \"ivy\", \"hope\");<br/>girlPrefers @:= [\"abi\"]  [] (\"bob\", \"fred\", \"jon\", \"gav\", \"ian\", \"abe\", \"dan\", \"ed\", \"col\", \"hal\");<br/>girlPrefers @:= [\"bea\"]  [] (\"bob\", \"abe\", \"col\", \"fred\", \"gav\", \"dan\", \"ian\", \"ed\", \"jon\", \"hal\");<br/>girlPrefers @:= [\"cath\"] [] (\"fred\", \"bob\", \"ed\", \"gav\", \"hal\", \"col\", \"ian\", \"abe\", \"dan\", \"jon\");<br/>girlPrefers @:= [\"dee\"]  [] (\"fred\", \"jon\", \"col\", \"abe\", \"ian\", \"hal\", \"gav\", \"dan\", \"bob\", \"ed\");<br/>girlPrefers @:= [\"eve\"]  [] (\"jon\", \"hal\", \"fred\", \"dan\", \"abe\", \"gav\", \"col\", \"ed\", \"ian\", \"bob\");<br/>girlPrefers @:= [\"fay\"]  [] (\"bob\", \"abe\", \"ed\", \"ian\", \"jon\", \"dan\", \"fred\", \"gav\", \"col\", \"hal\");<br/>girlPrefers @:= [\"gay\"]  [] (\"jon\", \"gav\", \"hal\", \"fred\", \"bob\", \"abe\", \"col\", \"ed\", \"dan\", \"ian\");<br/>girlPrefers @:= [\"hope\"] [] (\"gav\", \"jon\", \"bob\", \"abe\", \"ian\", \"dan\", \"hal\", \"ed\", \"col\", \"fred\");<br/>girlPrefers @:= [\"ivy\"]  [] (\"ian\", \"col\", \"hal\", \"gav\", \"fred\", \"bob\", \"abe\", \"ed\", \"jon\", \"dan\");<br/>girlPrefers @:= [\"jan\"]  [] (\"ed\", \"hal\", \"gav\", \"abe\", \"bob\", \"jon\", \"col\", \"ian\", \"fred\", \"dan\");<br/>\u00a0<br/>const proc: main is func<br/>  local<br/>    var engaged: engagedTo is engaged.value;<br/>    var string: girl is \"\";<br/>  begin<br/>    writeln(\"Matchmaking:\");<br/>    engagedTo\u00a0:= matchmaker(guyPrefers, girlPrefers);<br/>    writeln;<br/>    writeln(\"Engagements:\");<br/>    for girl range sort(keys(engagedTo)) do<br/>      writeln(\"  \" &lt;&amp; girl &lt;&amp; \" and \" &lt;&amp; engagedTo[girl]);<br/>    end for;<br/>    writeln;<br/>    writeln(\"Marriages are \" &lt;&amp; [] (\"unstable\", \"stable\") [succ(ord(check(engagedTo, guyPrefers, girlPrefers)))]);<br/>    writeln;<br/>    writeln(\"Perturb:\");<br/>    engagedTo @:= [\"abi\"] \"fred\";<br/>    engagedTo @:= [\"bea\"] \"jon\";<br/>    writeln(\"engage abi with fred and bea with jon\");<br/>    writeln;<br/>    writeln(\"Marriages are \" &lt;&amp; [] (\"unstable\", \"stable\") [succ(ord(check(engagedTo, guyPrefers, girlPrefers)))]);<br/>  end func;</pre>"}, {"lang": "Sidef", "loc": 89, "block": "<pre class=\"ruby highlighted_source\">var he_likes = <span class=\"kw4\">Hash</span><span class=\"br0\">(</span><br/>    abe  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> abi eve cath ivy jan dee fay bea hope gay <span class=\"sy0\">&gt;</span>,<br/>    bob  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> cath hope abi dee eve fay bea jan ivy gay <span class=\"sy0\">&gt;</span>,<br/>    col  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> hope eve abi dee bea fay ivy gay cath jan <span class=\"sy0\">&gt;</span>,<br/>    dan  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> ivy fay dee gay hope eve jan bea cath abi <span class=\"sy0\">&gt;</span>,<br/>    ed   <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> jan dee bea cath fay eve abi ivy hope gay <span class=\"sy0\">&gt;</span>,<br/>    fred <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bea abi dee gay eve ivy cath jan hope fay <span class=\"sy0\">&gt;</span>,<br/>    gav  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> gay eve ivy bea cath abi dee hope jan fay <span class=\"sy0\">&gt;</span>,<br/>    hal  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> abi eve hope fay ivy cath jan bea gay dee <span class=\"sy0\">&gt;</span>,<br/>    ian  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> hope cath dee gay bea abi fay ivy jan eve <span class=\"sy0\">&gt;</span>,<br/>    jon  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> abi fay jan gay eve bea dee cath ivy hope <span class=\"sy0\">&gt;</span>,<br/><span class=\"br0\">)</span>;<br/>\u00a0<br/>var she_likes = <span class=\"kw4\">Hash</span><span class=\"br0\">(</span><br/>    abi  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bob fred jon gav ian abe dan ed col hal <span class=\"sy0\">&gt;</span>,<br/>    bea  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bob abe col fred gav dan ian ed jon hal <span class=\"sy0\">&gt;</span>,<br/>    cath <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> fred bob ed gav hal col ian abe dan jon <span class=\"sy0\">&gt;</span>,<br/>    dee  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> fred jon col abe ian hal gav dan bob ed <span class=\"sy0\">&gt;</span>,<br/>    eve  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> jon hal fred dan abe gav col ed ian bob <span class=\"sy0\">&gt;</span>,<br/>    fay  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> bob abe ed ian jon dan fred gav col hal <span class=\"sy0\">&gt;</span>,<br/>    gay  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> jon gav hal fred bob abe col ed dan ian <span class=\"sy0\">&gt;</span>,<br/>    hope <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> gav jon bob abe ian dan hal ed col fred <span class=\"sy0\">&gt;</span>,<br/>    ivy  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> ian col hal gav fred bob abe ed jon dan <span class=\"sy0\">&gt;</span>,<br/>    jan  <span class=\"sy0\">=&gt;</span> <span class=\"sy0\">&lt;</span> ed hal gav abe bob jon col ian fred dan <span class=\"sy0\">&gt;</span>,<br/><span class=\"br0\">)</span>;<br/>\u00a0<br/>var guys = he_likes.<span class=\"me1\">keys</span>;<br/>var gals = she_likes.<span class=\"me1\">keys</span>;<br/>\u00a0<br/>var <span class=\"br0\">(</span><span class=\"re3\">:fianc</span>\u00e9, <span class=\"re3\">:fianc</span>\u00e9e, <span class=\"re3\">:proposed</span><span class=\"br0\">)</span>;<br/>\u00a0<br/>func she_prefers <span class=\"br0\">(</span>her, hottie<span class=\"br0\">)</span> <span class=\"br0\">{</span> var a = she_likes<span class=\"br0\">{</span>her<span class=\"br0\">}</span>; a.<span class=\"me1\">index</span><span class=\"br0\">(</span>hottie<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> a.<span class=\"me1\">index</span><span class=\"br0\">(</span>fianc\u00e9<span class=\"br0\">{</span>her<span class=\"br0\">}</span><span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>func he_prefers  <span class=\"br0\">(</span>him, hottie<span class=\"br0\">)</span> <span class=\"br0\">{</span> var a =  he_likes<span class=\"br0\">{</span>him<span class=\"br0\">}</span>; a.<span class=\"me1\">index</span><span class=\"br0\">(</span>hottie<span class=\"br0\">)</span> <span class=\"sy0\">&lt;</span> a.<span class=\"me1\">index</span><span class=\"br0\">(</span>fianc\u00e9e<span class=\"br0\">{</span>him<span class=\"br0\">}</span><span class=\"br0\">)</span> <span class=\"br0\">}</span><br/>\u00a0<br/>func unmatched_guy <span class=\"br0\">{</span> guys.<span class=\"me1\">first</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>k<span class=\"sy0\">|</span>\u00a0!<span class=\"kw1\">defined</span> fianc\u00e9e<span class=\"br0\">{</span>k<span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span><br/>func preferred_choice<span class=\"br0\">(</span>guy<span class=\"br0\">)</span> <span class=\"br0\">{</span> he_likes<span class=\"br0\">{</span>guy<span class=\"br0\">}</span>.<span class=\"me1\">first</span> <span class=\"br0\">{</span><span class=\"sy0\">|</span>k<span class=\"sy0\">|</span>\u00a0!<span class=\"kw1\">defined</span> proposed<span class=\"br0\">{</span>guy<span class=\"br0\">}</span><span class=\"br0\">{</span>k<span class=\"br0\">}</span> <span class=\"br0\">}</span> <span class=\"br0\">}</span><br/>\u00a0<br/>func engage<span class=\"br0\">(</span>guy, gal<span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>    fianc\u00e9<span class=\"br0\">{</span>gal<span class=\"br0\">}</span> = guy;<br/>    fianc\u00e9e<span class=\"br0\">{</span>guy<span class=\"br0\">}</span> = gal;<br/><span class=\"br0\">}</span><br/>\u00a0<br/>func match_em <span class=\"br0\">{</span><br/>    say <span class=\"st0\">'Matchmaking:'</span>;<br/>    <span class=\"kw1\">while</span> <span class=\"br0\">(</span><span class=\"kw1\">defined</span><span class=\"br0\">(</span>var guy = unmatched_guy<span class=\"br0\">(</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>        var gal = preferred_choice<span class=\"br0\">(</span>guy<span class=\"br0\">)</span>;<br/>        proposed<span class=\"br0\">{</span>guy<span class=\"br0\">}</span><span class=\"br0\">{</span>gal<span class=\"br0\">}</span> = <span class=\"st0\">'\u2764'</span>;<br/>        <span class=\"kw1\">if</span> <span class=\"br0\">(</span>!<span class=\"kw1\">defined</span> fianc\u00e9<span class=\"br0\">{</span>gal<span class=\"br0\">}</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            engage<span class=\"br0\">(</span>guy, gal<span class=\"br0\">)</span>;<br/>            say <span class=\"st0\">\"<span class=\"es0\">\\t</span>#{gal} and #{guy}\"</span>;<br/>        <span class=\"br0\">}</span><br/>        <span class=\"kw1\">elsif</span> <span class=\"br0\">(</span>she_prefers<span class=\"br0\">(</span>gal, guy<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>            var engaged_guy = fianc\u00e9<span class=\"br0\">{</span>gal<span class=\"br0\">}</span>;<br/>            engage<span class=\"br0\">(</span>guy, gal<span class=\"br0\">)</span>;<br/>            fianc\u00e9e<span class=\"br0\">{</span>engaged_guy<span class=\"br0\">}</span> = <span class=\"kw2\">nil</span>;<br/>            say <span class=\"st0\">\"<span class=\"es0\">\\t</span>#{gal} dumped #{engaged_guy} for #{guy}\"</span>;<br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/>func check_stability <span class=\"br0\">{</span><br/>    var instabilities = gather <span class=\"br0\">{</span><br/>        guys.<span class=\"me1\">each</span> <span class=\"br0\">{</span> <span class=\"sy0\">|</span>m<span class=\"sy0\">|</span><br/>            gals.<span class=\"me1\">each</span> <span class=\"br0\">{</span> <span class=\"sy0\">|</span>w<span class=\"sy0\">|</span><br/>                <span class=\"kw1\">if</span> <span class=\"br0\">(</span>he_prefers<span class=\"br0\">(</span>m, w<span class=\"br0\">)</span> <span class=\"sy0\">&amp;&amp;</span> she_prefers<span class=\"br0\">(</span>w, m<span class=\"br0\">)</span><span class=\"br0\">)</span> <span class=\"br0\">{</span><br/>                    take <span class=\"st0\">\"<span class=\"es0\">\\t</span>#{w} prefers #{m} to #{fianc\u00e9{w}} and #{m} prefers #{w} to #{fianc\u00e9e{m}}\"</span>;<br/>                <span class=\"br0\">}</span><br/>            <span class=\"br0\">}</span><br/>        <span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>\u00a0<br/>    say <span class=\"st0\">'Stablility:'</span>;<br/>    instabilities.<span class=\"me1\">is_empty</span><br/>       \u00a0? say <span class=\"st0\">\"<span class=\"es0\">\\t</span>(all marriages stable)\"</span><br/>       \u00a0: instabilities.<span class=\"me1\">each</span> <span class=\"br0\">{</span> <span class=\"sy0\">|</span>i<span class=\"sy0\">|</span> say i <span class=\"br0\">}</span>;<br/><span class=\"br0\">}</span><br/>\u00a0<br/>func perturb_em <span class=\"br0\">{</span><br/>    say <span class=\"st0\">'Perturb:'</span>;<br/>    say <span class=\"st0\">\"<span class=\"es0\">\\t</span>engage abi with fred and bea with jon\"</span>;<br/>    engage<span class=\"br0\">(</span><span class=\"st0\">'fred'</span>, <span class=\"st0\">'abi'</span><span class=\"br0\">)</span>;<br/>    engage<span class=\"br0\">(</span><span class=\"st0\">'jon'</span>, <span class=\"st0\">'bea'</span><span class=\"br0\">)</span>;<br/><span class=\"br0\">}</span><br/>\u00a0<br/>match_em<span class=\"br0\">(</span><span class=\"br0\">)</span>;<br/>check_stability<span class=\"br0\">(</span><span class=\"br0\">)</span>;<br/>\u00a0<br/>perturb_em<span class=\"br0\">(</span><span class=\"br0\">)</span>;<br/>check_stability<span class=\"br0\">(</span><span class=\"br0\">)</span>;</pre>"}, {"lang": "SPARK / Ada", "loc": 44, "block": "<pre class=\"ada highlighted_source\"><span class=\"kw3\">package</span> Preferences<br/><span class=\"kw1\">is</span><br/>\u00a0<br/>   <span class=\"kw3\">type</span> Guy_X <span class=\"kw1\">is</span> <span class=\"br0\">(</span>no_guy, abe, bob, col, dan, ed, fred, gav, hal, ian, jon<span class=\"br0\">)</span>;<br/>   <span class=\"kw3\">subtype</span> Guy <span class=\"kw1\">is</span> Guy_X <span class=\"kw3\">range</span> Guy_X'Succ<span class=\"br0\">(</span>Guy_X'First<span class=\"br0\">)</span> .. <span class=\"me1\">Guy_X</span>'Last;<br/>\u00a0<br/>   <span class=\"kw3\">type</span> Girl_X <span class=\"kw1\">is</span> <span class=\"br0\">(</span>no_girl, abi, bea, cath, dee, eve, fay, gay, hope, ivy, jan<span class=\"br0\">)</span>;<br/>   <span class=\"kw3\">subtype</span> Girl <span class=\"kw1\">is</span> Girl_X <span class=\"kw3\">range</span> Girl_X'Succ<span class=\"br0\">(</span>Girl_X'First<span class=\"br0\">)</span> .. <span class=\"me1\">Girl_X</span>'Last;<br/>\u00a0<br/>   <span class=\"kw3\">type</span> Extended_Rank <span class=\"kw1\">is</span> <span class=\"kw3\">range</span> <span class=\"nu0\">0</span> .. <span class=\"nu0\">10</span>;<br/>   <span class=\"kw3\">subtype</span> Rank <span class=\"kw1\">is</span> Extended_Rank <span class=\"kw3\">range</span> <span class=\"nu0\">1</span> .. <span class=\"me1\">Extended_Rank</span>'Last;<br/>\u00a0<br/>   <span class=\"kw3\">type</span> His_Rank <span class=\"kw1\">is</span> <span class=\"kw3\">array</span> <span class=\"br0\">(</span>Rank<span class=\"br0\">)</span> <span class=\"kw3\">of</span> Girl;<br/>   <span class=\"kw3\">type</span> He_Prefers <span class=\"kw1\">is</span> <span class=\"kw3\">array</span> <span class=\"br0\">(</span>Guy<span class=\"br0\">)</span> <span class=\"kw3\">of</span> His_Rank;<br/>\u00a0<br/>   Guys_Like\u00a0: <span class=\"kw3\">constant</span> He_Prefers\u00a0:= He_Prefers'<span class=\"br0\">(</span><br/>     abe  =&gt; His_Rank'<span class=\"br0\">(</span>abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay<span class=\"br0\">)</span>,<br/>     bob  =&gt; His_Rank'<span class=\"br0\">(</span>cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay<span class=\"br0\">)</span>,<br/>     col  =&gt; His_Rank'<span class=\"br0\">(</span>hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan<span class=\"br0\">)</span>,<br/>     dan  =&gt; His_Rank'<span class=\"br0\">(</span>ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi<span class=\"br0\">)</span>,<br/>     ed   =&gt; His_Rank'<span class=\"br0\">(</span>jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay<span class=\"br0\">)</span>,<br/>     fred =&gt; His_Rank'<span class=\"br0\">(</span>bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay<span class=\"br0\">)</span>,<br/>     gav  =&gt; His_Rank'<span class=\"br0\">(</span>gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay<span class=\"br0\">)</span>,<br/>     hal  =&gt; His_Rank'<span class=\"br0\">(</span>abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee<span class=\"br0\">)</span>,<br/>     ian  =&gt; His_Rank'<span class=\"br0\">(</span>hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve<span class=\"br0\">)</span>,<br/>     jon  =&gt; His_Rank'<span class=\"br0\">(</span>abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope<span class=\"br0\">)</span><span class=\"br0\">)</span>;<br/>\u00a0<br/>   <span class=\"kw3\">type</span> Her_Rank <span class=\"kw1\">is</span> <span class=\"kw3\">array</span><span class=\"br0\">(</span>Rank<span class=\"br0\">)</span> <span class=\"kw3\">of</span> Guy;<br/>   <span class=\"kw3\">type</span> She_Prefers <span class=\"kw1\">is</span> <span class=\"kw3\">array</span> <span class=\"br0\">(</span>Girl<span class=\"br0\">)</span> <span class=\"kw3\">of</span> Her_Rank;<br/>\u00a0<br/>   Girls_Like\u00a0: <span class=\"kw3\">constant</span> She_Prefers\u00a0:= She_Prefers'<span class=\"br0\">(</span><br/>     abi  =&gt; Her_Rank'<span class=\"br0\">(</span>bob, fred, jon, gav, ian, abe, dan, ed, col, hal<span class=\"br0\">)</span>,<br/>     bea  =&gt; Her_Rank'<span class=\"br0\">(</span>bob, abe, col, fred, gav, dan, ian, ed, jon, hal<span class=\"br0\">)</span>,<br/>     cath =&gt; Her_Rank'<span class=\"br0\">(</span>fred, bob, ed, gav, hal, col, ian, abe, dan, jon<span class=\"br0\">)</span>,<br/>     dee  =&gt; Her_Rank'<span class=\"br0\">(</span>fred, jon, col, abe, ian, hal, gav, dan, bob, ed<span class=\"br0\">)</span>,<br/>     eve  =&gt; Her_Rank'<span class=\"br0\">(</span>jon, hal, fred, dan, abe, gav, col, ed, ian, bob<span class=\"br0\">)</span>,<br/>     fay  =&gt; Her_Rank'<span class=\"br0\">(</span>bob, abe, ed, ian, jon, dan, fred, gav, col, hal<span class=\"br0\">)</span>,<br/>     gay  =&gt; Her_Rank'<span class=\"br0\">(</span>jon, gav, hal, fred, bob, abe, col, ed, dan, ian<span class=\"br0\">)</span>,<br/>     hope =&gt; Her_Rank'<span class=\"br0\">(</span>gav, jon, bob, abe, ian, dan, hal, ed, col, fred<span class=\"br0\">)</span>,<br/>     ivy  =&gt; Her_Rank'<span class=\"br0\">(</span>ian, col, hal, gav, fred, bob, abe, ed, jon, dan<span class=\"br0\">)</span>,<br/>     jan  =&gt; Her_Rank'<span class=\"br0\">(</span>ed, hal, gav, abe, bob, jon, col, ian, fred, dan<span class=\"br0\">)</span><span class=\"br0\">)</span>;<br/>\u00a0<br/><span class=\"kw1\">end</span> Preferences;<br/>\u00a0</pre>"}, {"lang": "Swift", "loc": 138, "block": "<pre class=\"text highlighted_source\">class Person {<br/>    let name:String<br/>    var candidateIndex = 0<br/>    var fiance:Person?<br/>    var candidates = [Person]()<br/>\u00a0<br/>    init(name:String) {<br/>        self.name = name<br/>    }<br/>\u00a0<br/>    func rank(p:Person) -&gt; Int {<br/>        for (i, candidate) in enumerate(self.candidates) {<br/>            if candidate === p {<br/>                return i<br/>            }<br/>        }<br/>        return self.candidates.count + 1<br/>    }<br/>\u00a0<br/>    func prefers(p:Person) -&gt; Bool {<br/>        if let fiance = self.fiance {<br/>            return self.rank(p) &lt; self.rank(fiance)<br/>        }<br/>        return false<br/>    }<br/>\u00a0<br/>    func nextCandidate() -&gt; Person? {<br/>        if self.candidateIndex &gt;= self.candidates.count {<br/>            return nil<br/>        }<br/>        return self.candidates[candidateIndex++]<br/>    }<br/>\u00a0<br/>    func engageTo(p:Person) {<br/>        p.fiance?.fiance = nil<br/>        p.fiance = self<br/>        self.fiance?.fiance = nil<br/>        self.fiance = p<br/>    }<br/>\u00a0<br/>    func swapWith(p:Person) {<br/>        let thisFiance = self.fiance<br/>        let pFiance = p.fiance<br/>        println(\"\\(self.name) swapped partners with \\(p.name)\")<br/>        if pFiance\u00a0!= nil &amp;&amp; thisFiance\u00a0!= nil {<br/>            self.engageTo(pFiance!)<br/>            p.engageTo(thisFiance!)<br/>        }<br/>    }<br/>}<br/>\u00a0<br/>func isStable(guys:[Person], gals:[Person]) -&gt; Bool {<br/>    for guy in guys {<br/>        for gal in gals {<br/>            if guy.prefers(gal) &amp;&amp; gal.prefers(guy) {<br/>                return false<br/>            }<br/>        }<br/>    }<br/>    return true<br/>}<br/>\u00a0<br/>func engageEveryone(guys:[Person]) {<br/>    var done = false<br/>    while\u00a0!done {<br/>        done = true<br/>        for guy in guys {<br/>            if guy.fiance == nil {<br/>                done = false<br/>                if let gal = guy.nextCandidate() {<br/>                    if gal.fiance == nil || gal.prefers(guy) {<br/>                        guy.engageTo(gal)<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    }<br/>}<br/>\u00a0<br/>func doMarriage() {<br/>    let abe  = Person(name: \"Abe\")<br/>    let bob  = Person(name: \"Bob\")<br/>    let col  = Person(name: \"Col\")<br/>    let dan  = Person(name: \"Dan\")<br/>    let ed   = Person(name: \"Ed\")<br/>    let fred = Person(name: \"Fred\")<br/>    let gav  = Person(name: \"Gav\")<br/>    let hal  = Person(name: \"Hal\")<br/>    let ian  = Person(name: \"Ian\")<br/>    let jon  = Person(name: \"Jon\")<br/>    let abi  = Person(name: \"Abi\")<br/>    let bea  = Person(name: \"Bea\")<br/>    let cath = Person(name: \"Cath\")<br/>    let dee  = Person(name: \"Dee\")<br/>    let eve  = Person(name: \"Eve\")<br/>    let fay  = Person(name: \"Fay\")<br/>    let gay  = Person(name: \"Gay\")<br/>    let hope = Person(name: \"Hope\")<br/>    let ivy  = Person(name: \"Ivy\")<br/>    let jan  = Person(name: \"Jan\")<br/>\u00a0<br/>    abe.candidates  = [abi, eve, cath, ivy, jan, dee, fay, bea, hope, gay]<br/>    bob.candidates  = [cath, hope, abi, dee, eve, fay, bea, jan, ivy, gay]<br/>    col.candidates  = [hope, eve, abi, dee, bea, fay, ivy, gay, cath, jan]<br/>    dan.candidates  = [ivy, fay, dee, gay, hope, eve, jan, bea, cath, abi]<br/>    ed.candidates   = [jan, dee, bea, cath, fay, eve, abi, ivy, hope, gay]<br/>    fred.candidates = [bea, abi, dee, gay, eve, ivy, cath, jan, hope, fay]<br/>    gav.candidates  = [gay, eve, ivy, bea, cath, abi, dee, hope, jan, fay]<br/>    hal.candidates  = [abi, eve, hope, fay, ivy, cath, jan, bea, gay, dee]<br/>    ian.candidates  = [hope, cath, dee, gay, bea, abi, fay, ivy, jan, eve]<br/>    jon.candidates  = [abi, fay, jan, gay, eve, bea, dee, cath, ivy, hope]<br/>    abi.candidates  = [bob, fred, jon, gav, ian, abe, dan, ed, col, hal]<br/>    bea.candidates  = [bob, abe, col, fred, gav, dan, ian, ed, jon, hal]<br/>    cath.candidates = [fred, bob, ed, gav, hal, col, ian, abe, dan, jon]<br/>    dee.candidates  = [fred, jon, col, abe, ian, hal, gav, dan, bob, ed]<br/>    eve.candidates  = [jon, hal, fred, dan, abe, gav, col, ed, ian, bob]<br/>    fay.candidates  = [bob, abe, ed, ian, jon, dan, fred, gav, col, hal]<br/>    gay.candidates  = [jon, gav, hal, fred, bob, abe, col, ed, dan, ian]<br/>    hope.candidates = [gav, jon, bob, abe, ian, dan, hal, ed, col, fred]<br/>    ivy.candidates  = [ian, col, hal, gav, fred, bob, abe, ed, jon, dan]<br/>    jan.candidates  = [ed, hal, gav, abe, bob, jon, col, ian, fred, dan]<br/>\u00a0<br/>    let guys = [abe, bob, col, dan, ed, fred, gav, hal, ian, jon]<br/>    let gals = [abi, bea, cath, dee, eve, fay, gay, hope, ivy, jan]<br/>\u00a0<br/>    engageEveryone(guys)<br/>\u00a0<br/>    for guy in guys {<br/>        println(\"\\(guy.name) is engaged to \\(guy.fiance!.name)\")<br/>    }<br/>\u00a0<br/>    println(\"Stable = \\(isStable(guys, gals))\")<br/>    jon.swapWith(fred)<br/>    println(\"Stable = \\(isStable(guys, gals))\")<br/>\u00a0<br/>}<br/>\u00a0<br/>doMarriage()</pre>"}, {"lang": "Tcl", "loc": 116, "block": "<pre class=\"tcl highlighted_source\"><span class=\"kw2\">package</span> require Tcl <span class=\"nu0\">8.5</span><br/>\u00a0<br/><span class=\"co1\"># Functions as aliases to standard commands</span><br/><span class=\"kw2\">interp</span> alias <span class=\"br0\">{</span><span class=\"br0\">}</span> tcl::<span class=\"me1\">mathfunc</span>::<span class=\"me1\">pos</span> <span class=\"br0\">{</span><span class=\"br0\">}</span>\u00a0::<span class=\"kw2\">lsearch</span> -exact<br/><span class=\"kw2\">interp</span> alias <span class=\"br0\">{</span><span class=\"br0\">}</span> tcl::<span class=\"me1\">mathfunc</span>::<span class=\"me1\">nonempty</span> <span class=\"br0\">{</span><span class=\"br0\">}</span>\u00a0::<span class=\"kw2\">llength</span><br/>\u00a0<br/><span class=\"co1\"># The stability check</span><br/><span class=\"kw1\">proc</span> check engaged <span class=\"br0\">{</span><br/>    <span class=\"kw1\">global</span> preferences<br/>    <span class=\"kw1\">set</span> inverse <span class=\"br0\">[</span>lreverse <span class=\"re0\">$engaged</span><span class=\"br0\">]</span><br/>    <span class=\"kw1\">set</span> errmsg <span class=\"st0\">\"%s and\u00a0%s like each other better than their present partners,<span class=\"es0\">\\</span><br/>\t   \u00a0%s and\u00a0%s respectively\"</span><br/>    dict <span class=\"kw1\">for</span> <span class=\"br0\">{</span>she he<span class=\"br0\">}</span> <span class=\"re0\">$engaged</span> <span class=\"br0\">{</span><br/>\t<span class=\"kw1\">set</span> shelikes <span class=\"br0\">[</span>dict get <span class=\"re0\">$preferences</span> <span class=\"re0\">$she</span><span class=\"br0\">]</span><br/>\t<span class=\"kw1\">set</span> shelikesbetter <span class=\"br0\">[</span><span class=\"kw2\">lrange</span> <span class=\"re0\">$shelikes</span> <span class=\"nu0\">0</span> <span class=\"br0\">[</span><span class=\"kw1\">expr</span> <span class=\"br0\">{</span>pos<span class=\"br0\">(</span><span class=\"re0\">$shelikes</span>,<span class=\"re0\">$he</span><span class=\"br0\">)</span><span class=\"br0\">}</span><span class=\"br0\">]</span><span class=\"br0\">]</span><br/>\t<span class=\"kw1\">set</span> helikes <span class=\"br0\">[</span>dict get <span class=\"re0\">$preferences</span> <span class=\"re0\">$he</span><span class=\"br0\">]</span><br/>\t<span class=\"kw1\">set</span> helikesbetter <span class=\"br0\">[</span><span class=\"kw2\">lrange</span> <span class=\"re0\">$helikes</span> <span class=\"nu0\">0</span> <span class=\"br0\">[</span><span class=\"kw1\">expr</span> <span class=\"br0\">{</span>pos<span class=\"br0\">(</span><span class=\"re0\">$helikes</span>,<span class=\"re0\">$she</span><span class=\"br0\">)</span><span class=\"br0\">}</span><span class=\"br0\">]</span><span class=\"br0\">]</span><br/>\t<span class=\"kw1\">foreach</span> guy <span class=\"re0\">$shelikesbetter</span> <span class=\"br0\">{</span><br/>\t    <span class=\"kw1\">set</span> guysgirl <span class=\"br0\">[</span>dict get <span class=\"re0\">$inverse</span> <span class=\"re0\">$guy</span><span class=\"br0\">]</span><br/>\t    <span class=\"kw1\">set</span> guylikes <span class=\"br0\">[</span>dict get <span class=\"re0\">$preferences</span> <span class=\"re0\">$guy</span><span class=\"br0\">]</span><br/>\t    <span class=\"kw1\">if</span> <span class=\"br0\">{</span>pos<span class=\"br0\">(</span><span class=\"re0\">$guylikes</span>,<span class=\"re0\">$guysgirl</span><span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> pos<span class=\"br0\">(</span><span class=\"re0\">$guylikes</span>,<span class=\"re0\">$she</span><span class=\"br0\">)</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>\t\t<span class=\"kw2\">puts</span> <span class=\"br0\">[</span><span class=\"kw2\">format</span> <span class=\"re0\">$errmsg</span> <span class=\"re0\">$she</span> <span class=\"re0\">$guy</span> <span class=\"re0\">$he</span> <span class=\"re0\">$guysgirl</span><span class=\"br0\">]</span><br/>\t\t<span class=\"kw1\">return</span> <span class=\"nu0\">0</span><br/>\t    <span class=\"br0\">}</span><br/>\t<span class=\"br0\">}</span><br/>\t<span class=\"kw1\">foreach</span> gal <span class=\"re0\">$helikesbetter</span> <span class=\"br0\">{</span><br/>\t    <span class=\"kw1\">set</span> galsguy <span class=\"br0\">[</span>dict get <span class=\"re0\">$engaged</span> <span class=\"re0\">$gal</span><span class=\"br0\">]</span><br/>\t    <span class=\"kw1\">set</span> gallikes <span class=\"br0\">[</span>dict get <span class=\"re0\">$preferences</span> <span class=\"re0\">$gal</span><span class=\"br0\">]</span><br/>\t    <span class=\"kw1\">if</span> <span class=\"br0\">{</span>pos<span class=\"br0\">(</span><span class=\"re0\">$gallikes</span>,<span class=\"re0\">$galsguy</span><span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> pos<span class=\"br0\">(</span><span class=\"re0\">$gallikes</span>,<span class=\"re0\">$he</span><span class=\"br0\">)</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>\t\t<span class=\"kw2\">puts</span> <span class=\"br0\">[</span><span class=\"kw2\">format</span> <span class=\"re0\">$errmsg</span> <span class=\"re0\">$he</span> <span class=\"re0\">$gal</span> <span class=\"re0\">$she</span> <span class=\"re0\">$galsguy</span><span class=\"br0\">]</span><br/>\t\t<span class=\"kw1\">return</span> <span class=\"nu0\">0</span><br/>\t    <span class=\"br0\">}</span><br/>\t<span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> <span class=\"nu0\">1</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co1\"># The match-making algorithm</span><br/><span class=\"kw1\">proc</span> matchmaker <span class=\"br0\">{</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>    <span class=\"kw1\">global</span> guys gals preferences<br/>    <span class=\"kw1\">set</span> guysfree <span class=\"re0\">$guys</span><br/>    <span class=\"kw1\">set</span> engaged <span class=\"br0\">{</span><span class=\"br0\">}</span><br/>    array <span class=\"kw1\">set</span> p <span class=\"re0\">$preferences</span><br/>    <span class=\"kw1\">while</span> <span class=\"br0\">{</span>nonempty<span class=\"br0\">(</span><span class=\"re0\">$guysfree</span><span class=\"br0\">)</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>\t<span class=\"kw1\">set</span> guysfree <span class=\"br0\">[</span>lassign <span class=\"re0\">$guysfree</span> guy<span class=\"br0\">]</span><br/>\t<span class=\"kw1\">set</span> p<span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"br0\">)</span> <span class=\"br0\">[</span><span class=\"kw1\">set</span> guyslist <span class=\"br0\">[</span>lassign <span class=\"re0\">$p</span><span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"br0\">)</span> gal<span class=\"br0\">]</span><span class=\"br0\">]</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">{</span><span class=\"sy0\">!</span><span class=\"br0\">[</span>dict exists <span class=\"re0\">$engaged</span> <span class=\"re0\">$gal</span><span class=\"br0\">]</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>\t    <span class=\"co1\"># She's free</span><br/>\t    dict <span class=\"kw1\">set</span> engaged <span class=\"re0\">$gal</span> <span class=\"re0\">$guy</span><br/>\t    <span class=\"kw2\">puts</span> <span class=\"st0\">\"  $guy and $gal\"</span><br/>\t    <span class=\"kw1\">continue</span><br/>\t<span class=\"br0\">}</span><br/>\t<span class=\"co1\"># The bounder proposes to an engaged lass!</span><br/>\t<span class=\"kw1\">set</span> fiance <span class=\"br0\">[</span>dict get <span class=\"re0\">$engaged</span> <span class=\"re0\">$gal</span><span class=\"br0\">]</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">{</span>pos<span class=\"br0\">(</span><span class=\"re0\">$p</span><span class=\"br0\">(</span><span class=\"re0\">$gal</span><span class=\"br0\">)</span>, <span class=\"re0\">$fiance</span><span class=\"br0\">)</span> <span class=\"sy0\">&gt;</span> pos<span class=\"br0\">(</span><span class=\"re0\">$p</span><span class=\"br0\">(</span><span class=\"re0\">$gal</span><span class=\"br0\">)</span>, <span class=\"re0\">$guy</span><span class=\"br0\">)</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>\t    <span class=\"co1\"># She prefers the new guy</span><br/>\t    dict <span class=\"kw1\">set</span> engaged <span class=\"re0\">$gal</span> <span class=\"re0\">$guy</span><br/>\t    <span class=\"kw2\">puts</span> <span class=\"st0\">\"  $gal dumped $fiance for $guy\"</span><br/>\t    <span class=\"kw1\">set</span> guy <span class=\"re0\">$fiance</span><br/>\t<span class=\"br0\">}</span><br/>\t<span class=\"kw1\">if</span> <span class=\"br0\">{</span>nonempty<span class=\"br0\">(</span><span class=\"re0\">$p</span><span class=\"br0\">(</span><span class=\"re0\">$guy</span><span class=\"br0\">)</span><span class=\"br0\">)</span><span class=\"br0\">}</span> <span class=\"br0\">{</span><br/>\t    <span class=\"kw2\">lappend</span> guysfree <span class=\"re0\">$guy</span><br/>\t<span class=\"br0\">}</span><br/>    <span class=\"br0\">}</span><br/>    <span class=\"kw1\">return</span> <span class=\"re0\">$engaged</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co1\"># Problem dataset; preferences unified since all names distinct</span><br/><span class=\"kw1\">set</span> guys <span class=\"br0\">{</span>abe bob col  dan ed  fred gav hal  ian jon<span class=\"br0\">}</span><br/><span class=\"kw1\">set</span> gals <span class=\"br0\">{</span>abi bea cath dee eve fay  gay hope ivy jan<span class=\"br0\">}</span><br/><span class=\"kw1\">set</span> preferences <span class=\"br0\">{</span><br/>    abe  <span class=\"br0\">{</span>abi  eve  cath ivy  jan  dee  fay  bea  hope gay<span class=\"br0\">}</span><br/>    bob  <span class=\"br0\">{</span>cath hope abi  dee  eve  fay  bea  jan  ivy  gay<span class=\"br0\">}</span><br/>    col  <span class=\"br0\">{</span>hope eve  abi  dee  bea  fay  ivy  gay  cath jan<span class=\"br0\">}</span><br/>    dan  <span class=\"br0\">{</span>ivy  fay  dee  gay  hope eve  jan  bea  cath abi<span class=\"br0\">}</span><br/>    ed   <span class=\"br0\">{</span>jan  dee  bea  cath fay  eve  abi  ivy  hope gay<span class=\"br0\">}</span><br/>    fred <span class=\"br0\">{</span>bea  abi  dee  gay  eve  ivy  cath jan  hope fay<span class=\"br0\">}</span><br/>    gav  <span class=\"br0\">{</span>gay  eve  ivy  bea  cath abi  dee  hope jan  fay<span class=\"br0\">}</span><br/>    hal  <span class=\"br0\">{</span>abi  eve  hope fay  ivy  cath jan  bea  gay  dee<span class=\"br0\">}</span><br/>    ian  <span class=\"br0\">{</span>hope cath dee  gay  bea  abi  fay  ivy  jan  eve<span class=\"br0\">}</span><br/>    jon  <span class=\"br0\">{</span>abi  fay  jan  gay  eve  bea  dee  cath ivy  hope<span class=\"br0\">}</span><br/>\u00a0<br/>    abi  <span class=\"br0\">{</span>bob  fred jon  gav  ian  abe dan  ed  col  hal<span class=\"br0\">}</span><br/>    bea  <span class=\"br0\">{</span>bob  abe  col  fred gav  dan ian  ed  jon  hal<span class=\"br0\">}</span><br/>    cath <span class=\"br0\">{</span>fred bob  ed   gav  hal  col ian  abe dan  jon<span class=\"br0\">}</span><br/>    dee  <span class=\"br0\">{</span>fred jon  col  abe  ian  hal gav  dan bob  ed<span class=\"br0\">}</span><br/>    eve  <span class=\"br0\">{</span>jon  hal  fred dan  abe  gav col  ed  ian  bob<span class=\"br0\">}</span><br/>    fay  <span class=\"br0\">{</span>bob  abe  ed   ian  jon  dan fred gav col  hal<span class=\"br0\">}</span><br/>    gay  <span class=\"br0\">{</span>jon  gav  hal  fred bob  abe col  ed  dan  ian<span class=\"br0\">}</span><br/>    hope <span class=\"br0\">{</span>gav  jon  bob  abe  ian  dan hal  ed  col  fred<span class=\"br0\">}</span><br/>    ivy  <span class=\"br0\">{</span>ian  col  hal  gav  fred bob abe  ed  jon  dan<span class=\"br0\">}</span><br/>    jan  <span class=\"br0\">{</span>ed   hal  gav  abe  bob  jon col  ian fred dan<span class=\"br0\">}</span><br/><span class=\"br0\">}</span><br/>\u00a0<br/><span class=\"co1\"># The demonstration code</span><br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"Engagements:\"</span><br/><span class=\"kw1\">set</span> engaged <span class=\"br0\">[</span>matchmaker<span class=\"br0\">]</span><br/>\u00a0<br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"<span class=\"es0\">\\n</span>Couples:\"</span><br/><span class=\"kw1\">set</span> pfx <span class=\"st0\">\"\"</span><br/><span class=\"kw1\">foreach</span> gal <span class=\"re0\">$gals</span> <span class=\"br0\">{</span><br/>    <span class=\"kw2\">puts</span> -nonewline <span class=\"st0\">\"$pfx  $gal is engaged to [dict get $engaged $gal]\"</span><br/>    <span class=\"kw1\">set</span> pfx <span class=\"st0\">\",<span class=\"es0\">\\n</span>\"</span><br/><span class=\"br0\">}</span><br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"<span class=\"es0\">\\n</span>\"</span><br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"Engagement stability check [lindex {FAILED PASSED} [check $engaged]]\"</span><br/>\u00a0<br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"<span class=\"es0\">\\n</span><span class=\"es0\">\\n</span>Swapping two fiances to introduce an error\"</span><br/><span class=\"kw1\">set</span> tmp <span class=\"br0\">[</span>dict get <span class=\"re0\">$engaged</span> <span class=\"br0\">[</span><span class=\"kw2\">lindex</span> <span class=\"re0\">$gals</span> <span class=\"nu0\">0</span><span class=\"br0\">]</span><span class=\"br0\">]</span><br/>dict <span class=\"kw1\">set</span> engaged <span class=\"br0\">[</span><span class=\"kw2\">lindex</span> <span class=\"re0\">$gals</span> <span class=\"nu0\">0</span><span class=\"br0\">]</span> <span class=\"br0\">[</span>dict get <span class=\"re0\">$engaged</span> <span class=\"br0\">[</span><span class=\"kw2\">lindex</span> <span class=\"re0\">$gals</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span><span class=\"br0\">]</span><br/>dict <span class=\"kw1\">set</span> engaged <span class=\"br0\">[</span><span class=\"kw2\">lindex</span> <span class=\"re0\">$gals</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span> <span class=\"re0\">$tmp</span><br/><span class=\"kw1\">foreach</span> gal <span class=\"br0\">[</span><span class=\"kw2\">lrange</span> <span class=\"re0\">$gals</span> <span class=\"nu0\">0</span> <span class=\"nu0\">1</span><span class=\"br0\">]</span> <span class=\"br0\">{</span><br/>    <span class=\"kw2\">puts</span> <span class=\"st0\">\"  $gal is now engaged to [dict get $engaged $gal]\"</span><br/><span class=\"br0\">}</span><br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"\"</span><br/><span class=\"kw2\">puts</span> <span class=\"st0\">\"Engagement stability check [lindex {FAILED PASSED} [check $engaged]]\"</span></pre>"}, {"lang": "UNIX Shell", "loc": 167, "block": "<pre class=\"text highlighted_source\">#!/usr/bin/env bash<br/>main() {<br/>  # Our ten males:<br/>  local males=(abe bob col dan ed fred gav hal ian jon)<br/>\u00a0<br/>  # And ten females:<br/>  local females=(abi bea cath dee eve fay gay hope ivy jan)<br/>\u00a0<br/>  # Everyone's preferences, ranked most to least desirable:<br/>  local  abe=( abi  eve  cath ivy  jan  dee  fay  bea  hope gay )<br/>  local  abi=( bob  fred jon  gav  ian  abe  dan  ed   col  hal )<br/>  local  bea=( bob  abe  col  fred gav  dan  ian  ed   jon  hal )<br/>  local  bob=(cath  hope abi  dee  eve  fay  bea  jan  ivy  gay )<br/>  local cath=(fred  bob  ed   gav  hal  col  ian  abe  dan  jon )<br/>  local  col=(hope  eve  abi  dee  bea  fay  ivy  gay  cath jan )<br/>  local  dan=( ivy  fay  dee  gay  hope eve  jan  bea  cath abi )<br/>  local  dee=(fred  jon  col  abe  ian  hal  gav  dan  bob  ed  )<br/>  local   ed=( jan  dee  bea  cath fay  eve  abi  ivy  hope gay )<br/>  local  eve=( jon  hal  fred dan  abe  gav  col  ed   ian  bob )<br/>  local  fay=( bob  abe  ed   ian  jon  dan  fred gav  col  hal )<br/>  local fred=( bea  abi  dee  gay  eve  ivy  cath jan  hope fay )<br/>  local  gav=( gay  eve  ivy  bea  cath abi  dee  hope jan  fay )<br/>  local  gay=( jon  gav  hal  fred bob  abe  col  ed   dan  ian )<br/>  local  hal=( abi  eve  hope fay  ivy  cath jan  bea  gay  dee )<br/>  local hope=( gav  jon  bob  abe  ian  dan  hal  ed   col  fred)<br/>  local  ian=(hope  cath dee  gay  bea  abi  fay  ivy  jan  eve )<br/>  local  ivy=( ian  col  hal  gav  fred bob  abe  ed   jon  dan )<br/>  local  jan=( ed   hal  gav  abe  bob  jon  col  ian  fred dan )<br/>  local  jon=( abi  fay  jan  gay  eve  bea  dee  cath ivy  hope)<br/>\u00a0<br/>  # A place to store the engagements:<br/>  local -A engagements=()<br/>\u00a0<br/>  # Our list of free males, initially comprised of all of them:<br/>  local freemales=( \"${males[@]}\" )<br/>\u00a0<br/>  # Now we use the Gale-Shapley algorithm to find a stable set of engagements<br/>\u00a0<br/>  # Loop over the free males. Note that we can't use for..in because the body<br/>  # of the loop may modify the array we're looping over<br/>  local -i m=0<br/>  while (( m &lt; ${#freemales[@]} )); do<br/>    local male=${freemales[m]}<br/>    let m+=1<br/>\u00a0<br/>    # This guy's preferences<br/>    eval 'local his=(\"${'\"$male\"'[@]}\")'<br/>\u00a0<br/>    # Starting with his favorite<br/>    local -i f=0<br/>    local female=${his[f]}<br/>\u00a0<br/>    # Find her preferences<br/>    eval 'local hers=(\"${'\"$female\"'[@]}\")'<br/>\u00a0<br/>    # And her current fianc\u00e9, if any<br/>    local fiance=${engagements[$female]}<br/>\u00a0<br/>    # If she has a fianc\u00e9 and prefers him to this guy, look for this guy's next<br/>    # best choice<br/>    while [[ -n $fiance ]] &amp;&amp; <br/>      (( $(index \"$male\" \"${hers[@]}\") &gt; $(index \"$fiance\" \"${hers[@]}\") )); do<br/>      let f+=1<br/>      female=${his[f]}<br/>      eval 'hers=(\"${'\"$female\"'[@]}\")'<br/>      fiance=${engagements[$female]}<br/>    done<br/>\u00a0<br/>    # If we're still on someone who's engaged, it means she prefers this guy<br/>    # to her current fianc\u00e9. Dump him and put him at the end of the free list.<br/>    if [[ -n $fiance ]]; then<br/>      freemales+=(\"$fiance\")<br/>      printf '%-4s rejected\u00a0%-4s\\n' \"$female\" \"$fiance\"<br/>    fi<br/>\u00a0<br/>    # We found a match! Record it<br/>    engagements[$female]=$male<br/>    printf '%-4s accepted\u00a0%-4s\\n' \"$female\" \"$male\"<br/>  done<br/>\u00a0<br/>  # Display the final result, which should be stable<br/>  print_couples engagements<br/>\u00a0<br/>  # Verify its stability<br/>  print_stable engagements \"${females[@]}\"<br/>\u00a0<br/>  # Try a swap <br/>  printf '\\nWhat if cath and ivy swap partners?\\n'<br/>  local temp=${engagements[cath]}<br/>  engagements[cath]=${engagements[ivy]}<br/>  engagements[ivy]=$temp<br/>\u00a0<br/>  # Display the new result, which should be unstable<br/>  print_couples engagements<br/>\u00a0<br/>  # Verify its instability<br/>  print_stable engagements \"${females[@]}\"<br/>}<br/>\u00a0<br/># utility function - get index of an item in an array<br/>index() {<br/>  local needle=$1<br/>  shift<br/>  local haystack=(\"<a class=\"__cf_email__\" data-cfemail=\"173357\" href=\"/cdn-cgi/l/email-protection\">[email\u00a0protected]</a>\")<br/>  local -i i<br/>  for i in \"${!haystack[@]}\"; do<br/>    if [[ ${haystack[i]} == $needle ]]; then<br/>      printf '%d\\n' \"$i\"<br/>      return 0<br/>    fi<br/>  done<br/>  return 1<br/>}<br/>\u00a0<br/># print the couples from the engagement array; takes name of array as argument<br/>print_couples() {<br/>  printf '\\nCouples:\\n'<br/>  local keys<br/>  mapfile -t keys &lt; &lt;(eval 'printf '\\''%s\\n'\\'' \"${!'\"$1\"'[@]}\"' | sort)<br/>  local female<br/>  for female in \"${keys[@]}\"; do<br/>    eval 'local male=${'\"$1\"'[\"'\"$female\"'\"]}'<br/>    printf '%-4s is engaged to\u00a0%-4s\\n' \"$female\" \"$male\"<br/>  done<br/>  printf '\\n'<br/>}<br/>\u00a0<br/># print whether a set of engagements is stable; takes name of engagement array<br/># followed by the list of females<br/>print_stable() {<br/>  if stable \"<a class=\"__cf_email__\" data-cfemail=\"85a1c5\" href=\"/cdn-cgi/l/email-protection\">[email\u00a0protected]</a>\"; then<br/>    printf 'These couples are stable.\\n'<br/>  else<br/>    printf 'These couples are not stable.\\n'<br/>  fi<br/>}<br/>\u00a0<br/># determine if a set of engagements is stable; takes name of engagement array<br/># followed by the list of females<br/>stable() {<br/>  local dict=$1 <br/>  shift<br/>  eval 'local shes=(\"${!'\"$dict\"'[@]}\")'<br/>  eval 'local hes=(\"${'\"$dict\"'[@]}\")'<br/>  local -i i<br/>  local -i result=0<br/>  for (( i=0; i&lt;${#shes[@]}; ++i )); do<br/>    local she=${shes[i]} he=${hes[i]}<br/>    eval 'local his=(\"${'\"$he\"'[@]}\")'<br/>    local alt<br/>    for alt in \"<a class=\"__cf_email__\" data-cfemail=\"ac88ec\" href=\"/cdn-cgi/l/email-protection\">[email\u00a0protected]</a>\"; do<br/>      eval 'local fiance=${'\"$dict\"'[\"'\"$alt\"'\"]}'<br/>      eval 'local hers=(\"${'\"$alt\"'[@]}\")'<br/>      if (( $(index \"$she\" \"${his[@]}\") &gt; $(index \"$alt\" \"${his[@]}\") <br/>         &amp;&amp; $(index \"$fiance\" \"${hers[@]}\") &gt; $(index \"$he\" \"${hers[@]}\") ))<br/>       then<br/>        printf '%-4s is engaged to\u00a0%-4s but prefers\u00a0%4s, ' \"$he\" \"$she\" \"$alt\"<br/>        printf 'while\u00a0%-4s is engaged to\u00a0%-4s but prefers\u00a0%4s.\\n' \"$alt\" \"$fiance\" \"$he\"<br/>        result=1<br/>      fi<br/>    done<br/>  done<br/>  if (( result )); then printf '\\n'; fi<br/>  return $result<br/>}<br/>\u00a0<br/>main \"<a class=\"__cf_email__\" data-cfemail=\"1c385c\" href=\"/cdn-cgi/l/email-protection\">[email\u00a0protected]</a>\"</pre>"}, {"lang": "Ursala", "loc": 48, "block": "<pre class=\"text highlighted_source\">men =<br/>\u00a0<br/>{<br/>   'abe': &lt;'abi','eve','cath','ivy','jan','dee','fay','bea','hope','gay'&gt;,<br/>   'bob': &lt;'cath','hope','abi','dee','eve','fay','bea','jan','ivy','gay'&gt;,<br/>   'col': &lt;'hope','eve','abi','dee','bea','fay','ivy','gay','cath','jan'&gt;,<br/>   'dan': &lt;'ivy','fay','dee','gay','hope','eve','jan','bea','cath','abi'&gt;,<br/>   'ed': &lt;'jan','dee','bea','cath','fay','eve','abi','ivy','hope','gay'&gt;,<br/>   'fred': &lt;'bea','abi','dee','gay','eve','ivy','cath','jan','hope','fay'&gt;,<br/>   'gav': &lt;'gay','eve','ivy','bea','cath','abi','dee','hope','jan','fay'&gt;,<br/>   'hal': &lt;'abi','eve','hope','fay','ivy','cath','jan','bea','gay','dee'&gt;,<br/>   'ian': &lt;'hope','cath','dee','gay','bea','abi','fay','ivy','jan','eve'&gt;,<br/>   'jon': &lt;'abi','fay','jan','gay','eve','bea','dee','cath','ivy','hope'&gt;}<br/>\u00a0<br/>women =<br/>\u00a0<br/>{<br/>   'abi': &lt;'bob','fred','jon','gav','ian','abe','dan','ed','col','hal'&gt;,<br/>   'bea': &lt;'bob','abe','col','fred','gav','dan','ian','ed','jon','hal'&gt;,<br/>   'cath': &lt;'fred','bob','ed','gav','hal','col','ian','abe','dan','jon'&gt;,<br/>   'dee': &lt;'fred','jon','col','abe','ian','hal','gav','dan','bob','ed'&gt;,<br/>   'eve': &lt;'jon','hal','fred','dan','abe','gav','col','ed','ian','bob'&gt;,<br/>   'fay': &lt;'bob','abe','ed','ian','jon','dan','fred','gav','col','hal'&gt;,<br/>   'gay': &lt;'jon','gav','hal','fred','bob','abe','col','ed','dan','ian'&gt;,<br/>   'hope': &lt;'gav','jon','bob','abe','ian','dan','hal','ed','col','fred'&gt;,<br/>   'ivy': &lt;'ian','col','hal','gav','fred','bob','abe','ed','jon','dan'&gt;,<br/>   'jan': &lt;'ed','hal','gav','abe','bob','jon','col','ian','fred','dan'&gt;}<br/>\u00a0<br/>match = # finds a stable list of engagements from data as given above<br/>\u00a0<br/>-+<br/>   ^=rrmhPnXS ^/~&amp;l ^/~&amp;rl ^|DlrHSs/~&amp; ^TlK2hlPrSLPAS\\~&amp;r -+<br/>      ~&amp;lK2hlPrSXS,<br/>      *=rnmihBPK12D ~&amp;mmhPnXNCB^rnPrmPllSPcA\\~&amp;r ~&amp;<a class=\"__cf_email__\" data-cfemail=\"5e322c2c0e2904156f691e2c300e3206\" href=\"/cdn-cgi/l/email-protection\">[email\u00a0protected]</a>+-,<br/>   ^|rrPlrlPXX/~&amp; ^/~&amp;nNAS ^/~&amp;l+ ^|H\\~&amp;+ -:+ * ^|/~&amp; -&lt;+ \\/-=+ ~&amp;<a class=\"__cf_email__\" data-cfemail=\"2561766965516e1616\" href=\"/cdn-cgi/l/email-protection\">[email\u00a0protected]</a>+-<br/>\u00a0<br/>preferred = # finds non-couples that would prefer each other to their betrothed<br/>\u00a0<br/>~&amp;lSLPrSLrlXS2c^|DlrHS\\~&amp; ~~irlXX+ ^D/~&amp;l+ ^|H\\~&amp;+ -:+ *T ^|/~&amp; //~=;+ -~l;+ \\/~&amp;H<br/>\u00a0<br/>#cast\u00a0%sWLm<br/>\u00a0<br/>main = # stable, perturbed, and preferred alternatives to the perturbed<br/>\u00a0<br/>&lt;<br/>   'stable': match/men women,<br/>   'perturbed': ~&amp;lSrSxPp match/men women,<br/>   'preferred': preferred/(men,women) ~&amp;lSrSxPp match/men women&gt;</pre>"}, {"lang": "VBA", "loc": 1, "block": "<pre>2 methods will be shown here:\n1 - using basic VBA-features for strings\n2 - using the scripting.dictionary library</pre>"}, {"lang": "XSLT 2.0", "loc": 136, "block": "<pre class=\"text highlighted_source\">&lt;xsl:stylesheet version=\"2.0\"<br/>  xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" <br/>  xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" <br/>  xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" <br/>  xmlns:m=\"http://rosettacode.org/wiki/Stable_marriage_problem\"<br/>  xmlns:t=\"http://rosettacode.org/wiki/Stable_marriage_problem/temp\" <br/>  exclude-result-prefixes=\"xsl xs fn t m\"&gt;<br/>&lt;xsl:output indent=\"yes\" encoding=\"UTF-8\" omit-xml-declaration=\"yes\" /&gt;<br/>&lt;xsl:strip-space elements=\"*\" /&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"*\"&gt;<br/>  &lt;xsl:copy&gt;<br/>    &lt;xsl:apply-templates select=\"@*,node()\" /&gt;<br/>  &lt;/xsl:copy&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"@*|comment()|processing-instruction()\"&gt;<br/>  &lt;xsl:copy /&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"m:interest\" mode=\"match-making\"&gt;<br/>  &lt;m:engagement&gt;<br/>    &lt;m:dude name=\"{../@name}\" /&gt;&lt;m:maid name=\"{.}\" /&gt;<br/>  &lt;/m:engagement&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"m:dude\" mode=\"match-making\"&gt;<br/>  &lt;!-- 3. Reject suitors cross-off the maids that spurned them. --&gt;<br/>  &lt;xsl:param name=\"eliminations\" select=\"()\" /&gt;<br/>  &lt;m:dude name=\"{@name}\"&gt;<br/>\t&lt;xsl:copy-of select=\"for $b in @name return<br/>\t  m:interest[not(. = $eliminations[m:dude/@name=$b]/m:maid/@name)]\" /&gt;<br/>  &lt;/m:dude&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"*\" mode=\"perturbation\"&gt;<br/>  &lt;xsl:copy&gt;<br/>    &lt;xsl:apply-templates select=\"@*,node()\" mode=\"perturbation\"/&gt;<br/>  &lt;/xsl:copy&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"@*\" mode=\"perturbation\"&gt;<br/>  &lt;xsl:copy /&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"m:engagement[position() lt 3]/m:maid/@name\" mode=\"perturbation\"&gt;<br/>  &lt;!-- Swap maids 1 and 2. --&gt;<br/>  &lt;xsl:copy-of select=\"for $c in count(../../preceding-sibling::m:engagement)<br/>       return ../../../m:engagement[2 - $c]/m:maid/@name\" /&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template match=\"m:stable-marriage-problem\"&gt;<br/>  &lt;xsl:variable name=\"population\" select=\"m:dude|m:maid\" /&gt;<br/>  &lt;xsl:variable name=\"solution\"&gt;<br/>    &lt;xsl:call-template name=\"solve-it\"&gt;<br/>      &lt;xsl:with-param name=\"dudes\" select=\"m:dude\" /&gt;<br/>      &lt;xsl:with-param name=\"maids\" select=\"m:maid\" tunnel=\"yes\" /&gt; <br/>    &lt;/xsl:call-template&gt;<br/>  &lt;/xsl:variable&gt;<br/>  &lt;xsl:variable name=\"perturbed\"&gt;<br/>   &lt;xsl:apply-templates select=\"$solution/*\" mode=\"perturbation\" /&gt;<br/>  &lt;/xsl:variable&gt;<br/>  &lt;m:stable-marriage-problem-result&gt;<br/>    &lt;m:solution is-stable=\"{t:is-stable( $population, $solution/*)}\"&gt;<br/>\t  &lt;xsl:copy-of select=\"$solution/*\" /&gt;<br/>    &lt;/m:solution&gt;<br/>\t&lt;m:message&gt;Perturbing the matches! Swapping &lt;xsl:value-of select=\"$solution/*[1]/m:maid/@name\" /&gt; for &lt;xsl:value-of select=\"$solution/*[2]/m:maid/@name\" /&gt;&lt;/m:message&gt;<br/>\t&lt;m:message&gt;&lt;xsl:choose&gt;<br/>\t  &lt;xsl:when test=\"t:is-stable( $population, $perturbed/*)\"&gt;<br/>\t    &lt;xsl:text&gt;The perturbed configuration is stable.&lt;/xsl:text&gt;<br/>\t  &lt;/xsl:when&gt;<br/>\t    &lt;xsl:otherwise&gt;The perturbed configuration is unstable.&lt;/xsl:otherwise&gt;<br/>\t&lt;/xsl:choose&gt;&lt;/m:message&gt;<br/>  &lt;/m:stable-marriage-problem-result&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:template name=\"solve-it\"&gt;<br/>  &lt;xsl:param name=\"dudes\" as=\"element()*\" /&gt; &lt;!-- Sequence of m:dude --&gt;<br/>  &lt;xsl:param name=\"maids\" as=\"element()*\" tunnel=\"yes\" /&gt;  &lt;!-- Sequence of m:maid --&gt;<br/>  &lt;xsl:param name=\"engagements\" as=\"element()*\" select=\"()\" /&gt; &lt;!-- Sequence of m:engagement --&gt;<br/>\u00a0<br/>  &lt;!-- 1. For each dude not yet engaged, and has a preference, propose to his top preference. --&gt;<br/>  &lt;xsl:variable name=\"fresh-proposals\"&gt;<br/>    &lt;xsl:apply-templates select=\"$dudes[not(@name = $engagements/m:dude/@name)]/m:interest[1]\" mode=\"match-making\" /&gt;<br/>  &lt;/xsl:variable&gt;<br/>  &lt;xsl:variable name=\"proposals\" select=\"$engagements | $fresh-proposals/m:engagement\" /&gt;<br/>\u00a0<br/>  &lt;!-- 2. For each maid with conflicting suitors, reject all but the most attractive (for her) proposal. --&gt;<br/>  &lt;xsl:variable name=\"acceptable\" select=\"$proposals[<br/>    for $g in m:maid/@name, $b in m:dude/@name, $this-interest in $maids[@name=$g]/m:interest[.=$b]<br/>\t  return every<br/>\t      $interest<br/>\t\tin<br/>\t\t  for $other-b in $proposals[m:maid[@name=$g]]/m:dude/@name[. ne $b]<br/>\t\t    return $maids[@name=$g]/m:interest[.=$other-b]<br/>\t\tsatisfies<br/>\t\t  $interest &gt;&gt; $this-interest<br/>    ]\" /&gt;<br/>\u00a0<br/>  &lt;!-- 3. Reject suitors cross-off the maids that spurned them. --&gt;<br/>  &lt;xsl:variable name=\"new-dudes\"&gt;<br/>    &lt;xsl:apply-templates select=\"$dudes\" mode=\"match-making\"&gt;<br/>      &lt;xsl:with-param name=\"eliminations\" select=\"$fresh-proposals/m:engagement\" /&gt;<br/>    &lt;/xsl:apply-templates&gt;<br/>  &lt;/xsl:variable&gt;<br/>\u00a0<br/>  &lt;!-- 4. Test for finish. If not, loop back for another round of proposals. --&gt;<br/>  &lt;xsl:choose&gt;<br/>    &lt;xsl:when test=\"$dudes[not(for $b in @name return $acceptable[m:dude/@name=$b])]\"&gt;<br/>  \t  &lt;xsl:call-template name=\"solve-it\"&gt;<br/>        &lt;xsl:with-param name=\"dudes\" select=\"$new-dudes/m:dude\" /&gt;<br/>        &lt;xsl:with-param name=\"engagements\" select=\"$acceptable\" /&gt; <br/>\t  &lt;/xsl:call-template&gt;<br/>    &lt;/xsl:when&gt;<br/>\t&lt;xsl:otherwise&gt;<br/>      &lt;xsl:copy-of select=\"$acceptable\" /&gt;<br/>\t&lt;/xsl:otherwise&gt;<br/>  &lt;/xsl:choose&gt;<br/>&lt;/xsl:template&gt;<br/>\u00a0<br/>&lt;xsl:function name=\"t:is-stable\" as=\"xs:boolean\"&gt;<br/>  &lt;xsl:param name=\"population\" as=\"element()*\" /&gt;<br/>  &lt;xsl:param name=\"engagements\" as=\"element()*\" /&gt;<br/>  &lt;xsl:sequence select=\"<br/>    every $e in $engagements,<br/>\t      $b in string($e/m:dude/@name), $g in string($e/m:maid/@name),<br/>\t\t  $desired-g in $population/self::m:dude[@name=$b]/m:interest[$g=following-sibling::m:interest],<br/>\t\t  $desired-maid in $population/self::m:maid[@name=$desired-g]<br/>\t  satisfies <br/>          not(<br/>\t\t    $desired-maid/m:interest[.=$b] &amp;lt;&amp;lt;<br/>\t\t    $desired-maid/m:interest[.=$engagements[m:maid[@name=$desired-g]]/m:dude/@name])<br/>  \" /&gt;  <br/>&lt;/xsl:function&gt;  <br/>\u00a0<br/>&lt;/xsl:stylesheet&gt;</pre>"}, {"lang": "zkl", "loc": 62, "block": "<pre class=\"text highlighted_source\">var<br/>   Boys=Dictionary(<br/>      \"abe\", \"abi eve cath ivy jan dee fay bea hope gay\".split(),<br/>      \"bob\", \"cath hope abi dee eve fay bea jan ivy gay\".split(),<br/>      \"col\", \"hope eve abi dee bea fay ivy gay cath jan\".split(),<br/>      \"dan\", \"ivy fay dee gay hope eve jan bea cath abi\".split(),<br/>      \"ed\",  \"jan dee bea cath fay eve abi ivy hope gay\".split(),<br/>      \"fred\",\"bea abi dee gay eve ivy cath jan hope fay\".split(),<br/>      \"gav\", \"gay eve ivy bea cath abi dee hope jan fay\".split(),<br/>      \"hal\", \"abi eve hope fay ivy cath jan bea gay dee\".split(),<br/>      \"ian\", \"hope cath dee gay bea abi fay ivy jan eve\".split(),<br/>      \"jon\", \"abi fay jan gay eve bea dee cath ivy hope\".split(), ),<br/>   Girls=Dictionary(<br/>      \"abi\", \"bob fred jon gav ian abe dan ed col hal\".split(),<br/>      \"bea\", \"bob abe col fred gav dan ian ed jon hal\".split(),<br/>      \"cath\",\"fred bob ed gav hal col ian abe dan jon\".split(),<br/>      \"dee\", \"fred jon col abe ian hal gav dan bob ed\".split(),<br/>      \"eve\", \"jon hal fred dan abe gav col ed ian bob\".split(),<br/>      \"fay\", \"bob abe ed ian jon dan fred gav col hal\".split(),<br/>      \"gay\", \"jon gav hal fred bob abe col ed dan ian\".split(),<br/>      \"hope\",\"gav jon bob abe ian dan hal ed col fred\".split(),<br/>      \"ivy\", \"ian col hal gav fred bob abe ed jon dan\".split(),<br/>      \"jan\", \"ed hal gav abe bob jon col ian fred dan\".split(), ),<br/>   Couples=List();  // ( (boy,girl),(boy,girl),...)<br/>\u00a0<br/>Boyz:=Boys.pump(Dictionary(),fcn([(b,gs)]){ return(b,gs.copy()) }); // make writable copy<br/>while( bgs:=Boyz.filter1( 'wrap([(Boy,gs)]){ // while unattached boy<br/>             gs and (not Couples.filter1(\"holds\",Boy)) <br/>     }) )<br/>{<br/>   Boy,Girl:=bgs; Girl=Girl.pop(0);<br/>   Pair:=Couples.filter1(\"holds\",Girl);  // is Girl part of a couple?<br/>   if(not Pair) Couples.append(List(Boy,Girl));\t# no, Girl was free<br/>   else{\t\t\t  // yes, Girl is engaged to Pair[0]<br/>      bsf,nBoy,nB:=Girls[Girl].index, bsf(Boy),bsf(Pair[0]);<br/>      if(nBoy&lt;nB) Pair[0]=Boy;\t\t# Girl prefers Boy, change Couples<br/>   }<br/>}<br/>foreach Boy,Girl in (Couples){ println(Girl,\" is engaged to \",Boy) }<br/>\u00a0<br/>fcn checkCouples(Couples){<br/>   Couples.filter(fcn([(Boy,Girl)]){<br/>      Girls[Girl].filter1('wrap(B){<br/>         // is B before Boy in Girls preferences?<br/>         bsf,nBoy,nB:=Girls[Girl].index, bsf(Boy),bsf(B);<br/>\t // Does B prefer Girl (over his partner)?<br/>\t _,G:=Couples.filter1(\"holds\",B); // (B,G)<br/>\t gsf,nGirl,nG:=Boys[B].index, gsf(Girl),gsf(G);<br/>\t ( nB&lt;nBoy and nGirl&lt;nG and<br/>\t    println(Girl,\" likes \",B,\" better than \",Boy,\" and \",<br/>                    B,\" likes \",Girl,\" better than \",G) )<br/>      })<br/>   }) or println(\"All marriages are stable\");<br/>}<br/>\u00a0<br/>checkCouples(Couples);<br/>println();<br/>\u00a0<br/>println(\"Engage fred with abi and jon with bea\");<br/>Couples.filter1(\"holds\",\"fred\")[1]=\"abi\";<br/>Couples.filter1(\"holds\",\"jon\") [1]=\"bea\";<br/>checkCouples(Couples);</pre>"}]}